!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=267)}([function(e,t,n){var r=n(5),i=n(38),a=n(25),o=n(26),s=n(32),u="prototype",l=function(e,t,n){var c,f,d,h,v=e&l.F,_=e&l.G,p=e&l.S,m=e&l.P,g=e&l.B,E=_?r:p?r[t]||(r[t]={}):(r[t]||{})[u],y=_?i:i[t]||(i[t]={}),S=y[u]||(y[u]={});_&&(n=t);for(c in n)f=!v&&E&&void 0!==E[c],d=(f?E:n)[c],h=g&&f?s(d,r):m&&"function"==typeof d?s(Function.call,d):d,E&&o(E,c,d,e&l.U),y[c]!=d&&a(y,c,h),m&&S[c]!=d&&(S[c]=d)};r.core=i,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(474),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){var r=n(7);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={ChunkManager:{CHUNK_DOWNLOADED:"chunkDownloaded"},Config:{CONFIG_UPDATED:"configUpdated"},Distributor:{READY:"DISTRIBUTOR_READY"},Metrics:{TRACK_SWITCH:"metricsTrackSwitch"},Media:{ENDED:"mediaEnded"},Scheduler:{REACHED_LIVE_EDGE_STATE_CHANGED:"schedulerReachedLiveEdgeStateChanged"},SRModuleInterface:{ABR_FEEDBACK:"srModuleInterfaceAbrFeedback",UNCOMPLETE_SEGMENT_REQUESTED:"srmoduleinterfaceUncompleteSegmentRequested",SEGMENT_TRANSFERED_TO_MEDIA_ENGINE:"segmentTransferedToMediaEngine"},PeerPool:{PEER_OPEN:"peerpoolPeerOpen",PEER_DESTROYED:"peerpoolPeerDestroyed",PEER_STATS_UPDATE:"peerPoolStat",START_ASKING_PEERS:"startAskingPeers",STOP_ASKING_PEERS:"stopAskingPeers"},BufferManager:{LOW_BUFFER:"buffermanagerLowBuffer",HIGH_BUFFER:"buffermanagerHighBuffer",STATE_CHANGED:"buffermanagerStateChanged"},PeerConnection:{DISCONNECTED:"peerConnectionDisconnected",MESSAGE_RECEIVED:"peerConnectionMessageReceived",BINARY_DATA_RECEIVED:"peerConnectionBinaryDataReceived"},Peer:{PEER_DISCONNECTED:"PeerDisconnected"},UploadQueue:{CHUNK_REQUESTED:"chunkRequested"},P2PCache:{REMOVE_SEGMENT_FROM_CACHE:"removeSegmentFromCache",ATTEMPTED_GC_TRACK_EDGE_FROM_CACHE:"attemptedGCTrackEdgeFromCache"},BufferedAmountObserver:{BUFFER_CHECK:"bufferCheck"},Tracker:{PERM_TRACKER_DISCONNECTION_REQUEST:"permTrackerDisconnectionRequest",TEMP_TRACKER_DISCONNECTION_REQUEST:"tempTrackerDisconnectionRequest",TRACKER_RECONNECTION_REQUEST:"trackerReconnectionRequest"},TrafficAnalytics:{STOP_SENDING_USAGE:"stopSendingUsage",RESTART_SENDING_USAGE:"restartSendingUsage"},Signaling:{PERM_SIGNALING_DISCONNECTION_REQUEST:"permSignalingDisconnectionRequest",TEMP_SIGNALING_DISCONNECTION_REQUEST:"tempSignalingDisconnectionRequest",SIGNALING_RECONNECTION_REQUEST:"signalingReconnectionRequest"}},e.exports=t.default},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(98)("wks"),i=n(55),a=n(5).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";e.exports=0?require("./BrowserError"):n(502)},function(e,t,n){var r=n(22),i=n(8),a=n(48),o=n(53),s="prototype",u=function(e,t,n){var l,c,f,d=e&u.F,h=e&u.G,v=e&u.S,_=e&u.P,p=e&u.B,m=e&u.W,g=h?i:i[t]||(i[t]={}),E=g[s],y=h?r:v?r[t]:(r[t]||{})[s];h&&(n=t);for(l in n)(c=!d&&y&&void 0!==y[l])&&l in g||(f=c?y[l]:n[l],g[l]=h&&"function"!=typeof y[l]?n[l]:p&&c?a(f,r):m&&y[l]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[s]=e[s],t}(f):_&&"function"==typeof f?a(Function.call,f):f,_&&((g.virtual||(g.virtual={}))[l]=f,e&u.R&&E&&!E[l]&&o(E,l,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e,t,n){e.exports=!n(6)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(3),i=n(181),a=n(39),o=Object.defineProperty;t.f=n(12)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(41),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){"use strict";function r(e,t){return new o(e,t,a.TIMER_TYPE.INTERVAL)}function i(e,t){return new o(e,t,a.TIMER_TYPE.TIMEOUT)}Object.defineProperty(t,"__esModule",{value:!0}),t.createInterval=r,t.createTimeout=i;var a=n(216),o=void 0;o=0?require("./BrowserTimer"):n(220).MobileTimer},function(e,t,n){var r=n(40);e.exports=function(e){return Object(r(e))}},function(e,t,n){e.exports={default:n(479),__esModule:!0}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(114),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){var r=n(157)("wks"),i=n(113),a=n(22).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(495),a=r(i),o=n(499),s=r(o),u=n(114),l=r(u);t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,l.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(a.default?(0,a.default)(e,t):e.__proto__=t)}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(13),i=n(54);e.exports=n(12)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(5),i=n(25),a=n(24),o=n(55)("src"),s="toString",u=Function[s],l=(""+u).split(s);n(38).inspectSource=function(e){return u.call(e)},(e.exports=function(e,t,n,s){var u="function"==typeof n;u&&(a(n,"name")||i(n,"name",t)),e[t]!==n&&(u&&(a(n,o)||i(n,o,e[t]?""+e[t]:l.join(String(t)))),e===r?e[t]=n:s?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,s,function(){return"function"==typeof this&&this[o]||u.call(this)})},function(e,t,n){var r=n(0),i=n(6),a=n(40),o=/"/g,s=function(e,t,n,r){var i=String(a(e)),s="<"+t;return""!==n&&(s+=" "+n+'="'+String(r).replace(o,"&quot;")+'"'),s+">"+i+"</"+t+">"};e.exports=function(e,t){var n={};n[e]=t(s),r(r.P+r.F*i(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",n)}},function(e,t,n){e.exports={default:n(545),__esModule:!0}},function(e,t,n){var r=n(81),i=n(40);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(82),i=n(54),a=n(29),o=n(39),s=n(24),u=n(181),l=Object.getOwnPropertyDescriptor;t.f=n(12)?l:function(e,t){if(e=a(e),t=o(t,!0),u)try{return l(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(24),i=n(16),a=n(128)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(18);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){"use strict";var r=n(6);e.exports=function(e,t){return!!e&&r(function(){t?e.call(null,function(){},1):e.call(null)})}},function(e,t,n){var r=n(44),i=n(217),a=n(154),o=Object.defineProperty;t.f=n(36)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){e.exports=!n(65)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){e.exports={default:n(507),__esModule:!0}},function(e,t){var n=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(7);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(0),i=n(38),a=n(6);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t,n){var r=n(32),i=n(81),a=n(16),o=n(14),s=n(145);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,c=4==e,f=6==e,d=5==e||f,h=t||s;return function(t,s,v){for(var _,p,m=a(t),g=i(m),E=r(s,v,3),y=o(g.length),S=0,T=n?h(t,y):u?h(t,0):void 0;y>S;S++)if((d||S in g)&&(_=g[S],p=E(_,S,m),e))if(n)T[S]=p;else if(p)switch(e){case 3:return!0;case 5:return _;case 6:return S;case 2:T.push(_)}else if(c)return!1;return f?-1:l||c?c:T}}},function(e,t,n){var r=n(23);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";if(n(12)){var r=n(56),i=n(5),a=n(6),o=n(0),s=n(108),u=n(151),l=n(32),c=n(62),f=n(54),d=n(25),h=n(64),v=n(41),_=n(14),p=n(207),m=n(58),g=n(39),E=n(24),y=n(83),S=n(7),T=n(16),b=n(142),R=n(59),A=n(31),D=n(60).f,w=n(144),O=n(55),k=n(9),C=n(43),L=n(99),P=n(106),I=n(147),M=n(74),N=n(103),x=n(61),F=n(146),U=n(197),B=n(13),G=n(30),H=B.f,j=G.f,W=i.RangeError,V=i.TypeError,K=i.Uint8Array,Y="ArrayBuffer",q="Shared"+Y,X="BYTES_PER_ELEMENT",z="prototype",Q=Array[z],Z=u.ArrayBuffer,J=u.DataView,$=C(0),ee=C(2),te=C(3),ne=C(4),re=C(5),ie=C(6),ae=L(!0),oe=L(!1),se=I.values,ue=I.keys,le=I.entries,ce=Q.lastIndexOf,fe=Q.reduce,de=Q.reduceRight,he=Q.join,ve=Q.sort,_e=Q.slice,pe=Q.toString,me=Q.toLocaleString,ge=k("iterator"),Ee=k("toStringTag"),ye=O("typed_constructor"),Se=O("def_constructor"),Te=s.CONSTR,be=s.TYPED,Re=s.VIEW,Ae="Wrong length!",De=C(1,function(e,t){return Le(P(e,e[Se]),t)}),we=a(function(){return 1===new K(new Uint16Array([1]).buffer)[0]}),Oe=!!K&&!!K[z].set&&a(function(){new K(1).set({})}),ke=function(e,t){var n=v(e);if(n<0||n%t)throw W("Wrong offset!");return n},Ce=function(e){if(S(e)&&be in e)return e;throw V(e+" is not a typed array!")},Le=function(e,t){if(!(S(e)&&ye in e))throw V("It is not a typed array constructor!");return new e(t)},Pe=function(e,t){return Ie(P(e,e[Se]),t)},Ie=function(e,t){for(var n=0,r=t.length,i=Le(e,r);r>n;)i[n]=t[n++];return i},Me=function(e,t,n){H(e,t,{get:function(){return this._d[n]}})},Ne=function(e){var t,n,r,i,a,o,s=T(e),u=arguments.length,c=u>1?arguments[1]:void 0,f=void 0!==c,d=w(s);if(void 0!=d&&!b(d)){for(o=d.call(s),r=[],t=0;!(a=o.next()).done;t++)r.push(a.value);s=r}for(f&&u>2&&(c=l(c,arguments[2],2)),t=0,n=_(s.length),i=Le(this,n);n>t;t++)i[t]=f?c(s[t],t):s[t];return i},xe=function(){for(var e=0,t=arguments.length,n=Le(this,t);t>e;)n[e]=arguments[e++];return n},Fe=!!K&&a(function(){me.call(new K(1))}),Ue=function(){return me.apply(Fe?_e.call(Ce(this)):Ce(this),arguments)},Be={copyWithin:function(e,t){return U.call(Ce(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return ne(Ce(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return F.apply(Ce(this),arguments)},filter:function(e){return Pe(this,ee(Ce(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return re(Ce(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ie(Ce(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){$(Ce(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return oe(Ce(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return ae(Ce(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return he.apply(Ce(this),arguments)},lastIndexOf:function(e){return ce.apply(Ce(this),arguments)},map:function(e){return De(Ce(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return fe.apply(Ce(this),arguments)},reduceRight:function(e){return de.apply(Ce(this),arguments)},reverse:function(){for(var e,t=this,n=Ce(t).length,r=Math.floor(n/2),i=0;i<r;)e=t[i],t[i++]=t[--n],t[n]=e;return t},some:function(e){return te(Ce(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return ve.call(Ce(this),e)},subarray:function(e,t){var n=Ce(this),r=n.length,i=m(e,r);return new(P(n,n[Se]))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,_((void 0===t?r:m(t,r))-i))}},Ge=function(e,t){return Pe(this,_e.call(Ce(this),e,t))},He=function(e){Ce(this);var t=ke(arguments[1],1),n=this.length,r=T(e),i=_(r.length),a=0;if(i+t>n)throw W(Ae);for(;a<i;)this[t+a]=r[a++]},je={entries:function(){return le.call(Ce(this))},keys:function(){return ue.call(Ce(this))},values:function(){return se.call(Ce(this))}},We=function(e,t){return S(e)&&e[be]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ve=function(e,t){return We(e,t=g(t,!0))?f(2,e[t]):j(e,t)},Ke=function(e,t,n){return!(We(e,t=g(t,!0))&&S(n)&&E(n,"value"))||E(n,"get")||E(n,"set")||n.configurable||E(n,"writable")&&!n.writable||E(n,"enumerable")&&!n.enumerable?H(e,t,n):(e[t]=n.value,e)};Te||(G.f=Ve,B.f=Ke),o(o.S+o.F*!Te,"Object",{getOwnPropertyDescriptor:Ve,defineProperty:Ke}),a(function(){pe.call({})})&&(pe=me=function(){return he.call(this)});var Ye=h({},Be);h(Ye,je),d(Ye,ge,je.values),h(Ye,{slice:Ge,set:He,constructor:function(){},toString:pe,toLocaleString:Ue}),Me(Ye,"buffer","b"),Me(Ye,"byteOffset","o"),Me(Ye,"byteLength","l"),Me(Ye,"length","e"),H(Ye,Ee,{get:function(){return this[be]}}),e.exports=function(e,t,n,u){u=!!u;var l=e+(u?"Clamped":"")+"Array",f="get"+e,h="set"+e,v=i[l],m=v||{},g=v&&A(v),E=!v||!s.ABV,T={},b=v&&v[z],w=function(e,n){var r=e._d;return r.v[f](n*t+r.o,we)},O=function(e,n,r){var i=e._d;u&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),i.v[h](n*t+i.o,r,we)},k=function(e,t){H(e,t,{get:function(){return w(this,t)},set:function(e){return O(this,t,e)},enumerable:!0})};E?(v=n(function(e,n,r,i){c(e,v,l,"_d");var a,o,s,u,f=0,h=0;if(S(n)){if(!(n instanceof Z||(u=y(n))==Y||u==q))return be in n?Ie(v,n):Ne.call(v,n);a=n,h=ke(r,t);var m=n.byteLength;if(void 0===i){if(m%t)throw W(Ae);if((o=m-h)<0)throw W(Ae)}else if((o=_(i)*t)+h>m)throw W(Ae);s=o/t}else s=p(n),o=s*t,a=new Z(o);for(d(e,"_d",{b:a,o:h,l:o,e:s,v:new J(a)});f<s;)k(e,f++)}),b=v[z]=R(Ye),d(b,"constructor",v)):a(function(){v(1)})&&a(function(){new v(-1)})&&N(function(e){new v,new v(null),new v(1.5),new v(e)},!0)||(v=n(function(e,n,r,i){c(e,v,l);var a;return S(n)?n instanceof Z||(a=y(n))==Y||a==q?void 0!==i?new m(n,ke(r,t),i):void 0!==r?new m(n,ke(r,t)):new m(n):be in n?Ie(v,n):Ne.call(v,n):new m(p(n))}),$(g!==Function.prototype?D(m).concat(D(g)):D(m),function(e){e in v||d(v,e,m[e])}),v[z]=b,r||(b.constructor=v));var C=b[ge],L=!!C&&("values"==C.name||void 0==C.name),P=je.values;d(v,ye,!0),d(b,be,l),d(b,Re,!0),d(b,Se,v),(u?new v(1)[Ee]==l:Ee in b)||H(b,Ee,{get:function(){return l}}),T[l]=v,o(o.G+o.W+o.F*(v!=m),T),o(o.S,l,{BYTES_PER_ELEMENT:t}),o(o.S+o.F*a(function(){m.of.call(v,1)}),l,{from:Ne,of:xe}),X in b||d(b,X,t),o(o.P,l,Be),x(l),o(o.P+o.F*Oe,l,{set:He}),o(o.P+o.F*!L,l,je),r||b.toString==pe||(b.toString=pe),o(o.P+o.F*a(function(){new v(1).slice()}),l,{slice:Ge}),o(o.P+o.F*(a(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!a(function(){b.toLocaleString.call([1,2])})),l,{toLocaleString:Ue}),M[l]=L?C:P,r||L||d(b,ge,P)}}else e.exports=function(){}},function(e,t,n){var r=n(202),i=n(0),a=n(98)("metadata"),o=a.store||(a.store=new(n(205))),s=function(e,t,n){var i=o.get(e);if(!i){if(!n)return;o.set(e,i=new r)}var a=i.get(t);if(!a){if(!n)return;i.set(t,a=new r)}return a},u=function(e,t,n){var r=s(t,n,!1);return void 0!==r&&r.has(e)},l=function(e,t,n){var r=s(t,n,!1);return void 0===r?void 0:r.get(e)},c=function(e,t,n,r){s(n,r,!0).set(e,t)},f=function(e,t){var n=s(e,t,!1),r=[];return n&&n.forEach(function(e,t){r.push(t)}),r},d=function(e){return void 0===e||"symbol"==typeof e?e:String(e)},h=function(e){i(i.S,"Reflect",e)};e.exports={store:o,map:s,has:u,get:l,set:c,keys:f,key:d,exp:h}},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function isAndroid(){return"android"===_platform2.default.get()}function androidInterface(e){switch(e){case"error":return AndroidError;case"log":return AndroidLog;case"peer_agent_loaded":return AndroidPeerAgent;case"truncated_manifest_notification":return AndroidManifest;case"get_segment_success_notification":case"get_segment_error_notification":case"segment_created":case"destroy_segment":case"set_binary_data":case"get_binary_data":case"set_segment_complete":return AndroidBinary;case"send_http_request":case"abort_http_request":return AndroidHttp;case"set_timer":case"clear_timer":return AndroidTimer;case"call_hash_worker":return AndroidHash;case"peer_connector_init_notification":case"signaling_create_peer_connection":return AndroidSignaling;case"peer_connection_send_message":case"peer_connection_send_data":case"peer_connection_close":return AndroidPeerConnection;default:return null}}function androidCall(e,t){var n=androidInterface(e);n?t?n[e]((0,_stringify2.default)(t)):n[e]():AndroidError.error(e+" not supported.")}function iosCall(method,args){eval("ios_call_"+method+"("+(0,_stringify2.default)(args)+");")}function nativeCall(e,t){1&&(isAndroid()?androidCall(e,t):iosCall(e,t))}function nativeLog(e){nativeCall("log",e)}function nativeError(e){e instanceof Error?nativeCall("error",e.name+": "+e.message+"\n"+e.stack):nativeCall("error",e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.nativeError=exports.nativeLog=exports.nativeCall=void 0;var _stringify=__webpack_require__(84),_stringify2=_interopRequireDefault(_stringify),_platform=__webpack_require__(215),_platform2=_interopRequireDefault(_platform);exports.nativeCall=nativeCall,exports.nativeLog=nativeLog,exports.nativeError=nativeError},function(e,t,n){var r=n(85);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(){this._events=new r,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,s="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),a.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e,t){var n=s?s+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},a.prototype.emit=function(e,t,n,r,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var u,l,c=this._events[o],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,a),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var d,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,r);break;default:if(!u)for(d=1,u=new Array(f-1);d<f;d++)u[d-1]=arguments[d];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(e,t,n){var r=new i(t,n||this),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.once=function(e,t,n){var r=new i(t,n||this,!0),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.removeListener=function(e,t,n,i){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return 0==--this._eventsCount?this._events=new r:delete this._events[a],this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||(0==--this._eventsCount?this._events=new r:delete this._events[a]);else{for(var u=0,l=[],c=o.length;u<c;u++)(o[u].fn!==t||i&&!o[u].once||n&&o[u].context!==n)&&l.push(o[u]);l.length?this._events[a]=1===l.length?l[0]:l:0==--this._eventsCount?this._events=new r:delete this._events[a]}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=s,a.EventEmitter=a,0||(e.exports=a)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return"number"==typeof e&&!isNaN(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isNumeric=t.Delta=void 0;var a=n(1),o=r(a),s=n(2),u=r(s),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,o.default)(this,e),this._lastDeltaValue=t}return(0,u.default)(e,[{key:"calcDelta",value:function(e){var t=e-this._lastDeltaValue;return this._lastDeltaValue=e,t}}]),e}();t.Delta=l,t.isNumeric=i},function(e,t,n){var r=n(55)("meta"),i=n(7),a=n(24),o=n(13).f,s=0,u=Object.isExtensible||function(){return!0},l=!n(6)(function(){return u(Object.preventExtensions({}))}),c=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},f=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[r].i},d=function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[r].w},h=function(e){return l&&v.NEED&&u(e)&&!a(e,r)&&c(e),e},v=e.exports={KEY:r,NEED:!1,fastKey:f,getWeak:d,onFreeze:h}},function(e,t,n){var r=n(9)("unscopables"),i=Array.prototype;void 0==i[r]&&n(25)(i,r,{}),e.exports=function(e){i[r][e]=!0}},function(e,t,n){var r=n(35),i=n(86);e.exports=n(36)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=!1},function(e,t,n){var r=n(183),i=n(129);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(41),i=Math.max,a=Math.min;e.exports=function(e,t){return e=r(e),e<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(3),i=n(184),a=n(129),o=n(128)("IE_PROTO"),s=function(){},u="prototype",l=function(){var e,t=n(126)("iframe"),r=a.length,i="<",o=">";for(t.style.display="none",n(130).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(i+"script"+o+"document.F=Object"+i+"/script"+o),e.close(),l=e.F;r--;)delete l[u][a[r]];return l()};e.exports=Object.create||function(e,t){var n;return null!==e?(s[u]=r(e),n=new s,s[u]=null,n[o]=e):n=l(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(183),i=n(129).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){"use strict";var r=n(5),i=n(13),a=n(12),o=n(9)("species");e.exports=function(e){var t=r[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(32),i=n(195),a=n(142),o=n(3),s=n(14),u=n(144),l={},c={},t=e.exports=function(e,t,n,f,d){var h,v,_,p,m=d?function(){return e}:u(e),g=r(n,f,t?2:1),E=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(a(m)){for(h=s(e.length);h>E;E++)if((p=t?g(o(v=e[E])[0],v[1]):g(e[E]))===l||p===c)return p}else for(_=m.call(e);!(v=_.next()).done;)if((p=i(_,g,v.value,t))===l||p===c)return p};t.BREAK=l,t.RETURN=c},function(e,t,n){var r=n(26);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){"use strict";var r=n(483)(!0);n(159)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(160),i=n(155);e.exports=function(e){return r(i(e))}},function(e,t,n){e.exports={default:n(504),__esModule:!0}},function(e,t,n){"use strict";function r(e,t){return parseFloat(e.toFixed(t))}function i(e,t){for(var n=[],r=t>=e?1:-1,i=Math.min(e*r,t*r),a=Math.max(e*r,t*r),o=i;o<=a;o++)n.push(o*r);return n}function a(e,t,n){return Math.min(Math.max(e,t),n)}Object.defineProperty(t,"__esModule",{value:!0}),t.toDecimal=r,t.range=i,t.clamp=a},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(13).f,i=n(24),a=n(9)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){var r=n(0),i=n(40),a=n(6),o=n(132),s="["+o+"]",u="​",l=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),f=function(e,t,n){var i={},s=a(function(){return!!o[e]()||u[e]()!=u}),l=i[e]=s?t(d):o[e];n&&(i[n]=l),r(r.P+r.F*s,"String",i)},d=f.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(c,"")),e};e.exports=f},function(e,t){e.exports={}},function(e,t,n){var r=n(7);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){var r=n(155);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(11),i=n(8),a=n(65);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t){e.exports={}},function(e,t,n){var r=n(224),i=n(161);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){n(487);for(var r=n(22),i=n(53),a=n(78),o=n(20)("toStringTag"),s=("CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,"+"DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,"+"MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,"+"SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,"+"TextTrackList,TouchList").split(","),u=0;u<s.length;u++){var l=s[u],c=r[l],f=c&&c.prototype;f&&!f[o]&&i(f,o,l),a[l]=a.Array}},function(e,t,n){var r=n(33);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(33),i=n(9)("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=o(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,n){e.exports={default:n(471),__esModule:!0}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(35).f,i=n(66),a=n(20)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){var r=n(113)("meta"),i=n(23),a=n(66),o=n(35).f,s=0,u=Object.isExtensible||function(){return!0},l=!n(65)(function(){return u(Object.preventExtensions({}))}),c=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},f=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[r].i},d=function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[r].w},h=function(e){return l&&v.NEED&&u(e)&&!a(e,r)&&c(e),e},v=e.exports={KEY:r,NEED:!1,fastKey:f,getWeak:d,onFreeze:h}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(37),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=function(){function e(){(0,s.default)(this,e),this._scopes=new a.default}return(0,l.default)(e,[{key:"add",value:function(e,t,n){this._scopes.has(e)||this._scopes.set(e,new a.default);var r=this._scopes.get(e);r&&r.set(t,n)}},{key:"remove",value:function(e,t){var n=this._scopes.get(e);return!!n&&n.delete(t)}},{key:"removeAll",value:function(){this._scopes.clear()}},{key:"get",value:function(e,t){var n=this._scopes.get(e);return n&&n.has(t)?n.get(t):null}},{key:"count",value:function(e){var t=this._scopes.get(e);return t?t.size:0}}]),e}();t.default=new c,e.exports=t.default},function(e,t,n){var r=n(48),i=n(233),a=n(234),o=n(44),s=n(117),u=n(167),l={},c={},t=e.exports=function(e,t,n,f,d){var h,v,_,p,m=d?function(){return e}:u(e),g=r(n,f,t?2:1),E=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(a(m)){for(h=s(e.length);h>E;E++)if((p=t?g(o(v=e[E])[0],v[1]):g(e[E]))===l||p===c)return p}else for(_=m.call(e);!(v=_.next()).done;)if((p=i(_,g,v.value,t))===l||p===c)return p};t.BREAK=l,t.RETURN=c},function(e,t,n){"use strict";e.exports=0?require("./BrowserHttpRequest"):n(516)},function(e,t,n){"use strict";t.__esModule=!0;var r=n(121),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(37),s=r(o),u=n(1),l=r(u),c=n(2),f=r(c),d=n(10),h=r(d),v=function(){function e(){(0,l.default)(this,e),this._timers=new s.default}return(0,f.default)(e,[{key:"register",value:function(e){var t=e.name;return!this._timers.has(t)&&(this._timers.set(t,e),!0)}},{key:"registerAs",value:function(e,t){return!this._timers.has(e)&&(t.name=e,this._timers.set(e,t),!0)}},{key:"clear",value:function(e){return!!e&&this.clearNamedTimer(e.name)}},{key:"clearNamedTimer",value:function(e){var t=this._timers.get(e);return!!t&&(t.clear(),this._timers.delete(t.name))}},{key:"clearAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this._timers.values());!(e=(r=i.next()).done);e=!0){var o=r.value;this.clear(o)||h.default.notify("Cannot remove timer","Timer "+o.id+" was not found in timers map.")}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){e.exports={default:n(555),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u="Unvalid weight parameter for EMWA: must be an number in ]0,1[",l=function(){function e(t,n){if((0,a.default)(this,e),n<=0||n>=1)throw new Error(u);this._emwaValue=t,this._weight=n}return(0,s.default)(e,[{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null!==t?t:this._weight;this._emwaValue=(1-n)*this._emwaValue+n*e}},{key:"value",get:function(){return this._emwaValue}}],[{key:"Errors",value:function(){return{UNVALID_WEIGHT:u}}},{key:"fromHalfLife",value:function(t,n,r){return new e(t,this.halfLifeToEMAWeight(n,r))}},{key:"halfLifeToEMAWeight",value:function(e,t){var n=e/t;return 1-1/Math.pow(2,1/n)}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){var r=n(5),i="__core-js_shared__",a=r[i]||(r[i]={});e.exports=function(e){return a[e]||(a[e]={})}},function(e,t,n){var r=n(29),i=n(14),a=n(58);e.exports=function(e){return function(t,n,o){var s,u=r(t),l=i(u.length),c=a(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(33);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(7),i=n(33),a=n(9)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==i(e))}},function(e,t,n){var r=n(9)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(3);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,n){"use strict";var r=n(25),i=n(26),a=n(6),o=n(40),s=n(9);e.exports=function(e,t,n){var u=s(e),l=n(o,u,""[e]),c=l[0],f=l[1];a(function(){var t={};return t[u]=function(){return 7},7!=""[e](t)})&&(i(String.prototype,e,c),r(RegExp.prototype,u,2==t?function(e,t){return f.call(e,this,t)}:function(e){return f.call(e,this)}))}},function(e,t,n){var r=n(3),i=n(18),a=n(9)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||void 0==(n=r(o)[a])?t:i(n)}},function(e,t,n){"use strict";var r=n(5),i=n(0),a=n(26),o=n(64),s=n(51),u=n(63),l=n(62),c=n(7),f=n(6),d=n(103),h=n(72),v=n(133);e.exports=function(e,t,n,_,p,m){var g=r[e],E=g,y=p?"set":"add",S=E&&E.prototype,T={},b=function(e){var t=S[e];a(S,e,"delete"==e?function(e){return!(m&&!c(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(m&&!c(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return m&&!c(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof E&&(m||S.forEach&&!f(function(){(new E).entries().next()}))){var R=new E,A=R[y](m?{}:-0,1)!=R,D=f(function(){R.has(1)}),w=d(function(e){new E(e)}),O=!m&&f(function(){for(var e=new E,t=5;t--;)e[y](t,t);return!e.has(-0)});w||(E=t(function(t,n){l(t,E,e);var r=v(new g,t,E);return void 0!=n&&u(n,p,r[y],r),r}),E.prototype=S,S.constructor=E),(D||O)&&(b("delete"),b("has"),p&&b("get")),(O||A)&&b(y),m&&S.clear&&delete S.clear}else E=_.getConstructor(t,e,p,y),o(E.prototype,n),s.NEED=!0;return h(E,e),T[e]=E,i(i.G+i.W+i.F*(E!=g),T),m||_.setStrong(E,e,p),E}},function(e,t,n){for(var r,i=n(5),a=n(25),o=n(55),s=o("typed_array"),u=o("view"),l=!(!i.ArrayBuffer||!i.DataView),c=l,f=0,d=9,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");f<d;)(r=i[h[f++]])?(a(r.prototype,s,!0),a(r.prototype,u,!0)):c=!1;e.exports={ABV:l,CONSTR:c,TYPED:s,VIEW:u}},function(e,t,n){"use strict";e.exports=n(56)||!n(6)(function(){var e=Math.random();__defineSetter__.call(null,e,function(){}),delete n(5)[e]})},function(e,t,n){"use strict";var r=n(0);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var r=n(0),i=n(18),a=n(32),o=n(63);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,s,u=arguments[1];return i(this),t=void 0!==u,t&&i(u),void 0==e?new this:(n=[],t?(r=0,s=a(u,arguments[2],2),o(e,!1,function(e){n.push(s(e,r++))})):o(e,!1,n.push,n),new this(n))}})}},function(e,t,n){var r=n(477),i=n(478),a=i;a.v1=r,a.v4=i,e.exports=a},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(481),a=r(i),o=n(489),s=r(o),u="function"==typeof s.default&&"symbol"==typeof a.default?function(e){return typeof e}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":typeof e};t.default="function"==typeof s.default&&"symbol"===u(a.default)?function(e){return void 0===e?"undefined":u(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":u(e)}},function(e,t){e.exports=!0},function(e,t,n){var r=n(44),i=n(223),a=n(161),o=n(156)("IE_PROTO"),s=function(){},u="prototype",l=function(){var e,t=n(153)("iframe"),r=a.length,i="<",o=">";for(t.style.display="none",n(225).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(i+"script"+o+"document.F=Object"+i+"/script"+o),e.close(),l=e.F;r--;)delete l[u][a[r]];return l()};e.exports=Object.create||function(e,t){var n;return null!==e?(s[u]=r(e),n=new s,s[u]=null,n[o]=e):n=l(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(158),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t){},function(e,t,n){var r=n(87),i=n(20)("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=o(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.level=t.level,this.urlId=t.urlId,this.bitrate=t.bitrate}return i(e,[{key:"viewToString",value:function(){return"L"+this.level+"U"+this.urlId}},{key:"isEqual",value:function(e){return!!e&&(e.level===this.level&&e.urlId===this.urlId)}},{key:"type",get:function(){return"video"}}]),e}();t.default=a,e.exports=t.default},function(e,t,n){e.exports={default:n(524),__esModule:!0}},function(e,t,n){e.exports={default:n(534),__esModule:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="safe",i="unsafe",a={SAFE:r,UNSAFE:i};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=e.prototype,r=!0,i=!1,o=void 0;try{for(var s,u=(0,h.default)(a(n));!(r=(s=u.next()).done);r=!0){var l=s.value;if((0,f.default)(t[l])!==(0,f.default)(n[l])){var c=t.constructor.name;throw new Error("The method "+l+" of "+e.name+" is not defined in "+c)}}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}}function a(e){var t=(0,l.default)(e).filter(function(e){return"constructor"!==e}),n=Object.prototype;if((0,s.default)(e)===n)return t;var r=(0,s.default)(e);return t.concat(a(r))}Object.defineProperty(t,"__esModule",{value:!0}),t._getEveryPropertyNames=t.checkInterface=void 0;var o=n(17),s=r(o),u=n(247),l=r(u),c=n(114),f=r(c),d=n(28),h=r(d);t.checkInterface=i,t._getEveryPropertyNames=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.assertStreamType=t.StreamTypes=void 0;var i=n(565),a=r(i),o=n(122),s=r(o),u={HLS:"hls",DASH:"dash",SMOOTH:"smooth"};(0,s.default)(u);var l=function(e){if(-1===(0,a.default)(u).indexOf(e))throw new TypeError("'"+e+"' is not a valid value for stream type.")};t.StreamTypes=u,t.assertStreamType=l},function(e,t,n){var r=n(7),i=n(5).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){var r=n(5),i=n(38),a=n(56),o=n(182),s=n(13).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,n){var r=n(98)("keys"),i=n(55);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(5).document;e.exports=r&&r.documentElement},function(e,t,n){var r=n(7),i=n(3),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{r=n(32)(Function.call,n(30).f(Object.prototype,"__proto__").set,2),r(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},function(e,t){e.exports="\t\n\v\f\r   ᠎    "+"         　\u2028\u2029\ufeff"},function(e,t,n){var r=n(7),i=n(131).set;e.exports=function(e,t,n){var a,o=t.constructor;return o!==n&&"function"==typeof o&&(a=o.prototype)!==n.prototype&&r(a)&&i&&i(e,a),e}},function(e,t,n){"use strict";var r=n(41),i=n(40);e.exports=function(e){var t=String(i(this)),n="",a=r(e);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},function(e,t){var n=Math.expm1;e.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},function(e,t,n){var r=n(41),i=n(40);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(a=s.charCodeAt(u),a<55296||a>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):(a-55296<<10)+(o-56320)+65536)}}},function(e,t,n){"use strict";var r=n(56),i=n(0),a=n(26),o=n(25),s=n(24),u=n(74),l=n(139),c=n(72),f=n(31),d=n(9)("iterator"),h=!([].keys&&"next"in[].keys()),v="keys",_="values",p=function(){return this};e.exports=function(e,t,n,m,g,E,y){l(n,t,m);var S,T,b,R=function(e){if(!h&&e in O)return O[e];switch(e){case v:case _:return function(){return new n(this,e)}}return function(){return new n(this,e)}},A=t+" Iterator",D=g==_,w=!1,O=e.prototype,k=O[d]||O["@@iterator"]||g&&O[g],C=k||R(g),L=g?D?R("entries"):C:void 0,P="Array"==t?O.entries||k:k;if(P&&(b=f(P.call(new e)))!==Object.prototype&&b.next&&(c(b,A,!0),r||s(b,d)||o(b,d,p)),D&&k&&k.name!==_&&(w=!0,C=function(){return k.call(this)}),r&&!y||!h&&!w&&O[d]||o(O,d,C),u[t]=C,u[A]=p,g)if(S={values:D?C:R(_),keys:E?C:R(v),entries:L},y)for(T in S)T in O||a(O,T,S[T]);else i(i.P+i.F*(h||w),t,S);return S}},function(e,t,n){"use strict";var r=n(59),i=n(54),a=n(72),o={};n(25)(o,n(9)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(102),i=n(40);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(i(e))}},function(e,t,n){var r=n(9)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,n){var r=n(74),i=n(9)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){"use strict";var r=n(13),i=n(54);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(83),i=n(9)("iterator"),a=n(74);e.exports=n(38).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){var r=n(360);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){"use strict";var r=n(16),i=n(58),a=n(14);e.exports=function(e){for(var t=r(this),n=a(t.length),o=arguments.length,s=i(o>1?arguments[1]:void 0,n),u=o>2?arguments[2]:void 0,l=void 0===u?n:i(u,n);l>s;)t[s++]=e;return t}},function(e,t,n){"use strict";var r=n(52),i=n(198),a=n(74),o=n(29);e.exports=n(138)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t,n){var r,i,a,o=n(32),s=n(188),u=n(130),l=n(126),c=n(5),f=c.process,d=c.setImmediate,h=c.clearImmediate,v=c.MessageChannel,_=c.Dispatch,p=0,m={},g="onreadystatechange",E=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},y=function(e){E.call(e.data)};d&&h||(d=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++p]=function(){s("function"==typeof e?e:Function(e),t)},r(p),p},h=function(e){delete m[e]},"process"==n(33)(f)?r=function(e){f.nextTick(o(E,e,1))}:_&&_.now?r=function(e){_.now(o(E,e,1))}:v?(i=new v,a=i.port2,i.port1.onmessage=y,r=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",y,!1)):r=g in l("script")?function(e){u.appendChild(l("script"))[g]=function(){u.removeChild(this),E.call(e)}}:function(e){setTimeout(o(E,e,1),0)}),e.exports={set:d,clear:h}},function(e,t,n){var r=n(5),i=n(148).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(33)(o);e.exports=function(){var e,t,n,l=function(){var r,i;for(u&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(l)};else if(a){var c=!0,f=document.createTextNode("");new a(l).observe(f,{characterData:!0}),n=function(){f.data=c=!c}}else if(s&&s.resolve){var d=s.resolve();n=function(){d.then(l)}}else n=function(){i.call(r,l)};return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";function r(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=i(t),this.reject=i(n)}var i=n(18);e.exports.f=function(e){return new r(e)}},function(e,t,n){"use strict";function r(e,t,n){var r,i,a,o=Array(n),s=8*n-t-1,u=(1<<s)-1,l=u>>1,c=23===t?G(2,-24)-G(2,-77):0,f=0,d=e<0||0===e&&1/e<0?1:0;for(e=B(e),e!=e||e===F?(i=e!=e?1:0,r=u):(r=H(j(e)/W),e*(a=G(2,-r))<1&&(r--,a*=2),e+=r+l>=1?c/a:c*G(2,1-l),e*a>=2&&(r++,a/=2),r+l>=u?(i=0,r=u):r+l>=1?(i=(e*a-1)*G(2,t),r+=l):(i=e*G(2,l-1)*G(2,t),r=0));t>=8;o[f++]=255&i,i/=256,t-=8);for(r=r<<t|i,s+=t;s>0;o[f++]=255&r,r/=256,s-=8);return o[--f]|=128*d,o}function i(e,t,n){var r,i=8*n-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=n-1,l=e[u--],c=127&l;for(l>>=7;s>0;c=256*c+e[u],u--,s-=8);for(r=c&(1<<-s)-1,c>>=-s,s+=t;s>0;r=256*r+e[u],u--,s-=8);if(0===c)c=1-o;else{if(c===a)return r?NaN:l?-F:F;r+=G(2,t),c-=o}return(l?-1:1)*r*G(2,c-t)}function a(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function o(e){return[255&e]}function s(e){return[255&e,e>>8&255]}function u(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function l(e){return r(e,52,8)}function c(e){return r(e,23,4)}function f(e,t,n){D(e[L],t,{get:function(){return this[n]}})}function d(e,t,n,r){var i=+n,a=R(i);if(a+t>e[X])throw x(P);var o=e[q]._b,s=a+e[z],u=o.slice(s,s+t);return r?u:u.reverse()}function h(e,t,n,r,i,a){var o=+n,s=R(o);if(s+t>e[X])throw x(P);for(var u=e[q]._b,l=s+e[z],c=r(+i),f=0;f<t;f++)u[l+f]=c[a?f:t-f-1]}var v=n(5),_=n(12),p=n(56),m=n(108),g=n(25),E=n(64),y=n(6),S=n(62),T=n(41),b=n(14),R=n(207),A=n(60).f,D=n(13).f,w=n(146),O=n(72),k="ArrayBuffer",C="DataView",L="prototype",P="Wrong index!",I=v[k],M=v[C],N=v.Math,x=v.RangeError,F=v.Infinity,U=I,B=N.abs,G=N.pow,H=N.floor,j=N.log,W=N.LN2,V="buffer",K="byteLength",Y="byteOffset",q=_?"_b":V,X=_?"_l":K,z=_?"_o":Y;if(m.ABV){if(!y(function(){I(1)})||!y(function(){new I(-1)})||y(function(){return new I,new I(1.5),new I(NaN),I.name!=k})){I=function(e){return S(this,I),new U(R(e))};for(var Q,Z=I[L]=U[L],J=A(U),$=0;J.length>$;)(Q=J[$++])in I||g(I,Q,U[Q]);p||(Z.constructor=I)}var ee=new M(new I(2)),te=M[L].setInt8;ee.setInt8(0,2147483648),ee.setInt8(1,2147483649),!ee.getInt8(0)&&ee.getInt8(1)||E(M[L],{setInt8:function(e,t){te.call(this,e,t<<24>>24)},setUint8:function(e,t){te.call(this,e,t<<24>>24)}},!0)}else I=function(e){S(this,I,k);var t=R(e);this._b=w.call(Array(t),0),this[X]=t},M=function(e,t,n){S(this,M,C),S(e,I,C);var r=e[X],i=T(t);if(i<0||i>r)throw x("Wrong offset!");if(n=void 0===n?r-i:b(n),i+n>r)throw x("Wrong length!");this[q]=e,this[z]=i,this[X]=n},_&&(f(I,K,"_l"),f(M,V,"_b"),f(M,K,"_l"),f(M,Y,"_o")),E(M[L],{getInt8:function(e){return d(this,1,e)[0]<<24>>24},getUint8:function(e){return d(this,1,e)[0]},getInt16:function(e){var t=d(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=d(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return a(d(this,4,e,arguments[1]))},getUint32:function(e){return a(d(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return i(d(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return i(d(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){h(this,1,e,o,t)},setUint8:function(e,t){h(this,1,e,o,t)},setInt16:function(e,t){h(this,2,e,s,t,arguments[2])},setUint16:function(e,t){h(this,2,e,s,t,arguments[2])},setInt32:function(e,t){h(this,4,e,u,t,arguments[2])},setUint32:function(e,t){h(this,4,e,u,t,arguments[2])},setFloat32:function(e,t){h(this,4,e,c,t,arguments[2])},setFloat64:function(e,t){h(this,8,e,l,t,arguments[2])}});O(I,k),O(M,C),g(M[L],m.VIEW,!0),t[k]=I,t[C]=M},function(e,t,n){"use strict";function r(){var e=window&&window.navigator?window.navigator.userAgent:"";return(new o.default).setUA(e).getResult()}function i(){var e=r();return"mobile"===e.device.type||"tablet"===e.device.type||"console"===e.device.type||"Android"===e.os.name||"iOS"===e.os.name}Object.defineProperty(t,"__esModule",{value:!0});var a=n(472),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={getUAObject:r,isMobile:i},e.exports=t.default},function(e,t,n){var r=n(23),i=n(22).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){var r=n(23);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(157)("keys"),i=n(113);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(22),i="__core-js_shared__",a=r[i]||(r[i]={});e.exports=function(e){return a[e]||(a[e]={})}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){"use strict";var r=n(115),i=n(11),a=n(222),o=n(53),s=n(66),u=n(78),l=n(484),c=n(88),f=n(221),d=n(20)("iterator"),h=!([].keys&&"next"in[].keys()),v="keys",_="values",p=function(){return this};e.exports=function(e,t,n,m,g,E,y){l(n,t,m);var S,T,b,R=function(e){if(!h&&e in O)return O[e];switch(e){case v:case _:return function(){return new n(this,e)}}return function(){return new n(this,e)}},A=t+" Iterator",D=g==_,w=!1,O=e.prototype,k=O[d]||O["@@iterator"]||g&&O[g],C=k||R(g),L=g?D?R("entries"):C:void 0,P="Array"==t?O.entries||k:k;if(P&&(b=f(P.call(new e)))!==Object.prototype&&b.next&&(c(b,A,!0),r||s(b,d)||o(b,d,p)),D&&k&&k.name!==_&&(w=!0,C=function(){return k.call(this)}),r&&!y||!h&&!w&&O[d]||o(O,d,C),u[t]=C,u[A]=p,g)if(S={values:D?C:R(_),keys:E?C:R(v),entries:L},y)for(T in S)T in O||a(O,T,S[T]);else i(i.P+i.F*(h||w),t,S);return S}},function(e,t,n){var r=n(87);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){t.f=n(20)},function(e,t,n){var r=n(22),i=n(8),a=n(115),o=n(162),s=n(35).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(53);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(119),i=n(20)("iterator"),a=n(78);e.exports=n(8).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){var r=n(23);e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(120),s=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(){function e(t){r(this,e),this.sn=t.sn,this.trackView=new s.default(t.trackView),this.time=t.time}return a(e,null,[{key:"fromArrayBuffer",value:function(t){var n=new Uint32Array(t),r=i(n,3),a=r[0],o=r[1],u=r[2];return new e({trackView:new s.default({level:a,urlId:o}),sn:u})}}]),a(e,[{key:"isEqual",value:function(e){if(!e)return!1;var t=e.sn,n=e.trackView;return this.sn===t&&this.trackView.isEqual(n)}},{key:"isInTrack",value:function(e){return this.trackView.isEqual(e)}},{key:"viewToString",value:function(){return this.trackView.viewToString()+"S"+this.sn}},{key:"toArrayBuffer",value:function(){var e=this.trackView,t=e.level,n=e.urlId;return new Uint32Array([t,n,this.sn]).buffer}},{key:"getId",value:function(){return this.sn}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=i(t),this.reject=i(n)}var i=n(85);e.exports.f=function(e){return new r(e)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return(0,S.default)(e,t)}function a(e){(0,E.default)(e);for(var t=(0,m.default)(e),n=0;n<t.length;n++){var r=t[n],i=e[r];null===i||"object"!==(void 0===i?"undefined":(0,_.default)(i))||(0,h.default)(i)||a(i)}}function o(e,t){for(var n={},r=(0,f.default)(e),i=0;i<r.length;i++){var a=r[i];t!==a&&(n[a]=e[a])}return n}function s(e){return JSON.parse((0,l.default)(e))}Object.defineProperty(t,"__esModule",{value:!0});var u=n(84),l=r(u),c=n(172),f=r(c),d=n(529),h=r(d),v=n(114),_=r(v),p=n(247),m=r(p),g=n(122),E=r(g),y=n(69),S=r(y);t.default={merge:i,deepFreeze:a,omit:o,deepCopy:s},e.exports=t.default},function(e,t,n){e.exports={default:n(527),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t,n){if((0,a.default)(this,e),!(t instanceof String||"number"==typeof n))throw new TypeError("Wrong parameter");this.id=t,this.byteLength=n}return(0,s.default)(e,[{key:"slice",value:function(e,t){if((void 0===e||0===e)&&void 0===t)return this;throw new Error("slice is not supported with those arguments")}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u="Method not implemented",l=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getUpdatedRange",value:function(e){throw new Error(u)}},{key:"getFullSegment",value:function(e,t,n){throw new Error(u)}},{key:"isComplete",value:function(){throw new Error(u)}},{key:"isLocked",value:function(){throw new Error(u)}},{key:"p2pSpeed",get:function(){throw new Error(u)}},{key:"p2pAmount",get:function(){throw new Error(u)}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"isEqual",value:function(e){return!0}},{key:"viewToString",value:function(){return""}},{key:"toArrayBuffer",value:function(){return new ArrayBuffer(0)}},{key:"isInTrack",value:function(e){return!1}},{key:"getId",value:function(){return 0}}],[{key:"fromArrayBuffer",value:function(t){return new e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(84),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(575),f=r(c),d=n(215),h=r(d),v=function(){function e(t,n){(0,s.default)(this,e),this._sharedState=t,this._namespace=n}return(0,l.default)(e,[{key:"send",value:function(e,t){var n=this._sharedState,r=n.conf,i=n.moduleState,o=n.peerToken,s=r.ANALYTICS.KLARA_URL;e.customer=r.ID_CLIENT,e.content=i.content,e.peerAgentVersion="4.10.14",e.token=o,e.platform=h.default.get();var u=(0,a.default)(e),l=""+s+this._namespace;t&&(l+="/"+t),f.default.send(l,u,this._sharedState)}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(50),l=function(){function e(){(0,a.default)(this,e);var t=Date.now();this._metricSum=0,this._latestValue=0,this._integralTimestampDelta=new u.Delta(t),this._getterTimestampDelta=new u.Delta(t)}return(0,s.default)(e,[{key:"getAverage",value:function(){var e=this.getIntegral();return e.intervalLength?e.value/e.intervalLength:e.value}},{key:"getIntegral",value:function(){var e=Date.now(),t=this._integralTimestampDelta.calcDelta(e),n=this._getterTimestampDelta.calcDelta(e);this._metricSum+=this._latestValue*t;var r=this._metricSum;return this._metricSum=0,{value:r,intervalLength:n}}},{key:"updateMetric",value:function(e){var t=Date.now(),n=this._integralTimestampDelta.calcDelta(t);this._metricSum+=this._latestValue*n,this._latestValue=e}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._expirationThreshold=t,this._values=[]}return(0,s.default)(e,[{key:"push",value:function(e){this._cleanExpiredValues(),this._values.push({time:Date.now(),value:e})}},{key:"_cleanExpiredValues",value:function(){for(var e=Date.now();this._values.length>0&&e-this._expirationThreshold>=this._values[0].time;)this._values.shift()}},{key:"subDelta",value:function(e){if(this._cleanExpiredValues(),e>this._expirationThreshold)return null;for(var t=Date.now()-e,n=0;n<this._values.length&&this._values[n].time<=t;)n++;return n<this._values.length-1?this._values[this._values.length-1].value-this._values[n].value:null}},{key:"subTimeDelta",value:function(e){if(this._cleanExpiredValues(),e>this._expirationThreshold)return null;for(var t=Date.now()-e,n=0;n<this._values.length&&this._values[n].time<=t;)n++;return n<this._values.length-1?this._values[this._values.length-1].time-this._values[n].time:null}},{key:"delta",get:function(){return this._cleanExpiredValues(),this._values.length>1?this._values[this._values.length-1].value-this._values[0].value:null}},{key:"timeDelta",get:function(){return this._cleanExpiredValues(),this._values.length>1?this._values[this._values.length-1].time-this._values[0].time:null}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(null===e)throw new Error("Panic! Attempted to unwrap null");if(void 0===e)throw new Error("Panic! Attempted to unwrap undefined");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.unwrap=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(604),a=r(i),o=n(28),s=r(o);t.default=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=(0,s.default)(e);!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,a.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(e,t,n){e.exports=!n(12)&&!n(6)(function(){return 7!=Object.defineProperty(n(126)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){t.f=n(9)},function(e,t,n){var r=n(24),i=n(29),a=n(99)(!1),o=n(128)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)n!=o&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(l,n)||l.push(n));return l}},function(e,t,n){var r=n(13),i=n(3),a=n(57);e.exports=n(12)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(29),i=n(60).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return i(e)}catch(e){return o.slice()}};e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?s(e):i(r(e))}},function(e,t,n){"use strict";var r=n(57),i=n(100),a=n(82),o=n(16),s=n(81),u=Object.assign;e.exports=!u||n(6)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=o(e),u=arguments.length,l=1,c=i.f,f=a.f;u>l;)for(var d,h=s(arguments[l++]),v=c?r(h).concat(c(h)):r(h),_=v.length,p=0;_>p;)f.call(h,d=v[p++])&&(n[d]=h[d]);return n}:u},function(e,t,n){"use strict";var r=n(18),i=n(7),a=n(188),o=[].slice,s={},u=function(e,t,n){if(!(t in s)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";s[t]=Function("F,a","return new F("+r.join(",")+")")}return s[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=o.call(arguments,1),s=function(){var r=n.concat(o.call(arguments));return this instanceof s?u(t,r.length,r):a(t,r,e)};return i(t.prototype)&&(s.prototype=t.prototype),s}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(5).parseInt,i=n(73).trim,a=n(132),o=/^[-+]?0[xX]/;e.exports=8!==r(a+"08")||22!==r(a+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(o.test(n)?16:10))}:r},function(e,t,n){var r=n(5).parseFloat,i=n(73).trim;e.exports=1/r(n(132)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},function(e,t,n){var r=n(33);e.exports=function(e,t){if("number"!=typeof e&&"Number"!=r(e))throw TypeError(t);return+e}},function(e,t,n){var r=n(7),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t){e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},function(e,t,n){var r=n(135),i=Math.pow,a=i(2,-52),o=i(2,-23),s=i(2,127)*(2-o),u=i(2,-126),l=function(e){return e+1/a-1/a};e.exports=Math.fround||function(e){var t,n,i=Math.abs(e),c=r(e);return i<u?c*l(i/u/o)*u*o:(t=(1+o/a)*i,n=t-(t-i),n>s||n!=n?c*(1/0):c*n)}},function(e,t,n){var r=n(3);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){var r=n(18),i=n(16),a=n(81),o=n(14);e.exports=function(e,t,n,s,u){r(t);var l=i(e),c=a(l),f=o(l.length),d=u?f-1:0,h=u?-1:1;if(n<2)for(;;){if(d in c){s=c[d],d+=h;break}if(d+=h,u?d<0:f<=d)throw TypeError("Reduce of empty array with no initial value")}for(;u?d>=0:f>d;d+=h)d in c&&(s=t(s,c[d],d,l));return s}},function(e,t,n){"use strict";var r=n(16),i=n(58),a=n(14);e.exports=[].copyWithin||function(e,t){var n=r(this),o=a(n.length),s=i(e,o),u=i(t,o),l=arguments.length>2?arguments[2]:void 0,c=Math.min((void 0===l?o:i(l,o))-u,o-s),f=1;for(u<s&&s<u+c&&(f=-1,u+=c-1,s+=c-1);c-- >0;)u in n?n[s]=n[u]:delete n[s],s+=f,u+=f;return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){n(12)&&"g"!=/./g.flags&&n(13).f(RegExp.prototype,"flags",{configurable:!0,get:n(104)})},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(3),i=n(7),a=n(150);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";var r=n(203),i=n(75),a="Map";e.exports=n(107)(a,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(i(this,a),e);return t&&t.v},set:function(e,t){return r.def(i(this,a),0===e?0:e,t)}},r,!0)},function(e,t,n){"use strict";var r=n(13).f,i=n(59),a=n(64),o=n(32),s=n(62),u=n(63),l=n(138),c=n(198),f=n(61),d=n(12),h=n(51).fastKey,v=n(75),_=d?"_s":"size",p=function(e,t){var n,r=h(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,l){var c=e(function(e,r){s(e,c,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[_]=0,void 0!=r&&u(r,n,e[l],e)});return a(c.prototype,{clear:function(){for(var e=v(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[_]=0},delete:function(e){var n=v(this,t),r=p(n,e);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[_]--}return!!r},forEach:function(e){v(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!p(v(this,t),e)}}),d&&r(c.prototype,"size",{get:function(){return v(this,t)[_]}}),c},def:function(e,t,n){var r,i,a=p(e,t);return a?a.v=n:(e._l=a={i:i=h(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[_]++,"F"!==i&&(e._i[i]=a)),e},getEntry:p,setStrong:function(e,t,n){l(e,t,function(e,n){this._t=v(e,t),this._k=n,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?c(0,n.k):"values"==t?c(0,n.v):c(0,[n.k,n.v]):(e._t=void 0,c(1))},n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){"use strict";var r=n(203),i=n(75),a="Set";e.exports=n(107)(a,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(i(this,a),e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r,i=n(43)(0),a=n(26),o=n(51),s=n(186),u=n(206),l=n(7),c=n(6),f=n(75),d="WeakMap",h=o.getWeak,v=Object.isExtensible,_=u.ufstore,p={},m=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},g={get:function(e){if(l(e)){var t=h(e);return!0===t?_(f(this,d)).get(e):t?t[this._i]:void 0}},set:function(e,t){return u.def(f(this,d),e,t)}},E=e.exports=n(107)(d,m,g,u,!0,!0);c(function(){return 7!=(new E).set((Object.freeze||Object)(p),7).get(p)})&&(r=u.getConstructor(m,d),s(r.prototype,g),o.NEED=!0,i(["delete","has","get","set"],function(e){var t=E.prototype,n=t[e];a(t,e,function(t,i){if(l(t)&&!v(t)){this._f||(this._f=new r);var a=this._f[e](t,i);return"set"==e?this:a}return n.call(this,t,i)})}))},function(e,t,n){"use strict";var r=n(64),i=n(51).getWeak,a=n(3),o=n(7),s=n(62),u=n(63),l=n(43),c=n(24),f=n(75),d=l(5),h=l(6),v=0,_=function(e){return e._l||(e._l=new p)},p=function(){this.a=[]},m=function(e,t){return d(e.a,function(e){return e[0]===t})};p.prototype={get:function(e){var t=m(this,e);if(t)return t[1]},has:function(e){return!!m(this,e)},set:function(e,t){var n=m(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=h(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,a){var l=e(function(e,r){s(e,l,t,"_i"),e._t=t,e._i=v++,e._l=void 0,void 0!=r&&u(r,n,e[a],e)});return r(l.prototype,{delete:function(e){if(!o(e))return!1;var n=i(e);return!0===n?_(f(this,t)).delete(e):n&&c(n,this._i)&&delete n[this._i]},has:function(e){if(!o(e))return!1;var n=i(e);return!0===n?_(f(this,t)).has(e):n&&c(n,this._i)}}),l},def:function(e,t,n){var r=i(a(t),!0);return!0===r?_(e).set(t,n):r[e._i]=n,e},ufstore:_}},function(e,t,n){var r=n(41),i=n(14);e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length!");return n}},function(e,t,n){var r=n(60),i=n(100),a=n(3),o=n(5).Reflect;e.exports=o&&o.ownKeys||function(e){var t=r.f(a(e)),n=i.f;return n?t.concat(n(e)):t}},function(e,t,n){"use strict";function r(e,t,n,l,c,f,d,h){for(var v,_,p=c,m=0,g=!!d&&s(d,h,3);m<l;){if(m in n){if(v=g?g(n[m],m,t):n[m],_=!1,a(v)&&(_=v[u],_=void 0!==_?!!_:i(v)),_&&f>0)p=r(e,t,v,o(v.length),p,f-1)-1;else{if(p>=9007199254740991)throw TypeError();e[p]=v}p++}m++}return p}var i=n(101),a=n(7),o=n(14),s=n(32),u=n(9)("isConcatSpreadable");e.exports=r},function(e,t,n){var r=n(14),i=n(134),a=n(40);e.exports=function(e,t,n,o){var s=String(a(e)),u=s.length,l=void 0===n?" ":String(n),c=r(t);if(c<=u||""==l)return s;var f=c-u,d=i.call(l,Math.ceil(f/l.length));return d.length>f&&(d=d.slice(0,f)),o?d+s:s+d}},function(e,t,n){var r=n(57),i=n(29),a=n(82).f;e.exports=function(e){return function(t){for(var n,o=i(t),s=r(o),u=s.length,l=0,c=[];u>l;)a.call(o,n=s[l++])&&c.push(e?[n,o[n]]:o[n]);return c}}},function(e,t,n){var r=n(83),i=n(213);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){var r=n(63);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t){e.exports=Math.scale||function(e,t,n,r,i){return 0===arguments.length||e!=e||t!=t||n!=n||r!=r||i!=i?NaN:e===1/0||e===-1/0?e:(e-t)*(i-r)/(n-t)+r}},function(e,t,n){"use strict";function r(e){if(/Android.* Chrome\/[0-9.]+ /.test(e)){if(-1!==e.indexOf("wv"))return!0;if(/ Version\/[0-9]+\.[0.9]+ /.test(e))return!0}return!1}function i(){var e=o.default.getUAObject();if(!e.ua)return"unknown";if(-1!==e.ua.indexOf("CrKey"))return"chromecast";var t=e.device,n=e.os;return 0?o.default.isMobile()?r(e.ua)?"android-webview":"web-mobile":"web-desktop":n&&"iOS"===n.name||t&&"Apple"===t.vendor?"ios":n&&"Android"===n.name?"android":"unknown"}Object.defineProperty(t,"__esModule",{value:!0});var a=n(152),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={get:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TIMER_TYPE=t.AbstractTimer=void 0;var i=n(1),a=r(i),o=n(2),s=r(o),u=n(112),l=r(u),c={TIMEOUT:0,INTERVAL:1},f=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.TIMEOUT;(0,a.default)(this,e),this._id="timer-"+l.default.v4(),this._name=this._id,this._callback=t,this._time=n,this._type=r,this._isRepeatable=r===c.INTERVAL}return(0,s.default)(e,[{key:"clear",value:function(){throw new Error("Cannot call abstract method")}},{key:"id",get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}}]),e}();t.AbstractTimer=f,t.TIMER_TYPE=c},function(e,t,n){e.exports=!n(36)&&!n(65)(function(){return 7!=Object.defineProperty(n(153)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){(function(t){var n,r=t.crypto||t.msCrypto;if(r&&r.getRandomValues){var i=new Uint8Array(16);n=function(){return r.getRandomValues(i),i}}if(!n){var a=new Array(16);n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}e.exports=n}).call(t,n(71))},function(e,t){function n(e,t){var n=t||0,i=r;return i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]}for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=T.default.get(A,e);n?(n(),t===m.TIMER_TYPE.TIMEOUT&&T.default.remove(A,e)):y.default.notify("Cannot trigger timer callback","Timer callback not found with given id")}function a(e){i(e,m.TIMER_TYPE.INTERVAL)}function o(e){i(e,m.TIMER_TYPE.TIMEOUT)}Object.defineProperty(t,"__esModule",{value:!0}),t.triggerTimeoutCallback=t.triggerIntervalCallback=t.MobileTimer=void 0;var s=n(17),u=r(s),l=n(1),c=r(l),f=n(2),d=r(f),h=n(19),v=r(h),_=n(21),p=r(_),m=n(216),g=n(47),E=n(10),y=r(E),S=n(91),T=r(S),b="set_timer",R="clear_timer",A="timer",D=function(e){function t(e,n,r){(0,c.default)(this,t);var i=(0,v.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e,n,r));return i._time>0?(T.default.add(A,i._id,e),(0,g.nativeCall)(b,{timer_id:i._id,interval:i._time,repeats:i._isRepeatable})):e(),i}return(0,p.default)(t,e),(0,d.default)(t,[{key:"clear",value:function(){this._time>0&&((0,g.nativeCall)(R,{timer_id:this._id}),T.default.remove(A,this._id))}}]),t}(m.AbstractTimer);t.MobileTimer=D,t.triggerIntervalCallback=a,t.triggerTimeoutCallback=o},function(e,t,n){var r=n(66),i=n(76),a=n(156)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){e.exports=n(53)},function(e,t,n){var r=n(35),i=n(44),a=n(79);e.exports=n(36)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(66),i=n(68),a=n(485)(!1),o=n(156)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)n!=o&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(l,n)||l.push(n));return l}},function(e,t,n){var r=n(22).document;e.exports=r&&r.documentElement},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(87);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(68),i=n(229).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return i(e)}catch(e){return o.slice()}};e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?s(e):i(r(e))}},function(e,t,n){var r=n(224),i=n(161).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(90),i=n(86),a=n(68),o=n(154),s=n(66),u=n(217),l=Object.getOwnPropertyDescriptor;t.f=n(36)?l:function(e,t){if(e=a(e),t=o(t,!0),u)try{return l(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function e(t){(0,i.default)(this,e),this.message=t.error.message,this.stacktrace=t.error.stack,this.fileName=t.filename,this.lineNumber=t.lineno,this.columnNumber=t.colno?t.colno:void 0};t.default=a,e.exports=t.default},function(e,t,n){"use strict";var r=n(35).f,i=n(116),a=n(165),o=n(48),s=n(166),u=n(92),l=n(159),c=n(226),f=n(235),d=n(36),h=n(89).fastKey,v=n(168),_=d?"_s":"size",p=function(e,t){var n,r=h(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,l){var c=e(function(e,r){s(e,c,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[_]=0,void 0!=r&&u(r,n,e[l],e)});return a(c.prototype,{clear:function(){for(var e=v(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[_]=0},delete:function(e){var n=v(this,t),r=p(n,e);if(r){var i=r.n,a=r.p;delete n._i[r.i],r.r=!0,a&&(a.n=i),i&&(i.p=a),n._f==r&&(n._f=i),n._l==r&&(n._l=a),n[_]--}return!!r},forEach:function(e){v(this,t);for(var n,r=o(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!p(v(this,t),e)}}),d&&r(c.prototype,"size",{get:function(){return v(this,t)[_]}}),c},def:function(e,t,n){var r,i,a=p(e,t);return a?a.v=n:(e._l=a={i:i=h(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[_]++,"F"!==i&&(e._i[i]=a)),e},getEntry:p,setStrong:function(e,t,n){l(e,t,function(e,n){this._t=v(e,t),this._k=n,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?c(0,n.k):"values"==t?c(0,n.v):c(0,[n.k,n.v]):(e._t=void 0,c(1))},n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){var r=n(44);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){var r=n(78),i=n(20)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){"use strict";var r=n(22),i=n(8),a=n(35),o=n(36),s=n(20)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];o&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var r=n(22),i=n(11),a=n(89),o=n(65),s=n(53),u=n(165),l=n(92),c=n(166),f=n(23),d=n(88),h=n(35).f,v=n(509)(0),_=n(36);e.exports=function(e,t,n,p,m,g){var E=r[e],y=E,S=m?"set":"add",T=y&&y.prototype,b={};return _&&"function"==typeof y&&(g||T.forEach&&!o(function(){(new y).entries().next()}))?(y=t(function(t,n){c(t,y,e,"_c"),t._c=new E,void 0!=n&&l(n,m,t[S],t)}),v("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in T&&(!g||"clear"!=e)&&s(y.prototype,e,function(n,r){if(c(this,y,e),!t&&g&&!f(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),g||h(y.prototype,"size",{get:function(){return this._c.size}})):(y=p.getConstructor(t,e,m,S),u(y.prototype,n),a.NEED=!0),d(y,e),b[e]=y,i(i.G+i.W+i.F,b),g||p.setStrong(y,e,m),y}},function(e,t,n){var r=n(119),i=n(513);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){"use strict";var r=n(11);e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var r=n(11),i=n(85),a=n(48),o=n(92);e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,s,u=arguments[1];return i(this),t=void 0!==u,t&&i(u),void 0==e?new this:(n=[],t?(r=0,s=a(u,arguments[2],2),o(e,!1,function(e){n.push(s(e,r++))})):o(e,!1,n.push,n),new this(n))}})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){s.default.add(f,e.id,t),s.default.add(d,e.id,e),(0,c.nativeCall)("call_hash_worker",{binaryDataId:e.id})}function a(e,t){var n=s.default.get(d,e),r=s.default.get(f,e);r&&n?(r(n,t),s.default.remove(f,e),s.default.remove(d,e)):l.default.notify("Cannot trigger hasher callback","Hasher callback or binary data not found with given id")}Object.defineProperty(t,"__esModule",{value:!0}),t.hasherCallback=t.callHashWorker=void 0;var o=n(91),s=r(o),u=n(10),l=r(u),c=n(47),f="hash_worker_callback",d="hash_worker_binary_data";t.callHashWorker=i,t.hasherCallback=a},function(e,t,n){e.exports={default:n(517),__esModule:!0}},function(e,t,n){var r=n(44),i=n(85),a=n(20)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||void 0==(n=r(o)[a])?t:i(n)}},function(e,t,n){var r,i,a,o=n(48),s=n(519),u=n(225),l=n(153),c=n(22),f=c.process,d=c.setImmediate,h=c.clearImmediate,v=c.MessageChannel,_=c.Dispatch,p=0,m={},g="onreadystatechange",E=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},y=function(e){E.call(e.data)};d&&h||(d=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++p]=function(){s("function"==typeof e?e:Function(e),t)},r(p),p},h=function(e){delete m[e]},"process"==n(87)(f)?r=function(e){f.nextTick(o(E,e,1))}:_&&_.now?r=function(e){_.now(o(E,e,1))}:v?(i=new v,a=i.port2,i.port1.onmessage=y,r=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",y,!1)):r=g in l("script")?function(e){u.appendChild(l("script"))[g]=function(){u.removeChild(this),E.call(e)}}:function(e){setTimeout(o(E,e,1),0)}),e.exports={set:d,clear:h}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var r=n(44),i=n(23),a=n(170);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){var r=n(20)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t,n){e.exports={default:n(532),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(249),a=r(i),o=n(121),s=r(o),u=n(1),l=r(u),c=n(2),f=r(c),d=n(47),h=n(250),v=r(h),_=n(91),p=r(_),m=n(4),g=r(m),E="peer_connector",y="peer_pool",S="shared_state",T="peer_connection",b=function(){function e(t,n,r){(0,l.default)(this,e),p.default.add(E,y,n),p.default.add(E,S,r),this._peerId=t,this._conf=r.conf;var i={url:this._conf.SIGNALING_URL,peerId:this._peerId,timeout:this._conf.PEER_CONNECTION_TIMEOUT,bufferedAmountLowThreshold:this._conf.UP_BUFFERED_AMOUNT_LOW_THRESHOLD};(0,d.nativeCall)("peer_connector_init_notification",i),r.eventBus.on(g.default.Signaling.SIGNALING_RECONNECTION_REQUEST,function(){(0,d.nativeCall)("signaling_reconnect")}),r.eventBus.on(g.default.Signaling.PERM_SIGNALING_DISCONNECTION_REQUEST,function(){(0,d.nativeCall)("perm_signaling_disconnect")}),r.eventBus.on(g.default.Signaling.TEMP_SIGNALING_DISCONNECTION_REQUEST,function(){(0,d.nativeCall)("temp_signaling_disconnect")})}return(0,f.default)(e,[{key:"createPeerConnection",value:function(e){(0,d.nativeCall)("signaling_create_peer_connection",{remotePeerId:e}),this._pendingPeerSet.add(e)}},{key:"getPeerConnectionCount",value:function(){return p.default.count(T)}},{key:"getOpenConnectorSlotsCount",value:function(){var e=p.default.get(E,y);return e?Math.max(Math.round(e.openSlotsCount()-this.getPeerConnectionCount()*this._conf.EXPECTED_CONNECTION_SUCCESS_RATE),0):void(0,d.nativeError)("[SIGNALING] peerPool cannot be null")}},{key:"getPendingConnectionDebugInfos",value:function(){return[]}},{key:"dispose",value:function(){}},{key:"getPendingConnectionPeers",value:function(){return(0,s.default)(e._pendingPeerSet)}}],[{key:"connectedToSignalingServer",value:function(){var e=p.default.get(E,S);e&&e.status&&e.status.setConnectedToSignalingServer()}},{key:"disconnectedFromSignalingServer",value:function(){var e=p.default.get(E,S);e&&e.status&&e.status.setDisconnectedToSignalingServer()}},{key:"peerConnectionCallback",value:function(e,t,n){var r=p.default.get(E,y);if(!r)return void(0,d.nativeError)("[SIGNALING] peerPool cannot be null");switch(e){case"success":var i=p.default.get(E,S);if(i){var a=new v.default(t,i);r.addPeerConnection(n,a),this._pendingPeerSet.delete(n)}break;case"timeout":r.connectionAttemptTimeout(n),this._pendingPeerSet.delete(n);break;case"declined":r.offerDeclined(n),this._pendingPeerSet.delete(n);break;default:(0,d.nativeError)("[SIGNALING] bad status")}}},{key:"peerConnectionDidTimeout",value:function(e){var t=p.default.get(E,y);t&&t.connectionAttemptTimeout(e)}},{key:"peerConnectionOffered",value:function(e){this._pendingPeerSet.add(e)}}]),e}();b._pendingPeerSet=new a.default,t.default=b,e.exports=t.default},function(e,t,n){e.exports={default:n(539),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(84),a=r(i),o=n(17),s=r(o),u=n(1),l=r(u),c=n(2),f=r(c),d=n(19),h=r(d),v=n(21),_=r(v),p=n(544),m=r(p),g=n(91),E=r(g),y=n(547),S=r(y),T=n(10),b=r(T),R=n(173),A=r(R),D=n(4),w=r(D),O=n(47),k="peer_connection",C="shared_state",L=function(e){function t(e,n){(0,l.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,s.default)(t)).call(this,n));return r._bufferedAmount=0,E.default.add(k,C,n),E.default.add(k,e,r),r._connectionId=e,r._manageHeartbeat(),r}return(0,_.default)(t,e),(0,f.default)(t,[{key:"_closeConnectionIfOpen",value:function(){(0,O.nativeCall)("peer_connection_close",{connection_id:this._connectionId}),this._setDisconnected()}},{key:"sendMessage",value:function(e,t){var n=S.default.encode(e,t),r=(0,a.default)(n),i={connection_id:this._connectionId,message:r};(0,O.nativeCall)("peer_connection_send_message",i)}},{key:"sendBinaryData",value:function(e,t){var n={connection_id:this._connectionId,binary_data_id:e.id,chunk_id:t.chunkIndex,segment_coord:t.segmentCoord};return(0,O.nativeCall)("peer_connection_send_data",n),!0}},{key:"destroy",value:function(){E.default.remove(k,this._connectionId),this._timerStore.clearAll()}},{key:"close",value:function(){(0,O.nativeCall)("peer_connection_close",{connection_id:this._connectionId}),this.destroy()}},{key:"getRtt",value:function(){return-1}},{key:"getBufferedAmount",value:function(){return this._bufferedAmount}},{key:"onbufferedamountlow",set:function(e){this._onBufferedAmountLow=e}}],[{key:"receivedMessage",value:function(e,t){var n=E.default.get(k,C);n&&(n.transferStats.p2pMessagesDownloaded+=t.length);var r=E.default.get(k,e);if(r){r._isCommunicating=!0;var i=S.default.decode(JSON.parse(t));"heartbeat"!==i.type&&r.emit(w.default.PeerConnection.MESSAGE_RECEIVED,i.type,i.args)}else b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}},{key:"receivedData",value:function(e,t,n,r,i,a){var o=parseInt(n,10),s=E.default.get(k,C);s&&(s.transferStats.p2pHeadersDownloaded+=parseInt(a,10),s.transferStats.p2pMediaDownloaded+=o);var u=new A.default(t,o),l=E.default.get(k,e);l?(l._isCommunicating=!0,l.emit(w.default.PeerConnection.BINARY_DATA_RECEIVED,u,r,i)):b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}},{key:"onDisconnect",value:function(e){var t=E.default.get(k,e);t?t.emit("disconnected"):b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}},{key:"onBufferedAmountChange",value:function(e,t,n){var r=E.default.get(k,e);r?(r._bufferedAmount=t,n&&r._onBufferedAmountLow&&r._onBufferedAmountLow()):b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}}]),t}(m.default);e.exports=L},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(112),_=r(v),p=n(548),m=r(p),g=n(173),E=r(g),y=n(91),S=r(y),T=n(10),b=r(T),R=n(47),A=n(4),D=r(A),w="binary",O="segment",k=function(e){function t(e,n,r){(0,s.default)(this,t);var i=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this));if(i._eventBus=r,i._id="segment-"+_.default.v4(),i._isNativeInformedOfDeletion=!1,i._segmentCoord=n,"number"==typeof e)i._byteLength=e,(0,R.nativeCall)("segment_created",{id:i._id,size:e});else{if(!(e instanceof E.default))throw new TypeError("Wrong parameter in Segment Constructor");i._byteLength=e.byteLength,(0,R.nativeCall)("segment_created",{id:i._id,binaryDataId:e.id})}return S.default.add(O,i._id,i),i}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getBinaryData",value:function(e,t,n){var r="binary-data-callback-"+_.default.v4();S.default.add(w,r,n);var i={segmentId:this._id,offset:e,size:t,callbackId:r};(0,R.nativeCall)("get_binary_data",i)}},{key:"setBinaryData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(e instanceof E.default||"number"==typeof t))throw new TypeError("Wrong parameter");(0,R.nativeCall)("set_binary_data",{offset:t,binaryDataId:e.id,segmentId:this._id})}},{key:"setComplete",value:function(){(0,R.nativeCall)("set_segment_complete",{segmentId:this._id})}},{key:"notifyDeletion",value:function(){this._isNativeInformedOfDeletion=!0,this._eventBus.emit(D.default.P2PCache.REMOVE_SEGMENT_FROM_CACHE,this._segmentCoord)}},{key:"destroy",value:function(){this._isNativeInformedOfDeletion||(0,R.nativeCall)("destroy_segment",{segmentId:this._id})}}],[{key:"getBinaryDataCallback",value:function(e,t,n,r,i){var a=S.default.get(w,i);if(a){a(new E.default(n,parseInt(r,10))),S.default.remove(w,i)}else b.default.notifyError(new Error("Cannot get BinaryDataCallback with the given id"))}},{key:"removeSegmentFromCache",value:function(e){var t=S.default.get(O,e);t?(t.notifyDeletion(),S.default.remove(O,e)):b.default.notifyError(new Error("Cannot get Segment instance with the given id"))}}]),t}(m.default);t.default=k,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(122),a=r(i),o=n(1),s=r(o),u=n(50),l=n(175),c=r(l),f=n(124),d=function e(t,n,r){if((0,s.default)(this,e),(0,f.checkInterface)(c.default,t),!(0,u.isNumeric)(n))throw new Error("Invalid value for size");if(!r)throw new Error("No hash");this.segmentCoord=t,this.size=n,this.hash=r,(0,a.default)(this)};t.default=d,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={IDLE:"IDLE",NO_PEER:"NO_PEER",RANDOM:"RANDOM",DYNAMIC:"DYNAMIC",TOP_SEEDER:"TOP_SEEDER"};t.default=r,e.exports=t.default},function(e,t,n){!function(n,r){0?"function"==typeof define&&define.amd?define([],r):"object"==typeof t?t.QoSAnalytics=r():n.QoSAnalytics=r():e.exports=r()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=29)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(30),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(24)("wks"),i=n(25),a=n(2).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){var r=n(7),i=n(20);e.exports=n(6)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){e.exports=!n(13)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(8),i=n(35),a=n(36),o=Object.defineProperty;t.f=n(6)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(12);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports={}},function(e,t,n){var r=n(2),i=n(3),a=n(33),o=n(5),s=function(e,t,n){var u,l,c,f=e&s.F,d=e&s.G,h=e&s.S,v=e&s.P,_=e&s.B,p=e&s.W,m=d?i:i[t]||(i[t]={}),g=m.prototype,E=d?r:h?r[t]:(r[t]||{}).prototype;d&&(n=t);for(u in n)(l=!f&&E&&void 0!==E[u])&&u in m||(c=l?E[u]:n[u],m[u]=d&&"function"!=typeof E[u]?n[u]:_&&l?a(c,r):p&&E[u]==c?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(c):v&&"function"==typeof c?a(Function.call,c):c,v&&((m.virtual||(m.virtual={}))[u]=c,e&s.R&&g&&!g[u]&&o(g,u,c)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={IDLE:"IDLE",PLAYING:"PLAYING",SEEKING:"SEEKING",BUFFERING:"BUFFERING",BUFFERING_WITH_BUFFER:"BUFFERING_WITH_BUFFER",PAUSED:"PAUSED",ENDED:"ENDED"};t.default=r,e.exports=t.default},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(44),i=n(15);e.exports=function(e){return r(i(e))}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(24)("keys"),i=n(25);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(12),i=n(2).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(15);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(43),i=n(26);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(2),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){"use strict";var r=n(55),i=n(11),a=n(56),o=n(5),s=n(9),u=n(10),l=n(57),c=n(28),f=n(61),d=n(4)("iterator"),h=!([].keys&&"next"in[].keys()),v=function(){return this};e.exports=function(e,t,n,_,p,m,g){l(n,t,_);var E,y,S,T=function(e){if(!h&&e in D)return D[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},b=t+" Iterator",R="values"==p,A=!1,D=e.prototype,w=D[d]||D["@@iterator"]||p&&D[p],O=w||T(p),k=p?R?T("entries"):O:void 0,C="Array"==t?D.entries||w:w;if(C&&(S=f(C.call(new e)))!==Object.prototype&&(c(S,b,!0),r||s(S,d)||o(S,d,v)),R&&w&&"values"!==w.name&&(A=!0,O=function(){return w.call(this)}),r&&!g||!h&&!A&&D[d]||o(D,d,O),u[t]=O,u[b]=v,p)if(E={values:R?O:T("values"),keys:m?O:T("keys"),entries:k},g)for(y in E)y in D||a(D,y,E[y]);else i(i.P+i.F*(h||A),t,E);return E}},function(e,t,n){var r=n(7).f,i=n(9),a=n(4)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(37),l=r(u),c=n(38),f=r(c),d=n(39),h=r(d),v=n(67),_=r(v),p=n(68),m=r(p),g={ATTACHED:"ATTACHED",DETACHED:"DETACHED",DISPOSED:"DISPOSED"},E=function(){function e(t,n){(0,a.default)(this,e),this._state=g.ATTACHED,this._stateMachine=new l.default,this._playbackWatcher=new f.default(t,this._stateMachine,n||_.default),this._stateTimeCalculator=new h.default(this._stateMachine),this._qosStats=new m.default(t,this._stateTimeCalculator)}return(0,s.default)(e,[{key:"getQoSAnalytics",value:function(){return this._qosStats.getAnalytics()}},{key:"attach",value:function(){this._state===g.DETACHED&&(this._state=g.ATTACHED,this._playbackWatcher.resume(),this._stateTimeCalculator.resume())}},{key:"detach",value:function(){this._state===g.ATTACHED&&(this._state=g.DETACHED,this._playbackWatcher.pause(),this._stateTimeCalculator.pause())}},{key:"dispose",value:function(){this._state=g.DISPOSED,this._playbackWatcher.dispose(),this._stateTimeCalculator.dispose()}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){e.exports={default:n(31),__esModule:!0}},function(e,t,n){n(32);var r=n(3).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(11);r(r.S+r.F*!n(6),"Object",{defineProperty:n(7).f})},function(e,t,n){var r=n(34);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){e.exports=!n(6)&&!n(13)(function(){return 7!=Object.defineProperty(n(19)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(12);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(14),l=r(u),c=function(){function e(){(0,a.default)(this,e),this._stateChangedCallbacks=[],this.gotoIdle()}return(0,s.default)(e,[{key:"_setState",value:function(e){var t=this;this._state!==e&&(this._prevState=this._state,this._state=e,this._stateChangedCallbacks.forEach(function(e){e(t._state,t._prevState)}))}},{key:"gotoIdle",value:function(){this._setState(l.default.IDLE)}},{key:"gotoPlaying",value:function(){this._setState(l.default.PLAYING)}},{key:"gotoSeeking",value:function(){this._setState(l.default.SEEKING)}},{key:"gotoBuffering",value:function(){this._setState(l.default.BUFFERING)}},{key:"gotoBufferingWithBuffer",value:function(){this._setState(l.default.BUFFERING_WITH_BUFFER)}},{key:"gotoPaused",value:function(){this._setState(l.default.PAUSED)}},{key:"gotoEnded",value:function(){this._setState(l.default.ENDED)}},{key:"getState",value:function(){return this._state}},{key:"addObserver",value:function(e){this._stateChangedCallbacks.indexOf(e)<0&&this._stateChangedCallbacks.push(e)}},{key:"removeObserver",value:function(e){var t=this._stateChangedCallbacks.indexOf(e);t>-1&&this._stateChangedCallbacks.splice(t,1)}},{key:"isIdle",value:function(){return this._state===l.default.IDLE}},{key:"isPlaying",value:function(){return this._state===l.default.PLAYING}},{key:"isSeeking",value:function(){return this._state===l.default.SEEKING}},{key:"isBuffering",value:function(){return this._state===l.default.BUFFERING}},{key:"isBufferingWithBuffer",value:function(){return this._state===l.default.BUFFERING_WITH_BUFFER}},{key:"isPaused",value:function(){return this._state===l.default.PAUSED}},{key:"isEnded",value:function(){return this._state===l.default.ENDED}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t,n,r){(0,a.default)(this,e),this._createInterval=r,this._video=t,this._stateMachine=n,this._previousPlaybackTime=0,this.resume()}return(0,s.default)(e,[{key:"dispose",value:function(){this.pause()}},{key:"pause",value:function(){this._tickInterval.clear()}},{key:"resume",value:function(){this._tickInterval=this._createInterval(this._tickHandler.bind(this),100)}},{key:"_getBufferLength",value:function(){for(var e=this._video.currentTime,t=this._video.buffered,n=0;n<t.length;n++)if(t.start(n)<=e&&e<=t.end(n))return t.end(n)-e;return 0}},{key:"_tickHandler",value:function(){var e=this._video.duration-this._video.currentTime,t=Math.abs(this._video.currentTime-this._previousPlaybackTime);if(isNaN(t))this._stateMachine.gotoIdle();else if(this._video.seeking)this._stateMachine.gotoSeeking();else if(this._video.paused)this._stateMachine.isIdle()||(!isNaN(e)&&e<.3?this._stateMachine.gotoEnded():this._stateMachine.gotoPaused());else if(t>0)this._stateMachine.gotoPlaying();else if(!this._stateMachine.isIdle()&&!this._stateMachine.isSeeking()){var n=this._getBufferLength();n<1?this._stateMachine.gotoBuffering():this._stateMachine.gotoBufferingWithBuffer()}this._previousPlaybackTime=this._video.currentTime}}],[{key:"BUFFERING_WITH_BUFFER_THRESHOLD",get:function(){return 1}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(40),a=r(i),o=n(49),s=r(o),u=n(0),l=r(u),c=n(1),f=r(c),d=n(14),h=r(d),v=function(){function e(t){(0,l.default)(this,e),this._stateMachine=t,this._stats={};var n=!0,r=!1,i=void 0;try{for(var o,u=(0,s.default)((0,a.default)(h.default));!(n=(o=u.next()).done);n=!0){var c=o.value;this._stats[c]={count:0,timeSpent:0}}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}this.resume(),this._onStateChangedCallback=this._onStateChanged.bind(this),this._stateMachine.addObserver(this._onStateChangedCallback)}return(0,f.default)(e,[{key:"getStats",value:function(){return this._isAttached&&this._updateStateTimeSpent(this._stateMachine.getState()),this._stats}},{key:"pause",value:function(){this._isAttached=!1,this._terminateState(this._stateMachine.getState())}},{key:"resume",value:function(){this._isAttached=!0,this._resumeState(this._stateMachine.getState())}},{key:"dispose",value:function(){this.pause(),this._stateMachine.removeObserver(this._onStateChangedCallback)}},{key:"_onStateChanged",value:function(e,t){this._terminateState(t),this._resumeState(e)}},{key:"_terminateState",value:function(e){this._updateStateTimeSpent(e),this._stats[e].startTimeStamp=null}},{key:"_updateStateTimeSpent",value:function(e){var t=this._stats[e],n=Date.now();t.timeSpent+=(n-t.startTimeStamp)/1e3,t.startTimeStamp=n}},{key:"_resumeState",value:function(e){var t=this._stats[e];t.count++,t.startTimeStamp=Date.now()}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){e.exports={default:n(41),__esModule:!0}},function(e,t,n){n(42),e.exports=n(3).Object.keys},function(e,t,n){var r=n(21),i=n(22);n(48)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(9),i=n(16),a=n(45)(!1),o=n(18)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)n!=o&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(l,n)||l.push(n));return l}},function(e,t,n){var r=n(23);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(16),i=n(46),a=n(47);e.exports=function(e){return function(t,n,o){var s,u=r(t),l=i(u.length),c=a(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var r=n(17),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(17),i=Math.max,a=Math.min;e.exports=function(e,t){return e=r(e),e<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(11),i=n(3),a=n(13);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t,n){e.exports={default:n(50),__esModule:!0}},function(e,t,n){n(51),n(62),e.exports=n(64)},function(e,t,n){n(52);for(var r=n(2),i=n(5),a=n(10),o=n(4)("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;u<5;u++){var l=s[u],c=r[l],f=c&&c.prototype;f&&!f[o]&&i(f,o,l),a[l]=a.Array}},function(e,t,n){"use strict";var r=n(53),i=n(54),a=n(10),o=n(16);e.exports=n(27)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t){e.exports=!0},function(e,t,n){e.exports=n(5)},function(e,t,n){"use strict";var r=n(58),i=n(20),a=n(28),o={};n(5)(o,n(4)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(8),i=n(59),a=n(26),o=n(18)("IE_PROTO"),s=function(){},u=function(){var e,t=n(19)("iframe"),r=a.length;for(t.style.display="none",n(60).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(7),i=n(8),a=n(22);e.exports=n(6)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){e.exports=n(2).document&&document.documentElement},function(e,t,n){var r=n(9),i=n(21),a=n(18)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){"use strict";var r=n(63)(!0);n(27)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(17),i=n(15);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(a=s.charCodeAt(u),a<55296||a>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):o-56320+(a-55296<<10)+65536)}}},function(e,t,n){var r=n(8),i=n(65);e.exports=n(3).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){var r=n(66),i=n(4)("iterator"),a=n(10);e.exports=n(3).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){var r=n(23),i=n(4)("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=o(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o);t.default=function(e,t){return new u(e,t)};var u=function(){function e(t,n){(0,a.default)(this,e),this._callback=t,this._time=n,this._timer=this._createTimer()}return(0,s.default)(e,[{key:"_createTimer",value:function(){return setInterval(this._callback,this._time)}},{key:"clear",value:function(){clearInterval(this._timer)}}]),e}();e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(14),l=r(u),c=function(){function e(t,n){(0,a.default)(this,e),this._video=t,this._stateTimeCalculator=n,this._cachedDroppedFrameCount=0}return(0,s.default)(e,[{key:"_getDroppedFrameCount",value:function(){var e=0;return e=this._video.getVideoPlaybackQuality?this._video.getVideoPlaybackQuality().droppedVideoFrames||0:this._video.webkitDroppedFrameCount||this._video.droppedFrameCount||0,e>0&&(this._cachedDroppedFrameCount=e),this._cachedDroppedFrameCount}},{key:"getAnalytics",value:function(){var e=this._stateTimeCalculator.getStats();return{droppedFrameCount:this._getDroppedFrameCount(),timeSpentPlaying:e[l.default.PLAYING].timeSpent,timeSpentPaused:e[l.default.PAUSED].timeSpent,timeSpentSeeking:e[l.default.SEEKING].timeSpent,timeSpentEnded:e[l.default.ENDED].timeSpent,rebufferingCount:e[l.default.BUFFERING].count,timeSpentRebuffering:e[l.default.BUFFERING].timeSpent,rebufferingCountWithBuffer:e[l.default.BUFFERING_WITH_BUFFER].count,timeSpentRebufferingWithBuffer:e[l.default.BUFFERING_WITH_BUFFER].timeSpent}}}]),e}();t.default=c,e.exports=t.default}])})},function(e,t,n){"use strict";function r(e,t){for(var n=[],r=0;r<e.length;r++)(0,o.default)(e[r],t)||n.push(e[r]);return n}function i(e){e.length=0}Object.defineProperty(t,"__esModule",{value:!0});var a=n(584),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={without:r,clear:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._internalQueue=t}return(0,s.default)(e,[{key:"_canDequeue",value:function(){return!0}},{key:"_dequeuedCallback",value:function(e){}},{key:"_emptyCallback",value:function(){}},{key:"_validateItem",value:function(e){return!0}},{key:"push",value:function(e){this._internalQueue.push(e),this.tryDequeue()}},{key:"_skipInvalidItems",value:function(){for(var e=this._internalQueue.shift();void 0!==e&&!this._validateItem(e);)e=this._internalQueue.shift();return e}},{key:"tryDequeue",value:function(){if(this._canDequeue()){var e=this._skipInvalidItems();e?this._dequeuedCallback(e):this._emptyCallback()}}},{key:"tryDequeueN",value:function(e){for(;this._canDequeue()&&e>0;){var t=this._skipInvalidItems();if(!t){this._emptyCallback();break}this._dequeuedCallback(t),e--}}},{key:"tryDequeueAll",value:function(){for(;this._canDequeue();){var e=this._skipInvalidItems();if(!e){this._emptyCallback();break}this._dequeuedCallback(e)}}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t,n,r){(0,a.default)(this,e),this._segmentCoord=t,this._chunkIndex=n,this._bandwidthSafety=r,this._timestamp=Date.now()}return(0,s.default)(e,[{key:"segmentCoord",get:function(){return this._segmentCoord}},{key:"chunkIndex",get:function(){return this._chunkIndex}},{key:"bandwidthSafety",get:function(){return this._bandwidthSafety}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(0===e.length)return null;e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}function i(e){if(0===e.length)return null;for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function a(e){var t=i(e);if(!t)return null;for(var n=0,r=0;r<e.length;r++)n+=Math.abs(e[r]-t);return n/e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.default={median:r,mean:i,meanAbsoluteDeviation:a},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={PeerStats:{SAMPLED_PUC:"sampledPUC"}},e.exports=t.default},function(e,t,n){e.exports={default:n(611),__esModule:!0}},function(e,t,n){"use strict";e.exports=0?require("./browser/Segment"):n(251)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(121),a=r(i),o=n(37),s=r(o),u=n(249),l=r(u),c=n(28),f=r(c),d=n(1),h=r(d),v=n(2),_=r(v),p=n(624),m=r(p),g=n(627),E=r(g),y=n(4),S=r(y),T=n(10),b=r(T),R=function(){function e(t,n,r,i){(0,h.default)(this,e),this._reachedLiveEdge=!1,this._cachedSegmentToDownload=[],this._sharedState=i,this._currentTracks=i.moduleState.currentTracks,this._p2pCache=n,this._distributedSegmentList=r,this._mediaMapCache=new E.default(t,i),this._edges=new m.default(this._mediaMapCache,i)}return(0,_.default)(e,[{key:"_getSegmentsToDownloadByTrack",value:function(e,t){var n=[],r=void 0;if(r="audio"===t?this._edges.audio:this._edges.video){var i=this._mediaMapCache.getSegmentListAfterEdge(e,r,this._sharedState.conf.MAX_BUFFER_DURATION),a=this._distributedSegmentList.getSegmentListAfter(r),o=this._mergeDedupe(i,a),s=this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM&&0===o.length?[]:this._p2pCache.listSegmentsToSkipForTrack(e);if("video"===t){var u=this._sharedState.conf.ENABLE_PREBUFFER_FEEDBACK||this._sharedState.conf.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME?!i.length:i.length<=1;u!==this._reachedLiveEdge&&(this._reachedLiveEdge=u,this._sharedState.eventBus.emit(S.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,u))}n=this._getDifference(o,s),this._sharedState.conf.ENABLE_PREBUFFER_FEEDBACK&&this._checkNextSegmentPrebuffered(t,o,n);var l=this._mediaMapCache.getSegmentTime(r);if(null===l)b.default.notifyError(new Error("Unexpected getSegmentTime error: track edge timestamp is not supposed to be unreliable"));else if(this._sharedState.moduleState.isLive()&&n.length>0){var c=o[0],f=this._mediaMapCache.getSegmentTime(c);if(null!==f){var d=l-f;this._sharedState.moduleState.isNearEdge=d<=this._sharedState.conf.LIVE.NEAR_EDGE_MARGIN}else this._sharedState.moduleState.isNearEdge=!0}}return n}},{key:"_checkNextSegmentPrebuffered",value:function(e,t,n){this._sharedState.moduleState.nextSegmentPrebuffered[e]=t.length>=2&&(!n.length||!t[0].isEqual(n[0])&&!t[1].isEqual(n[0]))}},{key:"isSegmentRequested",value:function(e){if(this._sharedState.conf.ENABLE_PUSH_SEGMENT_OPTIM){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,f.default)(this._cachedSegmentToDownload);!(t=(i=a.next()).done);t=!0){var o=i.value;if(e.isEqual(o)){var s=this._p2pCache.getSegmentHandler(e);return s&&s.chunkManager.shouldDownloadSegment()}}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return this._cachedSegmentToDownload.length<this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER&&this.isSegmentInAcceptableRange(e)}var u=this.getSegmentListToDownload(),l=!0,c=!1,d=void 0;try{for(var h,v=(0,f.default)(u);!(l=(h=v.next()).done);l=!0){var _=h.value;if(e.isEqual(_))return!0}}catch(e){c=!0,d=e}finally{try{!l&&v.return&&v.return()}finally{if(c)throw d}}return!1}},{key:"isSegmentInAcceptableRange",value:function(e){for(var t=!1,n=["audio","video"],r=0;r<n.length;r++){var i=n[r],a=this._edges[i];t=t||!!a&&e.isInTrack(a.trackView)&&e.getId()>a.getId()&&e.getId()-a.getId()<=this._sharedState.conf.SEGMENT_ID_ACCEPTABLE_RANGE}return t}},{key:"_getDifference",value:function(e,t){if(this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM){if(0===t.length||0===e.length)return e;var n=new l.default(t.map(function(e){return e.viewToString()}));return e.filter(function(e){return!n.has(e.viewToString())})}return e.filter(function(e){return void 0===t.find(function(t){return e.isEqual(t)})})}},{key:"_mergeDedupe",value:function(e,t){var n=new s.default,r=!0,i=!1,o=void 0;try{for(var u,l=(0,f.default)(e);!(r=(u=l.next()).done);r=!0){var c=u.value;n.set(c.viewToString(),c)}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}var d=!0,h=!1,v=void 0;try{for(var _,p=(0,f.default)(t);!(d=(_=p.next()).done);d=!0){var m=_.value;n.set(m.viewToString(),m)}}catch(e){h=!0,v=e}finally{try{!d&&p.return&&p.return()}finally{if(h)throw v}}return(0,a.default)(n.values())}},{key:"getCachedSegmentListToDownload",value:function(){return this._cachedSegmentToDownload}},{key:"getSegmentListToDownload",value:function(){throw new Error("Cannot call abstract method")}},{key:"updateTrackEdge",value:function(e){throw new Error("Cannot call abstract method")}},{key:"getEdgeSegment",value:function(){return this._edges.video}}]),e}();t.default=R,e.exports=t.default},function(e,t,n){e.exports={default:n(625),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._providers={}}return(0,s.default)(e,[{key:"registerProvider",value:function(e,t){this._providers[e]=t}},{key:"getStat",value:function(e){var t=this._providers[e];if(t)return t()}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._maxSize=t,this._internalQueue=[]}return(0,s.default)(e,[{key:"addSample",value:function(e){this._internalQueue.length>=this._maxSize&&this._internalQueue.shift(),this._internalQueue.push(e)}},{key:"fetchSample",value:function(){if(this._internalQueue.length>0){var e=Math.floor(Math.random()*this._internalQueue.length);return this._internalQueue.splice(e,1)[0]}}},{key:"mean",get:function(){if(this.length>0){return this._internalQueue.reduce(function(e,t){return e+t})/this.length}return 0}},{key:"length",get:function(){return this._internalQueue.length}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(){var e=s.default.getUAObject();if(!e.ua)return!1;var t=e.browser;return"Edge"===t.name||"Safari"===t.name||"Mobile Safari"===t.name}function i(){return!0||!!(window.RTCPeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection)}function a(e){return!!(i()&&e.ALLOW_P2P&&e.CONTENT_ACTIVATED)&&(!0||(r()||!s.default.isMobile()||e.ENABLE_MOBILE_BROWSER))}Object.defineProperty(t,"__esModule",{value:!0});var o=n(152),s=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default={isP2PAvailable:i,isP2PEnabled:a},e.exports=t.default},function(e,t,n){n(268),e.exports=n(470)},function(e,t,n){"use strict";(function(e){function t(e,t,n){e[t]||Object[r](e,t,{writable:!0,configurable:!0,value:n})}if(n(269),n(466),n(467),e._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");e._babelPolyfill=!0;var r="defineProperty";t(String.prototype,"padLeft","".padStart),t(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(e){[][e]&&t(Array,e,Function.call.bind([][e]))})}).call(t,n(71))},function(e,t,n){n(270),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(350),n(351),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(371),n(372),n(373),n(147),n(374),n(375),n(199),n(376),n(377),n(378),n(379),n(380),n(202),n(204),n(205),n(381),n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(389),n(390),n(391),n(392),n(393),n(394),n(395),n(396),n(397),n(398),n(399),n(400),n(401),n(402),n(403),n(404),n(405),n(406),n(407),n(408),n(409),n(410),n(411),n(412),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(423),n(424),n(425),n(426),n(427),n(428),n(429),n(430),n(431),n(432),n(433),n(434),n(435),n(436),n(437),n(438),n(439),n(440),n(441),n(442),n(443),n(444),n(445),n(446),n(447),n(448),n(449),n(450),n(451),n(452),n(453),n(454),n(455),n(456),n(457),n(458),n(459),n(460),n(461),n(462),n(463),n(464),n(465),e.exports=n(38)},function(e,t,n){"use strict";var r=n(5),i=n(24),a=n(12),o=n(0),s=n(26),u=n(51).KEY,l=n(6),c=n(98),f=n(72),d=n(55),h=n(9),v=n(182),_=n(127),p=n(271),m=n(101),g=n(3),E=n(29),y=n(39),S=n(54),T=n(59),b=n(185),R=n(30),A=n(13),D=n(57),w=R.f,O=A.f,k=b.f,C=r.Symbol,L=r.JSON,P=L&&L.stringify,I="prototype",M=h("_hidden"),N=h("toPrimitive"),x={}.propertyIsEnumerable,F=c("symbol-registry"),U=c("symbols"),B=c("op-symbols"),G=Object[I],H="function"==typeof C,j=r.QObject,W=!j||!j[I]||!j[I].findChild,V=a&&l(function(){return 7!=T(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=w(G,t);r&&delete G[t],O(e,t,n),r&&e!==G&&O(G,t,r)}:O,K=function(e){var t=U[e]=T(C[I]);return t._k=e,t},Y=H&&"symbol"==typeof C.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof C},q=function(e,t,n){return e===G&&q(B,t,n),g(e),t=y(t,!0),g(n),i(U,t)?(n.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),n=T(n,{enumerable:S(0,!1)})):(i(e,M)||O(e,M,S(1,{})),e[M][t]=!0),V(e,t,n)):O(e,t,n)},X=function(e,t){g(e);for(var n,r=p(t=E(t)),i=0,a=r.length;a>i;)q(e,n=r[i++],t[n]);return e},z=function(e,t){return void 0===t?T(e):X(T(e),t)},Q=function(e){var t=x.call(this,e=y(e,!0));return!(this===G&&i(U,e)&&!i(B,e))&&(!(t||!i(this,e)||!i(U,e)||i(this,M)&&this[M][e])||t)},Z=function(e,t){if(e=E(e),t=y(t,!0),e!==G||!i(U,t)||i(B,t)){var n=w(e,t);return!n||!i(U,t)||i(e,M)&&e[M][t]||(n.enumerable=!0),n}},J=function(e){for(var t,n=k(E(e)),r=[],a=0;n.length>a;)i(U,t=n[a++])||t==M||t==u||r.push(t);return r},$=function(e){for(var t,n=e===G,r=k(n?B:E(e)),a=[],o=0;r.length>o;)!i(U,t=r[o++])||n&&!i(G,t)||a.push(U[t]);return a};H||(C=function(){if(this instanceof C)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(B,n),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),V(this,e,S(1,n))};return a&&W&&V(G,e,{configurable:!0,set:t}),K(e)},s(C[I],"toString",function(){return this._k}),R.f=Z,A.f=q,n(60).f=b.f=J,n(82).f=Q,n(100).f=$,a&&!n(56)&&s(G,"propertyIsEnumerable",Q,!0),v.f=function(e){return K(h(e))}),o(o.G+o.W+o.F*!H,{Symbol:C});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)h(ee[te++]);for(var ne=D(h.store),re=0;ne.length>re;)_(ne[re++]);o(o.S+o.F*!H,"Symbol",{for:function(e){return i(F,e+="")?F[e]:F[e]=C(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),o(o.S+o.F*!H,"Object",{create:z,defineProperty:q,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:J,getOwnPropertySymbols:$}),L&&o(o.S+o.F*(!H||l(function(){var e=C();return"[null]"!=P([e])||"{}"!=P({a:e})||"{}"!=P(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!Y(e)){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);return t=r[1],"function"==typeof t&&(n=t),!n&&m(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!Y(t))return t}),r[1]=t,P.apply(L,r)}}}),C[I][N]||n(25)(C[I],N,C[I].valueOf),f(C,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){var r=n(57),i=n(100),a=n(82);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,s=n(e),u=a.f,l=0;s.length>l;)u.call(e,o=s[l++])&&t.push(o);return t}},function(e,t,n){var r=n(0);r(r.S,"Object",{create:n(59)})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(12),"Object",{defineProperty:n(13).f})},function(e,t,n){var r=n(0);r(r.S+r.F*!n(12),"Object",{defineProperties:n(184)})},function(e,t,n){var r=n(29),i=n(30).f;n(42)("getOwnPropertyDescriptor",function(){return function(e,t){return i(r(e),t)}})},function(e,t,n){var r=n(16),i=n(31);n(42)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(16),i=n(57);n(42)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){n(42)("getOwnPropertyNames",function(){return n(185).f})},function(e,t,n){var r=n(7),i=n(51).onFreeze;n(42)("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(7),i=n(51).onFreeze;n(42)("seal",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(7),i=n(51).onFreeze;n(42)("preventExtensions",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(7);n(42)("isFrozen",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(7);n(42)("isSealed",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(7);n(42)("isExtensible",function(e){return function(t){return!!r(t)&&(!e||e(t))}})},function(e,t,n){var r=n(0);r(r.S+r.F,"Object",{assign:n(186)})},function(e,t,n){var r=n(0);r(r.S,"Object",{is:n(287)})},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){var r=n(0);r(r.S,"Object",{setPrototypeOf:n(131).set})},function(e,t,n){"use strict";var r=n(83),i={};i[n(9)("toStringTag")]="z",i+""!="[object z]"&&n(26)(Object.prototype,"toString",function(){return"[object "+r(this)+"]"},!0)},function(e,t,n){var r=n(0);r(r.P,"Function",{bind:n(187)})},function(e,t,n){var r=n(13).f,i=Function.prototype,a=/^\s*function ([^ (]*)/,o="name";o in i||n(12)&&r(i,o,{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(e){return""}}})},function(e,t,n){"use strict";var r=n(7),i=n(31),a=n(9)("hasInstance"),o=Function.prototype;a in o||n(13).f(o,a,{value:function(e){if("function"!=typeof this||!r(e))return!1;if(!r(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},function(e,t,n){var r=n(0),i=n(189);r(r.G+r.F*(parseInt!=i),{parseInt:i})},function(e,t,n){var r=n(0),i=n(190);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},function(e,t,n){"use strict";var r=n(5),i=n(24),a=n(33),o=n(133),s=n(39),u=n(6),l=n(60).f,c=n(30).f,f=n(13).f,d=n(73).trim,h="Number",v=r[h],_=v,p=v.prototype,m=a(n(59)(p))==h,g="trim"in String.prototype,E=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){t=g?t.trim():d(t,3);var n,r,i,a=t.charCodeAt(0);if(43===a||45===a){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+t}for(var o,u=t.slice(2),l=0,c=u.length;l<c;l++)if((o=u.charCodeAt(l))<48||o>i)return NaN;return parseInt(u,r)}}return+t};if(!v(" 0o1")||!v("0b1")||v("+0x1")){v=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof v&&(m?u(function(){p.valueOf.call(n)}):a(n)!=h)?o(new _(E(t)),n,v):E(t)};for(var y,S=n(12)?l(_):("MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,"+"EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,"+"MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger").split(","),T=0;S.length>T;T++)i(_,y=S[T])&&!i(v,y)&&f(v,y,c(_,y));v.prototype=p,p.constructor=v,n(26)(r,h,v)}},function(e,t,n){"use strict";var r=n(0),i=n(41),a=n(191),o=n(134),s=1..toFixed,u=Math.floor,l=[0,0,0,0,0,0],c="Number.toFixed: incorrect invocation!",f="0",d=function(e,t){for(var n=-1,r=t;++n<6;)r+=e*l[n],l[n]=r%1e7,r=u(r/1e7)},h=function(e){for(var t=6,n=0;--t>=0;)n+=l[t],l[t]=u(n/e),n=n%e*1e7},v=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==l[e]){var n=String(l[e]);t=""===t?n:t+o.call(f,7-n.length)+n}return t},_=function(e,t,n){return 0===t?n:t%2==1?_(e,t-1,n*e):_(e*e,t/2,n)},p=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t};r(r.P+r.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!n(6)(function(){s.call({})})),"Number",{toFixed:function(e){var t,n,r,s,u=a(this,c),l=i(e),m="",g=f;if(l<0||l>20)throw RangeError(c);if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return String(u);if(u<0&&(m="-",u=-u),u>1e-21)if(t=p(u*_(2,69,1))-69,n=t<0?u*_(2,-t,1):u/_(2,t,1),n*=4503599627370496,(t=52-t)>0){for(d(0,n),r=l;r>=7;)d(1e7,0),r-=7;for(d(_(10,r,1),0),r=t-1;r>=23;)h(1<<23),r-=23;h(1<<r),d(1,1),h(2),g=v()}else d(0,n),d(1<<-t,0),g=v()+o.call(f,l);return l>0?(s=g.length,g=m+(s<=l?"0."+o.call(f,l-s)+g:g.slice(0,s-l)+"."+g.slice(s-l))):g=m+g,g}})},function(e,t,n){"use strict";var r=n(0),i=n(6),a=n(191),o=1..toPrecision;r(r.P+r.F*(i(function(){return"1"!==o.call(1,void 0)})||!i(function(){o.call({})})),"Number",{toPrecision:function(e){var t=a(this,"Number#toPrecision: incorrect invocation!");return void 0===e?o.call(t):o.call(t,e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},function(e,t,n){var r=n(0),i=n(5).isFinite;r(r.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},function(e,t,n){var r=n(0);r(r.S,"Number",{isInteger:n(192)})},function(e,t,n){var r=n(0);r(r.S,"Number",{isNaN:function(e){return e!=e}})},function(e,t,n){var r=n(0),i=n(192),a=Math.abs;r(r.S,"Number",{isSafeInteger:function(e){return i(e)&&a(e)<=9007199254740991}})},function(e,t,n){var r=n(0);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(0);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(0),i=n(190);r(r.S+r.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(e,t,n){var r=n(0),i=n(189);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(0),i=n(193),a=Math.sqrt,o=Math.acosh;r(r.S+r.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+a(e-1)*a(e+1))}})},function(e,t,n){function r(e){return isFinite(e=+e)&&0!=e?e<0?-r(-e):Math.log(e+Math.sqrt(e*e+1)):e}var i=n(0),a=Math.asinh;i(i.S+i.F*!(a&&1/a(0)>0),"Math",{asinh:r})},function(e,t,n){var r=n(0),i=Math.atanh;r(r.S+r.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},function(e,t,n){var r=n(0),i=n(135);r(r.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},function(e,t,n){var r=n(0),i=Math.exp;r(r.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},function(e,t,n){var r=n(0),i=n(136);r(r.S+r.F*(i!=Math.expm1),"Math",{expm1:i})},function(e,t,n){var r=n(0);r(r.S,"Math",{fround:n(194)})},function(e,t,n){var r=n(0),i=Math.abs;r(r.S,"Math",{hypot:function(e,t){for(var n,r,a=0,o=0,s=arguments.length,u=0;o<s;)n=i(arguments[o++]),u<n?(r=u/n,a=a*r*r+1,u=n):n>0?(r=n/u,a+=r*r):a+=n;return u===1/0?1/0:u*Math.sqrt(a)}})},function(e,t,n){var r=n(0),i=Math.imul;r(r.S+r.F*n(6)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(e,t){var n=65535,r=+e,i=+t,a=n&r,o=n&i;return 0|a*o+((n&r>>>16)*o+a*(n&i>>>16)<<16>>>0)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},function(e,t,n){var r=n(0);r(r.S,"Math",{log1p:n(193)})},function(e,t,n){var r=n(0);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,n){var r=n(0);r(r.S,"Math",{sign:n(135)})},function(e,t,n){var r=n(0),i=n(136),a=Math.exp;r(r.S+r.F*n(6)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(a(e-1)-a(-e-1))*(Math.E/2)}})},function(e,t,n){var r=n(0),i=n(136),a=Math.exp;r(r.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(a(e)+a(-e))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},function(e,t,n){var r=n(0),i=n(58),a=String.fromCharCode,o=String.fromCodePoint;r(r.S+r.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,o=0;r>o;){if(t=+arguments[o++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?a(t):a(((t-=65536)>>10)+55296,t%1024+56320))}return n.join("")}})},function(e,t,n){var r=n(0),i=n(29),a=n(14);r(r.S,"String",{raw:function(e){for(var t=i(e.raw),n=a(t.length),r=arguments.length,o=[],s=0;n>s;)o.push(String(t[s++])),s<r&&o.push(String(arguments[s]));return o.join("")}})},function(e,t,n){"use strict";n(73)("trim",function(e){return function(){return e(this,3)}})},function(e,t,n){"use strict";var r=n(137)(!0);n(138)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";var r=n(0),i=n(137)(!1);r(r.P,"String",{codePointAt:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(0),i=n(14),a=n(140),o="endsWith",s=""[o];r(r.P+r.F*n(141)(o),"String",{endsWith:function(e){var t=a(this,e,o),n=arguments.length>1?arguments[1]:void 0,r=i(t.length),u=void 0===n?r:Math.min(i(n),r),l=String(e);return s?s.call(t,l,u):t.slice(u-l.length,u)===l}})},function(e,t,n){"use strict";var r=n(0),i=n(140),a="includes";r(r.P+r.F*n(141)(a),"String",{includes:function(e){return!!~i(this,e,a).indexOf(e,arguments.length>1?arguments[1]:void 0)}})},function(e,t,n){var r=n(0);r(r.P,"String",{repeat:n(134)})},function(e,t,n){"use strict";var r=n(0),i=n(14),a=n(140),o="startsWith",s=""[o];r(r.P+r.F*n(141)(o),"String",{startsWith:function(e){var t=a(this,e,o),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return s?s.call(t,r,n):t.slice(n,n+r.length)===r}})},function(e,t,n){"use strict";n(27)("anchor",function(e){return function(t){return e(this,"a","name",t)}})},function(e,t,n){"use strict";n(27)("big",function(e){return function(){return e(this,"big","","")}})},function(e,t,n){"use strict";n(27)("blink",function(e){return function(){return e(this,"blink","","")}})},function(e,t,n){"use strict";n(27)("bold",function(e){return function(){return e(this,"b","","")}})},function(e,t,n){"use strict";n(27)("fixed",function(e){return function(){return e(this,"tt","","")}})},function(e,t,n){"use strict";n(27)("fontcolor",function(e){return function(t){return e(this,"font","color",t)}})},function(e,t,n){"use strict";n(27)("fontsize",function(e){return function(t){return e(this,"font","size",t)}})},function(e,t,n){"use strict";n(27)("italics",function(e){return function(){return e(this,"i","","")}})},function(e,t,n){"use strict";n(27)("link",function(e){return function(t){return e(this,"a","href",t)}})},function(e,t,n){"use strict";n(27)("small",function(e){return function(){return e(this,"small","","")}})},function(e,t,n){"use strict";n(27)("strike",function(e){return function(){return e(this,"strike","","")}})},function(e,t,n){"use strict";n(27)("sub",function(e){return function(){return e(this,"sub","","")}})},function(e,t,n){"use strict";n(27)("sup",function(e){return function(){return e(this,"sup","","")}})},function(e,t,n){var r=n(0);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,n){"use strict";var r=n(0),i=n(16),a=n(39);r(r.P+r.F*n(6)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(e){var t=i(this),n=a(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},function(e,t,n){var r=n(0),i=n(349);r(r.P+r.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(e,t,n){"use strict";var r=n(6),i=Date.prototype.getTime,a=Date.prototype.toISOString,o=function(e){return e>9?e:"0"+e};e.exports=r(function(){return"0385-07-25T07:06:39.999Z"!=a.call(new Date(-5e13-1))})||!r(function(){a.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+o(e.getUTCMonth()+1)+"-"+o(e.getUTCDate())+"T"+o(e.getUTCHours())+":"+o(e.getUTCMinutes())+":"+o(e.getUTCSeconds())+"."+(n>99?n:"0"+o(n))+"Z"}:a},function(e,t,n){var r=Date.prototype,i="Invalid Date",a="toString",o=r[a],s=r.getTime;new Date(NaN)+""!=i&&n(26)(r,a,function(){var e=s.call(this);return e===e?o.call(this):i})},function(e,t,n){var r=n(9)("toPrimitive"),i=Date.prototype;r in i||n(25)(i,r,n(352))},function(e,t,n){"use strict";var r=n(3),i=n(39),a="number";e.exports=function(e){if("string"!==e&&e!==a&&"default"!==e)throw TypeError("Incorrect hint");return i(r(this),e!=a)}},function(e,t,n){var r=n(0);r(r.S,"Array",{isArray:n(101)})},function(e,t,n){"use strict";var r=n(32),i=n(0),a=n(16),o=n(195),s=n(142),u=n(14),l=n(143),c=n(144);i(i.S+i.F*!n(103)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,f,d=a(e),h="function"==typeof this?this:Array,v=arguments.length,_=v>1?arguments[1]:void 0,p=void 0!==_,m=0,g=c(d);if(p&&(_=r(_,v>2?arguments[2]:void 0,2)),void 0==g||h==Array&&s(g))for(t=u(d.length),n=new h(t);t>m;m++)l(n,m,p?_(d[m],m):d[m]);else for(f=g.call(d),n=new h;!(i=f.next()).done;m++)l(n,m,p?o(f,_,[i.value,m],!0):i.value);return n.length=m,n}})},function(e,t,n){"use strict";var r=n(0),i=n(143);r(r.S+r.F*n(6)(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},function(e,t,n){"use strict";var r=n(0),i=n(29),a=[].join;r(r.P+r.F*(n(81)!=Object||!n(34)(a)),"Array",{join:function(e){return a.call(i(this),void 0===e?",":e)}})},function(e,t,n){"use strict";var r=n(0),i=n(130),a=n(33),o=n(58),s=n(14),u=[].slice;r(r.P+r.F*n(6)(function(){i&&u.call(i)}),"Array",{slice:function(e,t){var n=s(this.length),r=a(this);if(t=void 0===t?n:t,"Array"==r)return u.call(this,e,t);for(var i=o(e,n),l=o(t,n),c=s(l-i),f=Array(c),d=0;d<c;d++)f[d]="String"==r?this.charAt(i+d):this[i+d];return f}})},function(e,t,n){"use strict";var r=n(0),i=n(18),a=n(16),o=n(6),s=[].sort,u=[1,2,3];r(r.P+r.F*(o(function(){u.sort(void 0)})||!o(function(){u.sort(null)})||!n(34)(s)),"Array",{sort:function(e){return void 0===e?s.call(a(this)):s.call(a(this),i(e))}})},function(e,t,n){"use strict";var r=n(0),i=n(43)(0),a=n(34)([].forEach,!0);r(r.P+r.F*!a,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},function(e,t,n){var r=n(7),i=n(101),a=n(9)("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){"use strict";var r=n(0),i=n(43)(1);r(r.P+r.F*!n(34)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(43)(2);r(r.P+r.F*!n(34)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(43)(3);r(r.P+r.F*!n(34)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(43)(4);r(r.P+r.F*!n(34)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(196);r(r.P+r.F*!n(34)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},function(e,t,n){"use strict";var r=n(0),i=n(196);r(r.P+r.F*!n(34)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},function(e,t,n){"use strict";var r=n(0),i=n(99)(!1),a=[].indexOf,o=!!a&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(o||!n(34)(a)),"Array",{indexOf:function(e){return o?a.apply(this,arguments)||0:i(this,e,arguments[1])}})},function(e,t,n){"use strict";var r=n(0),i=n(29),a=n(41),o=n(14),s=[].lastIndexOf,u=!!s&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(u||!n(34)(s)),"Array",{lastIndexOf:function(e){if(u)return s.apply(this,arguments)||0;var t=i(this),n=o(t.length),r=n-1;for(arguments.length>1&&(r=Math.min(r,a(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}})},function(e,t,n){var r=n(0);r(r.P,"Array",{copyWithin:n(197)}),n(52)("copyWithin")},function(e,t,n){var r=n(0);r(r.P,"Array",{fill:n(146)}),n(52)("fill")},function(e,t,n){"use strict";var r=n(0),i=n(43)(5),a="find",o=!0;a in[]&&Array(1)[a](function(){o=!1}),r(r.P+r.F*o,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(52)(a)},function(e,t,n){"use strict";var r=n(0),i=n(43)(6),a="findIndex",o=!0;a in[]&&Array(1)[a](function(){o=!1}),r(r.P+r.F*o,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(52)(a)},function(e,t,n){n(61)("Array")},function(e,t,n){var r=n(5),i=n(133),a=n(13).f,o=n(60).f,s=n(102),u=n(104),l=r.RegExp,c=l,f=l.prototype,d=/a/g,h=/a/g,v=new l(d)!==d;if(n(12)&&(!v||n(6)(function(){return h[n(9)("match")]=!1,l(d)!=d||l(h)==h||"/a/i"!=l(d,"i")}))){l=function(e,t){var n=this instanceof l,r=s(e),a=void 0===t;return!n&&r&&e.constructor===l&&a?e:i(v?new c(r&&!a?e.source:e,t):c((r=e instanceof l)?e.source:e,r&&a?u.call(e):t),n?this:f,l)};for(var _=o(c),p=0;_.length>p;)!function(e){e in l||a(l,e,{configurable:!0,get:function(){return c[e]},set:function(t){c[e]=t}})}(_[p++]);f.constructor=l,l.prototype=f,n(26)(r,"RegExp",l)}n(61)("RegExp")},function(e,t,n){"use strict";n(199);var r=n(3),i=n(104),a=n(12),o="toString",s=/./[o],u=function(e){n(26)(RegExp.prototype,o,e,!0)};n(6)(function(){return"/a/b"!=s.call({source:"a",flags:"b"})})?u(function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!a&&e instanceof RegExp?i.call(e):void 0)}):s.name!=o&&u(function(){return s.call(this)})},function(e,t,n){n(105)("match",1,function(e,t,n){return[function(n){"use strict";var r=e(this),i=void 0==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},n]})},function(e,t,n){n(105)("replace",2,function(e,t,n){return[function(r,i){"use strict";var a=e(this),o=void 0==r?void 0:r[t];return void 0!==o?o.call(r,a,i):n.call(String(a),r,i)},n]})},function(e,t,n){n(105)("search",1,function(e,t,n){return[function(n){"use strict";var r=e(this),i=void 0==n?void 0:n[t];return void 0!==i?i.call(n,r):new RegExp(n)[t](String(r))},n]})},function(e,t,n){n(105)("split",2,function(e,t,r){"use strict";var i=n(102),a=r,o=[].push,s="split",u="length",l="lastIndex";if("c"=="abbc"[s](/(b)*/)[1]||4!="test"[s](/(?:)/,-1)[u]||2!="ab"[s](/(?:ab)*/)[u]||4!="."[s](/(.?)(.?)/)[u]||"."[s](/()()/)[u]>1||""[s](/.?/)[u]){var c=void 0===/()??/.exec("")[1];r=function(e,t){var n=String(this);if(void 0===e&&0===t)return[];if(!i(e))return a.call(n,e,t);var r,s,f,d,h,v=[],_=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,m=void 0===t?4294967295:t>>>0,g=new RegExp(e.source,_+"g");for(c||(r=new RegExp("^"+g.source+"$(?!\\s)",_));(s=g.exec(n))&&!((f=s.index+s[0][u])>p&&(v.push(n.slice(p,s.index)),!c&&s[u]>1&&s[0].replace(r,function(){for(h=1;h<arguments[u]-2;h++)void 0===arguments[h]&&(s[h]=void 0)}),s[u]>1&&s.index<n[u]&&o.apply(v,s.slice(1)),d=s[0][u],p=f,v[u]>=m));)g[l]===s.index&&g[l]++;return p===n[u]?!d&&g.test("")||v.push(""):v.push(n.slice(p)),v[u]>m?v.slice(0,m):v}}else"0"[s](void 0,0)[u]&&(r=function(e,t){return void 0===e&&0===t?[]:a.call(this,e,t)});return[function(n,i){var a=e(this),o=void 0==n?void 0:n[t];return void 0!==o?o.call(n,a,i):r.call(String(a),n,i)},r]})},function(e,t,n){"use strict";var r,i,a,o,s=n(56),u=n(5),l=n(32),c=n(83),f=n(0),d=n(7),h=n(18),v=n(62),_=n(63),p=n(106),m=n(148).set,g=n(149)(),E=n(150),y=n(200),S=n(201),T="Promise",b=u.TypeError,R=u.process,A=u[T],D="process"==c(R),w=function(){},O=i=E.f,k=!!function(){try{var e=A.resolve(1),t=(e.constructor={})[n(9)("species")]=function(e){e(w,w)};return(D||"function"==typeof PromiseRejectionEvent)&&e.then(w)instanceof t}catch(e){}}(),C=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},L=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,i=1==e._s,a=0;n.length>a;)!function(t){var n,a,o=i?t.ok:t.fail,s=t.resolve,u=t.reject,l=t.domain;try{o?(i||(2==e._h&&M(e),e._h=1),!0===o?n=r:(l&&l.enter(),n=o(r),l&&l.exit()),n===t.promise?u(b("Promise-chain cycle")):(a=C(n))?a.call(n,s,u):s(n)):u(r)}catch(e){u(e)}}(n[a++]);e._c=[],e._n=!1,t&&!e._h&&P(e)})}},P=function(e){m.call(u,function(){var t,n,r,i=e._v,a=I(e);if(a&&(t=y(function(){D?R.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=D||I(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},I=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,r=0;n.length>r;)if(t=n[r++],t.fail||!I(t.promise))return!1;return!0},M=function(e){m.call(u,function(){var t;D?R.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},N=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),L(t,!0))},x=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw b("Promise can't be resolved itself");(t=C(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,l(x,r,1),l(N,r,1))}catch(e){N.call(r,e)}}):(n._v=e,n._s=1,L(n,!1))}catch(e){N.call({_w:n,_d:!1},e)}}};k||(A=function(e){v(this,A,T,"_h"),h(e),r.call(this);try{e(l(x,this,1),l(N,this,1))}catch(e){N.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(64)(A.prototype,{then:function(e,t){var n=O(p(this,A));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=D?R.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&L(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=l(x,e,1),this.reject=l(N,e,1)},E.f=O=function(e){return e===A||e===o?new a(e):i(e)}),f(f.G+f.W+f.F*!k,{Promise:A}),n(72)(A,T),n(61)(T),o=n(38)[T],f(f.S+f.F*!k,T,{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!k),T,{resolve:function(e){return S(s&&this===o?A:this,e)}}),f(f.S+f.F*!(k&&n(103)(function(e){A.all(e).catch(w)})),T,{all:function(e){var t=this,n=O(t),r=n.resolve,i=n.reject,a=y(function(){var n=[],a=0,o=1;_(e,!1,function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--o||r(n))},i)}),--o||r(n)});return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=O(t),r=n.reject,i=y(function(){_(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";var r=n(206),i=n(75),a="WeakSet";n(107)(a,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(i(this,a),e,!0)}},r,!1,!0)},function(e,t,n){"use strict";var r=n(0),i=n(108),a=n(151),o=n(3),s=n(58),u=n(14),l=n(7),c=n(5).ArrayBuffer,f=n(106),d=a.ArrayBuffer,h=a.DataView,v=i.ABV&&c.isView,_=d.prototype.slice,p=i.VIEW,m="ArrayBuffer";r(r.G+r.W+r.F*(c!==d),{ArrayBuffer:d}),r(r.S+r.F*!i.CONSTR,m,{isView:function(e){return v&&v(e)||l(e)&&p in e}}),r(r.P+r.U+r.F*n(6)(function(){return!new d(2).slice(1,void 0).byteLength}),m,{slice:function(e,t){if(void 0!==_&&void 0===t)return _.call(o(this),e);for(var n=o(this).byteLength,r=s(e,n),i=s(void 0===t?n:t,n),a=new(f(this,d))(u(i-r)),l=new h(this),c=new h(a),v=0;r<i;)c.setUint8(v++,l.getUint8(r++));return a}}),n(61)(m)},function(e,t,n){var r=n(0);r(r.G+r.W+r.F*!n(108).ABV,{DataView:n(151).DataView})},function(e,t,n){n(45)("Int8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(45)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(45)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(e,t,n){n(45)("Int16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(45)("Uint16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(45)("Int32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(45)("Uint32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(45)("Float32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){n(45)("Float64",8,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(e,t,n){var r=n(0),i=n(18),a=n(3),o=(n(5).Reflect||{}).apply,s=Function.apply;r(r.S+r.F*!n(6)(function(){o(function(){})}),"Reflect",{apply:function(e,t,n){var r=i(e),u=a(n);return o?o(r,t,u):s.call(r,t,u)}})},function(e,t,n){var r=n(0),i=n(59),a=n(18),o=n(3),s=n(7),u=n(6),l=n(187),c=(n(5).Reflect||{}).construct,f=u(function(){function e(){}return!(c(function(){},[],e)instanceof e)}),d=!u(function(){c(function(){})});r(r.S+r.F*(f||d),"Reflect",{construct:function(e,t){a(e),o(t);var n=arguments.length<3?e:a(arguments[2]);if(d&&!f)return c(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(l.apply(e,r))}var u=n.prototype,h=i(s(u)?u:Object.prototype),v=Function.apply.call(e,h,t);return s(v)?v:h}})},function(e,t,n){var r=n(13),i=n(0),a=n(3),o=n(39);i(i.S+i.F*n(6)(function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,n){a(e),t=o(t,!0),a(n);try{return r.f(e,t,n),!0}catch(e){return!1}}})},function(e,t,n){var r=n(0),i=n(30).f,a=n(3);r(r.S,"Reflect",{deleteProperty:function(e,t){var n=i(a(e),t);return!(n&&!n.configurable)&&delete e[t]}})},function(e,t,n){"use strict";var r=n(0),i=n(3),a=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};n(139)(a,"Object",function(){var e,t=this,n=t._k;do{if(t._i>=n.length)return{value:void 0,done:!0}}while(!((e=n[t._i++])in t._t));return{value:e,done:!1}}),r(r.S,"Reflect",{enumerate:function(e){return new a(e)}})},function(e,t,n){function r(e,t){var n,s,c=arguments.length<3?e:arguments[2];return l(e)===c?e[t]:(n=i.f(e,t))?o(n,"value")?n.value:void 0!==n.get?n.get.call(c):void 0:u(s=a(e))?r(s,t,c):void 0}var i=n(30),a=n(31),o=n(24),s=n(0),u=n(7),l=n(3);s(s.S,"Reflect",{get:r})},function(e,t,n){var r=n(30),i=n(0),a=n(3);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return r.f(a(e),t)}})},function(e,t,n){var r=n(0),i=n(31),a=n(3);r(r.S,"Reflect",{getPrototypeOf:function(e){return i(a(e))}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{has:function(e,t){return t in e}})},function(e,t,n){var r=n(0),i=n(3),a=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(e){return i(e),!a||a(e)}})},function(e,t,n){var r=n(0);r(r.S,"Reflect",{ownKeys:n(208)})},function(e,t,n){var r=n(0),i=n(3),a=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(e){i(e);try{return a&&a(e),!0}catch(e){return!1}}})},function(e,t,n){function r(e,t,n){var u,d,h=arguments.length<4?e:arguments[3],v=a.f(c(e),t);if(!v){if(f(d=o(e)))return r(d,t,n,h);v=l(0)}return s(v,"value")?!(!1===v.writable||!f(h))&&(u=a.f(h,t)||l(0),u.value=n,i.f(h,t,u),!0):void 0!==v.set&&(v.set.call(h,n),!0)}var i=n(13),a=n(30),o=n(31),s=n(24),u=n(0),l=n(54),c=n(3),f=n(7);u(u.S,"Reflect",{set:r})},function(e,t,n){var r=n(0),i=n(131);i&&r(r.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},function(e,t,n){"use strict";var r=n(0),i=n(99)(!0);r(r.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),n(52)("includes")},function(e,t,n){"use strict";var r=n(0),i=n(209),a=n(16),o=n(14),s=n(18),u=n(145);r(r.P,"Array",{flatMap:function(e){var t,n,r=a(this);return s(e),t=o(r.length),n=u(r,0),i(n,r,r,t,0,1,e,arguments[1]),n}}),n(52)("flatMap")},function(e,t,n){"use strict";var r=n(0),i=n(209),a=n(16),o=n(14),s=n(41),u=n(145);r(r.P,"Array",{flatten:function(){var e=arguments[0],t=a(this),n=o(t.length),r=u(t,0);return i(r,t,t,n,0,void 0===e?1:s(e)),r}}),n(52)("flatten")},function(e,t,n){"use strict";var r=n(0),i=n(137)(!0);r(r.P,"String",{at:function(e){return i(this,e)}})},function(e,t,n){"use strict";var r=n(0),i=n(210);r(r.P,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){"use strict";var r=n(0),i=n(210);r(r.P,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},function(e,t,n){"use strict";n(73)("trimLeft",function(e){return function(){return e(this,1)}},"trimStart")},function(e,t,n){"use strict";n(73)("trimRight",function(e){return function(){return e(this,2)}},"trimEnd")},function(e,t,n){"use strict";var r=n(0),i=n(40),a=n(14),o=n(102),s=n(104),u=RegExp.prototype,l=function(e,t){this._r=e,this._s=t};n(139)(l,"RegExp String",function(){var e=this._r.exec(this._s);return{value:e,done:null===e}}),r(r.P,"String",{matchAll:function(e){if(i(this),!o(e))throw TypeError(e+" is not a regexp!");var t=String(this),n="flags"in u?String(e.flags):s.call(e),r=new RegExp(e.source,~n.indexOf("g")?n:"g"+n);return r.lastIndex=a(e.lastIndex),new l(r,t)}})},function(e,t,n){n(127)("asyncIterator")},function(e,t,n){n(127)("observable")},function(e,t,n){var r=n(0),i=n(208),a=n(29),o=n(30),s=n(143);r(r.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,r=a(e),u=o.f,l=i(r),c={},f=0;l.length>f;)void 0!==(n=u(r,t=l[f++]))&&s(c,t,n);return c}})},function(e,t,n){var r=n(0),i=n(211)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){var r=n(0),i=n(211)(!0);r(r.S,"Object",{entries:function(e){return i(e)}})},function(e,t,n){"use strict";var r=n(0),i=n(16),a=n(18),o=n(13);n(12)&&r(r.P+n(109),"Object",{__defineGetter__:function(e,t){o.f(i(this),e,{get:a(t),enumerable:!0,configurable:!0})}})},function(e,t,n){"use strict";var r=n(0),i=n(16),a=n(18),o=n(13);n(12)&&r(r.P+n(109),"Object",{__defineSetter__:function(e,t){o.f(i(this),e,{set:a(t),enumerable:!0,configurable:!0})}})},function(e,t,n){"use strict";var r=n(0),i=n(16),a=n(39),o=n(31),s=n(30).f;n(12)&&r(r.P+n(109),"Object",{__lookupGetter__:function(e){var t,n=i(this),r=a(e,!0);do{if(t=s(n,r))return t.get}while(n=o(n))}})},function(e,t,n){"use strict";var r=n(0),i=n(16),a=n(39),o=n(31),s=n(30).f;n(12)&&r(r.P+n(109),"Object",{__lookupSetter__:function(e){var t,n=i(this),r=a(e,!0);do{if(t=s(n,r))return t.set}while(n=o(n))}})},function(e,t,n){var r=n(0);r(r.P+r.R,"Map",{toJSON:n(212)("Map")})},function(e,t,n){var r=n(0);r(r.P+r.R,"Set",{toJSON:n(212)("Set")})},function(e,t,n){n(110)("Map")},function(e,t,n){n(110)("Set")},function(e,t,n){n(110)("WeakMap")},function(e,t,n){n(110)("WeakSet")},function(e,t,n){n(111)("Map")},function(e,t,n){n(111)("Set")},function(e,t,n){n(111)("WeakMap")},function(e,t,n){n(111)("WeakSet")},function(e,t,n){var r=n(0);r(r.G,{global:n(5)})},function(e,t,n){var r=n(0);r(r.S,"System",{global:n(5)})},function(e,t,n){var r=n(0),i=n(33);r(r.S,"Error",{isError:function(e){return"Error"===i(e)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{clamp:function(e,t,n){return Math.min(n,Math.max(t,e))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(e,t,n){var r=n(0),i=180/Math.PI;r(r.S,"Math",{degrees:function(e){return e*i}})},function(e,t,n){var r=n(0),i=n(214),a=n(194);r(r.S,"Math",{fscale:function(e,t,n,r,o){return a(i(e,t,n,r,o))}})},function(e,t,n){var r=n(0);r(r.S,"Math",{iaddh:function(e,t,n,r){var i=e>>>0,a=t>>>0,o=n>>>0;return a+(r>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(e,t,n){var r=n(0);r(r.S,"Math",{isubh:function(e,t,n,r){var i=e>>>0,a=t>>>0,o=n>>>0;return a-(r>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(e,t,n){var r=n(0);r(r.S,"Math",{imulh:function(e,t){var n=65535,r=+e,i=+t,a=r&n,o=i&n,s=r>>16,u=i>>16,l=(s*o>>>0)+(a*o>>>16);return s*u+(l>>16)+((a*u>>>0)+(l&n)>>16)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(e,t,n){var r=n(0),i=Math.PI/180;r(r.S,"Math",{radians:function(e){return e*i}})},function(e,t,n){var r=n(0);r(r.S,"Math",{scale:n(214)})},function(e,t,n){var r=n(0);r(r.S,"Math",{umulh:function(e,t){var n=65535,r=+e,i=+t,a=r&n,o=i&n,s=r>>>16,u=i>>>16,l=(s*o>>>0)+(a*o>>>16);return s*u+(l>>>16)+((a*u>>>0)+(l&n)>>>16)}})},function(e,t,n){var r=n(0);r(r.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:e>0}})},function(e,t,n){"use strict";var r=n(0),i=n(38),a=n(5),o=n(106),s=n(201);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,i.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){"use strict";var r=n(0),i=n(150),a=n(200);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=a(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){var r=n(46),i=n(3),a=r.key,o=r.set;r.exp({defineMetadata:function(e,t,n,r){o(e,t,i(n),a(r))}})},function(e,t,n){var r=n(46),i=n(3),a=r.key,o=r.map,s=r.store;r.exp({deleteMetadata:function(e,t){var n=arguments.length<3?void 0:a(arguments[2]),r=o(i(t),n,!1);if(void 0===r||!r.delete(e))return!1;if(r.size)return!0;var u=s.get(t);return u.delete(n),!!u.size||s.delete(t)}})},function(e,t,n){var r=n(46),i=n(3),a=n(31),o=r.has,s=r.get,u=r.key,l=function(e,t,n){if(o(e,t,n))return s(e,t,n);var r=a(t);return null!==r?l(e,r,n):void 0};r.exp({getMetadata:function(e,t){return l(e,i(t),arguments.length<3?void 0:u(arguments[2]))}})},function(e,t,n){var r=n(204),i=n(213),a=n(46),o=n(3),s=n(31),u=a.keys,l=a.key,c=function(e,t){var n=u(e,t),a=s(e);if(null===a)return n;var o=c(a,t);return o.length?n.length?i(new r(n.concat(o))):o:n};a.exp({getMetadataKeys:function(e){return c(o(e),arguments.length<2?void 0:l(arguments[1]))}})},function(e,t,n){var r=n(46),i=n(3),a=r.get,o=r.key;r.exp({getOwnMetadata:function(e,t){return a(e,i(t),arguments.length<3?void 0:o(arguments[2]))}})},function(e,t,n){var r=n(46),i=n(3),a=r.keys,o=r.key;r.exp({getOwnMetadataKeys:function(e){return a(i(e),arguments.length<2?void 0:o(arguments[1]))}})},function(e,t,n){var r=n(46),i=n(3),a=n(31),o=r.has,s=r.key,u=function(e,t,n){if(o(e,t,n))return!0;var r=a(t);return null!==r&&u(e,r,n)};r.exp({hasMetadata:function(e,t){return u(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},function(e,t,n){var r=n(46),i=n(3),a=r.has,o=r.key;r.exp({hasOwnMetadata:function(e,t){return a(e,i(t),arguments.length<3?void 0:o(arguments[2]))}})},function(e,t,n){var r=n(46),i=n(3),a=n(18),o=r.key,s=r.set;r.exp({metadata:function(e,t){return function(n,r){s(e,t,(void 0!==r?i:a)(n),o(r))}}})},function(e,t,n){var r=n(0),i=n(149)(),a=n(5).process,o="process"==n(33)(a);r(r.G,{asap:function(e){var t=o&&a.domain;i(t?t.bind(e):e)}})},function(e,t,n){"use strict";var r=n(0),i=n(5),a=n(38),o=n(149)(),s=n(9)("observable"),u=n(18),l=n(3),c=n(62),f=n(64),d=n(25),h=n(63),v=h.RETURN,_=function(e){return null==e?void 0:u(e)},p=function(e){var t=e._c;t&&(e._c=void 0,t())},m=function(e){return void 0===e._o},g=function(e){m(e)||(e._o=void 0,p(e))},E=function(e,t){l(e),this._c=void 0,this._o=e,e=new y(this);try{var n=t(e),r=n;null!=n&&("function"==typeof n.unsubscribe?n=function(){r.unsubscribe()}:u(n),this._c=n)}catch(t){return void e.error(t)}m(this)&&p(this)};E.prototype=f({},{unsubscribe:function(){g(this)}});var y=function(e){this._s=e};y.prototype=f({},{next:function(e){var t=this._s;if(!m(t)){var n=t._o;try{var r=_(n.next);if(r)return r.call(n,e)}catch(e){try{g(t)}finally{throw e}}}},error:function(e){var t=this._s;if(m(t))throw e;var n=t._o;t._o=void 0;try{var r=_(n.error);if(!r)throw e;e=r.call(n,e)}catch(e){try{p(t)}finally{throw e}}return p(t),e},complete:function(e){var t=this._s;if(!m(t)){var n=t._o;t._o=void 0;try{var r=_(n.complete);e=r?r.call(n,e):void 0}catch(e){try{p(t)}finally{throw e}}return p(t),e}}});var S=function(e){c(this,S,"Observable","_f")._f=u(e)};f(S.prototype,{subscribe:function(e){return new E(e,this._f)},forEach:function(e){var t=this;return new(a.Promise||i.Promise)(function(n,r){u(e);var i=t.subscribe({next:function(t){try{return e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:n})})}}),f(S,{from:function(e){var t="function"==typeof this?this:S,n=_(l(e)[s]);if(n){var r=l(n.call(e));return r.constructor===t?r:new t(function(e){return r.subscribe(e)})}return new t(function(t){var n=!1;return o(function(){if(!n){try{if(h(e,!1,function(e){if(t.next(e),n)return v})===v)return}catch(e){if(n)throw e;return void t.error(e)}t.complete()}}),function(){n=!0}})},of:function(){for(var e=0,t=arguments.length,n=Array(t);e<t;)n[e]=arguments[e++];return new("function"==typeof this?this:S)(function(e){var t=!1;return o(function(){if(!t){for(var r=0;r<n.length;++r)if(e.next(n[r]),t)return;e.complete()}}),function(){t=!0}})}}),d(S.prototype,s,function(){return this}),r(r.G,{Observable:S}),n(61)("Observable")},function(e,t,n){var r=n(5),i=n(0),a=r.navigator,o=[].slice,s=!!a&&/MSIE .\./.test(a.userAgent),u=function(e){return function(t,n){var r=arguments.length>2,i=!!r&&o.call(arguments,2);return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};i(i.G+i.B+i.F*s,{setTimeout:u(r.setTimeout),setInterval:u(r.setInterval)})},function(e,t,n){var r=n(0),i=n(148);r(r.G+r.B,{setImmediate:i.set,clearImmediate:i.clear})},function(e,t,n){for(var r=n(147),i=n(57),a=n(26),o=n(5),s=n(25),u=n(74),l=n(9),c=l("iterator"),f=l("toStringTag"),d=u.Array,h={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},v=i(h),_=0;_<v.length;_++){var p,m=v[_],g=h[m],E=o[m],y=E&&E.prototype;if(y&&(y[c]||s(y,c,d),y[f]||s(y,f,m),u[m]=d,g))for(p in r)y[p]||a(y,p,r[p],!0)}},function(e,t,n){(function(t){!function(t){"use strict";function n(e,t,n,r){var a=t&&t.prototype instanceof i?t:i,o=Object.create(a.prototype),s=new h(r||[]);return o._invoke=l(e,n,s),o}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function a(){}function o(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function u(e){function n(t,i,a,o){var s=r(e[t],e,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&g.call(l,"__await")?Promise.resolve(l.__await).then(function(e){n("next",e,a,o)},function(e){n("throw",e,a,o)}):Promise.resolve(l).then(function(e){u.value=e,a(u)},o)}o(s.arg)}function i(e,t){function r(){return new Promise(function(r,i){n(e,t,r,i)})}return a=a?a.then(r,r):r()}"object"==typeof t.process&&t.process.domain&&(n=t.process.domain.bind(n));var a;this._invoke=i}function l(e,t,n){var i=A;return function(a,o){if(i===w)throw new Error("Generator is already running");if(i===O){if("throw"===a)throw o;return _()}for(n.method=a,n.arg=o;!0;){var s=n.delegate;if(s){var u=c(s,n);if(u){if(u===k)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===A)throw i=O,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=w;var l=r(e,t,n);if("normal"===l.type){if(i=n.done?O:D,l.arg===k)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=O,n.method="throw",n.arg=l.arg)}}}function c(e,t){var n=e.iterator[t.method];if(n===p){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=p,c(e,t),"throw"===t.method))return k;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return k}var i=r(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,k;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=p),t.delegate=null,k):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,k)}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function v(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(g.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=p,t.done=!0,t};return r.next=r}}return{next:_}}function _(){return{value:p,done:!0}}var p,m=Object.prototype,g=m.hasOwnProperty,E="function"==typeof Symbol?Symbol:{},y=E.iterator||"@@iterator",S=E.asyncIterator||"@@asyncIterator",T=E.toStringTag||"@@toStringTag",b="object"==typeof e,R=t.regeneratorRuntime;if(R)return void(b&&(e.exports=R));R=t.regeneratorRuntime=b?e.exports:{},R.wrap=n;var A="suspendedStart",D="suspendedYield",w="executing",O="completed",k={},C={};C[y]=function(){return this};var L=Object.getPrototypeOf,P=L&&L(L(v([])));P&&P!==m&&g.call(P,y)&&(C=P);var I=o.prototype=i.prototype=Object.create(C);a.prototype=I.constructor=o,o.constructor=a,o[T]=a.displayName="GeneratorFunction",R.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===a||"GeneratorFunction"===(t.displayName||t.name))},R.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,T in e||(e[T]="GeneratorFunction")),e.prototype=Object.create(I),e},R.awrap=function(e){return{__await:e}},s(u.prototype),u.prototype[S]=function(){return this},R.AsyncIterator=u,R.async=function(e,t,r,i){var a=new u(n(e,t,r,i));return R.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},s(I),I[T]="Generator",I[y]=function(){return this},I.toString=function(){return"[object Generator]"},R.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},R.values=v,h.prototype={constructor:h,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=p,this.done=!1,this.delegate=null,this.method="next",this.arg=p,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&g.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=p)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return a.type="throw",a.arg=e,n.next=t,r&&(n.method="next",n.arg=p),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var o=g.call(i,"catchLoc"),s=g.call(i,"finallyLoc");if(o&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,k):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),k},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),k}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;d(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:v(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=p),k}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,n(71))},function(e,t,n){n(468),e.exports=n(38).RegExp.escape},function(e,t,n){var r=n(0),i=n(469)(/[\\^$*+?.()|[\]{}]/g,"\\$&");r(r.S,"RegExp",{escape:function(e){return i(e)}})},function(e,t){e.exports=function(e,t){var n=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,n)}}},function(e,t,n){"use strict";(function(e){function t(e){return e&&e.__esModule?e:{default:e}}var r=function(){var e="/Users/jlouazel/Streamroot/panama/lib/wrapper.js",t="c692b5a57aec05ac2bd05e10511c20a375e9b068",n=new Function("return this")(),r="__coverage__",i={path:"/Users/jlouazel/Streamroot/panama/lib/wrapper.js",statementMap:{0:{start:{line:13,column:0},end:{line:13,column:22}},1:{start:{line:14,column:0},end:{line:14,column:35}},2:{start:{line:15,column:0},end:{line:15,column:38}},3:{start:{line:17,column:0},end:{line:32,column:1}},4:{start:{line:18,column:2},end:{line:18,column:72}},5:{start:{line:18,column:42},end:{line:18,column:71}},6:{start:{line:19,column:2},end:{line:19,column:74}},7:{start:{line:19,column:43},end:{line:19,column:73}},8:{start:{line:21,column:2},end:{line:25,column:4}},9:{start:{line:22,column:4},end:{line:24,column:5}},10:{start:{line:23,column:6},end:{line:23,column:20}},11:{start:{line:27,column:2},end:{line:31,column:4}},12:{start:{line:28,column:4},end:{line:30,column:5}},13:{start:{line:29,column:6},end:{line:29,column:20}},14:{start:{line:35,column:26},end:{line:35,column:30}},15:{start:{line:36,column:28},end:{line:36,column:32}},16:{start:{line:38,column:0},end:{line:52,column:2}},17:{start:{line:39,column:2},end:{line:51,column:3}},18:{start:{line:40,column:4},end:{line:48,column:27}},19:{start:{line:50,column:4},end:{line:50,column:23}},20:{start:{line:54,column:0},end:{line:60,column:2}},21:{start:{line:55,column:2},end:{line:59,column:3}},22:{start:{line:56,column:4},end:{line:56,column:28}},23:{start:{line:58,column:4},end:{line:58,column:23}},24:{start:{line:62,column:0},end:{line:69,column:2}},25:{start:{line:63,column:2},end:{line:68,column:3}},26:{start:{line:64,column:17},end:{line:64,column:50}},27:{start:{line:65,column:4},end:{line:65,column:58}},28:{start:{line:67,column:4},end:{line:67,column:23}},29:{start:{line:71,column:0},end:{line:80,column:2}},30:{start:{line:72,column:2},end:{line:79,column:3}},31:{start:{line:73,column:4},end:{line:73,column:64}},32:{start:{line:74,column:4},end:{line:74,column:49}},33:{start:{line:75,column:4},end:{line:75,column:51}},34:{start:{line:76,column:4},end:{line:76,column:50}},35:{start:{line:78,column:4},end:{line:78,column:23}},36:{start:{line:82,column:0},end:{line:88,column:2}},37:{start:{line:83,column:2},end:{line:87,column:3}},38:{start:{line:84,column:4},end:{line:84,column:44}},39:{start:{line:86,column:4},end:{line:86,column:23}},40:{start:{line:90,column:0},end:{line:96,column:2}},41:{start:{line:91,column:2},end:{line:95,column:3}},42:{start:{line:92,column:4},end:{line:92,column:48}},43:{start:{line:94,column:4},end:{line:94,column:23}},44:{start:{line:98,column:0},end:{line:104,column:2}},45:{start:{line:99,column:2},end:{line:103,column:3}},46:{start:{line:100,column:4},end:{line:100,column:101}},47:{start:{line:102,column:4},end:{line:102,column:23}},48:{start:{line:106,column:0},end:{line:112,column:2}},49:{start:{line:107,column:2},end:{line:111,column:3}},50:{start:{line:108,column:4},end:{line:108,column:44}},51:{start:{line:110,column:4},end:{line:110,column:23}},52:{start:{line:114,column:0},end:{line:120,column:2}},53:{start:{line:115,column:2},end:{line:119,column:3}},54:{start:{line:116,column:4},end:{line:116,column:105}},55:{start:{line:118,column:4},end:{line:118,column:23}},56:{start:{line:122,column:0},end:{line:128,column:2}},57:{start:{line:123,column:2},end:{line:127,column:3}},58:{start:{line:124,column:4},end:{line:124,column:75}},59:{start:{line:126,column:4},end:{line:126,column:23}},60:{start:{line:130,column:0},end:{line:136,column:2}},61:{start:{line:131,column:2},end:{line:135,column:3}},62:{start:{line:132,column:4},end:{line:132,column:36}},63:{start:{line:134,column:4},end:{line:134,column:23}},64:{start:{line:138,column:0},end:{line:144,column:2}},65:{start:{line:139,column:2},end:{line:143,column:3}},66:{start:{line:140,column:4},end:{line:140,column:47}},67:{start:{line:142,column:4},end:{line:142,column:23}},68:{start:{line:146,column:0},end:{line:152,column:2}},69:{start:{line:147,column:2},end:{line:151,column:3}},70:{start:{line:148,column:4},end:{line:148,column:50}},71:{start:{line:150,column:4},end:{line:150,column:23}},72:{start:{line:154,column:0},end:{line:160,column:2}},73:{start:{line:155,column:2},end:{line:159,column:3}},74:{start:{line:156,column:4},end:{line:156,column:77}},75:{start:{line:158,column:4},end:{line:158,column:23}},76:{start:{line:162,column:0},end:{line:168,column:2}},77:{start:{line:163,column:2},end:{line:167,column:3}},78:{start:{line:164,column:4},end:{line:164,column:57}},79:{start:{line:166,column:4},end:{line:166,column:23}},80:{start:{line:170,column:0},end:{line:176,column:2}},81:{start:{line:171,column:2},end:{line:175,column:3}},82:{start:{line:172,column:4},end:{line:172,column:58}},83:{start:{line:174,column:4},end:{line:174,column:23}},84:{start:{line:178,column:0},end:{line:189,column:2}},85:{start:{line:179,column:2},end:{line:188,column:3}},86:{start:{line:180,column:22},end:{line:183,column:5}},87:{start:{line:184,column:24},end:{line:184,column:58}},88:{start:{line:185,column:4},end:{line:185,column:118}},89:{start:{line:187,column:4},end:{line:187,column:23}},90:{start:{line:191,column:0},end:{line:197,column:2}},91:{start:{line:192,column:2},end:{line:196,column:3}},92:{start:{line:193,column:4},end:{line:193,column:46}},93:{start:{line:195,column:4},end:{line:195,column:23}},94:{start:{line:199,column:0},end:{line:209,column:2}},95:{start:{line:200,column:2},end:{line:208,column:3}},96:{start:{line:201,column:4},end:{line:205,column:5}},97:{start:{line:202,column:6},end:{line:202,column:32}},98:{start:{line:204,column:6},end:{line:204,column:33}},99:{start:{line:207,column:4},end:{line:207,column:23}},100:{start:{line:211,column:0},end:{line:221,column:2}},101:{start:{line:212,column:2},end:{line:220,column:3}},102:{start:{line:213,column:4},end:{line:217,column:5}},103:{start:{line:214,column:6},end:{line:214,column:33}},104:{start:{line:216,column:6},end:{line:216,column:34}},105:{start:{line:219,column:4},end:{line:219,column:23}},106:{start:{line:223,column:0},end:{line:233,column:2}},107:{start:{line:224,column:2},end:{line:232,column:3}},108:{start:{line:225,column:4},end:{line:229,column:5}},109:{start:{line:226,column:6},end:{line:226,column:34}},110:{start:{line:228,column:6},end:{line:228,column:35}},111:{start:{line:231,column:4},end:{line:231,column:23}},112:{start:{line:235,column:0},end:{line:245,column:2}},113:{start:{line:236,column:2},end:{line:244,column:3}},114:{start:{line:237,column:4},end:{line:241,column:5}},115:{start:{line:238,column:6},end:{line:238,column:35}},116:{start:{line:240,column:6},end:{line:240,column:36}},117:{start:{line:243,column:4},end:{line:243,column:23}},118:{start:{line:247,column:0},end:{line:253,column:2}},119:{start:{line:248,column:2},end:{line:252,column:3}},120:{start:{line:249,column:4},end:{line:249,column:31}},121:{start:{line:251,column:4},end:{line:251,column:23}},122:{start:{line:255,column:0},end:{line:261,column:2}},123:{start:{line:256,column:2},end:{line:260,column:3}},124:{start:{line:257,column:4},end:{line:257,column:32}},125:{start:{line:259,column:4},end:{line:259,column:23}},126:{start:{line:263,column:0},end:{line:271,column:2}},127:{start:{line:264,column:2},end:{line:268,column:3}},128:{start:{line:265,column:4},end:{line:265,column:30}},129:{start:{line:267,column:4},end:{line:267,column:23}},130:{start:{line:270,column:2},end:{line:270,column:14}},131:{start:{line:273,column:0},end:{line:279,column:2}},132:{start:{line:274,column:2},end:{line:278,column:3}},133:{start:{line:275,column:4},end:{line:275,column:54}},134:{start:{line:277,column:4},end:{line:277,column:23}},135:{start:{line:281,column:0},end:{line:287,column:2}},136:{start:{line:282,column:2},end:{line:286,column:3}},137:{start:{line:283,column:4},end:{line:283,column:46}},138:{start:{line:285,column:4},end:{line:285,column:23}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:14,column:26},end:{line:14,column:27}},loc:{start:{line:14,column:32},end:{line:14,column:34}},line:14},1:{name:"(anonymous_1)",decl:{start:{line:15,column:29},end:{line:15,column:30}},loc:{start:{line:15,column:35},end:{line:15,column:37}},line:15},2:{name:"(anonymous_2)",decl:{start:{line:18,column:22},end:{line:18,column:23}},loc:{start:{line:18,column:42},end:{line:18,column:71}},line:18},3:{name:"(anonymous_3)",decl:{start:{line:19,column:23},end:{line:19,column:24}},loc:{start:{line:19,column:43},end:{line:19,column:73}},line:19},4:{name:"(anonymous_4)",decl:{start:{line:21,column:24},end:{line:21,column:25}},loc:{start:{line:21,column:35},end:{line:25,column:3}},line:21},5:{name:"(anonymous_5)",decl:{start:{line:27,column:25},end:{line:27,column:26}},loc:{start:{line:27,column:36},end:{line:31,column:3}},line:27},6:{name:"(anonymous_6)",decl:{start:{line:38,column:23},end:{line:38,column:24}},loc:{start:{line:38,column:108},end:{line:52,column:1}},line:38},7:{name:"(anonymous_7)",decl:{start:{line:54,column:23},end:{line:54,column:24}},loc:{start:{line:54,column:29},end:{line:60,column:1}},line:54},8:{name:"(anonymous_8)",decl:{start:{line:62,column:24},end:{line:62,column:25}},loc:{start:{line:62,column:59},end:{line:69,column:1}},line:62},9:{name:"(anonymous_9)",decl:{start:{line:71,column:28},end:{line:71,column:29}},loc:{start:{line:71,column:73},end:{line:80,column:1}},line:71},10:{name:"(anonymous_10)",decl:{start:{line:82,column:20},end:{line:82,column:21}},loc:{start:{line:82,column:45},end:{line:88,column:1}},line:82},11:{name:"(anonymous_11)",decl:{start:{line:90,column:29},end:{line:90,column:30}},loc:{start:{line:90,column:49},end:{line:96,column:1}},line:90},12:{name:"(anonymous_12)",decl:{start:{line:98,column:31},end:{line:98,column:32}},loc:{start:{line:98,column:102},end:{line:104,column:1}},line:98},13:{name:"(anonymous_13)",decl:{start:{line:106,column:29},end:{line:106,column:30}},loc:{start:{line:106,column:52},end:{line:112,column:1}},line:106},14:{name:"(anonymous_14)",decl:{start:{line:114,column:33},end:{line:114,column:34}},loc:{start:{line:114,column:99},end:{line:120,column:1}},line:114},15:{name:"(anonymous_15)",decl:{start:{line:122,column:33},end:{line:122,column:34}},loc:{start:{line:122,column:69},end:{line:128,column:1}},line:122},16:{name:"(anonymous_16)",decl:{start:{line:130,column:24},end:{line:130,column:25}},loc:{start:{line:130,column:45},end:{line:136,column:1}},line:130},17:{name:"(anonymous_17)",decl:{start:{line:138,column:36},end:{line:138,column:37}},loc:{start:{line:138,column:42},end:{line:144,column:1}},line:138},18:{name:"(anonymous_18)",decl:{start:{line:146,column:39},end:{line:146,column:40}},loc:{start:{line:146,column:45},end:{line:152,column:1}},line:146},19:{name:"(anonymous_19)",decl:{start:{line:154,column:30},end:{line:154,column:31}},loc:{start:{line:154,column:70},end:{line:160,column:1}},line:154},20:{name:"(anonymous_20)",decl:{start:{line:162,column:34},end:{line:162,column:35}},loc:{start:{line:162,column:52},end:{line:168,column:1}},line:162},21:{name:"(anonymous_21)",decl:{start:{line:170,column:39},end:{line:170,column:40}},loc:{start:{line:170,column:66},end:{line:176,column:1}},line:170},22:{name:"(anonymous_22)",decl:{start:{line:178,column:36},end:{line:178,column:37}},loc:{start:{line:178,column:131},end:{line:189,column:1}},line:178},23:{name:"(anonymous_23)",decl:{start:{line:191,column:36},end:{line:191,column:37}},loc:{start:{line:191,column:54},end:{line:197,column:1}},line:191},24:{name:"(anonymous_24)",decl:{start:{line:199,column:25},end:{line:199,column:26}},loc:{start:{line:199,column:31},end:{line:209,column:1}},line:199},25:{name:"(anonymous_25)",decl:{start:{line:211,column:26},end:{line:211,column:27}},loc:{start:{line:211,column:32},end:{line:221,column:1}},line:211},26:{name:"(anonymous_26)",decl:{start:{line:223,column:27},end:{line:223,column:28}},loc:{start:{line:223,column:33},end:{line:233,column:1}},line:223},27:{name:"(anonymous_27)",decl:{start:{line:235,column:28},end:{line:235,column:29}},loc:{start:{line:235,column:34},end:{line:245,column:1}},line:235},28:{name:"(anonymous_28)",decl:{start:{line:247,column:32},end:{line:247,column:33}},loc:{start:{line:247,column:40},end:{line:253,column:1}},line:247},29:{name:"(anonymous_29)",decl:{start:{line:255,column:33},end:{line:255,column:34}},loc:{start:{line:255,column:41},end:{line:261,column:1}},line:255},30:{name:"(anonymous_30)",decl:{start:{line:263,column:18},end:{line:263,column:19}},loc:{start:{line:263,column:24},end:{line:271,column:1}},line:263},31:{name:"(anonymous_31)",decl:{start:{line:273,column:31},end:{line:273,column:32}},loc:{start:{line:273,column:49},end:{line:279,column:1}},line:273},32:{name:"(anonymous_32)",decl:{start:{line:281,column:32},end:{line:281,column:33}},loc:{start:{line:281,column:47},end:{line:287,column:1}},line:281}},branchMap:{0:{loc:{start:{line:13,column:9},end:{line:13,column:21}},type:"binary-expr",locations:[{start:{line:13,column:9},end:{line:13,column:15}},{start:{line:13,column:19},end:{line:13,column:21}}],line:13},1:{loc:{start:{line:17,column:0},end:{line:32,column:1}},type:"if",locations:[{start:{line:17,column:0},end:{line:32,column:1}},{start:{line:17,column:0},end:{line:32,column:1}}],line:17},2:{loc:{start:{line:22,column:4},end:{line:24,column:5}},type:"if",locations:[{start:{line:22,column:4},end:{line:24,column:5}},{start:{line:22,column:4},end:{line:24,column:5}}],line:22},3:{loc:{start:{line:28,column:4},end:{line:30,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:30,column:5}},{start:{line:28,column:4},end:{line:30,column:5}}],line:28},4:{loc:{start:{line:201,column:4},end:{line:205,column:5}},type:"if",locations:[{start:{line:201,column:4},end:{line:205,column:5}},{start:{line:201,column:4},end:{line:205,column:5}}],line:201},5:{loc:{start:{line:213,column:4},end:{line:217,column:5}},type:"if",locations:[{start:{line:213,column:4},end:{line:217,column:5}},{start:{line:213,column:4},end:{line:217,column:5}}],line:213},6:{loc:{start:{line:225,column:4},end:{line:229,column:5}},type:"if",locations:[{start:{line:225,column:4},end:{line:229,column:5}},{start:{line:225,column:4},end:{line:229,column:5}}],line:225},7:{loc:{start:{line:237,column:4},end:{line:241,column:5}},type:"if",locations:[{start:{line:237,column:4},end:{line:241,column:5}},{start:{line:237,column:4},end:{line:241,column:5}}],line:237}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0,101:0,102:0,103:0,104:0,105:0,106:0,107:0,108:0,109:0,110:0,111:0,112:0,113:0,114:0,115:0,116:0,117:0,118:0,119:0,120:0,121:0,122:0,123:0,124:0,125:0,126:0,127:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:0,136:0,137:0,138:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),i=n(47),a=n(15),o=n(169),s=t(o),u=n(240),l=n(93),c=t(l),f=n(248),d=t(f),h=n(250),v=t(h),_=n(251),p=t(_),m=n(220),g=n(549),E=t(g);r.s[0]++,window=(r.b[0][0]++,window||(r.b[0][1]++,{})),r.s[1]++,window.addEventListener=function(){r.f[0]++},r.s[2]++,window.removeEventListener=function(){r.f[1]++},r.s[3]++,e.setTimeout?r.b[1][1]++:(r.b[1][0]++,r.s[4]++,e.setTimeout=function(e,t){return r.f[2]++,r.s[5]++,(0,a.createTimeout)(e,t)},r.s[6]++,e.setInterval=function(e,t){return r.f[3]++,r.s[7]++,(0,a.createInterval)(e,t)},r.s[8]++,e.clearTimeout=function(e){r.f[4]++,r.s[9]++,e?(r.b[2][0]++,r.s[10]++,e.clear()):r.b[2][1]++},r.s[11]++,e.clearInterval=function(e){r.f[5]++,r.s[12]++,e?(r.b[3][0]++,r.s[13]++,e.clear()):r.b[3][1]++});var y=void 0,S=(r.s[14]++,!0),T=(r.s[15]++,!0);r.s[16]++,e.createService=function(e,t,n,a,o,s){r.f[6]++,r.s[17]++;try{r.s[18]++,y=new E.default(e,t,parseInt(n,10),a,o,"true"===s,T,S)}catch(e){r.s[19]++,(0,i.nativeError)(e)}},r.s[20]++,e.loadPeerAgent=function(){r.f[7]++,r.s[21]++;try{r.s[22]++,y.loadPeerAgent()}catch(e){r.s[23]++,(0,i.nativeError)(e)}},r.s[24]++,e.updateManifest=function(e,t){for(var n=arguments.length,a=Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];r.f[8]++,r.s[25]++;try{var s=(r.s[26]++,parseInt(e,10)/1e3);r.s[27]++,y.updateManifest(s,a.join("\n"),t)}catch(e){r.s[28]++,(0,i.nativeError)(e)}},r.s[29]++,e.updateMediaElement=function(e,t,n,a){r.f[9]++,r.s[30]++;try{r.s[31]++,y.mediaElement.currentTime=parseFloat(e),r.s[32]++,y.mediaElement.paused="1"===t,r.s[33]++,y.mediaElement.seeking="1"===n,r.s[34]++,y.mediaElement.updateBuffered(a)}catch(e){r.s[35]++,(0,i.nativeError)(e)}},r.s[36]++,e.getSegment=function(e,t){r.f[10]++,r.s[37]++;try{r.s[38]++,y.getSegment(e,t)}catch(e){r.s[39]++,(0,i.nativeError)(e)}},r.s[40]++,e.abortSegmentRequest=function(e){r.f[11]++,r.s[41]++;try{r.s[42]++,y.abortSegmentRequest(e)}catch(e){r.s[43]++,(0,i.nativeError)(e)}},r.s[44]++,e.getBinaryDataCallback=function(e,t,n,a,o){r.f[12]++,r.s[45]++;try{r.s[46]++,p.default.getBinaryDataCallback(e,t,n,a,o)}catch(e){r.s[47]++,(0,i.nativeError)(e)}},r.s[48]++,e.httpRequestProgress=function(e,t,n){r.f[13]++,r.s[49]++;try{r.s[50]++,c.default.progress(e,t,n)}catch(e){r.s[51]++,(0,i.nativeError)(e)}},r.s[52]++,e.httpRequestDataResponse=function(e,t,n,a,o){r.f[14]++,r.s[53]++;try{r.s[54]++,c.default.dataResponse(e,t,n,parseInt(a,10),o)}catch(e){r.s[55]++,(0,i.nativeError)(e)}},r.s[56]++,e.httpRequestJSONResponse=function(e,t,n,a){r.f[15]++,r.s[57]++;try{r.s[58]++,c.default.jsonResponse(e,t,parseInt(n,10),a)}catch(e){r.s[59]++,(0,i.nativeError)(e)}},r.s[60]++,e.hasherCallback=function(e,t){r.f[16]++,r.s[61]++;try{r.s[62]++,(0,u.hasherCallback)(e,t)}catch(e){r.s[63]++,(0,i.nativeError)(e)}},r.s[64]++,e.connectedToSignalingServer=function(){r.f[17]++,r.s[65]++;try{r.s[66]++,d.default.connectedToSignalingServer()}catch(e){r.s[67]++,(0,i.nativeError)(e)}},r.s[68]++,e.disconnectedToSignalingServer=function(){r.f[18]++,r.s[69]++;try{r.s[70]++,d.default.disconnectedToSignalingServer()}catch(e){r.s[71]++,(0,i.nativeError)(e)}},r.s[72]++,e.signalingDidComplete=function(e,t,n){r.f[19]++,r.s[73]++;try{r.s[74]++,d.default.peerConnectionCallback(e,t,n)}catch(e){r.s[75]++,(0,i.nativeError)(e)}},r.s[76]++,e.peerConnectionDidTimeout=function(e){r.f[20]++,r.s[77]++;try{r.s[78]++,d.default.peerConnectionDidTimeout(e)}catch(e){r.s[79]++,(0,i.nativeError)(e)}},r.s[80]++,e.peerConnectionReceivedMessage=function(e,t){r.f[21]++,r.s[81]++;try{r.s[82]++,v.default.receivedMessage(e,t)}catch(e){r.s[83]++,(0,i.nativeError)(e)}},r.s[84]++,e.peerConnectionReceivedData=function(e,t,n,a,o,u,l,c){r.f[22]++,r.s[85]++;try{var f=(r.s[86]++,{level:parseInt(l,10),urlId:parseInt(u,10)}),d=(r.s[87]++,new s.default({sn:o,trackView:f}));r.s[88]++,v.default.receivedData(e,t,n,a,d,c)}catch(e){r.s[89]++,(0,i.nativeError)(e)}},r.s[90]++,e.peerConnectionDisconnected=function(e){r.f[23]++,r.s[91]++;try{r.s[92]++,v.default.onDisconnect(e)}catch(e){r.s[93]++,(0,i.nativeError)(e)}},r.s[94]++,e.enableP2PUpload=function(){r.f[24]++,r.s[95]++;try{r.s[96]++,y?(r.b[4][0]++,r.s[97]++,y.enableP2PUpload()):(r.b[4][1]++,r.s[98]++,S=!0)}catch(e){r.s[99]++,(0,i.nativeError)(e)}},r.s[100]++,e.disableP2PUpload=function(){r.f[25]++,r.s[101]++;try{r.s[102]++,y?(r.b[5][0]++,r.s[103]++,y.disableP2PUpload()):(r.b[5][1]++,r.s[104]++,S=!1)}catch(e){r.s[105]++,(0,i.nativeError)(e)}},r.s[106]++,e.enableP2PDownload=function(){r.f[26]++,r.s[107]++;try{r.s[108]++,y?(r.b[6][0]++,r.s[109]++,y.enableP2PDownload()):(r.b[6][1]++,r.s[110]++,T=!0)}catch(e){r.s[111]++,(0,i.nativeError)(e)}},r.s[112]++,e.disableP2PDownload=function(){r.f[27]++,r.s[113]++;try{r.s[114]++,y?(r.b[7][0]++,r.s[115]++,y.disableP2PDownload()):(r.b[7][1]++,r.s[116]++,T=!1)}catch(e){r.s[117]++,(0,i.nativeError)(e)}},r.s[118]++,e.triggerTimeoutCallback=function(e){r.f[28]++,r.s[119]++;try{r.s[120]++,(0,m.triggerTimeoutCallback)(e)}catch(e){r.s[121]++,(0,i.nativeError)(e)}},r.s[122]++,e.triggerIntervalCallback=function(e){r.f[29]++,r.s[123]++;try{r.s[124]++,(0,m.triggerIntervalCallback)(e)}catch(e){r.s[125]++,(0,i.nativeError)(e)}},r.s[126]++,e.getStats=function(){r.f[30]++,r.s[127]++;try{return r.s[128]++,y.getStats()}catch(e){r.s[129]++,(0,i.nativeError)(e)}return r.s[130]++,null},r.s[131]++,e.peerConnectionOffered=function(e){r.f[31]++,r.s[132]++;try{r.s[133]++,d.default.peerConnectionOffered(e)}catch(e){r.s[134]++,(0,i.nativeError)(e)}},r.s[135]++,e.removeSegmentFromCache=function(e){r.f[32]++,r.s[136]++;try{r.s[137]++,p.default.removeSegmentFromCache(e)}catch(e){r.s[138]++,(0,i.nativeError)(e)}}}).call(t,n(71))},function(e,t,n){var r=n(8),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,n){var r;!function(i,a){"use strict";var o="",s="?",u="function",l="undefined",c="object",f="string",d="model",h="name",v="type",_="vendor",p="version",m="architecture",g="console",E="mobile",y="tablet",S="smarttv",T="wearable",b={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===f?e.replace(/[^\d\.]/g,"").split(".")[0]:a},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},R={rgx:function(e,t){for(var n,r,i,o,s,l,f=0;f<t.length&&!s;){var d=t[f],h=t[f+1];for(n=r=0;n<d.length&&!s;)if(s=d[n++].exec(e))for(i=0;i<h.length;i++)l=s[++r],o=h[i],typeof o===c&&o.length>0?2==o.length?typeof o[1]==u?this[o[0]]=o[1].call(this,l):this[o[0]]=o[1]:3==o.length?typeof o[1]!==u||o[1].exec&&o[1].test?this[o[0]]=l?l.replace(o[1],o[2]):a:this[o[0]]=l?o[1].call(this,l,o[2]):a:4==o.length&&(this[o[0]]=l?o[3].call(this,l.replace(o[1],o[2])):a):this[o]=l||a;f+=2}},str:function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(b.has(t[n][r],e))return n===s?a:n}else if(b.has(t[n],e))return n===s?a:n;return e}},A={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},D={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[h,p],[/(opios)[\/\s]+([\w\.]+)/i],[[h,"Opera Mini"],p],[/\s(opr)\/([\w\.]+)/i],[[h,"Opera"],p],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[h,p],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[h,"IE"],p],[/(edge)\/((\d+)?[\w\.]+)/i],[h,p],[/(yabrowser)\/([\w\.]+)/i],[[h,"Yandex"],p],[/(puffin)\/([\w\.]+)/i],[[h,"Puffin"],p],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[h,"UCBrowser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],p],[/(micromessenger)\/([\w\.]+)/i],[[h,"WeChat"],p],[/(QQ)\/([\d\.]+)/i],[h,p],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[h,p],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[p,[h,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[p,[h,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[p,[h,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[h,/(.+)/,"$1 WebView"],p],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[h,/(.+(?:g|us))(.+)/,"$1 $2"],p],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[p,[h,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[h,p],[/(dolfin)\/([\w\.]+)/i],[[h,"Dolphin"],p],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[h,"Chrome"],p],[/(coast)\/([\w\.]+)/i],[[h,"Opera Coast"],p],[/fxios\/([\w\.-]+)/i],[p,[h,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[p,[h,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[p,h],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[h,"GSA"],p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[h,[p,R.str,A.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[h,p],[/(navigator|netscape)\/([\w\.-]+)/i],[[h,"Netscape"],p],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[h,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,b.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",b.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,b.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[d,_,[v,y]],[/applecoremedia\/[\w\.]+ \((ipad)/],[d,[_,"Apple"],[v,y]],[/(apple\s{0,1}tv)/i],[[d,"Apple TV"],[_,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[_,d,[v,y]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[d,[_,"Amazon"],[v,y]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[d,R.str,A.device.amazon.model],[_,"Amazon"],[v,E]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[d,_,[v,E]],[/\((ip[honed|\s\w*]+);/i],[d,[_,"Apple"],[v,E]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[_,d,[v,E]],[/\(bb10;\s(\w+)/i],[d,[_,"BlackBerry"],[v,E]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[d,[_,"Asus"],[v,y]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[_,"Sony"],[d,"Xperia Tablet"],[v,y]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[d,[_,"Sony"],[v,E]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[_,d,[v,g]],[/android.+;\s(shield)\sbuild/i],[d,[_,"Nvidia"],[v,g]],[/(playstation\s[34portablevi]+)/i],[d,[_,"Sony"],[v,g]],[/(sprint\s(\w+))/i],[[_,R.str,A.device.sprint.vendor],[d,R.str,A.device.sprint.model],[v,E]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[_,d,[v,y]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[_,[d,/_/g," "],[v,E]],[/(nexus\s9)/i],[d,[_,"HTC"],[v,y]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[d,[_,"Huawei"],[v,E]],[/(microsoft);\s(lumia[\s\w]+)/i],[_,d,[v,E]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[d,[_,"Microsoft"],[v,g]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[_,"Microsoft"],[v,E]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[d,[_,"Motorola"],[v,E]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[d,[_,"Motorola"],[v,y]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[_,b.trim],[d,b.trim],[v,S]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[_,"Samsung"],[v,S]],[/\(dtv[\);].+(aquos)/i],[d,[_,"Sharp"],[v,S]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[_,"Samsung"],d,[v,y]],[/smart-tv.+(samsung)/i],[_,[v,S],d],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[_,"Samsung"],d,[v,E]],[/sie-(\w+)*/i],[d,[_,"Siemens"],[v,E]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[_,"Nokia"],d,[v,E]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[d,[_,"Acer"],[v,y]],[/android.+([vl]k\-?\d{3})\s+build/i],[d,[_,"LG"],[v,y]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[_,"LG"],d,[v,y]],[/(lg) netcast\.tv/i],[_,d,[v,S]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[d,[_,"LG"],[v,E]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[d,[_,"Lenovo"],[v,y]],[/linux;.+((jolla));/i],[_,d,[v,E]],[/((pebble))app\/[\d\.]+\s/i],[_,d,[v,T]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[_,d,[v,E]],[/crkey/i],[[d,"Chromecast"],[_,"Google"]],[/android.+;\s(glass)\s\d/i],[d,[_,"Google"],[v,T]],[/android.+;\s(pixel c)\s/i],[d,[_,"Google"],[v,y]],[/android.+;\s(pixel xl|pixel)\s/i],[d,[_,"Google"],[v,E]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[d,/_/g," "],[_,"Xiaomi"],[v,E]],[/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[d,/_/g," "],[_,"Xiaomi"],[v,y]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[d,[_,"Meizu"],[v,y]],[/android.+a000(1)\s+build/i],[d,[_,"OnePlus"],[v,E]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[d,[_,"RCA"],[v,y]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[d,[_,"Dell"],[v,y]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[d,[_,"Verizon"],[v,y]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[_,"Barnes & Noble"],d,[v,y]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[d,[_,"NuVision"],[v,y]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[_,"ZTE"],d,[v,y]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[d,[_,"Swiss"],[v,E]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[d,[_,"Swiss"],[v,y]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[d,[_,"Zeki"],[v,y]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[_,"Dragon Touch"],d,[v,y]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[d,[_,"Insignia"],[v,y]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[d,[_,"NextBook"],[v,y]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[_,"Voice"],d,[v,E]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[_,"LvTel"],d,[v,E]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[d,[_,"Envizen"],[v,y]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[_,d,[v,y]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[d,[_,"MachSpeed"],[v,y]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[_,d,[v,y]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[d,[_,"Rotor"],[v,y]],[/android.+(KS(.+))\s+build/i],[d,[_,"Amazon"],[v,y]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[_,d,[v,y]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[v,b.lowerize],_,d],[/(android.+)[;\/].+build/i],[d,[_,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[p,[h,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[h,p],[/rv\:([\w\.]+).*(gecko)/i],[p,h]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[h,p],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[h,[p,R.str,A.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[h,"Windows"],[p,R.str,A.os.windows.version]],[/\((bb)(10);/i],[[h,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[h,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[h,"Symbian"],p],[/\((series40);/i],[h],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[h,"Firefox OS"],p],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[h,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[h,"Chromium OS"],p],[/(sunos)\s?([\w\.]+\d)*/i],[[h,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[h,p],[/(haiku)\s(\w+)/i],[h,p],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[p,/_/g,"."],[h,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[h,"Mac OS"],[p,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[h,p]]},w=function(e,t){if("object"==typeof e&&(t=e,e=a),!(this instanceof w))return new w(e,t).getResult();var n=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:o),r=t?b.extend(D,t):D;return this.getBrowser=function(){var e={name:a,version:a};return R.rgx.call(e,n,r.browser),e.major=b.major(e.version),e},this.getCPU=function(){var e={architecture:a};return R.rgx.call(e,n,r.cpu),e},this.getDevice=function(){var e={vendor:a,model:a,type:a};return R.rgx.call(e,n,r.device),e},this.getEngine=function(){var e={name:a,version:a};return R.rgx.call(e,n,r.engine),e},this.getOS=function(){var e={name:a,version:a};return R.rgx.call(e,n,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};w.VERSION="0.7.17",w.BROWSER={NAME:h,MAJOR:"major",VERSION:p},w.CPU={ARCHITECTURE:m},w.DEVICE={MODEL:d,VENDOR:_,TYPE:v,CONSOLE:g,MOBILE:E,SMARTTV:S,TABLET:y,WEARABLE:T,EMBEDDED:"embedded"},w.ENGINE={NAME:h,VERSION:p},w.OS={NAME:h,VERSION:p},typeof t!==l?(typeof e!==l&&e.exports&&(t=e.exports=w),t.UAParser=w):"function"===u&&n(473)?(r=function(){return w}.call(t,n,t,e))!==a&&(e.exports=r):i&&(i.UAParser=w);var O=i&&(i.jQuery||i.Zepto);if(typeof O!==l){var k=new w;O.ua=k.getResult(),O.ua.get=function(){return k.getUA()},O.ua.set=function(e){k.setUA(e);var t=k.getResult();for(var n in t)O.ua[n]=t[n]}}}("object"==typeof window?window:this)},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){e.exports={default:n(475),__esModule:!0}},function(e,t,n){n(476);var r=n(8).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(11);r(r.S+r.F*!n(36),"Object",{defineProperty:n(35).f})},function(e,t,n){function r(e,t,n){var r=t&&n||0,i=t||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:u,f=void 0!==e.msecs?e.msecs:(new Date).getTime(),d=void 0!==e.nsecs?e.nsecs:c+1,h=f-l+(d-c)/1e4;if(h<0&&void 0===e.clockseq&&(o=o+1&16383),(h<0||f>l)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=f,c=d,u=o,f+=122192928e5;var v=(1e4*(268435455&f)+d)%4294967296;i[r++]=v>>>24&255,i[r++]=v>>>16&255,i[r++]=v>>>8&255,i[r++]=255&v;var _=f/4294967296*1e4&268435455;i[r++]=_>>>8&255,i[r++]=255&_,i[r++]=_>>>24&15|16,i[r++]=_>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var p=e.node||s,m=0;m<6;++m)i[r+m]=p[m];return t||a(i)}var i=n(218),a=n(219),o=i(),s=[1|o[0],o[1],o[2],o[3],o[4],o[5]],u=16383&(o[6]<<8|o[7]),l=0,c=0;e.exports=r},function(e,t,n){function r(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[r+s]=o[s];return t||a(o)}var i=n(218),a=n(219);e.exports=r},function(e,t,n){n(480),e.exports=n(8).Object.getPrototypeOf},function(e,t,n){var r=n(76),i=n(221);n(77)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){e.exports={default:n(482),__esModule:!0}},function(e,t,n){n(67),n(80),e.exports=n(162).f("iterator")},function(e,t,n){var r=n(158),i=n(155);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(a=s.charCodeAt(u),a<55296||a>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):(a-55296<<10)+(o-56320)+65536)}}},function(e,t,n){"use strict";var r=n(116),i=n(86),a=n(88),o={};n(53)(o,n(20)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(68),i=n(117),a=n(486);e.exports=function(e){return function(t,n,o){var s,u=r(t),l=i(u.length),c=a(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var r=n(158),i=Math.max,a=Math.min;e.exports=function(e,t){return e=r(e),e<0?i(e+t,0):a(e,t)}},function(e,t,n){"use strict";var r=n(488),i=n(226),a=n(78),o=n(68);e.exports=n(159)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t,n){e.exports={default:n(490),__esModule:!0}},function(e,t,n){n(491),n(118),n(493),n(494),e.exports=n(8).Symbol},function(e,t,n){"use strict";var r=n(22),i=n(66),a=n(36),o=n(11),s=n(222),u=n(89).KEY,l=n(65),c=n(157),f=n(88),d=n(113),h=n(20),v=n(162),_=n(163),p=n(492),m=n(227),g=n(44),E=n(68),y=n(154),S=n(86),T=n(116),b=n(228),R=n(230),A=n(35),D=n(79),w=R.f,O=A.f,k=b.f,C=r.Symbol,L=r.JSON,P=L&&L.stringify,I="prototype",M=h("_hidden"),N=h("toPrimitive"),x={}.propertyIsEnumerable,F=c("symbol-registry"),U=c("symbols"),B=c("op-symbols"),G=Object[I],H="function"==typeof C,j=r.QObject,W=!j||!j[I]||!j[I].findChild,V=a&&l(function(){return 7!=T(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=w(G,t);r&&delete G[t],O(e,t,n),r&&e!==G&&O(G,t,r)}:O,K=function(e){var t=U[e]=T(C[I]);return t._k=e,t},Y=H&&"symbol"==typeof C.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof C},q=function(e,t,n){return e===G&&q(B,t,n),g(e),t=y(t,!0),g(n),i(U,t)?(n.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),n=T(n,{enumerable:S(0,!1)})):(i(e,M)||O(e,M,S(1,{})),e[M][t]=!0),V(e,t,n)):O(e,t,n)},X=function(e,t){g(e);for(var n,r=p(t=E(t)),i=0,a=r.length;a>i;)q(e,n=r[i++],t[n]);return e},z=function(e,t){return void 0===t?T(e):X(T(e),t)},Q=function(e){var t=x.call(this,e=y(e,!0));return!(this===G&&i(U,e)&&!i(B,e))&&(!(t||!i(this,e)||!i(U,e)||i(this,M)&&this[M][e])||t)},Z=function(e,t){if(e=E(e),t=y(t,!0),e!==G||!i(U,t)||i(B,t)){var n=w(e,t);return!n||!i(U,t)||i(e,M)&&e[M][t]||(n.enumerable=!0),n}},J=function(e){for(var t,n=k(E(e)),r=[],a=0;n.length>a;)i(U,t=n[a++])||t==M||t==u||r.push(t);return r},$=function(e){for(var t,n=e===G,r=k(n?B:E(e)),a=[],o=0;r.length>o;)!i(U,t=r[o++])||n&&!i(G,t)||a.push(U[t]);return a};H||(C=function(){if(this instanceof C)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(B,n),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),V(this,e,S(1,n))};return a&&W&&V(G,e,{configurable:!0,set:t}),K(e)},s(C[I],"toString",function(){return this._k}),R.f=Z,A.f=q,n(229).f=b.f=J,n(90).f=Q,n(164).f=$,a&&!n(115)&&s(G,"propertyIsEnumerable",Q,!0),v.f=function(e){return K(h(e))}),o(o.G+o.W+o.F*!H,{Symbol:C});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)h(ee[te++]);for(var ne=D(h.store),re=0;ne.length>re;)_(ne[re++]);o(o.S+o.F*!H,"Symbol",{for:function(e){return i(F,e+="")?F[e]:F[e]=C(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in F)if(F[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),o(o.S+o.F*!H,"Object",{create:z,defineProperty:q,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:J,getOwnPropertySymbols:$}),L&&o(o.S+o.F*(!H||l(function(){var e=C();return"[null]"!=P([e])||"{}"!=P({a:e})||"{}"!=P(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!Y(e)){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);return t=r[1],"function"==typeof t&&(n=t),!n&&m(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!Y(t))return t}),r[1]=t,P.apply(L,r)}}}),C[I][N]||n(53)(C[I],N,C[I].valueOf),f(C,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},function(e,t,n){var r=n(79),i=n(164),a=n(90);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,s=n(e),u=a.f,l=0;s.length>l;)u.call(e,o=s[l++])&&t.push(o);return t}},function(e,t,n){n(163)("asyncIterator")},function(e,t,n){n(163)("observable")},function(e,t,n){e.exports={default:n(496),__esModule:!0}},function(e,t,n){n(497),e.exports=n(8).Object.setPrototypeOf},function(e,t,n){var r=n(11);r(r.S,"Object",{setPrototypeOf:n(498).set})},function(e,t,n){var r=n(23),i=n(44),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{r=n(48)(Function.call,n(230).f(Object.prototype,"__proto__").set,2),r(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},function(e,t,n){e.exports={default:n(500),__esModule:!0}},function(e,t,n){n(501);var r=n(8).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){var r=n(11);r(r.S,"Object",{create:n(116)})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(503),_=r(v),p=n(47),m=n(231),g=(r(m),function(e){function t(){return(0,s.default)(this,t),(0,f.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"notify",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"warning";(0,p.nativeError)("["+n+"] "+e+" - "+t)}},{key:"notifyError",value:function(e){(0,p.nativeError)(e)}}]),t}(_.default));t.default=new g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(69),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(231),f=r(c),d=function(){function e(){(0,s.default)(this,e),this._scriptOrigin=null,this._metadata={}}return(0,l.default)(e,[{key:"_onErrorListener",value:function(e){e.filename&&e.filename===this._scriptOrigin&&this.notifyError(new f.default(e))}},{key:"notify",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];throw new Error("AbstractError#notify should be implemented")}},{key:"notifyError",value:function(e,t){throw new Error("AbstractError#notifyError should be implemented")}},{key:"_getAppVersion",value:function(){return"4.10.14".split("-")[0]}},{key:"setMetadata",value:function(e){(0,a.default)(this._metadata,e)}},{key:"setScriptOrigin",value:function(e){this._scriptOrigin=e}},{key:"setCustomer",value:function(e){}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){n(505),e.exports=n(8).Object.assign},function(e,t,n){var r=n(11);r(r.S+r.F,"Object",{assign:n(506)})},function(e,t,n){"use strict";var r=n(79),i=n(164),a=n(90),o=n(76),s=n(160),u=Object.assign;e.exports=!u||n(65)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=o(e),u=arguments.length,l=1,c=i.f,f=a.f;u>l;)for(var d,h=s(arguments[l++]),v=c?r(h).concat(c(h)):r(h),_=v.length,p=0;_>p;)f.call(h,d=v[p++])&&(n[d]=h[d]);return n}:u},function(e,t,n){n(118),n(67),n(80),n(508),n(512),n(514),n(515),e.exports=n(8).Map},function(e,t,n){"use strict";var r=n(232),i=n(168),a="Map";e.exports=n(236)(a,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(i(this,a),e);return t&&t.v},set:function(e,t){return r.def(i(this,a),0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(48),i=n(160),a=n(76),o=n(117),s=n(510);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,c=4==e,f=6==e,d=5==e||f,h=t||s;return function(t,s,v){for(var _,p,m=a(t),g=i(m),E=r(s,v,3),y=o(g.length),S=0,T=n?h(t,y):u?h(t,0):void 0;y>S;S++)if((d||S in g)&&(_=g[S],p=E(_,S,m),e))if(n)T[S]=p;else if(p)switch(e){case 3:return!0;case 5:return _;case 6:return S;case 2:T.push(_)}else if(c)return!1;return f?-1:l||c?c:T}}},function(e,t,n){var r=n(511);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){var r=n(23),i=n(227),a=n(20)("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var r=n(11);r(r.P+r.R,"Map",{toJSON:n(237)("Map")})},function(e,t,n){var r=n(92);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){n(238)("Map")},function(e,t,n){n(239)("Map")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(241),a=r(i),o=n(17),s=r(o),u=n(1),l=r(u),c=n(2),f=r(c),d=n(19),h=r(d),v=n(21),_=r(v),p=n(37),m=r(p),g=n(112),E=r(g),y=n(523),S=r(y),T=n(47),b=n(173),R=r(b),A=n(10),D=r(A),w=n(537),O=r(w),k=n(538),C=r(k),L=new m.default,P=function(e){function t(e,n,r){(0,l.default)(this,t);var i=(0,h.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e,n,r));return i._aborted=!1,i._id="http-request-"+E.default.v4(),i}return(0,_.default)(t,e),(0,f.default)(t,[{key:"_send",value:function(e){var t=this;L.set(this._id,this);var n={id:this._id,method:this._method,url:this._url,response_type:this._options.responseType,headers:this._options.headers,with_credentials:this._options.withCredentials,valid_status_codes:this._options.validStatusCodes,isStreamrootEndpoint:this._isStreamrootEndpoint,body:e};return(0,T.nativeCall)("send_http_request",n),new a.default(function(e,n){t._onSuccess=e,t._onFailure=n})}},{key:"abort",value:function(){var e={id:this._id};this._aborted=!0,(0,T.nativeCall)("abort_http_request",e)}}],[{key:"progress",value:function(e,t,n){var r=L.get(e),i=void 0,a=parseInt(t,10);i=""!==n?new C.default(!0,a,parseInt(n,10)):new C.default(!1,a,0),r?r._options.events.onprogress(i):D.default.notifyError(new Error("Cannot get httpRequest with given id"))}},{key:"dataResponse",value:function(e,n,r,i,a){var o=new R.default(n,parseInt(r,10)),s=L.get(e);s?(s._aborted?s._onFailure(new O.default(t.Errors.REQUEST_ABORTED)):a?s._onFailure(new O.default(a,i)):s._onSuccess(o),L.delete(e)):D.default.notifyError(new Error("Cannot get httpRequest with given id"))}},{key:"jsonResponse",value:function(e,t,n,r){var i=t&&""!==t?JSON.parse(t):null,a=L.get(e);a?(r?a._onFailure(new O.default(r,n)):a._onSuccess(i),L.delete(e)):D.default.notifyError(new Error("Cannot get httpRequest with given id"))}}]),t}(S.default);t.default=P,e.exports=t.default},function(e,t,n){n(118),n(67),n(80),n(518),n(521),n(522),e.exports=n(8).Promise},function(e,t,n){"use strict";var r,i,a,o,s=n(115),u=n(22),l=n(48),c=n(119),f=n(11),d=n(23),h=n(85),v=n(166),_=n(92),p=n(242),m=n(243).set,g=n(520)(),E=n(170),y=n(244),S=n(245),T="Promise",b=u.TypeError,R=u.process,A=u[T],D="process"==c(R),w=function(){},O=i=E.f,k=!!function(){try{var e=A.resolve(1),t=(e.constructor={})[n(20)("species")]=function(e){e(w,w)};return(D||"function"==typeof PromiseRejectionEvent)&&e.then(w)instanceof t}catch(e){}}(),C=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},L=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,i=1==e._s,a=0;n.length>a;)!function(t){var n,a,o=i?t.ok:t.fail,s=t.resolve,u=t.reject,l=t.domain;try{o?(i||(2==e._h&&M(e),e._h=1),!0===o?n=r:(l&&l.enter(),n=o(r),l&&l.exit()),n===t.promise?u(b("Promise-chain cycle")):(a=C(n))?a.call(n,s,u):s(n)):u(r)}catch(e){u(e)}}(n[a++]);e._c=[],e._n=!1,t&&!e._h&&P(e)})}},P=function(e){m.call(u,function(){var t,n,r,i=e._v,a=I(e);if(a&&(t=y(function(){D?R.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=D||I(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},I=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,r=0;n.length>r;)if(t=n[r++],t.fail||!I(t.promise))return!1;return!0},M=function(e){m.call(u,function(){var t;D?R.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},N=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),L(t,!0))},x=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw b("Promise can't be resolved itself");(t=C(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,l(x,r,1),l(N,r,1))}catch(e){N.call(r,e)}}):(n._v=e,n._s=1,L(n,!1))}catch(e){N.call({_w:n,_d:!1},e)}}};k||(A=function(e){v(this,A,T,"_h"),h(e),r.call(this);try{e(l(x,this,1),l(N,this,1))}catch(e){N.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(165)(A.prototype,{then:function(e,t){var n=O(p(this,A));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=D?R.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&L(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=l(x,e,1),this.reject=l(N,e,1)},E.f=O=function(e){return e===A||e===o?new a(e):i(e)}),f(f.G+f.W+f.F*!k,{Promise:A}),n(88)(A,T),n(235)(T),o=n(8)[T],f(f.S+f.F*!k,T,{reject:function(e){var t=O(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(s||!k),T,{resolve:function(e){return S(s&&this===o?A:this,e)}}),f(f.S+f.F*!(k&&n(246)(function(e){A.all(e).catch(w)})),T,{all:function(e){var t=this,n=O(t),r=n.resolve,i=n.reject,a=y(function(){var n=[],a=0,o=1;_(e,!1,function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--o||r(n))},i)}),--o||r(n)});return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=O(t),r=n.reject,i=y(function(){_(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(22),i=n(243).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(87)(o);e.exports=function(){var e,t,n,l=function(){var r,i;for(u&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(l)};else if(a){var c=!0,f=document.createTextNode("");new a(l).observe(f,{characterData:!0}),n=function(){f.data=c=!c}}else if(s&&s.resolve){var d=s.resolve();n=function(){d.then(l)}}else n=function(){i.call(r,l)};return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";var r=n(11),i=n(8),a=n(22),o=n(242),s=n(245);r(r.P+r.R,"Promise",{finally:function(e){var t=o(this,i.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then(function(){return n})}:e,n?function(n){return s(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){"use strict";var r=n(11),i=n(170),a=n(244);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=a(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(241),a=r(i),o=n(94),s=r(o),u=n(1),l=r(u),c=n(2),f=r(c),d=n(15),h=n(70),v=n(171),_=r(v),p=n(536),m={GET:"GET",POST:"POST"},g={JSON:"json",ARRAY_BUFFER:"arraybuffer"},E={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},y={INVALID_STATUS:"Response status is not part of valid status codes",REQUEST_ABORTED:"Request has been aborted",REQUEST_ERROR:"An error occured while sending the request",REQUEST_TIMEOUT:"Request timeout"},S=function(){function e(t,n,r){(0,l.default)(this,e),this._method=t,this._url=n,this._retryCount=0,this._aborted=!1,this._options=_.default.merge({responseType:e.ResponseTypes.JSON,validStatusCodes:[].concat((0,s.default)((0,h.range)(200,206)),[304]),timeout:0,retry:0,retryDelay:0,withCredentials:!1,headers:{},events:{onprogress:p.noop}},r)}return(0,f.default)(e,[{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new a.default(function(n,r){function i(){var e=this;this._send(t).then(function(e){n(e)}).catch(function(t){if(e._retryCount===e._options.retry)return void r(t);e._retryCount++,(0,d.createTimeout)(function(){e._init(),i.call(e)},e._options.retryDelay)})}i.call(e)})}},{key:"abort",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"_send",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"_init",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"isStreamroot",set:function(e){this._isStreamrootEndpoint=e}}]),e}();S.Methods=m,S.ResponseTypes=g,S.ReadyStates=E,S.Errors=y,t.default=S,e.exports=t.default},function(e,t,n){n(67),n(525),e.exports=n(8).Array.from},function(e,t,n){"use strict";var r=n(48),i=n(11),a=n(76),o=n(233),s=n(234),u=n(117),l=n(526),c=n(167);i(i.S+i.F*!n(246)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,f,d=a(e),h="function"==typeof this?this:Array,v=arguments.length,_=v>1?arguments[1]:void 0,p=void 0!==_,m=0,g=c(d);if(p&&(_=r(_,v>2?arguments[2]:void 0,2)),void 0==g||h==Array&&s(g))for(t=u(d.length),n=new h(t);t>m;m++)l(n,m,p?_(d[m],m):d[m]);else for(f=g.call(d),n=new h;!(i=f.next()).done;m++)l(n,m,p?o(f,_,[i.value,m],!0):i.value);return n.length=m,n}})},function(e,t,n){"use strict";var r=n(35),i=n(86);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){n(528),e.exports=n(8).Object.keys},function(e,t,n){var r=n(76),i=n(79);n(77)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){e.exports={default:n(530),__esModule:!0}},function(e,t,n){n(531),e.exports=n(8).Object.isFrozen},function(e,t,n){var r=n(23);n(77)("isFrozen",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){n(533);var r=n(8).Object;e.exports=function(e){return r.getOwnPropertyNames(e)}},function(e,t,n){n(77)("getOwnPropertyNames",function(){return n(228).f})},function(e,t,n){n(535),e.exports=n(8).Object.freeze},function(e,t,n){var r=n(23),i=n(89).onFreeze;n(77)("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.noop=function(){}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,a.default)(this,e),this._message=t,this._status=n}return(0,s.default)(e,[{key:"message",get:function(){return this._message}},{key:"status",get:function(){return this._status}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t,n,r){(0,a.default)(this,e),this._lengthComputable=t,this._loaded=n,this._total=r}return(0,s.default)(e,[{key:"lengthComputable",get:function(){return this._lengthComputable}},{key:"loaded",get:function(){return this._loaded}},{key:"total",get:function(){return this._total}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){n(118),n(67),n(80),n(540),n(541),n(542),n(543),e.exports=n(8).Set},function(e,t,n){"use strict";var r=n(232),i=n(168),a="Set";e.exports=n(236)(a,function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(i(this,a),e=0===e?0:e,e)}},r)},function(e,t,n){var r=n(11);r(r.P+r.R,"Set",{toJSON:n(237)("Set")})},function(e,t,n){n(238)("Set")},function(e,t,n){n(239)("Set")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(49),l=r(u),c=n(95),f=r(c),d=n(4),h=r(d),v=n(10),_=r(v),p=n(15),m=function(){function e(t){(0,a.default)(this,e),this._isCommunicating=!0,this._isConnected=!0,this._rtt=-1,this._ee=new l.default,this._timerStore=new f.default,this._sharedState=t}return(0,s.default)(e,[{key:"_sendHeartbeat",value:function(){return this.sendMessage("heartbeat",{videoTrack:this._getVideoTrack()})}},{key:"_manageHeartbeat",value:function(){var e=this;this._sendHeartbeat();var t=(0,p.createInterval)(function(){e._isCommunicating||(e._sharedState.controlStats.checkHeartbeatFailed++,e._closeConnectionIfOpen()),e._isCommunicating=!1},this._sharedState.conf.CHECK_HEARTBEAT_INTERVAL),n=(0,p.createInterval)(this._sendHeartbeat.bind(this),this._sharedState.conf.SEND_HEARTBEAT_INTERVAL);this._timerStore.register(t),this._timerStore.register(n)}},{key:"_getVideoTrack",value:function(){var e="noTrack";return this._sharedState.moduleState.currentTracks.video&&(e=this._sharedState.moduleState.currentTracks.video.viewToString()),e}},{key:"_setDisconnected",value:function(){if(!this._isConnected)return void _.default.notifyError(new Error("Guarded attempt to trigger 'disconnected' event on PeerConnection more than once"));this._isConnected=!1,this._ee.emit(h.default.PeerConnection.DISCONNECTED)}},{key:"_closeConnectionIfOpen",value:function(){throw new Error("Cannot call abstract method")}},{key:"sendMessage",value:function(e,t){throw new Error("Cannot call abstract method")}},{key:"sendBinaryData",value:function(e,t){throw new Error("Cannot call abstract method")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this._ee).emit.apply(t,[e].concat(r))}},{key:"on",value:function(e,t){this._ee.on(e,t)}},{key:"once",value:function(e,t){this._ee.once(e,t)}},{key:"removeListener",value:function(e,t){this._ee.removeListener(e,t)}},{key:"getRtt",value:function(){return this._rtt}},{key:"getBufferedAmount",value:function(){throw new Error("Cannot call abstract method")}},{key:"onbufferedamountlow",set:function(e){throw new Error("Cannot call abstract method")}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){n(80),n(67),e.exports=n(546)},function(e,t,n){var r=n(44),i=n(167);e.exports=n(8).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n={a:p[e]},r=l(e),i=o(t,r);return(0,_.default)(n,i),n}function a(e){var t=s(e.a);return{type:t,args:u(e,l(t))}}function o(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=(0,h.default)((0,f.default)(t));!(r=(o=s.next()).done);r=!0){var u=o.value;if(void 0===e[u])throw new Error("P2P protocol error: missing mandatory property "+u+" from message to encode");var l=t[u];void 0!==l&&(n[l]=e[u])}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}function s(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,h.default)((0,f.default)(p));!(t=(i=a.next()).done);t=!0){var o=i.value;if(p[o]===e)return o}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return null}function u(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=(0,h.default)((0,f.default)(t));!(r=(o=s.next()).done);r=!0){var u=o.value,l=t[u],c=e[l];if(void 0===c)throw new Error("P2P protocol error: could not decode property "+u+" from encoded payload");n[u]=c}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}function l(e){switch(e){case"info":return m;case"heartbeat":return S;case"requestHasSegment":return g;case"hasSegment":return E;case"requestChunks":return y;default:throw new Error("P2P protocol error: unhandled message type")}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(172),f=r(c),d=n(28),h=r(d),v=n(69),_=r(v),p={info:"a",requestHasSegment:"b",hasSegment:"c",requestChunks:"d",heartbeat:"e"},m={city:"c",country:"d",latitude:"e",longitude:"f"},g={segmentCoord:"b"},E={segmentInfo:"b",pushed:"c"},y={segmentCoord:"b",ids:"c",safe:"d"},S={videoTrack:"b"};t.default={encode:i,decode:a},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getBinaryData",value:function(e,t,n){throw new Error("must be implemented")}},{key:"setBinaryData",value:function(e,t){throw new Error("must be implemented")}},{key:"setComplete",value:function(){}},{key:"destroy",value:function(){}},{key:"byteLength",get:function(){return this._byteLength},set:function(e){this._byteLength=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e="/Users/jlouazel/Streamroot/panama/lib/P2PService.js",t="b58c5e34118b0b384a3be459860bce8487946aeb",n=new Function("return this")(),r="__coverage__",i={path:"/Users/jlouazel/Streamroot/panama/lib/P2PService.js",statementMap:{0:{start:{line:22,column:4},end:{line:22,column:35}},1:{start:{line:23,column:4},end:{line:23,column:38}},2:{start:{line:25,column:4},end:{line:25,column:28}},3:{start:{line:27,column:4},end:{line:27,column:51}},4:{start:{line:28,column:4},end:{line:28,column:55}},5:{start:{line:30,column:4},end:{line:30,column:43}},6:{start:{line:32,column:4},end:{line:32,column:34}},7:{start:{line:33,column:4},end:{line:33,column:50}},8:{start:{line:35,column:4},end:{line:35,column:27}},9:{start:{line:36,column:4},end:{line:36,column:39}},10:{start:{line:38,column:22},end:{line:40,column:5}},11:{start:{line:41,column:4},end:{line:43,column:5}},12:{start:{line:42,column:6},end:{line:42,column:38}},13:{start:{line:44,column:4},end:{line:46,column:5}},14:{start:{line:45,column:6},end:{line:45,column:44}},15:{start:{line:47,column:4},end:{line:47,column:58}},16:{start:{line:49,column:4},end:{line:49,column:31}},17:{start:{line:51,column:4},end:{line:51,column:84}},18:{start:{line:53,column:4},end:{line:53,column:41}},19:{start:{line:57,column:4},end:{line:60,column:5}},20:{start:{line:58,column:6},end:{line:58,column:39}},21:{start:{line:59,column:6},end:{line:59,column:13}},22:{start:{line:62,column:4},end:{line:69,column:12}},23:{start:{line:70,column:4},end:{line:70,column:53}},24:{start:{line:72,column:4},end:{line:80,column:5}},25:{start:{line:73,column:21},end:{line:73,column:50}},26:{start:{line:74,column:33},end:{line:74,column:86}},27:{start:{line:75,column:6},end:{line:75,column:27}},28:{start:{line:76,column:6},end:{line:76,column:45}},29:{start:{line:77,column:6},end:{line:77,column:67}},30:{start:{line:77,column:27},end:{line:77,column:40}},31:{start:{line:78,column:6},end:{line:78,column:65}},32:{start:{line:78,column:27},end:{line:78,column:42}},33:{start:{line:79,column:6},end:{line:79,column:34}},34:{start:{line:82,column:4},end:{line:86,column:5}},35:{start:{line:83,column:6},end:{line:83,column:29}},36:{start:{line:85,column:6},end:{line:85,column:30}},37:{start:{line:88,column:4},end:{line:92,column:5}},38:{start:{line:89,column:6},end:{line:89,column:31}},39:{start:{line:91,column:6},end:{line:91,column:32}},40:{start:{line:94,column:4},end:{line:94,column:36}},41:{start:{line:98,column:4},end:{line:104,column:6}},42:{start:{line:99,column:6},end:{line:99,column:36}},43:{start:{line:101,column:6},end:{line:103,column:7}},44:{start:{line:102,column:8},end:{line:102,column:29}},45:{start:{line:105,column:4},end:{line:105,column:39}},46:{start:{line:107,column:4},end:{line:112,column:6}},47:{start:{line:108,column:6},end:{line:111,column:9}},48:{start:{line:114,column:4},end:{line:128,column:6}},49:{start:{line:115,column:6},end:{line:124,column:11}},50:{start:{line:119,column:10},end:{line:119,column:48}},51:{start:{line:120,column:10},end:{line:123,column:13}},52:{start:{line:126,column:6},end:{line:126,column:45}},53:{start:{line:127,column:6},end:{line:127,column:39}},54:{start:{line:132,column:18},end:{line:132,column:28}},55:{start:{line:133,column:21},end:{line:133,column:50}},56:{start:{line:134,column:22},end:{line:134,column:69}},57:{start:{line:136,column:4},end:{line:139,column:7}},58:{start:{line:137,column:26},end:{line:137,column:95}},59:{start:{line:138,column:6},end:{line:138,column:52}},60:{start:{line:143,column:4},end:{line:143,column:37}},61:{start:{line:145,column:4},end:{line:145,column:43}},62:{start:{line:147,column:4},end:{line:149,column:11}},63:{start:{line:150,column:4},end:{line:150,column:59}},64:{start:{line:153,column:4},end:{line:153,column:37}},65:{start:{line:157,column:21},end:{line:191,column:5}},66:{start:{line:162,column:8},end:{line:165,column:11}},67:{start:{line:166,column:8},end:{line:166,column:54}},68:{start:{line:170,column:75},end:{line:170,column:80}},69:{start:{line:172,column:38},end:{line:172,column:63}},70:{start:{line:173,column:32},end:{line:173,column:61}},71:{start:{line:174,column:22},end:{line:174,column:35}},72:{start:{line:175,column:8},end:{line:177,column:9}},73:{start:{line:176,column:10},end:{line:176,column:60}},74:{start:{line:179,column:21},end:{line:186,column:9}},75:{start:{line:187,column:8},end:{line:187,column:61}},76:{start:{line:189,column:8},end:{line:189,column:54}},77:{start:{line:193,column:24},end:{line:193,column:46}},78:{start:{line:194,column:4},end:{line:194,column:35}},79:{start:{line:196,column:20},end:{line:200,column:5}},80:{start:{line:201,column:27},end:{line:201,column:83}},81:{start:{line:202,column:4},end:{line:202,column:63}},82:{start:{line:206,column:27},end:{line:206,column:69}},83:{start:{line:207,column:4},end:{line:213,column:5}},84:{start:{line:208,column:6},end:{line:208,column:29}},85:{start:{line:212,column:6},end:{line:212,column:96}},86:{start:{line:217,column:4},end:{line:219,column:5}},87:{start:{line:218,column:6},end:{line:218,column:33}},88:{start:{line:220,column:4},end:{line:220,column:16}},89:{start:{line:224,column:4},end:{line:228,column:5}},90:{start:{line:225,column:6},end:{line:225,column:39}},91:{start:{line:227,column:6},end:{line:227,column:38}},92:{start:{line:232,column:4},end:{line:236,column:5}},93:{start:{line:233,column:6},end:{line:233,column:40}},94:{start:{line:235,column:6},end:{line:235,column:39}},95:{start:{line:240,column:4},end:{line:244,column:5}},96:{start:{line:241,column:6},end:{line:241,column:41}},97:{start:{line:243,column:6},end:{line:243,column:40}},98:{start:{line:248,column:4},end:{line:252,column:5}},99:{start:{line:249,column:6},end:{line:249,column:42}},100:{start:{line:251,column:6},end:{line:251,column:41}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:14,column:2},end:{line:14,column:3}},loc:{start:{line:21,column:25},end:{line:54,column:3}},line:21},1:{name:"(anonymous_1)",decl:{start:{line:56,column:2},end:{line:56,column:3}},loc:{start:{line:56,column:18},end:{line:95,column:3}},line:56},2:{name:"(anonymous_2)",decl:{start:{line:77,column:21},end:{line:77,column:22}},loc:{start:{line:77,column:27},end:{line:77,column:40}},line:77},3:{name:"(anonymous_3)",decl:{start:{line:78,column:21},end:{line:78,column:22}},loc:{start:{line:78,column:27},end:{line:78,column:42}},line:78},4:{name:"(anonymous_4)",decl:{start:{line:97,column:2},end:{line:97,column:3}},loc:{start:{line:97,column:29},end:{line:129,column:3}},line:97},5:{name:"(anonymous_5)",decl:{start:{line:98,column:31},end:{line:98,column:32}},loc:{start:{line:98,column:37},end:{line:104,column:5}},line:98},6:{name:"(anonymous_6)",decl:{start:{line:105,column:30},end:{line:105,column:31}},loc:{start:{line:105,column:36},end:{line:105,column:38}},line:105},7:{name:"(anonymous_7)",decl:{start:{line:107,column:30},end:{line:107,column:31}},loc:{start:{line:107,column:36},end:{line:112,column:5}},line:107},8:{name:"(anonymous_8)",decl:{start:{line:114,column:27},end:{line:114,column:28}},loc:{start:{line:114,column:37},end:{line:128,column:5}},line:114},9:{name:"(anonymous_9)",decl:{start:{line:118,column:22},end:{line:118,column:23}},loc:{start:{line:118,column:55},end:{line:124,column:9}},line:118},10:{name:"(anonymous_10)",decl:{start:{line:131,column:2},end:{line:131,column:3}},loc:{start:{line:131,column:30},end:{line:140,column:3}},line:131},11:{name:"(anonymous_11)",decl:{start:{line:136,column:35},end:{line:136,column:36}},loc:{start:{line:136,column:49},end:{line:139,column:5}},line:136},12:{name:"(anonymous_12)",decl:{start:{line:142,column:2},end:{line:142,column:3}},loc:{start:{line:142,column:45},end:{line:154,column:3}},line:142},13:{name:"(anonymous_13)",decl:{start:{line:156,column:2},end:{line:156,column:3}},loc:{start:{line:156,column:34},end:{line:203,column:3}},line:156},14:{name:"(anonymous_14)",decl:{start:{line:159,column:18},end:{line:159,column:19}},loc:{start:{line:159,column:38},end:{line:159,column:40}},line:159},15:{name:"(anonymous_15)",decl:{start:{line:161,column:15},end:{line:161,column:16}},loc:{start:{line:161,column:35},end:{line:167,column:7}},line:161},16:{name:"(anonymous_16)",decl:{start:{line:169,column:17},end:{line:169,column:18}},loc:{start:{line:169,column:47},end:{line:190,column:7}},line:169},17:{name:"(anonymous_17)",decl:{start:{line:205,column:2},end:{line:205,column:3}},loc:{start:{line:205,column:38},end:{line:214,column:3}},line:205},18:{name:"(anonymous_18)",decl:{start:{line:216,column:2},end:{line:216,column:3}},loc:{start:{line:216,column:13},end:{line:221,column:3}},line:216},19:{name:"(anonymous_19)",decl:{start:{line:223,column:2},end:{line:223,column:3}},loc:{start:{line:223,column:20},end:{line:229,column:3}},line:223},20:{name:"(anonymous_20)",decl:{start:{line:231,column:2},end:{line:231,column:3}},loc:{start:{line:231,column:21},end:{line:237,column:3}},line:231},21:{name:"(anonymous_21)",decl:{start:{line:239,column:2},end:{line:239,column:3}},loc:{start:{line:239,column:22},end:{line:245,column:3}},line:239},22:{name:"(anonymous_22)",decl:{start:{line:247,column:2},end:{line:247,column:3}},loc:{start:{line:247,column:23},end:{line:253,column:3}},line:247}},branchMap:{0:{loc:{start:{line:41,column:4},end:{line:43,column:5}},type:"if",locations:[{start:{line:41,column:4},end:{line:43,column:5}},{start:{line:41,column:4},end:{line:43,column:5}}],line:41},1:{loc:{start:{line:44,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:46,column:5}},{start:{line:44,column:4},end:{line:46,column:5}}],line:44},2:{loc:{start:{line:57,column:4},end:{line:60,column:5}},type:"if",locations:[{start:{line:57,column:4},end:{line:60,column:5}},{start:{line:57,column:4},end:{line:60,column:5}}],line:57},3:{loc:{start:{line:72,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:72,column:4},end:{line:80,column:5}},{start:{line:72,column:4},end:{line:80,column:5}}],line:72},4:{loc:{start:{line:82,column:4},end:{line:86,column:5}},type:"if",locations:[{start:{line:82,column:4},end:{line:86,column:5}},{start:{line:82,column:4},end:{line:86,column:5}}],line:82},5:{loc:{start:{line:88,column:4},end:{line:92,column:5}},type:"if",locations:[{start:{line:88,column:4},end:{line:92,column:5}},{start:{line:88,column:4},end:{line:92,column:5}}],line:88},6:{loc:{start:{line:101,column:6},end:{line:103,column:7}},type:"if",locations:[{start:{line:101,column:6},end:{line:103,column:7}},{start:{line:101,column:6},end:{line:103,column:7}}],line:101},7:{loc:{start:{line:145,column:21},end:{line:145,column:42}},type:"binary-expr",locations:[{start:{line:145,column:21},end:{line:145,column:35}},{start:{line:145,column:39},end:{line:145,column:42}}],line:145},8:{loc:{start:{line:147,column:19},end:{line:149,column:10}},type:"cond-expr",locations:[{start:{line:148,column:6},end:{line:148,column:13}},{start:{line:149,column:6},end:{line:149,column:10}}],line:147},9:{loc:{start:{line:150,column:28},end:{line:150,column:58}},type:"binary-expr",locations:[{start:{line:150,column:28},end:{line:150,column:47}},{start:{line:150,column:51},end:{line:150,column:58}}],line:150},10:{loc:{start:{line:175,column:8},end:{line:177,column:9}},type:"if",locations:[{start:{line:175,column:8},end:{line:177,column:9}},{start:{line:175,column:8},end:{line:177,column:9}}],line:175},11:{loc:{start:{line:207,column:4},end:{line:213,column:5}},type:"if",locations:[{start:{line:207,column:4},end:{line:213,column:5}},{start:{line:207,column:4},end:{line:213,column:5}}],line:207},12:{loc:{start:{line:217,column:4},end:{line:219,column:5}},type:"if",locations:[{start:{line:217,column:4},end:{line:219,column:5}},{start:{line:217,column:4},end:{line:219,column:5}}],line:217},13:{loc:{start:{line:224,column:4},end:{line:228,column:5}},type:"if",locations:[{start:{line:224,column:4},end:{line:228,column:5}},{start:{line:224,column:4},end:{line:228,column:5}}],line:224},14:{loc:{start:{line:232,column:4},end:{line:236,column:5}},type:"if",locations:[{start:{line:232,column:4},end:{line:236,column:5}},{start:{line:232,column:4},end:{line:236,column:5}}],line:232},15:{loc:{start:{line:240,column:4},end:{line:244,column:5}},type:"if",locations:[{start:{line:240,column:4},end:{line:244,column:5}},{start:{line:240,column:4},end:{line:244,column:5}}],line:240},16:{loc:{start:{line:248,column:4},end:{line:252,column:5}},type:"if",locations:[{start:{line:248,column:4},end:{line:252,column:5}},{start:{line:248,column:4},end:{line:252,column:5}}],line:248}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0],13:[0,0],14:[0,0],15:[0,0],16:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(550),u=r(s),l=n(551),c=r(l),f=n(169),d=r(f),h=n(120),v=r(h),_=n(552),p=r(_),m=n(47),g=n(673),E=r(g),y=n(675),S=r(y),T=function(){function e(t,n,r,o,s,l,f,d){i(this,e),a.f[0]++,a.s[0]++,this._canLoadPeerAgent=!1,a.s[1]++,this._shouldLoadPeerAgent=!1,a.s[2]++,this._crowUrl=o,a.s[3]++,this.p2pUploadStartValue=d,a.s[4]++,this.p2pDownloadStartValue=f,a.s[5]++,this.mediaElement=new E.default,a.s[6]++,this.parser=new u.default,a.s[7]++,this.mediaMap=new c.default(this.parser.hls),a.s[8]++,this.segmentViews={},a.s[9]++,this.segmentRequestMap=new Map;var h=(a.s[10]++,{streamrootKey:t});a.s[11]++,""!==n?(a.b[0][0]++,a.s[12]++,h.contentId=n):a.b[0][1]++,a.s[13]++,s?(a.b[1][0]++,a.s[14]++,h.backendUrl=s):a.b[1][1]++,a.s[15]++,h.rangeRequestEnabled=l,a.s[16]++,this.p2pConfig=h,a.s[17]++,this.playerInterface=new S.default(this.parser.hls,h,r),a.s[18]++,this._setupParserEvents(this.parser)}return o(e,[{key:"loadPeerAgent",value:function(){var e=this;if(a.f[1]++,a.s[19]++,!this._canLoadPeerAgent)return a.b[2][0]++,a.s[20]++,this._shouldLoadPeerAgent=!0,void a.s[21]++;if(a.b[2][1]++,a.s[22]++,this.srModule=new p.default(this.playerInterface,this.parser.hls.url,this.mediaMap,this.p2pConfig,d.default,p.default.StreamTypes.HLS,"v2"),a.s[23]++,this.srModule.setMediaElement(this.mediaElement),a.s[24]++,1)a.b[3][1]++;else{a.b[3][0]++;var t=(a.s[25]++,require("@streamroot/reaper")),n=(a.s[26]++,require("streamroot-p2p/app/js/utils/timers/factory")),r=n.createInterval;a.s[27]++,t.mobile=!0,a.s[28]++,t.createInterval=r,a.s[29]++,t.collect(function(){return a.f[2]++,a.s[30]++,e.srModule},t.scopes.PeerAgent),a.s[31]++,t.collect(function(){return a.f[3]++,a.s[32]++,e.parser.hls},t.scopes.HlsJS),a.s[33]++,t.crow=this._crowUrl}a.s[34]++,this.p2pUploadStartValue?(a.b[4][0]++,a.s[35]++,this.enableP2PUpload()):(a.b[4][1]++,a.s[36]++,this.disableP2PUpload()),a.s[37]++,this.p2pDownloadStartValue?(a.b[5][0]++,a.s[38]++,this.enableP2PDownload()):(a.b[5][1]++,a.s[39]++,this.disableP2PDownload()),a.s[40]++,(0,m.nativeCall)("peer_agent_loaded")}},{key:"_setupParserEvents",value:function(e){var t=this;a.f[4]++,a.s[41]++,e.onManifestLoading=function(){a.f[5]++,a.s[42]++,t._canLoadPeerAgent=!0,a.s[43]++,t._shouldLoadPeerAgent?(a.b[6][0]++,a.s[44]++,t.loadPeerAgent()):a.b[6][1]++},a.s[45]++,e.onManifestLoaded=function(){a.f[6]++},a.s[46]++,e.onManifestParsed=function(){a.f[7]++,a.s[47]++,(0,m.nativeCall)("truncated_manifest_notification",{url:t.masterURL,manifest:t.masterPlayerlist})},a.s[48]++,e.onLevelLoaded=function(e){a.f[8]++,a.s[49]++,t.playerInterface.truncateManifest(t.playbackTime,e,t.content,function(n,r){a.f[9]++,a.s[50]++,t.mediaElement.duration=r,a.s[51]++,(0,m.nativeCall)("truncated_manifest_notification",{url:e.details.url,manifest:n})}),a.s[52]++,t.playerInterface.levelSwitch(e),a.s[53]++,t._generateSegmentViews(e)}}},{key:"_generateSegmentViews",value:function(e){var t=this;a.f[10]++;var n=(a.s[54]++,e.level),r=(a.s[55]++,this.parser.hls.levels[n]),i=(a.s[56]++,new v.default({level:n,urlId:r.urlId}));a.s[57]++,e.details.fragments.forEach(function(e){a.f[11]++;var n=(a.s[58]++,new d.default({sn:e.sn,trackView:i,time:e.start}));a.s[59]++,t.segmentViews[e.url]=n})}},{key:"updateManifest",value:function(e,t,n){a.f[12]++,a.s[60]++,this.playbackTime=e,a.s[61]++,this.masterURL=(a.b[7][0]++,this.masterURL||(a.b[7][1]++,n)),a.s[62]++,this.content=this.masterPlayerlist?(a.b[8][0]++,t):(a.b[8][1]++,null),a.s[63]++,this.masterPlayerlist=(a.b[9][0]++,this.masterPlaylist||(a.b[9][1]++,t)),a.s[64]++,this.parser.update(t,n)}},{key:"getSegment",value:function(e,t){var n=this;a.f[13]++;var r=(a.s[65]++,{onProgress:function(e,t){a.f[14]++},onError:function(t,r){a.f[15]++,a.s[66]++,(0,m.nativeCall)("get_segment_error_notification",{error:t,proxyRequestId:e}),a.s[67]++,n.segmentRequestMap.delete(e)},onSuccess:function(t,r,i){a.f[16]++;var o=(a.s[68]++,r),s=o.cdnDownloaded,u=o.p2pDownloaded,l=o.cdnDuration,c=o.p2pDuration,f=(a.s[69]++,l+c),d=(a.s[70]++,s+u),h=(a.s[71]++,r.latency);a.s[72]++,void 0===h?(a.b[10][0]++,a.s[73]++,h=Math.min(10,f/2)):a.b[10][1]++;var v=(a.s[74]++,{latency:h,bytesDownloaded:d,totalDownloadDuration:f,proxyRequestId:e,response:t,stats:r});a.s[75]++,(0,m.nativeCall)("get_segment_success_notification",v),a.s[76]++,n.segmentRequestMap.delete(e)}}),i=(a.s[77]++,this.segmentViews[t]);a.s[78]++,window.lastSN=i.sn;var o=(a.s[79]++,{url:t,headers:{},withCredentials:!1}),s=(a.s[80]++,this.srModule.getSegment(o,r,i));a.s[81]++,this.segmentRequestMap.set(e,s)}},{key:"abortSegmentRequest",value:function(e){a.f[17]++;var t=(a.s[82]++,this.segmentRequestMap.get(e));a.s[83]++,t?(a.b[11][0]++,a.s[84]++,t.abort()):(a.b[11][1]++,a.s[85]++,(0,m.nativeError)("Could not abort segment request: no request found for id "+e))}},{key:"getStats",value:function(){return a.f[18]++,a.s[86]++,this.srModule?(a.b[12][0]++,a.s[87]++,this.srModule.stats):(a.b[12][1]++,a.s[88]++,null)}},{key:"enableP2PUpload",value:function(){a.f[19]++,a.s[89]++,this.srModule?(a.b[13][0]++,a.s[90]++,this.srModule.p2pUploadOn=!0):(a.b[13][1]++,a.s[91]++,this.p2pUploadStartValue=!0)}},{key:"disableP2PUpload",value:function(){a.f[20]++,a.s[92]++,this.srModule?(a.b[14][0]++,a.s[93]++,this.srModule.p2pUploadOn=!1):(a.b[14][1]++,a.s[94]++,this.p2pUploadStartValue=!1)}},{key:"enableP2PDownload",value:function(){a.f[21]++,a.s[95]++,this.srModule?(a.b[15][0]++,a.s[96]++,this.srModule.p2pDownloadOn=!0):(a.b[15][1]++,a.s[97]++,this.p2pDownloadStartValue=!0)}},{key:"disableP2PDownload",value:function(){a.f[22]++,a.s[98]++,this.srModule?(a.b[16][0]++,a.s[99]++,this.srModule.p2pDownloadOn=!1):(a.b[16][1]++,a.s[100]++,this.p2pDownloadStartValue=!1)}}]),e}();t.default=T,e.exports=t.default},function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"load",value:function(t,n,r){(0,r.onSuccess)({data:e.Resources[t.url],url:t.url},{},t)}}]),e}();a.Resources={},t.default=a,e.exports=t.default},function(e,t,n){var r,r;!function(t){e.exports=function(){var e;return function e(t,n,i){function a(s,u){if(!n[s]){if(!t[s]){var l="function"==typeof r&&r;if(!u&&l)return r(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return a(n||e)},f,f.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function a(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,u=0;u<r;u++)l[u].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,n,r){!function(t){var i=/^([^#]*)(.*)$/,a=/^([^\?]*)(.*)$/,o=/^(([a-z]+:\/\/)?[^:\/]+(?::[0-9]+)?)?(\/?.*)$/i,s={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var n=null,r=null,u=i.exec(t);u&&(r=u[2],t=u[1]);var l=a.exec(t);l&&(n=l[2],t=l[1]);var c=i.exec(e);c&&(e=c[1]);var f=a.exec(e);f&&(e=f[1]);var d=o.exec(e);if(!d)throw new Error("Error trying to parse base URL.");var h=d[2]||"",v=d[1]||"",_=d[3];0!==_.indexOf("/")&&""!==v&&(_="/"+_);var p=null;return p=/^\/\//.test(t)?h+s.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?v+"/"+s.buildAbsolutePath("",t.substring(1)):s.buildAbsolutePath(v+_,t),n&&(p+=n),r&&(p+=r),p},buildAbsolutePath:function(e,t){for(var n,r,i=t,a="",o=e.replace(/[^\/]*$/,i.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),s=0;(r=o.indexOf("/../",s))>-1;s=r+n)n=/^\/(?:\.\.\/)*/.exec(o.slice(r))[0].length,a=(a+o.substring(s,r)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(n-1)/3+"}$"),"/");return a+o.substr(s)}};"object"==typeof r&&"object"==typeof n?n.exports=s:"function"==typeof e&&e.amd?e([],function(){return s}):"object"==typeof r?r.URLToolkit=s:t.URLToolkit=s}(this)},{}],3:[function(e,t,n){var r=arguments[3],i=arguments[4],a=arguments[5],o=JSON.stringify;t.exports=function(e,t){function n(e){p[e]=!0;for(var t in i[e][1]){var r=i[e][1][t];p[r]||n(r)}}for(var s,u=Object.keys(a),l=0,c=u.length;l<c;l++){var f=u[l],d=a[f].exports;if(d===e||d&&d.default===e){s=f;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},l=0,c=u.length;l<c;l++){var f=u[l];h[f]=f}i[s]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),_={};_[s]=s,i[v]=[Function(["require"],"var f = require("+o(s)+");(f.default ? f.default : f)(self);"),_];var p={};n(v);var m="("+r+")({"+Object.keys(p).map(function(e){return o(e)+":["+i[e][0]+","+o(i[e][1])+"]"}).join(",")+"},{},["+o(v)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return E;var y=g.createObjectURL(E),S=new Worker(y);return S.objectURL=y,S}},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(30),h=r(d),v=e(26),_=e(45),p=e(9),m=r(p),g=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.FRAG_LOADING,l.default.FRAG_LOADED,l.default.FRAG_BUFFERED,l.default.ERROR));return n.lastLoadedFragLevel=0,n._autoLevelCapping=-1,n._nextAutoLevel=-1,n.hls=e,n.onCheck=n.abandonRulesCheck.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.clearTimer(),f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var n=this.hls,r=e.frag.level,i=n.levels[r].details.live,a=n.config,o=void 0,s=void 0;i?(o=a.abrEwmaFastLive,s=a.abrEwmaSlowLive):(o=a.abrEwmaFastVoD,s=a.abrEwmaSlowVoD),this.bwEstimator=new m.default(n,s,o,a.abrEwmaDefaultEstimate)}this.fragCurrent=t}}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,n=this.fragCurrent,r=n.loader,i=this.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return _.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var a=r.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var o=performance.now()-a.trequest,s=Math.abs(t.playbackRate);if(o>500*n.duration/s){var u=e.levels,c=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/o),f=u[n.level],d=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,v=a.total?a.total:Math.max(a.loaded,Math.round(n.duration*d/8)),p=t.currentTime,m=(v-a.loaded)/c,g=(h.default.bufferInfo(t,p,e.config.maxBufferHole).end-p)/s;if(g<2*n.duration/s&&m>g){var E=void 0,y=void 0;for(y=n.level-1;y>i;y--){var S=u[y].realBitrate?Math.max(u[y].realBitrate,u[y].bitrate):u[y].bitrate;if((E=n.duration*S/(6.4*c))<g)break}E<m&&(_.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+E.toFixed(1)+"<"+m.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=y,this.bwEstimator.sample(o,a.loaded),r.abort(),this.clearTimer(),e.trigger(l.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:a}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type){this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1;var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;if(n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i),e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&1===n.loadCounter&&"main"===n.type&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;_.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this.bwEstimator.sample(r,t.loaded),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(e,t,n,r,i,a,o,s,u){for(var l=i;l>=r;l--){var c=u[l],f=c.details,d=f?f.totalduration/f.fragments.length:t,h=!!f&&f.live,v=void 0;v=l<=e?o*n:s*n;var p=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,m=p*d/v;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(v)+"/"+p+"/"+d+"/"+a+"/"+m),v>p&&(!m||h||m<a))return l}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator,n=this.hls,r=n.levels,i=n.config.minAutoBitrate;if(!(-1===e||t&&t.canEstimate()))return Math.min(e,this.maxAutoLevel);var a=this.nextABRAutoLevel;if(-1!==e&&(a=Math.min(e,a)),void 0!==i)for(var o=r[a].realBitrate?Math.max(r[a].realBitrate,r[a].bitrate):r[a].bitrate;o<i;)a++;return a},set:function(e){this._nextAutoLevel=e}},{key:"minAutoLevel",get:function(){for(var e=this.hls,t=e.levels,n=e.config.minAutoBitrate,r=t?t.length:0,i=0;i<r;i++){if((t[i].realBitrate?Math.max(t[i].realBitrate,t[i].bitrate):t[i].bitrate)>n)return i}return 0}},{key:"maxAutoLevel",get:function(){var e=this.hls.levels,t=this._autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextABRAutoLevel",get:function(){var e=this.hls,t=this.maxAutoLevel,n=e.levels,r=e.config,i=this.minAutoLevel,a=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,u=a?a.currentTime:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,f=(h.default.bufferInfo(a,u,r.maxBufferHole).end-u)/l,d=this.findBestLevel(o,s,c,i,t,f,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(d>=0)return d;_.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===f){var g=this.bitrateTestDelay;if(g){v=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-g,_.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),p=m=1}}return d=this.findBestLevel(o,s,c,i,t,f+v,p,m,n),Math.max(d,0)}}]),t}(f.default);n.default=g},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(41),c=r(l),f=e(30),d=r(f),h=e(22),v=r(h),_=e(28),p=r(_),m=e(27),g=r(m),E=e(31),y=r(E),S=e(46),T=r(S),b=e(26),R=e(45),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},D=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.AUDIO_TRACKS_UPDATED,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED,p.default.INIT_PTS_FOUND));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=A.STOPPED,n.ontick=n.tick.bind(n),n.initPTS=[],n.waitingFragment=null,n}return o(t,e),u(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),g.default.prototype.destroy.call(this),this.state=A.STOPPED}},{key:"onInitPtsFound",value:function(e){var t=e.id,n=e.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,R.logger.log("InitPTS for cc:"+n+" found from video track:"+r),this.state===A.WAITING_INIT_PTS&&(R.logger.log("sending pending audio frag to demuxer"),this.state=A.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&-1===e?(R.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,n,r,i,a,o=this,u=this.hls,l=u.config,f=function(){switch(o.state){case A.ERROR:case A.PAUSED:case A.BUFFER_FLUSHING:break;case A.STARTING:o.state=A.WAITING_TRACK,o.loadedmetadata=!1;break;case A.IDLE:var s=o.tracks;if(!s)break;if(!o.media&&(o.startFragRequested||!l.startFragPrefetch))break;e=o.loadedmetadata?o.media.currentTime:o.nextLoadPosition;var f=o.mediaBuffer?o.mediaBuffer:o.media,h=d.default.bufferInfo(f,e,l.maxBufferHole),v=h.len,_=h.end,m=o.fragPrevious,g=l.maxMaxBufferLength,E=o.audioSwitch,y=o.trackId;if(v<g&&y<s.length){if(void 0===(n=s[y].details)){o.state=A.WAITING_TRACK;break}if(!E&&!n.live&&m&&m.sn===n.endSN&&(!o.media.seeking||o.media.duration-_<m.duration/2)){o.hls.trigger(p.default.BUFFER_EOS,{type:"audio"}),o.state=A.ENDED;break}var S=n.fragments,T=S.length,D=S[0].start,w=S[T-1].start+S[T-1].duration,O=void 0;if(E)if(n.live&&!n.PTSKnown)R.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),_=0;else if(_=e,n.PTSKnown&&e<D){if(!(h.end>D||h.nextStart))return{v:void 0};R.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),o.media.currentTime=D+.05}if(_<=D){if(O=S[0],n.live&&O.loadIdx&&O.loadIdx===o.fragLoadIdx){var k=h.nextStart?h.nextStart:D;return R.logger.log("no alt audio available @currentTime:"+o.media.currentTime+", seeking @"+(k+.05)),o.media.currentTime=k+.05,{v:void 0}}}else!function(){var e=void 0,t=l.maxFragLookUpTolerance;_<w?(_>w-t&&(t=0),(e=c.default.search(S,function(e){return e.start+e.duration-t<=_?1:e.start-t>_?-1:0}))||R.logger.log("frag not found @bufferEnd/start:"+_+"/"+D)):e=S[T-1],e&&(O=e,D=e.start,m&&O.level===m.level&&O.sn===m.sn&&(O.sn<n.endSN?(O=S[O.sn+1-n.startSN],R.logger.log("SN just loaded, load next one: "+O.sn)):O=null))}();if(O)if(null!=O.decryptdata.uri&&null==O.decryptdata.key)R.logger.log("Loading key for "+O.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+y),o.state=A.KEY_LOADING,u.trigger(p.default.KEY_LOADING,{frag:O});else{if(R.logger.log("Loading "+O.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+y+", currentTime:"+e+",bufferEnd:"+_.toFixed(3)),void 0!==o.fragLoadIdx?o.fragLoadIdx++:o.fragLoadIdx=0,O.loadCounter){O.loadCounter++;var C=l.fragLoadingLoopThreshold;if(O.loadCounter>C&&Math.abs(o.fragLoadIdx-O.loadIdx)<C)return u.trigger(p.default.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:O}),{v:void 0}}else O.loadCounter=1;O.loadIdx=o.fragLoadIdx,o.fragCurrent=O,o.startFragRequested=!0,o.nextLoadPosition=O.start+O.duration,u.trigger(p.default.FRAG_LOADING,{frag:O}),o.state=A.FRAG_LOADING}}break;case A.WAITING_TRACK:(t=o.tracks[o.trackId])&&t.details&&(o.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:r=performance.now(),i=o.retryDate,f=o.media,a=f&&f.seeking,(!i||r>=i||a)&&(R.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),o.state=A.IDLE);break;case A.WAITING_INIT_PTS:case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}}();if("object"===(void 0===f?"undefined":s(f)))return f.v}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(R.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===A.ENDED&&(this.state=A.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){R.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.state=A.IDLE,this.fragCurrent=null,this.state=A.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=A.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,n=e.id,r=this.tracks[n],i=t.totalduration,a=0;if(R.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var o=r.details;o&&t.fragments.length>0?(y.default.mergeDetails(o,t),a=t.fragments[0].start,t.PTSKnown?R.logger.log("live audio playlist sliding:"+a.toFixed(3)):R.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,R.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;isNaN(s)?this.startPosition=0:(R.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s)}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_TRACK&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&"audio"===e.frag.type&&e.frag.level===t.level&&e.frag.sn===t.sn){this.state=A.PARSING,this.stats=e.stats;var n=this.tracks[this.trackId],r=n.details,i=r.totalduration,a=t.start,o=t.level,s=t.sn,u=t.cc,l=this.config.defaultAudioCodec||n.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new v.default(this.hls,"audio"));var c=this.initPTS[u];if(void 0!==c){this.pendingBuffering=!0,R.logger.log("Demuxing "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o);this.demuxer.push(e.payload,l,null,a,u,o,s,i,t.decryptdata,!1,c)}else R.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o),this.waitingFragment=e,this.state=A.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING){var n=e.tracks,r=void 0;if(n.video&&delete n.video,r=n.audio){r.levelCodec="mp4a.40.2",r.id=e.id,this.hls.trigger(p.default.BUFFER_CODECS,n),R.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var i=r.initSegment;if(i){var a={type:"audio",data:i,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,a))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;n&&"audio"===e.id&&"audio"===e.type&&e.sn===n.sn&&e.level===n.level&&this.state===A.PARSING&&function(){var n=t.trackId,r=t.tracks[n],i=t.fragCurrent,a=t.hls;R.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),y.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS);var o=t.audioSwitch,s=t.media,u=!1;if(o&&s)if(s.readyState){var l=s.currentTime;R.logger.log("switching audio track : currentTime:"+l),l>=e.startPTS&&(R.logger.log("switching audio track : flushing all audio"),t.state=A.BUFFER_FLUSHING,a.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u=!0,t.audioSwitch=!1,a.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:n}))}else t.audioSwitch=!1,a.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:n});var c=t.pendingData;t.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&c.push({type:e.type,data:t,parent:"audio",content:"data"})}),!u&&c.length&&(c.forEach(function(e){t.pendingBuffering=!0,t.hls.trigger(p.default.BUFFER_APPENDING,e)}),t.pendingData=[],t.appended=!0)),t.tick()}()}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==A.PARSING&&t!==A.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==A.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),n.trigger(p.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;R.logger.log("audio buffered : "+T.default.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=A.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var n=this.fragLoadError;n?n++:n=1;var r=this.config;if(n<=r.fragLoadingMaxRetry){this.fragLoadError=n,t.loadCounter=0;var i=Math.min(Math.pow(2,n-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);R.logger.warn("audioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=A.FRAG_LOADING_WAITING_RETRY}else R.logger.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=A.ERROR}break;case b.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,R.logger.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(R.logger.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(p.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=A.PARSED):(this.state=A.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,R.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(g.default);n.default=D},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.AUDIO_TRACK_LOADED));return n.ticks=0,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,n=e.audioTracks||[],r=!1;this.tracks=n,this.hls.trigger(l.default.AUDIO_TRACKS_UPDATED,{audioTracks:n});var i=0;n.forEach(function(e){return e.default?(t.audioTrack=i,void(r=!0)):void i++}),!1===r&&n.length&&(d.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(d.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,d.logger.log("switching to audioTrack "+e);var t=this.tracks[e],n=this.hls,r=t.type,i=t.url,a={id:e,type:r,url:i};n.trigger(l.default.AUDIO_TRACK_SWITCH,a),n.trigger(l.default.AUDIO_TRACK_SWITCHING,a);var o=t.details;!i||void 0!==o&&!0!==o.live||(d.logger.log("(re)loading playlist for audioTrack "+e),n.trigger(l.default.AUDIO_TRACK_LOADING,{url:i,id:e}))}}},{key:"updateTrack",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,d.logger.log("updating audioTrack "+e);var t=this.tracks[e],n=t.url,r=t.details;!n||void 0!==r&&!0!==r.live||(d.logger.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(l.default.AUDIO_TRACK_LOADING,{url:n,id:e}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(f.default);n.default=h},{27:27,28:28,45:45}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=e(26),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return o(t,e),s(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){i=!0,d.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(d.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){var t=e.audio,n=e.video,r=0;e.altAudio&&(t||n)&&(r=(t?1:0)+(n?1:0),d.logger.log(r+" sourceBuffer(s) expected")),this.sourceBufferNb=r}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function(){d.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){d.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(l.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){d.logger.log("media source opened"),this.hls.trigger(l.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){d.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){d.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;d.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,n=this.segments.reduce(function(e,n){return n.parent===t?e+1:e},0);this.hls.trigger(l.default.BUFFER_APPENDED,{parent:t,pending:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(e){d.logger.error("sourceBuffer error:"+e),this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this.onsbue),n.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var n=this.mediaSource;n&&"open"===n.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,n=this.mediaSource;for(var r in e)if(!t[r]){var i=e[r],a=i.levelCodec||i.codec,o=i.container+";codecs="+a;d.logger.log("creating sourceBuffer("+o+")");try{var s=t[r]=n.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[r]={codec:a,container:i.container},i.buffer=s}catch(e){d.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){d.logger.error("sourceBuffer error:",e.event),this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,n=e.type;for(var r in t)n&&r!==n||t[r].ended||(t[r].ended=!0,d.logger.log(r+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var n in e){var r=e[n];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}d.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){d.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e=this.media,t=this.mediaSource,n=this.sourceBuffer,r=this._levelDuration;if(null!==r&&e&&t&&n&&0!==e.readyState&&"open"===t.readyState){for(var i in n)if(n[i].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var a=e.duration;(r>this._msDuration&&r>a||a===1/0||isNaN(a))&&(d.logger.log("Updating mediasource duration to "+r.toFixed(3)),this._msDuration=t.duration=r)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n)t+=n[r].buffered.length}catch(e){d.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(l.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,n=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void d.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var r=n.shift();try{var i=r.type,a=t[i];a?a.updating?n.unshift(r):(a.ended=!1,this.parent=r.parent,a.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){d.logger.error("error while trying to append buffer:"+t.message),n.unshift(r);var o={type:h.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],o.details=h.ErrorDetails.BUFFER_FULL_ERROR,o.fatal=!1,void e.trigger(l.default.ERROR,o);if(this.appendError?this.appendError++:this.appendError=1,o.details=h.ErrorDetails.BUFFER_APPEND_ERROR,o.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return d.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),n=[],o.fatal=!0,void e.trigger(l.default.ERROR,o);o.fatal=!1,e.trigger(l.default.ERROR,o)}}}}},{key:"flushBuffer",value:function(e,t,n){var r,i,a,o,s,u,l=this.sourceBuffer;if(Object.keys(l).length){if(d.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var c in l)if(!n||c===n){if(r=l[c],r.ended=!1,r.updating)return d.logger.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<r.buffered.length;i++)if(a=r.buffered.start(i),o=r.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(s=e,u=t):(s=Math.max(a,e),u=Math.min(o,t)),Math.min(u,o)-s>.5)return this.flushBufferCounter++,d.logger.log("flush "+c+" ["+s+","+u+"], of ["+a+","+o+"], pos:"+this.media.currentTime),r.remove(s,u),!1}catch(e){d.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else d.logger.warn("abort flushing too many retries");d.logger.log("buffer flushed")}return!0}}]),t}(f.default);n.default=v},{26:26,27:27,28:28,45:45}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.FPS_DROP_LEVEL_CAPPING,l.default.MEDIA_ATTACHING,l.default.MANIFEST_PARSED))}return o(t,e),s(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var t=0,n=void 0,r=void 0,i=this.mediaWidth,a=this.mediaHeight,o=0,s=0;for(n=0;n<=e&&(r=this.levels[n],!this.isLevelRestricted(n))&&(t=n,o=r.width,s=r.height,!(i<=o||a<=s));n++);return t}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(e))}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(f.default);n.default=d},{27:27,28:28}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(44),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n,i,a){r(this,e),this.hls=t,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new o.default(n),this.fast_=new o.default(i)}return i(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var n=8e3*t/e,r=e/1e3;this.fast_.sample(r,n),this.slow_.sample(r,n)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();n.default=s},{44:44}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MEDIA_ATTACHING))}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){"function"==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,n){var r=performance.now();if(t){if(this.lastTime){var i=r-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/i,u=this.hls;if(u.trigger(l.default.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),s>0&&a>u.config.fpsDroppedMonitoringThreshold*o){var c=u.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=c)&&(c-=1,u.trigger(l.default.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,u.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(f.default);n.default=h},{27:27,28:28,45:45}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=e(26),v=e(30),_=r(v),p=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MANIFEST_LOADED,l.default.LEVEL_LOADED,l.default.FRAG_LOADED,l.default.ERROR));return n.ontick=n.tick.bind(n),n._manualLevel=n._autoLevelCapping=-1,n}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,n=[],r=[],i={},a=!1,o=!1,s=this.hls,u=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c=function(e,t){return MediaSource.isTypeSupported(e+"/mp4;codecs="+t)};if(e.levels.forEach(function(e){e.videoCodec&&(a=!0),u&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(o=!0);var t=i[e.bitrate];void 0===t?(i[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),a&&o?n.forEach(function(e){e.videoCodec&&r.push(e)}):r=n,r=r.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||c("audio",t))&&(!n||c("video",n))}),r.length){t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var f=0;f<r.length;f++)if(r[f].bitrate===t){this._firstLevel=f,d.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}s.trigger(l.default.MANIFEST_PARSED,{levels:r,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:a,altAudio:e.audioTracks.length>0})}else s.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e&&(d.logger.log("switching to level "+e),this._level=e,this.hls.trigger(l.default.LEVEL_SWITCH,{level:e}));var n=t[e],r=n.details;if(!r||!0===r.live){var i=n.urlId;this.hls.trigger(l.default.LEVEL_LOADING,{url:n.url[i],level:e,id:i})}}else this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,n=this.hls,r=void 0,i=void 0,a=!1,o=n.abrController,s=o.minAutoLevel;switch(t){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:r=e.frag.level;break;case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:r=e.context.level,a=!0;break;case h.ErrorDetails.REMUX_ALLOC_ERROR:r=e.level}if(void 0!==r){i=this._levels[r],i.loadError?i.loadError++:i.loadError=1;var u=i.url.length;if(u>1&&i.loadError<u)i.urlId=(i.urlId+1)%u,i.details=void 0,d.logger.warn("level controller,"+t+" for level "+r+": switching to redundant stream id "+i.urlId);else{if(-1===this._manualLevel&&r)d.logger.warn("level controller,"+t+": switch-down for next fragment"),o.nextAutoLevel=Math.max(s,r-1);else if(i&&i.details&&i.details.live)d.logger.warn("level controller,"+t+" on live stream, discard"),a&&(this._level=void 0);else if(t===h.ErrorDetails.LEVEL_LOAD_ERROR||t===h.ErrorDetails.LEVEL_LOAD_TIMEOUT){var c=n.media,f=c&&_.default.isBuffered(c,c.currentTime)&&_.default.isBuffered(c,c.currentTime+.5);if(f){var v=n.config.levelLoadingRetryDelay;d.logger.warn("level controller,"+t+", but media buffered, retry in "+v+"ms"),this.timer=setTimeout(this.ontick,v)}else d.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,n.trigger(l.default.ERROR,e)}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(t&&"main"===t.type){var n=this._levels[t.level];n&&(n.loadError=0)}}},{key:"onLevelLoaded",value:function(e){var t=e.level;if(t===this._level){var n=this._levels[t];n.loadError=0;var r=e.details;if(r.live){var i=1e3*(r.averagetargetduration?r.averagetargetduration:r.targetduration),a=n.details;a&&r.endSN===a.endSN&&(i/=2,d.logger.log("same live playlist, reload twice faster")),i-=performance.now()-e.stats.trequest,i=Math.max(1e3,Math.round(i)),d.logger.log("live playlist, reload in "+i+" ms"),this.timer=setTimeout(this.ontick,i)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],n=t.urlId;this.hls.trigger(l.default.LEVEL_LOADING,{url:t.url[n],level:e,id:n})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){-1!==e&&(e=Math.max(e,this.hls.abrController.minAutoLevel)),this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(f.default);n.default=p},{26:26,27:27,28:28,30:30,45:45}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(41),l=r(u),c=e(30),f=r(c),d=e(22),h=r(d),v=e(28),_=r(v),p=e(27),m=r(p),g=e(31),E=r(g),y=e(46),S=r(y),T=e(26),b=e(45),R={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},A=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,_.default.MEDIA_ATTACHED,_.default.MEDIA_DETACHING,_.default.MANIFEST_LOADING,_.default.MANIFEST_PARSED,_.default.LEVEL_LOADED,_.default.KEY_LOADED,_.default.FRAG_LOADED,_.default.FRAG_LOAD_EMERGENCY_ABORTED,_.default.FRAG_PARSING_INIT_SEGMENT,_.default.FRAG_PARSING_DATA,_.default.FRAG_PARSED,_.default.ERROR,_.default.AUDIO_TRACK_SWITCHING,_.default.AUDIO_TRACK_SWITCHED,_.default.BUFFER_CREATED,_.default.BUFFER_APPENDED,_.default.BUFFER_FLUSHED));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=R.STOPPED,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),m.default.prototype.destroy.call(this),this.state=R.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(b.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=R.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else b.logger.warn("cannot start loading as manifest not parsed yet"),this.state=R.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case R.ERROR:break;case R.BUFFER_FLUSHING:this.fragLoadError=0;break;case R.IDLE:if(!this._doTickIdle())return;break;case R.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=R.IDLE);break;case R.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(b.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=R.IDLE);break;case R.ERROR:case R.STOPPED:case R.FRAG_LOADING:case R.PARSING:case R.PARSED:case R.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&!n&&(this.startFragRequested||!t.startFragPrefetch))return!0;var r=void 0;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,a=this.levels[i],o=a.bitrate,s=void 0;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var u=f.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,t.maxBufferHole),l=u.len;if(l>=s)return!0;b.logger.trace("buffer length of "+l.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var c=a.details;if(void 0===c||c.live&&this.levelLastLoaded!==i)return this.state=R.WAITING_LEVEL,!0;var d=this.fragPrevious;if(!c.live&&d&&d.sn===c.endSN&&n.duration-Math.max(u.end,d.start)<=Math.max(.2,d.duration/2)){var h={};return this.altAudio&&(h.type="video"),this.hls.trigger(_.default.BUFFER_EOS,h),this.state=R.ENDED,!0}return this._fetchPayloadOrEos(r,u,c)}},{key:"_fetchPayloadOrEos",value:function(e,t,n){var r=this.fragPrevious,i=this.level,a=n.fragments,o=a.length;if(0===o)return!1;var s=a[0].start,u=a[o-1].start+a[o-1].duration,l=t.end,c=void 0;if(n.live){var f=this.config.initialLiveManifestSize;if(o<f)return b.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+f),!1;if(null===(c=this._ensureFragmentAtLivePoint(n,l,s,u,r,a,o)))return!1}else l<s&&(c=a[0]);return c||(c=this._findFragment(s,r,o,a,l,u,n)),!c||this._loadFragmentOrKey(c,i,n,e,l)}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,n,r,i,a,o){var s=this.hls.config,u=this.media,l=void 0,c=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(n-s.maxFragLookUpTolerance,r-c)){var f=this.liveSyncPosition=this.computeLivePosition(n,e);b.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),t=f,u&&u.readyState&&u.duration>f&&(u.currentTime=f)}if(e.PTSKnown&&t>r&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(i){var d=i.sn+1;d>=e.startSN&&d<=e.endSN&&(l=a[d-e.startSN],b.logger.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=a[Math.min(o-1,Math.round(o/2))],b.logger.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l}},{key:"_findFragment",value:function(e,t,n,r,i,a,o){var s=this.hls.config,u=void 0,c=void 0,f=s.maxFragLookUpTolerance;if(i<a?(i>a-f&&(f=0),c=l.default.search(r,function(e){return e.start+e.duration-f<=i?1:e.start-f>i&&e.start?-1:0})):c=r[n-1],c&&(u=c,c.start,t&&u.level===t.level&&u.sn===t.sn))if(u.sn<o.endSN){var d=t.deltaPTS,h=u.sn-o.startSN;d&&d>s.maxBufferHole&&t.dropped&&h?(u=r[h-1],b.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(u=r[h+1],b.logger.log("SN just loaded, load next one: "+u.sn))}else u=null;return u}},{key:"_loadFragmentOrKey",value:function(e,t,n,r,i){var a=this.hls,o=a.config;if(null==e.decryptdata.uri||null!=e.decryptdata.key){if(b.logger.log("Loading "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t+", currentTime:"+r.toFixed(3)+",bufferEnd:"+i.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var s=o.fragLoadingLoopThreshold;if(e.loadCounter>s&&Math.abs(this.fragLoadIdx-e.loadIdx)<s)return a.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e}),!1}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,this.nextLoadPosition=e.start+e.duration,e.autoLevel=a.autoLevelEnabled,e.bitrateTest=this.bitrateTest,a.trigger(_.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new h.default(a,"main")),this.state=R.FRAG_LOADING,!0}b.logger.log("Loading key for "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t),this.state=R.KEY_LOADING,a.trigger(_.default.KEY_LOADING,{frag:e})}},{key:"getBufferRange",value:function(e){return l.default.search(this.bufferRange,function(t){return e<t.start?-1:e>t.end?1:0})}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&(t=n.currentTime,t>n.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),f.default.isBuffered(n,t)?e=this.getBufferRange(t):f.default.isBuffered(n,t+.1)&&(e=this.getBufferRange(t+.1)),e)){var r=e.frag;r!==this.fragPlaying&&(this.fragPlaying=r,this.hls.trigger(_.default.FRAG_CHANGED,{frag:r}))}}},{key:"immediateLevelSwitch",value:function(){if(b.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,n=void 0,r=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,n=this.getBufferRange(e.currentTime),n&&n.start>1&&this.flushMainBuffer(0,n.start-1),e.paused)t=0;else{var i=this.hls.nextLoadLevel,a=this.levels[i],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if((r=this.getBufferRange(e.currentTime+t))&&(r=this.followingBufferRange(r))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=R.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(_.default.BUFFER_FLUSHING,n)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(b.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.media,t=e?e.currentTime:void 0,n=this.config;if(b.logger.log("media seeking to "+t.toFixed(3)),this.state===R.FRAG_LOADING){var r=this.mediaBuffer?this.mediaBuffer:e,i=f.default.bufferInfo(r,t,this.config.maxBufferHole),a=this.fragCurrent;if(0===i.len&&a){var o=n.maxFragLookUpTolerance,s=a.start-o,u=a.start+a.duration+o;t<s||t>u?(a.loader&&(b.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=R.IDLE):b.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===R.ENDED&&(this.state=R.IDLE);e&&(this.lastCurrentTime=t),this.state!==R.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*n.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()}},{key:"onMediaSeeked",value:function(){b.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){b.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){b.logger.log("trigger BUFFER_RESET"),this.hls.trigger(_.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t,n=!1,r=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&b.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var i=this.config;i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,n=e.level,r=this.levels[n],i=t.totalduration,a=0;if(b.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),this.levelLastLoaded=n,t.live){var o=r.details;o&&t.fragments.length>0?(E.default.mergeDetails(o,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,o),t.PTSKnown?b.logger.log("live playlist sliding:"+a.toFixed(3)):b.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,b.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,this.hls.trigger(_.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var s=t.startTimeOffset;isNaN(s)?t.live?(this.startPosition=this.computeLivePosition(a,t),b.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(s<0&&(b.logger.log("negative start time offset "+s+", count from end of last fragment"),s=a+i+s),b.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===R.WAITING_LEVEL&&(this.state=R.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===R.KEY_LOADING&&(this.state=R.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,n=e.frag;if(this.state===R.FRAG_LOADING&&t&&"main"===n.type&&n.level===t.level&&n.sn===t.sn){var r=e.stats,i=this.levels[t.level],a=i.details;if(b.logger.log("Loaded  "+t.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t.level),this.bitrateTest=!1,!0===n.bitrateTest&&this.hls.nextLoadLevel)this.state=R.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=performance.now(),this.hls.trigger(_.default.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else{this.state=R.PARSING,this.stats=r;var o=a.totalduration,s=isNaN(t.startDTS)?t.start:t.startDTS,u=t.level,l=t.sn,c=this.config.defaultAudioCodec||i.audioCodec;this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),void 0===c&&(c=this.lastAudioCodec),c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,b.logger.log("Parsing "+l+" of ["+a.startSN+" ,"+a.endSN+"],level "+u+", cc "+t.cc);var f=this.demuxer;f||(f=this.demuxer=new h.default(this.hls,"main"));var d=this.media,v=d&&d.seeking,p=!v&&(a.PTSKnown||!a.live);f.push(e.payload,c,i.videoCodec,s,t.cc,u,l,o,t.decryptdata,p,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING){var n,r,i=e.tracks;if(i.audio&&this.altAudio&&delete i.audio,r=i.audio){var a=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===o.indexOf("firefox")&&(a="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==r.container&&(a="mp4a.40.2",b.logger.log("Android: force audio codec to "+a)),r.levelCodec=a,r.id=e.id}if(r=i.video,r&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=e.id),e.unique){var s={codec:"",levelCodec:""};for(n in e.tracks)r=i[n],s.container=r.container,s.codec&&(s.codec+=",",s.levelCodec+=","),r.codec&&(s.codec+=r.codec),r.levelCodec&&(s.levelCodec+=r.levelCodec);i={audiovideo:s}}this.hls.trigger(_.default.BUFFER_CODECS,i);for(n in i){r=i[n],b.logger.log("main track:"+n+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var u=r.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(_.default.BUFFER_APPENDING,{type:n,data:u,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;if(n&&"main"===e.id&&e.sn===n.sn&&e.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===R.PARSING){var r=this.levels[this.level],i=this.fragCurrent;b.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var a=E.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),o=this.hls;o.trigger(_.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:a,type:e.type,start:e.startPTS,end:e.endPTS}),"video"===e.type&&(i.dropped=e.dropped),[e.data1,e.data2].forEach(function(n){n&&(t.appended=!0,t.pendingBuffering=!0,o.trigger(_.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING&&(this.stats.tparsed=performance.now(),this.state=R.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,n=e.id;if(!t){if(this.mediaBuffer!==this.media){b.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(b.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.IDLE}var i=this.hls;i.trigger(_.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(b.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,n=void 0,r=void 0,i=!1;for(var a in t){var o=t[a];"main"===o.id?(r=a,n=o,"video"===a&&(this.videoBuffer=t[a].buffer)):i=!0}i&&n?(b.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==R.PARSING&&t!==R.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var e=this;if(!(this.state!==R.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;t&&function(){var n=e.mediaBuffer?e.mediaBuffer:e.media;b.logger.log("main buffered : "+S.default.toString(n.buffered));var r=e.bufferRange.filter(function(e){return f.default.isBuffered(n,(e.start+e.end)/2)});r.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:t}),e.bufferRange=r.sort(function(e,t){return e.start-t.start}),e.fragPrevious=t;var i=e.stats;i.tbuffered=performance.now(),e.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),e.hls.trigger(_.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),e.state=R.IDLE}(),this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=this.media,r=n&&f.default.isBuffered(n,n.currentTime)&&f.default.isBuffered(n,n.currentTime+.5);switch(e.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var a=this.config;if(i<=a.fragLoadingMaxRetry||r||t.autoLevel&&t.level){this.fragLoadError=i,t.loadCounter=0;var o=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);b.logger.warn("mediaController: frag loading failed, retry in "+o+" ms"),this.retryDate=performance.now()+o,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=R.FRAG_LOADING_WAITING_RETRY}else b.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(_.default.ERROR,e),this.state=R.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.hls.trigger(_.default.ERROR,e),this.state=R.ERROR));break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.ERROR&&(e.fatal?(this.state=R.ERROR,b.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):this.state===R.WAITING_LEVEL&&(this.state=R.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:this.state!==R.PARSING&&this.state!==R.PARSED||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):(b.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,b.logger.warn("reduce max buffer length to "+t.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,n=this.mediaBuffer?this.mediaBuffer:e,r=n.buffered;if(this.loadedmetadata||!r.length||e.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var i=f.default.bufferInfo(e,t,0),a=!(e.paused||e.ended||0===e.buffered.length),o=.5,s=t!==this.lastCurrentTime,u=this.config;if(s)this.stallReported&&(b.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(a){var l=performance.now(),c=this.hls;if(this.stalled){var d=l-this.stalled,h=i.len,v=this.nudgeRetry||0;if(h<=o&&d>1e3*u.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in low buffer @"+t),c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h}));var p=i.nextStart,m=p-t;if(p&&m<u.maxSeekHole&&m>0){this.nudgeRetry=++v;var g=v*u.nudgeOffset;b.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+p+" + nudge "+g),e.currentTime=p+g,this.stalled=void 0,c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:p+g-t})}}else if(h>o&&d>1e3*u.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in high buffer @"+t),c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h})),this.stalled=void 0,this.nudgeRetry=++v,v<u.nudgeMaxRetry){var E=e.currentTime,y=E+v*u.nudgeOffset;b.logger.log("adjust currentTime from "+E+" to "+y),e.currentTime=y,c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("still stuck in high buffer @"+t+" after "+u.nudgeMaxRetry+", raise fatal error"),c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=l,this.stallReported=!1}}else{this.loadedmetadata=!0;var S=this.startPosition,R=f.default.isBuffered(n,S);t===S&&R||(b.logger.log("target start position:"+S),R||(S=r.start(0),b.logger.log("target start position not buffered, seek to buffered.start(0) "+S)),b.logger.log("adjust currentTime from "+t+" to "+S),e.currentTime=S)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=R.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(t){return f.default.isBuffered(e,(t.start+t.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=R.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,b.logger.log("main stream:"+t+"->"+e),this.hls.trigger(_.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferRange(e.currentTime);if(t)return t.frag.level}return-1}},{key:"nextBufferRange",get:function(){var e=this.media;return e?this.followingBufferRange(this.getBufferRange(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(m.default);n.default=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(42),h=r(d),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_USERDATA,l.default.MANIFEST_LOADING,l.default.FRAG_LOADED,l.default.LEVEL_SWITCH));if(n.hls=e,n.config=e.config,n.enabled=!0,n.Cues=e.config.cueHandler,n.config.enableCEA708Captions){var r=n,o=function(e,t){var n=null;try{n=new window.Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)},s={newCue:function(e,t,n){if(!r.textTrack1){var i=r.getExistingTrack("1");i?(r.textTrack1=i,r.clearCurrentCues(r.textTrack1),o(r.textTrack1,r.media)):(r.textTrack1=r.createTextTrack("captions","English","en"),r.textTrack1.textTrack1=!0)}r.Cues.newCue(r.textTrack1,e,t,n)}},u={newCue:function(e,t,n){if(!r.textTrack2){var i=r.getExistingTrack("2");i?(r.textTrack2=i,r.clearCurrentCues(r.textTrack2),o(r.textTrack2,r.media)):(r.textTrack2=r.createTextTrack("captions","Spanish","es"),r.textTrack2.textTrack2=!0)}r.Cues.newCue(r.textTrack2,e,t,n)}};n.cea608Parser=new h.default(0,s,u)}return n}return o(t,e),s(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n],i="textTrack"+e;if(!0===r[i])return r}return null}},{key:"createTextTrack",value:function(e,t,n){if(this.media)return this.media.addTextTrack(e,t,n)}},{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var n=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,n)}}},{key:"extractCea608Data",value:function(e){for(var t,n,r,i,a,o=31&e[0],s=2,u=[],l=0;l<o;l++)t=e[s++],n=127&e[s++],r=127&e[s++],i=0!=(4&t),a=3&t,0===n&&0===r||i&&0===a&&(u.push(n),u.push(r));return u}}]),t}(f.default);n.default=v},{27:27,28:28,42:42}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.aesIV=n}return i(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();n.default=a},{}],15:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return i(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<n.length;r++)n[r]=t.getUint32(4*r);return n}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,n=this.subMix[0],r=this.subMix[1],i=this.subMix[2],a=this.subMix[3],o=this.invSubMix[0],s=this.invSubMix[1],u=this.invSubMix[2],l=this.invSubMix[3],c=new Uint32Array(256),f=0,d=0,h=0;for(h=0;h<256;h++)c[h]=h<128?h<<1:h<<1^283;for(h=0;h<256;h++){var v=d^d<<1^d<<2^d<<3^d<<4;v=v>>>8^255&v^99,e[f]=v,t[v]=f;var _=c[f],p=c[_],m=c[p],g=257*c[v]^16843008*v;n[f]=g<<24|g>>>8,r[f]=g<<16|g>>>16,i[f]=g<<8|g>>>24,a[f]=g,g=16843009*m^65537*p^257*_^16843008*f,o[v]=g<<24|g>>>8,s[v]=g<<16|g>>>16,u[v]=g<<8|g>>>24,l[v]=g,f?(f=_^c[c[c[m^_]]],d^=c[c[d]]):f=d=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a=this.ksRows=4*(i+6+1),o=void 0,s=void 0,u=this.keySchedule=new Uint32Array(this.ksRows),l=this.invKeySchedule=new Uint32Array(this.ksRows),c=this.sBox,f=this.rcon,d=this.invSubMix[0],h=this.invSubMix[1],v=this.invSubMix[2],_=this.invSubMix[3],p=void 0,m=void 0;for(o=0;o<a;o++)o<i?p=u[o]=t[o]:(m=p,o%i==0?(m=m<<8|m>>>24,m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m],m^=f[o/i|0]<<24):i>6&&o%i==4&&(m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m]),u[o]=p=(u[o-i]^m)>>>0);for(s=0;s<a;s++)o=a-s,m=3&s?u[o]:u[o-4],l[s]=s<4||o<=4?m:d[c[m>>>24]]^h[c[m>>>16&255]]^v[c[m>>>8&255]]^_[c[255&m]],l[s]=l[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,n){for(var r,i,a=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,u=this.invSubMix[0],l=this.invSubMix[1],c=this.invSubMix[2],f=this.invSubMix[3],d=this.uint8ArrayToUint32Array_(n),h=d[0],v=d[1],_=d[2],p=d[3],m=new Int32Array(e),g=new Int32Array(m.length),E=void 0,y=void 0,S=void 0,T=void 0,b=void 0,R=void 0,A=void 0,D=void 0,w=void 0,O=void 0,k=void 0,C=void 0;t<m.length;){for(w=this.networkToHostOrderSwap(m[t]),O=this.networkToHostOrderSwap(m[t+1]),k=this.networkToHostOrderSwap(m[t+2]),C=this.networkToHostOrderSwap(m[t+3]),b=w^o[0],R=C^o[1],A=k^o[2],D=O^o[3],r=4,i=1;i<a;i++)E=u[b>>>24]^l[R>>16&255]^c[A>>8&255]^f[255&D]^o[r],y=u[R>>>24]^l[A>>16&255]^c[D>>8&255]^f[255&b]^o[r+1],S=u[A>>>24]^l[D>>16&255]^c[b>>8&255]^f[255&R]^o[r+2],T=u[D>>>24]^l[b>>16&255]^c[R>>8&255]^f[255&A]^o[r+3],b=E,R=y,A=S,D=T,r+=4;E=s[b>>>24]<<24^s[R>>16&255]<<16^s[A>>8&255]<<8^s[255&D]^o[r],y=s[R>>>24]<<24^s[A>>16&255]<<16^s[D>>8&255]<<8^s[255&b]^o[r+1],S=s[A>>>24]<<24^s[D>>16&255]<<16^s[b>>8&255]<<8^s[255&R]^o[r+2],T=s[D>>>24]<<24^s[b>>16&255]<<16^s[R>>8&255]<<8^s[255&A]^o[r+3],r+=3,g[t]=this.networkToHostOrderSwap(E^h),g[t+1]=this.networkToHostOrderSwap(T^v),g[t+2]=this.networkToHostOrderSwap(S^_),g[t+3]=this.networkToHostOrderSwap(y^p),h=w,v=O,_=k,p=C,t+=4}return g.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();n.default=a},{}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(14),s=r(o),u=e(17),l=r(u),c=e(15),f=r(c),d=e(26),h=e(45),v=function(){function e(t,n){i(this,e),this.observer=t,this.config=n;try{var r=crypto||self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return a(e,[{key:"decrypt",value:function(e,t,n,r){var i=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){h.logger.log("JS AES decrypt");var a=this.decryptor;a||(this.decryptor=a=new f.default),a.expandKey(t),r(a.decrypt(e,0,n))}else!function(){h.logger.log("WebCrypto AES decrypt");var a=i.subtle;i.key!==t&&(i.key=t,i.fastAesKey=new l.default(a,t)),i.fastAesKey.expandKey().then(function(t){new s.default(a,n).decrypt(e,t).then(function(e){r(e)})}).catch(function(a){i.onWebCryptoError(a,e,t,n,r)})}()}},{key:"onWebCryptoError",value:function(e,t,n,r,i){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(t,n,r,i)):(h.logger.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();n.default=v},{14:14,15:15,17:17,26:26,45:45}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.key=n}return i(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();n.default=a},{}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),u=e(45),l=e(24),c=r(l),f=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.remuxer=new this.remuxerClass(t,n,a,o),this.insertDiscontinuity()}return a(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(e,t,n,r,i,a,o,l,f,d){var h,v,_,p,m,g,E,y,S,T,b=new c.default(e),R=90*b.timeStamp,A=!1;for(i!==this.lastCC?(u.logger.log(this.id+" discontinuity detected"),this.lastCC=i,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):a!==this.lastLevel?(u.logger.log("audio track switch detected"),this.lastLevel=a,this.remuxer.switchLevel(),this.insertDiscontinuity()):o===this.lastSN+1&&(A=!0),h=this._aacTrack,this.lastSN=o,this.lastLevel=a,g=b.length,S=e.length;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);for(h.audiosamplerate||(v=s.default.getAudioConfig(this.observer,e,g,t),h.config=v.config,h.audiosamplerate=v.samplerate,h.channelCount=v.channelCount,h.codec=v.codec,h.manifestCodec=v.manifestCodec,h.duration=l,u.logger.log("parsed codec:"+h.codec+",rate:"+v.samplerate+",nb channel:"+v.channelCount)),m=0,p=9216e4/h.audiosamplerate;g+5<S&&(E=1&e[g+1]?7:9,_=(3&e[g+3])<<11|e[g+4]<<3|(224&e[g+5])>>>5,(_-=E)>0&&g+E+_<=S);)for(y=R+m*p,T={unit:e.subarray(g+E,g+E+_),pts:y,dts:y},h.samples.push(T),h.len+=_,g+=_+E,m++;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);this.remuxer.remux(a,o,i,h,{samples:[]},{samples:[{pts:R,dts:R,unit:b.payload}]},{samples:[]},r,A,f,d)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,n,r=new c.default(e);if(r.hasTimeStamp)for(t=r.length,n=e.length;t<n-1;t++)if(255===e[t]&&240==(240&e[t+1]))return!0;return!1}}]),e}();n.default=f},{19:19,24:24,45:45}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=e(26),s=function(){function e(){r(this,e)}return i(e,null,[{key:"getAudioConfig",value:function(e,t,n,r){var i,s,u,l,c,f=navigator.userAgent.toLowerCase(),d=r,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return i=((192&t[n+2])>>>6)+1,s=(60&t[n+2])>>>2,s>h.length-1?void e.trigger(Event.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s}):(l=(1&t[n+2])<<2,l|=(192&t[n+3])>>>6,a.logger.log("manifest codec:"+r+",ADTS data:type:"+i+",sampleingIndex:"+s+"["+h[s]+"Hz],channelConfig:"+l),/firefox/i.test(f)?s>=6?(i=5,c=new Array(4),u=s-3):(i=2,c=new Array(2),u=s):-1!==f.indexOf("android")?(i=2,c=new Array(2),u=s):(i=5,c=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&s>=6?u=s-3:((r&&-1!==r.indexOf("mp4a.40.2")&&s>=6&&1===l||!r&&1===l)&&(i=2,c=new Array(2)),u=s)),c[0]=i<<3,c[0]|=(14&s)>>1,c[1]|=(1&s)<<7,c[1]|=l<<3,5===i&&(c[1]|=(14&u)>>1,c[2]=(1&u)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:h[s],channelCount:l,codec:"mp4a.40."+i,manifestCodec:d})}}]),e}();n.default=s},{26:26,45:45}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),u=e(26),l=e(16),c=r(l),f=e(18),d=r(f),h=e(25),v=r(h),_=e(38),p=r(_),m=e(39),g=r(m),E=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this.hls=t,this.id=n,this.config=this.hls.config||a,this.typeSupported=r}return a(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,n,r,i,a,o,u,l,f,d){if(e.byteLength>0&&null!=l&&null!=l.key&&"AES-128"===l.method){null==this.decrypter&&(this.decrypter=new c.default(this.hls,this.config));var h,v=this;try{h=performance.now()}catch(e){h=Date.now()}this.decrypter.decrypt(e,l.key.buffer,l.iv.buffer,function(e){var l;try{l=performance.now()}catch(e){l=Date.now()}v.hls.trigger(s.default.FRAG_DECRYPTED,{level:a,sn:o,stats:{tstart:h,tdecrypt:l}}),v.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,u,f,d)})}else this.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,u,f,d)}},{key:"pushDecrypted",value:function(e,t,n,r,i,a,o,l,c,f){var h=this.demuxer;if(!h||i!==this.cc&&!h.probe(e)){var _=this.hls,m=this.id,E=this.config,y=this.typeSupported;if(v.default.probe(e))h=!0===this.typeSupported.mp2t?new v.default(_,m,g.default,E,y):new v.default(_,m,p.default,E,y),h.probe=v.default.probe;else{if(!d.default.probe(e))return void _.trigger(s.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,id:m,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});h=new d.default(_,m,p.default,E,y),h.probe=d.default.probe}this.demuxer=h}h.push(e,t,n,r,i,a,o,l,c,f),this.cc=i}}]),e}();n.default=E},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e(20),a=r(i),o=e(28),s=r(o),u=e(45),l=e(1),c=r(l),f=function(e){var t=new c.default;t.trigger=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var o=JSON.parse(i.config);e.demuxer=new a.default(t,i.id,i.typeSupported,o);try{(0,u.enableLogs)(!0===o.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":e.demuxer.push(i.data,i.audioCodec,i.videoCodec,i.timeOffset,i.cc,i.level,i.sn,i.duration,i.decryptdata,i.accurateTimeOffset,i.defaultInitPTS)}}),t.on(s.default.FRAG_DECRYPTED,n),t.on(s.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(s.default.FRAG_PARSED,n),t.on(s.default.ERROR,n),t.on(s.default.FRAG_PARSING_METADATA,n),t.on(s.default.FRAG_PARSING_USERDATA,n),t.on(s.default.INIT_PTS_FOUND,n),t.on(s.default.FRAG_PARSING_DATA,function(t,n){var r=n.data1.buffer,i=n.data2.buffer;delete n.data1,delete n.data2,e.postMessage({event:t,data:n,data1:r,data2:i},[r,i])})};n.default=f},{1:1,20:20,28:28,45:45}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),u=e(20),l=r(u),c=e(21),f=r(c),d=e(45),h=e(26),v=function(){function t(n,r){i(this,t),this.hls=n,this.id=r;var a={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:n.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(n.config.enableWorker&&"undefined"!=typeof Worker){d.logger.log("demuxing in webworker");var o=void 0;try{var u=e(3);o=this.w=u(f.default),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(e){n.trigger(s.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:a,id:r,config:JSON.stringify(n.config)})}catch(e){d.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&URL.revokeObjectURL(o.objectURL),this.demuxer=new l.default(n,r,a),this.w=void 0}}else this.demuxer=new l.default(n,r,a);this.demuxInitialized=!0}return a(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}}},{key:"push",value:function(e,t,n,r,i,a,o,s,u,l,c){var f=this.w;if(f)f.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:n,timeOffset:r,cc:i,level:a,sn:o,duration:s,decryptdata:u,accurateTimeOffset:l,defaultInitPTS:c},[e]);else{var d=this.demuxer;d&&d.push(e,t,n,r,i,a,o,s,u,l,c)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,n=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data.data2=new Uint8Array(t.data2);default:n.trigger(t.event,t.data)}}}]),t}();n.default=v},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,r=8,i=8;for(t=0;t<e;t++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i}},{key:"readSPS",value:function(){var e,t,n,r,i,a,o,s=0,u=0,l=0,c=0,f=this.readUByte.bind(this),d=this.readBits.bind(this),h=this.readUEG.bind(this),v=this.readBoolean.bind(this),_=this.skipBits.bind(this),p=this.skipEG.bind(this),m=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(f(),e=f(),d(5),_(3),f(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=h();if(3===E&&_(1),m(),m(),_(1),v())for(a=3!==E?8:12,o=0;o<a;o++)v()&&g(o<6?16:64)}m();var y=h();if(0===y)h();else if(1===y)for(_(1),p(),p(),t=h(),o=0;o<t;o++)p();m(),_(1),n=h(),r=h(),i=d(1),0===i&&_(1),_(1),v()&&(s=h(),u=h(),l=h(),c=h());var S=[1,1];if(v()&&v()){switch(f()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[f()<<8|f(),f()<<8|f()]}}return{width:Math.ceil(16*(n+1)-2*s-2*u),height:(2-i)*(r+1)*16-(i?2:4)*(l+c),pixelRatio:S}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();n.default=o},{45:45}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this._hasTimeStamp=!1;for(var n,i,o,s,u,l,c,f,d=0;;)if(c=this.readUTF(t,d,3),d+=3,"ID3"===c)d+=3,n=127&t[d++],i=127&t[d++],o=127&t[d++],s=127&t[d++],u=(n<<21)+(i<<14)+(o<<7)+s,l=d+u,this._parseID3Frames(t,d,l),d=l;else{if("3DI"!==c)return d-=3,void((f=d)&&(this.hasTimeStamp||a.logger.warn("ID3 tag found, but no timestamp"),this._length=f,this._payload=t.subarray(0,f)));d+=7,a.logger.log("3DI footer found, end: "+d)}}return i(e,[{key:"readUTF",value:function(e,t,n){var r="",i=t,a=t+n;do{r+=String.fromCharCode(e[i++])}while(i<a);return r}},{key:"_parseID3Frames",value:function(e,t,n){for(var r,i;t+8<=n;)switch(r=this.readUTF(e,t,4),t+=4,e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],e[t++]<<8+e[t++],t,r){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var o=1&e[t++];this._hasTimeStamp=!0,i=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,o&&(i+=47721858.84),i=Math.round(i),a.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();n.default=o},{45:45}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),u=e(28),l=r(u),c=e(23),f=r(c),d=e(45),h=e(26),v=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.typeSupported=o,this.lastCC=0,this.remuxer=new this.remuxerClass(t,n,a,o)}return a(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,n,r,i,a,o,s,u,c){var f,v,_,p,m,g=e.length,E=this.remuxer.passthrough,y=!1;this.audioCodec=t,this.videoCodec=n,this._duration=s,this.contiguous=!1,this.accurateTimeOffset=u,i!==this.lastCC&&(d.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=i),a!==this.lastLevel?(d.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=a):o===this.lastSN+1&&(this.contiguous=!0),this.lastSN=o;var S=this.pmtParsed,T=this._avcTrack,b=this._audioTrack,R=this._id3Track,A=T.id,D=b.id,w=R.id,O=this._pmtId,k=T.pesData,C=b.pesData,L=R.pesData,P=this._parsePAT,I=this._parsePMT,M=this._parsePES,N=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),F=this._parseMPEGPES.bind(this),U=this._parseID3PES.bind(this);for(g-=g%188,f=0;f<g;f+=188)if(71===e[f]){if(v=!!(64&e[f+1]),_=((31&e[f+1])<<8)+e[f+2],(48&e[f+3])>>4>1){if((p=f+5+e[f+4])===f+188)continue}else p=f+4;switch(_){case A:if(v){if(k&&(m=M(k))&&(N(m,!1),E&&T.codec&&(-1===D||b.codec)))return void this.remux(a,o,i,e,r);k={data:[],size:0}}k&&(k.data.push(e.subarray(p,f+188)),k.size+=f+188-p);break;case D:if(v){if(C&&(m=M(C))&&(b.isAAC?x(m):F(m),E&&b.codec&&(-1===A||T.codec)))return void this.remux(a,o,i,e,r);C={data:[],size:0}}C&&(C.data.push(e.subarray(p,f+188)),C.size+=f+188-p);break;case w:v&&(L&&(m=M(L))&&U(m),L={data:[],size:0}),L&&(L.data.push(e.subarray(p,f+188)),L.size+=f+188-p);break;case 0:v&&(p+=e[p]+1),O=this._pmtId=P(e,p);break;case O:v&&(p+=e[p]+1);var B=I(e,p,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3);A=B.avc,A>0&&(T.id=A),D=B.audio,D>0&&(b.id=D,b.isAAC=B.isAAC),w=B.id3,w>0&&(R.id=w),y&&!S&&(d.logger.log("reparse from beginning"),y=!1,f=-188),S=this.pmtParsed=!0;break;case 17:case 8191:break;default:y=!0}}else this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});k&&(m=M(k))?(N(m,!0),T.pesData=null):T.pesData=k,C&&(m=M(C))?(b.isAAC?x(m):F(m),b.pesData=null):(C&&C.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),b.pesData=C),L&&(m=M(L))?(U(m),R.pesData=null):R.pesData=L,this.remux(a,o,i,null,r,c)}},{key:"remux",value:function(e,t,n,r,i,a){for(var o=this._avcTrack,s=o.samples,u=0,l=0,c=0;c<s.length;c++){for(var f=s[c],d=f.units.units,h=d.length,v=0,_=0;_<h;_++)v+=d[_].data.length;l+=v,u+=h,f.length=v}o.len=l,o.nbNalu=u,this.remuxer.remux(e,t,n,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,i,this.contiguous,this.accurateTimeOffset,a,r)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,n){var r,i,a,o,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=(15&e[t+1])<<8|e[t+2],i=t+3+r-4,a=(15&e[t+10])<<8|e[t+11],t+=12+a;t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 15:-1===s.audio&&(s.audio=o);break;case 21:-1===s.id3&&(s.id3=o);break;case 27:-1===s.avc&&(s.avc=o);break;case 3:case 4:n?-1===s.audio&&(s.audio=o,s.isAAC=!1):d.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:d.logger.warn("HEVC stream type found, not supported for now");break;default:d.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}return s}},{key:"_parsePES",value:function(e){var t,n,r,i,a,o,s,u,l=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var f=new Uint8Array(c[0].length+c[1].length);f.set(c[0]),f.set(c[1],c[0].length),c[0]=f,c.splice(1,1)}if(t=c[0],1===(t[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;n=t[7],192&n&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&n?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,s>4294967295&&(s-=8589934592),o-s>54e5&&(d.logger.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),i=t[8],u=i+9,e.size-=u,a=new Uint8Array(e.size);for(var h=0,v=c.length;h<v;h++){t=c[h];var _=t.byteLength;if(u){if(u>_){u-=_;continue}t=t.subarray(u),_-=u,u=0}a.set(t,l),l+=_}return r&&(r-=i+3),{data:a,pts:o,dts:s,len:r}}return null}},{key:"pushAccesUnit",value:function(e,t){e.units.units.length&&e.frame&&(!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(t.samples.length||this.contiguous)?t.samples.push(e):t.dropped++),e.debug.length&&d.logger.log(e.pts+"/"+e.dts+":"+e.debug+","+e.units.length)}},{key:"_parseAVCPES",value:function(e,t){var n,r,i,a=this,o=this._avcTrack,s=this._parseAVCNALu(e.data),u=!1,l=this.avcSample;e.data=null,s.forEach(function(t){switch(t.type){case 1:r=!0,u&&l&&(l.debug+="NDR "),l.frame=!0;var s=t.data;if(s.length>4){var c=new f.default(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(l.key=!0)}break;case 5:r=!0,l||(l=a.avcSample=a._createAVCSample(!0,e.pts,e.dts,"")),u&&(l.debug+="IDR "),l.key=!0,l.frame=!0;break;case 6:r=!0,u&&l&&(l.debug+="SEI "),n=new f.default(a.discardEPB(t.data)),n.readUByte();for(var d=0,h=0,v=!1,_=0;!v&&n.bytesAvailable>1;){d=0;do{_=n.readUByte(),d+=_}while(255===_);h=0;do{_=n.readUByte(),h+=_}while(255===_);if(4===d&&0!==n.bytesAvailable){v=!0;if(181===n.readUByte()){if(49===n.readUShort()){if(1195456820===n.readUInt()){if(3===n.readUByte()){var p=n.readUByte(),m=n.readUByte(),g=31&p,E=[p,m];for(i=0;i<g;i++)E.push(n.readUByte()),E.push(n.readUByte()),E.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:E})}}}}}else if(h<n.bytesAvailable)for(i=0;i<h;i++)n.readUByte()}break;case 7:if(r=!0,u&&l&&(l.debug+="SPS "),!o.sps){n=new f.default(t.data);var y=n.readSPS();o.width=y.width,o.height=y.height,o.pixelRatio=y.pixelRatio,o.sps=[t.data],o.duration=a._duration;var S=t.data.subarray(1,4),T="avc1.";for(i=0;i<3;i++){var b=S[i].toString(16);b.length<2&&(b="0"+b),T+=b}o.codec=T}break;case 8:r=!0,u&&l&&(l.debug+="PPS "),o.pps||(o.pps=[t.data]);break;case 9:r=!1,l&&a.pushAccesUnit(l,o),l=a.avcSample=a._createAVCSample(!1,e.pts,e.dts,u?"AUD ":"");break;case 12:r=!1;break;default:r=!1,l&&(l.debug+="unknown NAL "+t.type+" ")}if(l&&r){l.units.units.push(t)}}),t&&l&&(this.pushAccesUnit(l,o),this.avcSample=null)}},{key:"_createAVCSample",value:function(e,t,n,r){return{key:e,pts:t,dts:n,units:{units:[],length:0},debug:r}}},{key:"_insertSampleInOrder",value:function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.units.length){var n=this._avcTrack,r=n.samples;e=r[r.length-1]}if(e){var i=e.units.units;t=i[i.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t,n,r,i,a,o=0,s=e.byteLength,u=this._avcTrack,l=u.naluState||0,c=l,f=[],d=-1;for(-1===l&&(d=0,a=31&e[0],l=0,o=1);o<s;)if(t=e[o++],l)if(1!==l)if(t)if(1===t){if(d>=0)r={data:e.subarray(d,o-l-1),type:a},f.push(r);else{var h=this._getLastNalUnit();if(h&&(c&&o<=4-c&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-c)),(n=o-l-1)>0)){var v=new Uint8Array(h.data.byteLength+n);v.set(h.data,0),v.set(e.subarray(0,n),h.data.byteLength),h.data=v}}o<s?(i=31&e[o],d=o,a=i,l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(d>=0&&l>=0&&(r={data:e.subarray(d,s),type:a,state:l},f.push(r)),0===f.length){var _=this._getLastNalUnit();if(_){var p=new Uint8Array(_.data.byteLength+e.byteLength);p.set(_.data,0),p.set(e,_.data.byteLength),_.data=p}}return u.naluState=l,f}},{key:"discardEPB",value:function(e){for(var t,n,r=e.byteLength,i=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var o=0;for(a=0;a<t;o++,a++)o===i[0]&&(o++,i.shift()),n[a]=e[o];return n}},{key:"_parseAACPES",value:function(e){var t,n,r,i,a,o,u,c,f,v=this._audioTrack,_=e.data,p=e.pts,m=0,g=this.aacOverFlow,E=this.aacLastPTS;if(g){var y=new Uint8Array(g.byteLength+_.byteLength);y.set(g,0),y.set(_,g.byteLength),_=y}for(a=m,c=_.length;a<c-1&&(255!==_[a]||240!=(240&_[a+1]));a++);if(a){var S,T;if(a<c-1?(S="AAC PES did not start with ADTS header,offset:"+a,T=!1):(S="no ADTS header found in AAC PES",T=!0),d.logger.warn("parsing error:"+S),this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:T,reason:S}),T)return}if(!v.audiosamplerate){var b=this.audioCodec;t=s.default.getAudioConfig(this.observer,_,a,b),v.config=t.config,v.audiosamplerate=t.samplerate,v.channelCount=t.channelCount,v.codec=t.codec,v.manifestCodec=t.manifestCodec,v.duration=this._duration,d.logger.log("parsed codec:"+v.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)}if(i=0,r=9216e4/v.audiosamplerate,g&&E){var R=E+r;Math.abs(R-p)>1&&(d.logger.log("AAC: align PTS for overlapping frames by "+Math.round((R-p)/90)),p=R)}for(;a+5<c&&(o=1&_[a+1]?7:9,n=(3&_[a+3])<<11|_[a+4]<<3|(224&_[a+5])>>>5,(n-=o)>0&&a+o+n<=c);)for(u=p+i*r,f={unit:_.subarray(a+o,a+o+n),pts:u,dts:u},v.samples.push(f),v.len+=n,a+=n+o,i++;a<c-1&&(255!==_[a]||240!=(240&_[a+1]));a++);g=a<c?_.subarray(a,c):null,this.aacOverFlow=g,this.aacLastPTS=u}},{key:"_parseMPEGPES",value:function(e){for(var t,n=e.data,r=e.pts,i=n.length,a=0,o=0;o<i&&(t=this._parseMpeg(n,o,i,a++,r))>0;)o+=t}},{key:"_onMpegFrame",value:function(e,t,n,r,i,a){var o=1152/n*1e3,s=a+i*o,u=this._audioTrack;u.config=[],u.channelCount=r,u.audiosamplerate=n,u.duration=this._duration,u.samples.push({unit:e,pts:s,dts:s}),u.len+=e.length}},{key:"_onMpegNoise",value:function(e){d.logger.warn("mpeg audio has noise: "+e.length+" bytes")}},{key:"_parseMpeg",value:function(e,t,n,r,i){var a=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(t+2>n)return-1;if(255===e[t]||224==(224&e[t+1])){if(t+24>n)return-1;var s=e[t+1]>>3&3,u=e[t+1]>>1&3,l=e[t+2]>>4&15,c=e[t+2]>>2&3,f=!!(2&e[t+2]);if(1!==s&&0!==l&&15!==l&&3!==c){var d=3===s?3-u:3===u?3:4,h=1e3*a[14*d+l-1],v=3===s?0:2===s?1:2,_=o[3*v+c],p=f?1:0,m=e[t+3]>>6==3?1:2,g=3===u?(3===s?12:6)*h/_+p<<2:(3===s?144:72)*h/_+p|0;return t+g>n?-1:(this._onMpegFrame&&this._onMpegFrame(e.subarray(t,t+g),h,_,m,r,i),g)}}for(var E=t+2;E<n;){if(255===e[E-1]&&224==(224&e[E]))return this._onMpegNoise&&this._onMpegNoise(e.subarray(t,E-1)),E-t-1;E++}return-1}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();n.default=v},{19:19,23:23,26:26,28:28,45:45}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(45),s=e(26),u=e(28),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(){function e(t){r(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return a(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===i(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();n.default=c},{26:26,28:28,45:45}],28:[function(e,t,n){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();n.default=a},{}],30:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"isBuffered",value:function(e,t){if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0;return!1}},{key:"bufferInfo",value:function(e,t,n){if(e){var r,i=e.buffered,a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,t,n)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,n){var r,i,a,o,s,u=[];for(e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end}),s=0;s<e.length;s++){var l=u.length;if(l){var c=u[l-1].end;e[s].start-c<n?e[s].end>c&&(u[l-1].end=e[s].end):u.push(e[s])}else u.push(e[s])}for(s=0,r=0,i=a=t;s<u.length;s++){var f=u[s].start,d=u[s].end;if(t+n>=f&&t<d)i=f,a=d,r=a-t;else if(t+n<f){o=f;break}}return{len:r,start:i,end:a,nextStart:o}}}]),e}();n.default=a},{}],31:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(){r(this,e)}return i(e,null,[{key:"mergeDetails",value:function(t,n){var r,i=Math.max(t.startSN,n.startSN)-n.startSN,o=Math.min(t.endSN,n.endSN)-n.startSN,s=n.startSN-t.startSN,u=t.fragments,l=n.fragments,c=0;if(o<i)return void(n.PTSKnown=!1);for(var f=i;f<=o;f++){var d=u[s+f],h=l[f];h&&d&&(c=d.cc-h.cc,isNaN(d.startPTS)||(h.start=h.startPTS=d.startPTS,h.endPTS=d.endPTS,h.duration=d.duration,r=h))}if(c)for(a.logger.log("discontinuity sliding from playlist, take drift into account"),f=0;f<l.length;f++)l[f].cc+=c;if(r)e.updateFragPTSDTS(n,r.sn,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(s>=0&&s<u.length){var v=u[s].start;for(f=0;f<l.length;f++)l[f].start+=v}n.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,n,r,i,a,o){var s,u,l,c;if(!t||n<t.startSN||n>t.endSN)return 0;if(s=n-t.startSN,u=t.fragments,l=u[s],!isNaN(l.startPTS)){var f=Math.abs(l.startPTS-r);isNaN(l.deltaPTS)?l.deltaPTS=f:l.deltaPTS=Math.max(f,l.deltaPTS),r=Math.min(r,l.startPTS),i=Math.max(i,l.endPTS),a=Math.min(a,l.startDTS),o=Math.max(o,l.endDTS)}var d=r-l.start;for(l.start=l.startPTS=r,l.endPTS=i,l.startDTS=a,l.endDTS=o,l.duration=i-r,c=s;c>0;c--)e.updatePTS(u,c,c-1);for(c=s;c<u.length-1;c++)e.updatePTS(u,c,c+1);return t.PTSKnown=!0,d}},{key:"updatePTS",value:function(e,t,n){var r=e[t],i=e[n],o=i.startPTS;isNaN(o)?i.start=n>t?r.start+r.duration:r.start-i.duration:n>t?(r.duration=o-r.start,r.duration<0&&a.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&a.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();n.default=o},{45:45}],32:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),u=e(26),l=e(36),c=r(l),f=e(34),d=r(f),h=e(4),v=r(h),_=e(7),p=r(_),m=e(8),g=r(m),E=e(5),y=r(E),S=e(12),T=r(S),b=e(11),R=r(b),A=e(13),D=r(A),w=e(10),O=r(w),k=e(6),C=r(k),L=e(45),P=e(47),I=r(P),M=e(1),N=r(M),x=e(35),F=r(x),U=e(43),B=r(U),G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var r in n)r in t||(t[r]=n[r]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,L.enableLogs)(t.debug),this.config=t;var a=this.observer=new N.default;a.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.emit.apply(a,[e,e].concat(n))},a.off=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.removeListener.apply(a,[e].concat(n))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a),this.playlistLoader=new c.default(this),this.fragmentLoader=new d.default(this),this.levelController=new R.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new C.default(this),this.keyLoader=new F.default(this)}return a(e,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.21"}},{key:"Events",get:function(){return s.default}},{key:"ErrorTypes",get:function(){return u.ErrorTypes}},{key:"ErrorDetails",get:function(){return u.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:I.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:v.default,bufferController:p.default,capLevelController:g.default,fpsController:O.default,streamController:T.default,audioStreamController:y.default,timelineController:D.default,cueHandler:B.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),a(e,[{key:"destroy",value:function(){L.logger.log("destroy"),this.trigger(s.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){L.logger.log("attachMedia"),this.media=e,this.trigger(s.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){L.logger.log("detachMedia"),this.trigger(s.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){L.logger.log("loadSource:"+e),this.url=e,this.trigger(s.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;L.logger.log("startLoad("+e+")"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){L.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){L.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){L.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){L.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){L.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){L.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(e){L.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){L.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){L.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();n.default=G},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(e,t,n){"use strict";t.exports=e(32).default},{32:32}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.FRAG_LOADING));return n.loaders={},n}return o(t,e),s(t,[{key:"destroy",value:function(){var e=this.loaders;for(var t in e){var n=e[t];n&&n.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=this.hls.config;t.loaded=0,r&&(h.logger.warn("abort previous fragment loader for type:"+n),r.abort()),r=this.loaders[n]=t.loader=void 0!==i.fLoader?new i.fLoader(i):new i.loader(i);var a=void 0,o=void 0,s=void 0;a={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var u=t.byteRangeStartOffset,l=t.byteRangeEndOffset;isNaN(u)||isNaN(l)||(a.rangeStart=u,a.rangeEnd=l),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},r.load(a,o,s)}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=n.frag;i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(l.default.FRAG_LOADED,{payload:r,frag:i,stats:t})}},{key:"loaderror",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(e,t,n){var r=t.frag;r.loaded=e.loaded,this.hls.trigger(l.default.FRAG_LOAD_PROGRESS,{frag:r,stats:e})}}]),t}(f.default);n.default=v},{26:26,27:27,28:28,45:45}],35:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return o(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=t.decryptdata,a=i.uri;if(a!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;r&&(h.logger.warn("abort previous key loader for type:"+n),r.abort()),t.loader=this.loaders[n]=new o.loader(o),this.decrypturl=a,this.decryptkey=null;var s=void 0,u=void 0,c=void 0;s={url:a,frag:t,responseType:"arraybuffer"},u={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(s,u,c)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(l.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,n){var r=n.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(l.default.KEY_LOADED,{frag:r})}},{key:"loaderror",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})}}]),t}(f.default);n.default=v},{26:26,27:27,28:28,45:45}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(2),l=r(u),c=e(28),f=r(c),d=e(27),h=r(d),v=e(26),_=e(40),p=r(_),m=e(45),g=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,E=/#EXT-X-MEDIA:(.*)/g,y=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,S=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,T=function(){function e(){o(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return s(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=l.default.buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),e}(),b=function(){function e(){o(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return s(e,[{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var n=e;return e&&e.method&&e.uri&&!e.iv&&(n=new T,n.method=e.method,n.baseuri=e.baseuri,n.reluri=e.reluri,n.iv=this.createInitializationVector(t)),n}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=l.default.buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var n=this.lastByteRangeEndOffset;e[0]=n||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),R=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MANIFEST_LOADING,f.default.LEVEL_LOADING,f.default.AUDIO_TRACK_LOADING));return n.loaders={},n}return a(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(e,t){var n=this.loaders[t.type];if(n){var r=n.context;if(r&&r.url===e)return void m.logger.trace("playlist request ongoing");m.logger.warn("abort previous loader for type:"+t.type),n.abort()}var i=this.hls.config,a=void 0,o=void 0,s=void 0,u=void 0;"manifest"===t.type?(a=i.manifestLoadingMaxRetry,o=i.manifestLoadingTimeOut,s=i.manifestLoadingRetryDelay,u=i.manifestLoadingMaxRetryTimeout):(a=i.levelLoadingMaxRetry,o=i.levelLoadingTimeOut,s=i.levelLoadingRetryDelay,u=i.levelLoadingMaxRetryTimeout,m.logger.log("loading playlist for "+t.type+" "+(t.level||t.id))),n=this.loaders[t.type]=t.loader=void 0!==i.pLoader?new i.pLoader(i):new i.loader(i),t.url=e,t.responseType="";var l=void 0,c=void 0;l={timeout:o,maxRetry:a,retryDelay:s,maxRetryDelay:u},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(t,l,c)}},{key:"resolve",value:function(e,t){return l.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){var n=[],r=void 0;for(g.lastIndex=0;null!=(r=g.exec(e));){var i={},a=i.attrs=new p.default(r[1]);i.url=this.resolve(r[2],t);var o=a.decimalResolution("RESOLUTION");o&&(i.width=o.width,i.height=o.height),i.bitrate=a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),i.name=a.NAME;var s=a.CODECS;if(s){s=s.split(/[ ,]+/);for(var u=0;u<s.length;u++){var l=s[u];-1!==l.indexOf("avc1")?i.videoCodec=this.avc1toavcoti(l):i.audioCodec=l}}n.push(i)}return n}},{key:"parseMasterPlaylistMedia",value:function(e,t,n){var r=void 0,i=[];for(E.lastIndex=0;null!=(r=E.exec(e));){var a={},o=new p.default(r[1]);o.TYPE===n&&(a.groupId=o["GROUP-ID"],a.name=o.NAME,a.type=n,a.default="YES"===o.DEFAULT,a.autoselect="YES"===o.AUTOSELECT,a.forced="YES"===o.FORCED,o.URI&&(a.url=this.resolve(o.URI,t)),a.lang=o.LANGUAGE,a.name||(a.name=a.lang),i.push(a))}return i}},{key:"avc1toavcoti",value:function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseLevelPlaylist",value:function(e,t,n,r){var i,a,o=0,s=0,u={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},l=new T,c=0,f=null,d=new b;for(y.lastIndex=0;null!==(i=y.exec(e));){var h=i[1];if(h){d.duration=parseFloat(h);var v=(" "+i[2]).slice(1);d.title=v||null,d.tagList.push(v?["INF",h,v]:["INF",h])}else if(i[3]){if(!isNaN(d.duration)){var _=o++;d.type=r,d.start=s,d.levelkey=l,d.sn=_,d.level=n,d.cc=c,d.baseurl=t,d.relurl=(" "+i[3]).slice(1),u.fragments.push(d),f=d,s+=d.duration,d=new b}}else if(i[4]){if(d.rawByteRange=(" "+i[4]).slice(1),f){var g=f.byteRangeEndOffset;g&&(d.lastByteRangeEndOffset=g)}}else if(i[5])d.rawProgramDateTime=(" "+i[5]).slice(1),d.tagList.push(["PROGRAM-DATE-TIME",d.rawProgramDateTime]);else{for(i=i[0].match(S),a=1;a<i.length&&void 0===i[a];a++);var E=(" "+i[a+1]).slice(1),R=(" "+i[a+2]).slice(1);switch(i[a]){case"#":d.tagList.push(R?[E,R]:[E]);break;case"PLAYLIST-TYPE":u.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":o=u.startSN=parseInt(E);break;case"TARGETDURATION":u.targetduration=parseFloat(E);break;case"VERSION":u.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":c++,d.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(E);break;case"KEY":var A=E,D=new p.default(A),w=D.enumeratedString("METHOD"),O=D.URI,k=D.hexadecimalInteger("IV");w&&(l=new T,O&&"AES-128"===w&&(l.method=w,l.baseuri=t,l.reluri=O,l.key=null,l.iv=k));break;case"START":var C=E,L=new p.default(C),P=L.decimalFloatingPoint("TIME-OFFSET");isNaN(P)||(u.startTimeOffset=P);break;case"MAP":var I=new p.default(E);d.relurl=I.URI,d.rawByteRange=I.BYTERANGE,d.baseurl=t,d.level=n,d.type=r,d.sn="initSegment",u.initSegment=d,d=new b;break;default:m.logger.warn("line parsed but not handled: "+i)}}}return d=f,d&&!d.relurl&&(u.fragments.pop(),s-=d.duration),u.totalduration=s,u.averagetargetduration=s/u.fragments.length,u.endSN=o-1,u}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=e.url,a=n.type,o=n.id,s=n.level,u=this.hls;if(this.loaders[a]=void 0,void 0!==i&&0!==i.indexOf("data:")||(i=n.url),t.tload=performance.now(),0===r.indexOf("#EXTM3U"))if(r.indexOf("#EXTINF:")>0){var l="audioTrack"!==a,c=this.parseLevelPlaylist(r,i,(l?s:o)||0,l?"main":"audio");"manifest"===a&&u.trigger(f.default.MANIFEST_LOADED,{levels:[{url:i,details:c}],audioTracks:[],url:i,stats:t}),t.tparsed=performance.now(),c.targetduration?l?u.trigger(f.default.LEVEL_LOADED,{details:c,level:s||0,id:o||0,stats:t}):u.trigger(f.default.AUDIO_TRACK_LOADED,{details:c,id:o,stats:t}):u.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"invalid targetduration"})}else{var d=this.parseMasterPlaylist(r,i);if(d.length){var h=this.parseMasterPlaylistMedia(r,i,"AUDIO");if(h.length){var _=!1;h.forEach(function(e){e.url||(_=!0)}),!1===_&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(m.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main"}))}u.trigger(f.default.MANIFEST_LOADED,{levels:d,audioTracks:h,url:i,stats:t})}else u.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no level found in manifest"})}else u.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,response:e,context:t})}},{key:"loadtimeout",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_TIMEOUT,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_TIMEOUT,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,context:t})}}]),t}(h.default);n.default=R},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,u,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;i--;)r+=n[i].byteLength;for(t=new Uint8Array(r),t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<a;i++)t.set(n[i],r),r+=n[i].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){return n*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))}},{key:"moov",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))}},{key:"mvhd",value:function(t,n){n*=t;var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,r)}},{key:"sdtp",value:function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,r,i,a=[],o=[];for(n=0;n<t.sps.length;n++)r=t.sps[n],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)r=t.pps[n],i=r.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(o))),u=t.width,l=t.height,c=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,f>>24,f>>16&255,f>>8&255,255&f])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var n=t.audiosamplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,a=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,n){var r=e.sdtp(t),i=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var r,i,a,o,s,u,l=t.samples||[],c=l.length,f=12+16*c,d=new Uint8Array(f);for(n+=8+f,d.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)i=l[r],a=i.duration,o=i.size,s=i.flags,u=i.cts,d.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,d)}},{key:"initSegment",value:function(t){e.types||e.init();var n,r=e.moov(t);return n=new Uint8Array(e.FTYP.byteLength+r.byteLength),n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n}}]),e}();n.default=a},{}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(29),s=r(o),u=e(28),l=r(u),c=e(45),f=e(37),d=r(f),h=e(26),v=function(){function e(t,n,r,a){i(this,e),this.observer=t,this.id=n,this.config=r,this.typeSupported=a,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return a(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a,o,s,u,c,f){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(r,i,s,n),null!==f&&(this._initPTS=this._initDTS=f),this.ISGenerated)if(r.samples.length){var d=this.remuxAudio(r,s,u,c);if(i.samples.length){var h=void 0;d&&(h=d.endPTS-d.startPTS),this.remuxVideo(i,s,u,h)}}else{var v=void 0;i.samples.length&&(v=this.remuxVideo(i,s,u)),v&&r.codec&&this.remuxEmptyAudio(r,s,u,v)}a.samples.length&&this.remuxID3(a,s),o.samples.length&&this.remuxText(o,s),this.observer.trigger(l.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,n,r){var i,a,o=this.observer,s=e.samples,u=t.samples,f=this.PES_TIMESCALE,v=this.typeSupported,_="audio/mp4",p={},m={id:this.id,level:this.level,sn:this.sn,tracks:p,unique:!1},g=void 0===this._initPTS;g&&(i=a=1/0),e.config&&s.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&function(){e.timescale=e.audiosamplerate/function e(t,n){return n?e(n,t%n):t}(e.audiosamplerate,e.isAAC?1024:1152)}(),c.logger.log("audio mp4 timescale :"+e.timescale),e.isAAC||(v.mpeg?(_="audio/mpeg",e.codec=""):v.mp3&&(e.codec="mp3")),p.audio={container:_,codec:e.codec,initSegment:!e.isAAC&&v.mpeg?new Uint8Array:d.default.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(i=a=s[0].pts-f*n)),t.sps&&t.pps&&u.length&&(t.timescale=this.MP4_TIMESCALE,p.video={container:"video/mp4",codec:t.codec,initSegment:d.default.initSegment([t]),metadata:{width:t.width,height:t.height}},g&&(i=Math.min(i,u[0].pts-f*n),a=Math.min(a,u[0].dts-f*n),this.observer.trigger(l.default.INIT_PTS_FOUND,{id:this.id,initPTS:i,cc:r}))),Object.keys(p).length?(o.trigger(l.default.FRAG_PARSING_INIT_SEGMENT,m),this.ISGenerated=!0,g&&(this._initPTS=i,this._initDTS=a)):o.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,r){var i,a,o,s,u,f,v,_=8,p=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,g=e.samples,E=[],y=g.length,S=this._PTSNormalize,T=this._initDTS;g.sort(function(e,t){var n=e.dts-t.dts;return n||e.pts-t.pts});var b=g.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(b<0){c.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var R=0;R<g.length;R++)g[R].dts+=b}var A=void 0;A=n?this.nextAvcDts:t*p;var D=g[0];u=Math.max(S(D.dts-T,A),0),s=Math.max(S(D.pts-T,A),0);var w=Math.round((u-A)/90);n&&w&&(w>1?c.logger.log("AVC:"+w+" ms hole between fragments detected,filling it"):w<-1&&c.logger.log("AVC:"+-w+" ms overlapping between fragments detected"),u=A,g[0].dts=u+T,s=Math.max(s-w,A),g[0].pts=s+T,c.logger.log("Video/PTS/DTS adjusted: "+Math.round(s/90)+"/"+Math.round(u/90)+",delta:"+w+" ms")),u,D=g[g.length-1],v=Math.max(S(D.dts-T,A),0),f=Math.max(S(D.pts-T,A),0),f=Math.max(f,v);var O=navigator.vendor,k=navigator.userAgent,C=O&&O.indexOf("Apple")>-1&&k&&!k.match("CriOS");C&&(i=Math.round((v-u)/(m*(g.length-1))));for(var L=0;L<y;L++){var P=g[L];C?P.dts=u+L*m*i:(P.dts=Math.max(S(P.dts-T,A),u),P.dts=Math.round(P.dts/m)*m),P.pts=Math.max(S(P.pts-T,A),P.dts),P.pts=Math.round(P.pts/m)*m}var I=e.len+4*e.nbNalu+8;try{a=new Uint8Array(I)}catch(e){return void this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:I,reason:"fail allocating video mdat "+I})}var M=new DataView(a.buffer);M.setUint32(0,I),a.set(d.default.types.mdat,4);for(var N=0;N<y;N++){for(var x=g[N],F=x.units.units,U=0,B=void 0,G=0,H=F.length;G<H;G++){var j=F[G],W=j.data,V=j.data.byteLength;M.setUint32(_,V),_+=4,a.set(W,_),_+=V,U+=4+V}if(C)B=Math.max(0,i*Math.round((x.pts-x.dts)/(m*i)));else{if(N<y-1)i=g[N+1].dts-x.dts;else{var K=this.config,Y=x.dts-g[N>0?N-1:N].dts;if(K.stretchShortVideoTrack){var q=K.maxBufferHole,X=K.maxSeekHole,z=Math.floor(Math.min(q,X)*p),Q=(r?s+r*p:this.nextAudioPts)-x.pts;Q>z?(i=Q-Y,i<0&&(i=Y),c.logger.log("It is approximately "+Q/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=Y}else i=Y}i/=m,B=Math.round((x.pts-x.dts)/m)}E.push({size:U,duration:i,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:x.key?2:1,isNonSync:x.key?0:1}})}this.nextAvcDts=v+i*m;var Z=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,E.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var J=E[0].flags;J.dependsOn=2,J.isNonSync=0}e.samples=E,o=d.default.moof(e.sequenceNumber++,u/m,e),e.samples=[];var $={id:this.id,level:this.level,sn:this.sn,data1:o,data2:a,startPTS:s/p,endPTS:(f+m*i)/p,startDTS:u/p,endDTS:this.nextAvcDts/p,type:"video",nb:E.length,dropped:Z};return this.observer.trigger(l.default.FRAG_PARSING_DATA,$),$}},{key:"remuxAudio",value:function(e,t,n,r){var i,a,o,u,f,v,_,p,m,g,E,y,S,T,b,R,A=this.PES_TIMESCALE,D=e.timescale,w=A/D,O=e.timescale*(e.isAAC?1024:1152)/e.audiosamplerate,k=O*w,C=this._PTSNormalize,L=this._initDTS,P=!e.isAAC&&this.typeSupported.mpeg,I=P?0:8,M=[],N=[];if(e.samples.sort(function(e,t){return e.pts-t.pts}),N=e.samples,R=this.nextAudioPts,n|=N.length&&R&&(Math.abs(t-R/A)<.1||Math.abs(N[0].pts-R-this._initDTS)<20*k),n||(R=t*A),r&&e.isAAC)for(var x=0,F=R;x<N.length;){var U=N[x],B=C(U.pts-L,R),G=B-F;if(G<=-k)c.logger.warn("Dropping 1 audio frame @ "+Math.round(F/90)/1e3+"s due to "+Math.round(Math.abs(G/90))+" ms overlap."),N.splice(x,1),e.len-=U.unit.length;else if(G>=k&&F){var H=Math.round(G/k);c.logger.warn("Injecting "+H+" audio frame @ "+Math.round(F/90)/1e3+"s due to "+Math.round(G/90)+" ms gap.");for(var j=0;j<H;j++)b=F+L,b=Math.max(b,L),T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),T=U.unit.subarray()),N.splice(x,0,{unit:T,pts:b,dts:b}),e.len+=T.length,F+=k,x+=1;U.pts=U.dts=F+L,F+=k,x+=1}else Math.abs(G),F+=k,U.pts=U.dts=0===x?L+R:N[x-1].pts+k,x+=1}for(var W=0,V=N.length;W<V;W++){if(a=N[W],u=a.unit,g=a.pts-L,E=a.dts-L,void 0!==m)y=C(g,m),S=C(E,m),o.duration=Math.round((S-m)/w);else{y=C(g,R),S=C(E,R);var K=Math.round(1e3*(y-R)/A),Y=0;if(n&&e.isAAC&&K){if(K>0)Y=Math.round((y-R)/k),c.logger.log(K+" ms hole between AAC samples detected,filling it"),Y>0&&(T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(T=u.subarray()),e.len+=Y*T.length);else if(K<-12){c.logger.log(-K+" ms overlapping between AAC samples detected, drop frame"),e.len-=u.byteLength;continue}y=S=R}if(_=Math.max(0,y),p=Math.max(0,S),!(e.len>0))return;var q=P?e.len:e.len+8;try{f=new Uint8Array(q)}catch(e){return void this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:q,reason:"fail allocating audio mdat "+q})}P||(i=new DataView(f.buffer),i.setUint32(0,q),f.set(d.default.types.mdat,4));for(var X=0;X<Y;X++)b=y-(Y-X)*k,T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),T=u.subarray()),f.set(T,I),I+=T.byteLength,o={size:T.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o)}f.set(u,I);var z=u.byteLength;I+=z,o={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o),m=S}var Q=0,Z=M.length;if(Z>=2&&(Q=M[Z-2].duration,o.duration=Q),Z){this.nextAudioPts=y+w*Q,e.len=0,e.samples=M,v=P?new Uint8Array:d.default.moof(e.sequenceNumber++,p/w,e),e.samples=[];var J={id:this.id,level:this.level,sn:this.sn,data1:v,data2:f,startPTS:_/A,endPTS:this.nextAudioPts/A,startDTS:p/A,endDTS:(S+w*Q)/A,type:"audio",nb:Z};return this.observer.trigger(l.default.FRAG_PARSING_DATA,J),J}return null}},{key:"remuxEmptyAudio",value:function(e,t,n,r){var i=this.PES_TIMESCALE,a=e.timescale?e.timescale:e.audiosamplerate,o=i/a,u=this.nextAudioPts,l=(void 0!==u?u:r.startDTS*i)+this._initDTS,f=r.endDTS*i+this._initDTS,d=1024,h=o*d,v=Math.ceil((f-l)/h),_=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(c.logger.warn("remux empty Audio"),!_)return void c.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],m=0;m<v;m++){var g=l+m*h;p.push({unit:_,pts:g,dts:g}),e.len+=_.length}e.samples=p,this.remuxAudio(e,t,n)}},{key:"remuxID3",value:function(e,t){var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE,n.dts=(n.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(l.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(l.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}},{key:"passthrough",get:function(){return!1}}]),e}();n.default=v},{26:26,28:28,29:29,37:37,45:45}],39:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(28),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n){r(this,e),this.observer=t,this.id=n,this.ISGenerated=!1}return i(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a){var s=this.observer;if(!this.ISGenerated){var u={},l={id:this.id,tracks:u,unique:!0},c=t,f=c.codec;f&&(l.tracks.video={container:c.container,codec:f,metadata:{width:c.width,height:c.height}}),c=e,f=c.codec,f&&(l.tracks.audio={container:c.container,codec:f,metadata:{channelCount:c.channelCount}}),this.ISGenerated=!0,s.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,l)}s.trigger(o.default.FRAG_PARSING_DATA,{id:this.id,data1:a,startPTS:i,startDTS:i,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();n.default=s},{28:28}],40:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){r(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}return i(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=a.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,n={};for(o.lastIndex=0;null!==(t=o.exec(e));){var r=t[2],i='"';0===r.indexOf(i)&&r.lastIndexOf(i)===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n}}]),e}();n.default=s},{}],41:[function(e,t,n){"use strict";var r={search:function(e,t){for(var n=0,r=e.length-1,i=null,a=null;n<=r;){i=(n+r)/2|0,a=e[i];var o=t(a);if(o>0)n=i+1;else{if(!(o<0))return a;r=i-1}}return null}};t.exports=r},{}],42:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(e){var t=e;return a.hasOwnProperty(e)&&(t=a[e]),String.fromCharCode(t)},s=15,u=32,l={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},d={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],v={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},_=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},p=function(){function e(t,n,i,a,o){r(this,e),this.foreground=t||"white",this.underline=n||!1,this.italics=i||!1,this.background=a||"black",this.flash=o||!1}return i(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),m=function(){function e(t,n,i,a,o,s){r(this,e),this.uchar=t||" ",this.penState=new p(n,i,a,o,s)}return i(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),g=function(){function e(){r(this,e),this.chars=[];for(var t=0;t<u;t++)this.chars.push(new m);this.pos=0,this.currPenState=new p}return i(e,[{key:"equals",value:function(e){for(var t=!0,n=0;n<u;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<u;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<u;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(v.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(v.log("ERROR","Too large cursor position "+this.pos),this.pos=u)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=o(e);return this.pos>=u?void v.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<u;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,n=0;n<u;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),E=function(){function e(){r(this,e),this.rows=[];for(var t=0;t<s;t++)this.rows.push(new g);this.currRow=s-1,this.nrRollUpRows=null,this.reset()}return i(e,[{key:"reset",value:function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1}},{key:"equals",value:function(e){for(var t=!0,n=0;n<s;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){v.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e,t){v.log("INFO","pacData = "+JSON.stringify(e));var n=e.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==n){for(var r=0;r<s;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=t.rows[i].cueStartTime;if(a&&a<v.time)for(r=0;r<this.nrRollUpRows;r++)this.rows[n-this.nrRollUpRows+r+1].copy(t.rows[i+r])}this.currRow=n;var o=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,l=Math.max(u-1,0);o.setCursor(e.indent),e.color=o.chars[l].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)}},{key:"setBkgData",value:function(e){v.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void v.log("DEBUG","roll_up but nrRollUpRows not set yet");v.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),v.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<s;i++){var a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),y=function(){function e(t,n){r(this,e),this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new E,this.nonDisplayedMemory=new E,this.lastOutputScreen=new E,this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return i(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e,this.lastOutputScreen)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,v.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";v.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(v.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){v.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){v.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){v.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){v.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){v.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){v.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){v.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){v.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){v.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){v.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){v.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(v.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,v.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){v.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}v.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=v.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),S=function(){function e(t,n,i){r(this,e),this.field=t||1,this.outputs=[n,i],this.channels=[new y(1,n),new y(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return i(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var n,r,i,a=!1;this.lastTime=e,v.setTime(e);for(var o=0;o<t.length;o+=2)if(r=127&t[o],i=127&t[o+1],0!==r||0!==i){if(v.log("DATA","["+_([t[o],t[o+1]])+"] -> ("+_([r,i])+")"),n=this.parseCmd(r,i),n||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(a=this.parseChars(r,i)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(a)}else v.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,v.log("WARNING","Couldn't parse cleaned data "+_([r,i])+" orig: "+_([t[o],t[o+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var n=null,r=(20===e||28===e)&&32<=t&&t<=47,i=(23===e||31===e)&&33<=t&&t<=35;if(!r&&!i)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,v.log("DEBUG","Repeated command ("+_([e,t])+") is dropped"),!0;n=20===e||23===e?1:2;var a=this.channels[n-1];return 20===e||28===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"parseMidrow",value:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return v.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[n-1].ccMIDROW(t),v.log("DEBUG","MIDROW ("+_([e,t])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var n=null,r=null,i=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,a=(16===e||24===e)&&64<=t&&t<=95;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=e<=23?1:2,r=64<=t&&t<=95?1===n?l[e]:f[e]:1===n?c[e]:d[e];var o=this.interpretPAC(r,t);return this.channels[n-1].setPAC(o),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"interpretPAC",value:function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}},{key:"parseChars",value:function(e,t){var n=null,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),17<=i&&i<=19){var a=t;a=17===i?t+80:18===i?t+112:t+144,v.log("INFO","Special char '"+o(a)+"' in channel "+n),r=[a]}else 32<=e&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=_(r);v.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r}},{key:"parseBackgroundAttributes",value:function(e,t){var n,r,i,a,o=(16===e||24===e)&&32<=t&&t<=47,s=(23===e||31===e)&&45<=t&&t<=47;return!(!o&&!s||(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=h[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,a=this.channels[i-1],a.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,0))}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();n.default=S},{}],43:[function(e,t,n){"use strict";var r={newCue:function(e,t,n,r){for(var i,a,o,s,u,l=window.VTTCue||window.TextTrackCue,c=0;c<r.rows.length;c++)if(i=r.rows[c],o=!0,s=0,u="",!i.isEmpty()){for(var f=0;f<i.chars.length;f++)i.chars[f].uchar.match(/\s/)&&o?s++:(u+=i.chars[f].uchar,o=!1);i.cueStartTime=t,a=new l(t,n,u.trim()),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?a.line=c+1:a.line=c>7?c-2:c+1,a.align="left",a.position=Math.max(0,Math.min(100,100*(s/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}};t.exports=r},{}],44:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return i(e,[{key:"sample",value:function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();n.default=a},{}],45:[function(e,t,n){"use strict";function r(){}function i(e,t){return t="["+e+"] > "+t}function a(e){var t=self.console[e];return t?function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];r[0]&&(r[0]=i(e,r[0])),t.apply(self.console,r)}:r}function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){l[t]=e[t]?e[t].bind(e):a(t)})}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u={trace:r,debug:r,log:r,warn:r,info:r,error:r},l=u;n.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":s(e))){o(e,"debug","log","info","warn","error");try{l.log()}catch(e){l=u}}else l=u},n.logger=l},{}],46:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"toString",value:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}}]),e}();n.default=a},{}],47:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return i(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var n=this.stats;n.tfirst=0,n.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(performance.now(),r.trequest)),4===n){var s=t.status;if(s>=200&&s<300){r.tload=Math.max(r.tfirst,performance.now());var u=void 0,l=void 0;"arraybuffer"===i.responseType?(u=t.response,l=u.byteLength):(u=t.responseText,l=u.length),r.loaded=r.total=l;var c={url:t.responseURL,data:u};this.callbacks.onSuccess(c,r,i)}else r.retry>=o.maxRetry||s>=400&&s<499?(a.logger.error(s+" while loading "+i.url),this.callbacks.onError({code:s,text:t.statusText},i)):(a.logger.warn(s+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)}},{key:"loadtimeout",value:function(){a.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null)}}]),e}();n.default=o},{45:45}]},{},[33])(33)}()}()},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),u=i(s),l=n(0),c=i(l),f=function(){};r.performance=Date,r.MediaSource={isTypeSupported:function(){return!0}},r.navigator||(r.navigator={userAgent:""});var d=function(){function e(){var t=this;a(this,e);var n={autoStartLoad:!1,loader:c.default};this.levels=[],this.manifestParsed=!1,this.callbacks={onLevelLoading:f,onLevelLoaded:f,onManifestLoading:f,onManifestLoaded:f,onManifestParsed:f,onError:f},this.hls=new u.default(n),this.hls.on(u.default.Events.ERROR,function(e,n){return t.callbacks.onError(n)}),this.hls.on(u.default.Events.LEVEL_LOADING,function(e,n){return t.callbacks.onLevelLoading(n)}),this.hls.on(u.default.Events.LEVEL_LOADED,function(e,n){return t.callbacks.onLevelLoaded(n)}),this.hls.on(u.default.Events.MANIFEST_LOADING,function(e,n){return t.callbacks.onManifestLoading(n)}),this.hls.on(u.default.Events.MANIFEST_LOADED,function(e,n){return t.callbacks.onManifestLoaded(n)}),this.hls.on(u.default.Events.MANIFEST_PARSED,function(e,n){t.manifestParsed=!0,t.levels=n.levels,t.callbacks.onManifestParsed(n)})}return o(e,[{key:"update",value:function(e,t){var n=e.toString("utf8");if(c.default.Resources[t]=n,this.manifestParsed){var r=this.getLevelIndex(t);if(-1===r)throw this.hls.loadSource(t),new Error("HlsParser error: Attempting to load manifest that does not match any level playlist. That could happen when the player reloads master playlist.");var i=this.levels[r].urlId;this.hls.playlistLoader.onLevelLoading({id:i,url:t,level:r})}else this.hls.loadSource(t)}},{key:"getLevelIndex",value:function(e){return this.levels.findIndex(function(t){return t.url.indexOf(e)>=0})}},{key:"onError",set:function(e){this.callbacks.onError=e}},{key:"onManifestLoading",set:function(e){this.callbacks.onManifestLoading=e}},{key:"onManifestLoaded",set:function(e){this.callbacks.onManifestLoaded=e}},{key:"onManifestParsed",set:function(e){this.callbacks.onManifestParsed=e}},{key:"onLevelLoaded",set:function(e){this.callbacks.onLevelLoaded=e}}]),e}();t.default=d,e.exports=t.default}).call(t,n(2))}])},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(169),s=r(o),u=n(120),l=r(u),c=function(){function e(t){i(this,e),this.hls=t}return a(e,[{key:"getSegmentTime",value:function(e){if(void 0===e.time)throw new Error("getSegmentTime: segmentView.time is undefined");return e.time}},{key:"getSegmentList",value:function(e,t,n){var r=this.hls.levels[e.level];if(!r)throw new Error("getSegmentList: level doesn't exist");if(!r.details)return console.warn("getSegmentList: level not parsed yet"),[];for(var i=[],a=r.details.fragments,o=0;o<a.length;o++){var u=a[o];t<=u.start&&u.start<=t+n&&i.push(new s.default({sn:u.sn,trackView:e,time:u.start}))}return i}},{key:"getTrackList",value:function(){if(!this.hls.levels)return[];for(var e=[],t=0;t<this.hls.levels.length;t++)for(var n=this.hls.levels[t],r=0;r<n.url.length;r++)e.push(new l.default({level:t,urlId:r,bitrate:n.bitrate}));return e}},{key:"getSegmentDuration",value:function(e){var t=this.hls.levels[e.trackView.level],n=!0,r=!1,i=void 0;try{for(var a,o=t.details.fragments[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){return a.value.duration}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}throw new Error("All segments should have a duration")}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(553),a=r(i),o=n(554),s=r(o),u=n(558),l=r(u),c=n(559),f=r(c),d=n(560),h=r(d),v=n(561),_=r(v),p=n(562),m=r(p),g=n(564),E=r(g),y=n(573),S=r(y),T=n(583),b=r(T),R=n(607),A=r(R),D=n(610),w=r(D),O=n(620),k=r(O),C=n(621),L=r(C),P=n(622),I=n(629),M=r(I),N=n(630),x=r(N),F=n(631),U=r(F),B=n(175),G=r(B),H=n(633),j=r(H),W=n(124),V=n(634),K=r(V),Y=n(125),q=n(661),X=r(q),z=n(10),Q=r(z),Z=n(663),J=r(Z),$=n(664),ee=r($),te=n(266),ne=r(te),re=n(665),ie=r(re),ae=n(666),oe=r(ae),se=n(667),ue=r(se),le=n(668),ce=r(le),fe=n(669),de=r(fe),he=n(672),ve=r(he);1||Q.default.setScriptOrigin(window.document.currentScript&&window.document.currentScript.src?window.document.currentScript.src:null);var _e=function e(t,n,r,i,o,u,c){var d=this;if("string"!=typeof c||""===c||c.length>10)throw new Error("Unvalid argument in PeerAgent constructor: integration version must be a non-empty string of less than 10 characters");var v=new J.default,p=new K.default(i,n,c,t,v,r,u);Q.default.setCustomer(p.conf.ID_CLIENT),Q.default.setMetadata({stream:p.moduleState.content}),(0,W.checkInterface)(j.default,r),(0,W.checkInterface)(G.default,o.prototype),(0,Y.assertStreamType)(u);var g=void 0,y=void 0,T=void 0,R=void 0,D=void 0,O=void 0,C=void 0,I=void 0,N=void 0,F=void 0,B=void 0,H=void 0,V=void 0,q=void 0,z=void 0,Z=!1,$=void 0,te=void 0,re=void 0,ae=function(){N=(0,P.createScheduler)(r,R,O,p)},se=function(){F&&(B=new M.default,D=new ue.default,y=new b.default(t,D,o,B,p),T=new A.default(p),q=new m.default(v,p),t.isLive()?z=new E.default(t,v,p):(0,ve.default)(p),R=new w.default(y,B,p),C=new k.default(B,R,p),I=new L.default(R,p),O=new x.default(r,p),ae(),D.init(R,N),g=new s.default(R,N,p),V=new S.default(v,p),(0,ce.default)(p),ee.default.connect(p),a.default.listenEvents(N,R,B,O,p),te.listenEvents(re),le()),Z=!0},le=function(){p.conf.DEBUG&&(H=new _.default(y,z,p))},fe=function(e){return e.trackView&&e.trackView.type&&("audio"===e.trackView.type||"video"===e.trackView.type)},he=function(e){if(!F)throw new Error("P2P is not activated, getP2PData can't be called");var t=void 0;return Z?t=F?R.getPartialSegment(e)||new f.default(e,R,B,p):new h.default(e):(re=fe(e),se(),t=new h.default(e)),re&&te.updateWithSegmentView(e),N.updateTrackEdge(e),t},_e=function(e,t,n){return null!==n&&(0,W.checkInterface)(G.default,n),U.default.getSegment(this,e,t,n,p)},pe=function(){F&&(Z&&(V.dispose(),g.dispose(),R.dispose(),y.dispose(),T.dispose(),H&&H.dispose(),q.dispose(),z&&z.dispose()),$.removeAllExternalEventListener()),ie.default.removeFromPeerAgentList(p.peerToken),p.dispose()};!function(){(F=ne.default.isP2PEnabled(p.conf))&&($=new l.default(t),te=new de.default($,p))}(),this.getSegment=_e,this.getP2PData=he,this.dispose=pe,this.setMediaElement=function(e){d.mediaElement=e},Object.defineProperty(this,"mediaElement",{get:function(){return v.mediaElement},set:function(e){v.mediaElement=e}}),Object.defineProperty(this,"p2pDownloadOn",{get:function(){return p.isP2PDownloadOn},set:function(e){e!==p.isP2PDownloadOn&&(p.isP2PDownloadOn=e,p.eventBus.emit("p2pDownloadToggle",e))}}),Object.defineProperty(this,"version",{get:function(){return e.version}}),Object.defineProperty(this,"p2pUploadOn",{get:function(){return p.isP2PUploadOn},set:function(e){e!==p.isP2PUploadOn&&(p.isP2PUploadOn=e,p.eventBus.emit("p2pUploadToggle",e))}}),Object.defineProperty(this,"isP2PEnabled",{get:function(){return ne.default.isP2PEnabled(p.conf)}}),Object.defineProperty(this,"stats",{get:function(){return X.default.get(y,p,z,v)}}),Object.defineProperty(this,"nextSegmentPrebuffered",{get:function(){return p.moduleState.nextSegmentPrebuffered}}),Object.defineProperty(this,"PublicAPI",{get:function(){return oe.default.get(d)}}),1||(i.crow&&window.Streamroot&&window.Streamroot.Reaper&&(window.Streamroot.Reaper.crow=i.crow),Object.defineProperty(this,"internals",{get:function(){return{currentTracks:p.moduleState.currentTracks,map:r,p2pCache:R,scheduler:N}}})),ie.default.addToPeerAgentList(p.peerToken,this)};Object.defineProperty(_e,"StreamTypes",{get:function(){return Y.StreamTypes}}),Object.defineProperty(_e,"version",{get:function(){return"4.10.14"}}),ie.default.setup(_e),t.default=_e,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(4),l=r(u),c=function(){function e(t,n,r,i,o){(0,a.default)(this,e),this._scheduler=t,this._p2pCache=n,this._segmentInfoMap=r,this._distributedSegmentList=i,this._sharedState=o}return(0,s.default)(e,[{key:"_onHasSegment",value:function(e,t,n){var r=n.pushed;if(this._segmentInfoMap.addSegmentInfo(t),r&&this._sharedState.moduleState.isLive()&&(this._sharedState.conf.ENABLE_PUSH_SEGMENT_OPTIM&&!this._scheduler.isSegmentInAcceptableRange(t.segmentCoord)||this._distributedSegmentList.insert(t.segmentCoord)),this._scheduler.isSegmentRequested(t.segmentCoord)){var i=this._p2pCache.getOrCreateSegmentHandler(t.segmentCoord);i.chunkManager.setSegmentSize(t.size),e.isBannedSeeder()&&!this._sharedState.conf.ENABLE_FILTER_BANNED_SEEDERS||i.seeders.add(e)}}},{key:"_onPeerOpen",value:function(){var e=void 0;e=this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM?this._scheduler.getCachedSegmentListToDownload():this._scheduler.getSegmentListToDownload(),this._sharedState.eventBus.emit("segmentInfo",e,this._segmentInfoMap)}},{key:"_onPeerDestroyed",value:function(e){var t=e.remotePeer;this._p2pCache.removePeer(t)}}],[{key:"listenEvents",value:function(t,n,r,i,a){var o=new e(t,n,r,i,a);a.eventBus.on(l.default.PeerPool.PEER_OPEN,o._onPeerOpen.bind(o)),a.eventBus.on("hasSegment",o._onHasSegment.bind(o)),a.eventBus.on(l.default.PeerPool.PEER_DESTROYED,o._onPeerDestroyed.bind(o))}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(96),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(15),f=n(557),d=r(f),h=n(4),v=r(h),_=n(123),p=r(_),m=function(){function e(t,n,r){var i=this;(0,s.default)(this,e),this._wasLowBuffer=!1,this._pauseSegmentSchedulingTimestamp=a.default,this._p2pCache=t,this._scheduler=n,this._sharedState=r,this._sharedState.eventBus.once(v.default.Distributor.READY,function(){i._timer=(0,c.createInterval)(i._scheduleChunkDownloads.bind(i),i._sharedState.conf.CHUNK_BATCHING_INTERVAL)}),this._sharedState.conf.ENABLE_TRACK_EDGE_GC_BLOCK&&this._sharedState.eventBus.on(v.default.P2PCache.ATTEMPTED_GC_TRACK_EDGE_FROM_CACHE,function(){i._pauseSegmentScheduling(i._sharedState.conf.P2P_CACHE_GC_TRACK_EDGE_BLOCK_DURATION)})}return(0,l.default)(e,[{key:"dispose",value:function(){this._timer&&this._timer.clear()}},{key:"_pauseSegmentScheduling",value:function(e){var t=Date.now()+e;this._pauseSegmentSchedulingTimestamp=Math.max(this._pauseSegmentSchedulingTimestamp,t)}},{key:"_isSegmentSchedulingPaused",value:function(){return Date.now()<this._pauseSegmentSchedulingTimestamp}},{key:"_scheduleChunkRequestsForSegment",value:function(e,t,n,r){for(var i=this._sharedState.conf.ENABLE_FILTER_BANNED_SEEDERS?t.seeders.allNotBanned():t.seeders.all(),a=i.length,o=0;o<a;o++){for(var s=i[o],u=n.getOrCreate(s);u[r]>0&&t.hasChunksToDownload;){var l=t.chunkManager.getNextChunks(s,u[r],r);u[r]-=l.size,s.requestChunks(e,l.encoded,r,t.chunkManager)}if(!t.hasChunksToDownload)break}}},{key:"_scheduleChunkDownloads",value:function(){for(var e=new d.default(this._sharedState.conf.CHUNK_BATCHING_INTERVAL),t=this._scheduler.getSegmentListToDownload(),n=t.length,r=0;r<n;r++){var i=t[r],a=this._isSegmentSchedulingPaused()?this._p2pCache.getSegmentHandler(i):this._p2pCache.getOrCreateSegmentHandler(i);null!==a&&this._sharedState.isP2PDownloadOn&&a.hasChunksToDownload&&!this._sharedState.isP2PDownloadBlocked&&(this._scheduleChunkRequestsForSegment(i,a,e,p.default.SAFE),this._scheduleChunkRequestsForSegment(i,a,e,p.default.UNSAFE))}}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){n(556),e.exports=-9007199254740991},function(e,t,n){var r=n(11);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(37),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=function(){function e(t){(0,s.default)(this,e),this._collection=new a.default,this._computationInterval=t}return(0,l.default)(e,[{key:"getOrCreate",value:function(e){var t=e.getId(),n=this._collection.get(t);return n||(n=e.getChunksQuantityForInterval(this._computationInterval),this._collection.set(t,n)),n}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(94),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e){var t=[],n=[],r=e,a={},o=function(e,n){t.push({eventName:e,fn:n}),r.addEventListener(e,n)},s=function(e,t){n.push({eventName:e,fn:t}),window.addEventListener(e,t)},u=function(){for(var e=0;e<t.length;e++){var n=t[e].eventName,i=t[e].fn;r.removeEventListener(n,i)}t=[]},l=function(){for(var e=0;e<n.length;e++){var t=n[e].eventName,r=n[e].fn;window.removeEventListener(t,r)}n=[]},c=function(){u(),l()},f=function(e){function t(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];a[e].arguments=n}return a[e]={arguments:void 0,handler:t},t},d=function(e){if(e in a&&!1)throw new Error("you should not use cacheMediaEvent twice on the same event");r.addEventListener(e,f(e))},h=function(e,t){if(!a[e]||!a[e].arguments)throw new Error("You are trying to trigger an event that have not been cached before");r.removeEventListener(e,a[e].handler),a[e].arguments&&t.apply(void 0,(0,i.default)(a[e].arguments))};this.addMediaEventListener=o,this.addWindowEventListener=s,this.removeAllExternalEventListener=c,this.cacheMediaEvent=d,this.triggerCachedEvent=h,1||(this.removeAllWindowEventListener=l,this.removeAllMediaEventListener=u)};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(174),_=r(v),p=n(252),m=r(p),g=function(e){function t(e,n,r,i){function o(e,t){function i(i,a){e.response=i;var o=new m.default(d,i.byteLength,a);r.addSegmentInfo(o),n.fillSegment(d,e.response),t(e,d)}l.callHashWorker(e.response,i)}(0,s.default)(this,t);var u=i.eventBus,l=i.workerHelper,c=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this)),d=e;return c.getFullSegment=function(e,t){u.emit("CDNSegmentDownloaded",d);var n=e.response;i.transferStats.cdnDownloaded+=n.byteLength,o(e,t)},c}return(0,h.default)(t,e),(0,l.default)(t,[{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"getUpdatedRange",value:function(e){return e}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(_.default);t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(174),_=r(v),p=function(e){function t(e){(0,s.default)(this,t);var n=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n._segmentCoord=e,n}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getUpdatedRange",value:function(e){return e}},{key:"getFullSegment",value:function(e,t){t(e,this._segmentCoord)}},{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(_.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,r){var i=r.status,a=function(){for(var n={download:{p2pUseful:r.transferStats.p2pUseful,p2pUploaded:r.transferStats.p2pUploaded,cdnDownloaded:r.transferStats.cdnDownloaded,dlSpeed:i.getDlSpeed(),upSpeed:i.getUpSpeed(),p2pDownloaded:r.transferStats.p2pUseful,p2pDownloadedNewAnalytics:r.transferStats.p2pUseful},peers:{count:0},buffer:{bufferTarget:t?t.bufferTarget:0,bufferedAmount:r.bufferStats.bufferedAmount,reachedLiveEdge:t?t._reachedLiveEdge:void 0},tracker:{connected:i.getConnected()},trackerConnected:i.getConnected(),sigConnected:i.getConnectedToSignalingServer(),isLive:r.moduleState.isLive()},a=[],o=0;o<e.getPeerArray().length;o++){var s=e.getPeerArray()[o];s.getId()&&n.peers.count++,a.push(s.getDebugInfos())}return n.peerList=a,1||(n.pendingConnectionList=e.getPendingConnectionDebugInfos()),n};!function(){console.warn("SR_DISPLAY_INTERFACE is deprecated, use Streamroot.PeerAgents[<id>] instead."),n.SR_DISPLAY_INTERFACE={getStats:a}}(),this.dispose=function(){delete window.SR_DISPLAY_INTERFACE}};t.default=r,e.exports=t.default}).call(t,n(71))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(15),l=n(563),c=r(l),f=n(4),d=r(f),h=function(){function e(t,n){(0,a.default)(this,e),this._mediaElementPlaceholder=t,this._sharedState=n,this._bufferCheck(),this._bufferCheckInterval=(0,u.createInterval)(this._bufferCheck.bind(this),this._sharedState.conf.BUFFER_CHECK_INTERVAL)}return(0,s.default)(e,[{key:"_bufferCheck",value:function(){this._bufferedAmount=c.default.getBufferedAmount(this._mediaElementPlaceholder),this._sharedState.bufferStats.bufferedAmount=this._bufferedAmount,this._sharedState.eventBus.emit(d.default.BufferedAmountObserver.BUFFER_CHECK,this._bufferedAmount)}},{key:"dispose",value:function(){this._bufferCheckInterval.clear()}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(null===e.mediaElement)return 0;for(var t=e.mediaElement.buffered,n=e.mediaElement.currentTime,r=n,a=0;a<t.length;a++)t.start(a)<r+i&&t.end(a)>r&&(r=t.end(a));return r-n}Object.defineProperty(t,"__esModule",{value:!0});var i=.3;t.default={getBufferedAmount:r},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(125),l=n(4),c=r(l),f=n(569),d=r(f),h=n(570),v=r(h),_=n(571),p=r(_),m=n(572),g=r(m),E=n(15),y=n(70),S=3,T=function(){function e(t,n,r){(0,a.default)(this,e),this._peerCount=0,this._bufferTarget=0,this._bufferedAmount=0,this._randomBufferLevel=null,this._reachedLiveEdge=!1,this._enableDynamicLowerTarget=!1,this._bufferTargetState=p.default.INIT,this._bufferStatus=g.default.ZERO,this._lastLowToModerateBufferTimestamp=null,this._droppedUnderLow=!1,this._reboundCount=0,this._netLowTargetChange=0,this._targetGapSamplerTimeout=null,this._sharedState=r,this._playerInterface=t,this._mediaElementPlaceholder=n,this._bufferStateMachine=new v.default(r.eventBus),this._sharedState.eventBus.on(c.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,this._onLiveEdgeChanged.bind(this)),this._sharedState.eventBus.on(c.default.SRModuleInterface.UNCOMPLETE_SEGMENT_REQUESTED,this._onUncompleteSegmentRequested.bind(this)),this._sharedState.eventBus.on(c.default.PeerPool.PEER_OPEN,this._onPeerCountChanged.bind(this)),this._sharedState.eventBus.on(c.default.PeerPool.PEER_DESTROYED,this._onPeerCountChanged.bind(this)),this._sharedState.eventBus.on(c.default.BufferedAmountObserver.BUFFER_CHECK,this._bufferCheck.bind(this)),this._sharedState.eventBus.on(c.default.Distributor.READY,this._resetDynamicBufferLevels.bind(this)),this._currentLowerBufferTarget=this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._uploadCapacityCalculator=new d.default(this._sharedState),this._sampleTargetGap(0)}return(0,s.default)(e,[{key:"_sampleTargetGap",value:function(e){this._sharedState.bufferStats.sampledHighLowBufferTargetGap=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._currentLowerBufferTarget;var t=Math.random()*this._sharedState.conf.ANALYTICS.STATS_INTERVAL;this._targetGapSamplerTimeout=(0,E.createTimeout)(this._sampleTargetGap.bind(this,this._sharedState.conf.ANALYTICS.STATS_INTERVAL-t),e+t)}},{key:"_onUncompleteSegmentRequested",value:function(){this._isLowBufferTarget()&&(this._sharedState.eventBus.emit(c.default.BufferManager.LOW_BUFFER,this._bufferedAmount),this._setHighTarget())}},{key:"_onLiveEdgeChanged",value:function(e){this._reachedLiveEdge=e&&(this._sharedState.moduleState.streamType!==u.StreamTypes.SMOOTH||this._bufferedAmount>this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-S)}},{key:"_onPeerCountChanged",value:function(e){var t=e.peerCount;this._peerCount=t}},{key:"_bufferCheck",value:function(e){this._bufferedAmount=e,0===this._peerCount?(this._bufferStateMachine.gotoNoPeer(),this._setHighTarget()):this._uploadCapacityCalculator.uploadCapacityEMWA>=this._sharedState.conf.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING?(this._bufferStateMachine.gotoTopSeeder(),this._setHighTarget()):null!==this._mediaElementPlaceholder.mediaElement?(this._bufferStateMachine.gotoDynamic(),this._dynamicBufferCheck()):(this._bufferStateMachine.gotoRandom(),this._setRandomTarget());var t=void 0;t=this._reachedLiveEdge||this._bufferedAmount>this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET?g.default.HIGH:this._bufferedAmount>this._currentLowerBufferTarget?g.default.MODERATE:this._bufferedAmount>this._sharedState.conf.LIVE.CRITICAL_LOWER_TARGET_RATIO*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET?g.default.LOW:this._bufferedAmount>this._sharedState.conf.BUFFER_ZERO_THRESHOLD?g.default.CRITICALLY_LOW:g.default.ZERO,this._bufferedAmount<this._currentLowerBufferTarget&&this._reachedLiveEdge?this._sharedState.bufferStats.timeLowerTargetAboveLiveEdgeStaircase.updateMetric(1):this._sharedState.bufferStats.timeLowerTargetAboveLiveEdgeStaircase.updateMetric(0),this._bufferStatus!==t&&(this._bufferStatusChanged(this._bufferStatus,t),this._bufferStatus=t)}},{key:"_bufferStatusChanged",value:function(e,t){if(this._sharedState.conf.LIVE.ENABLE_DYNAMIC_LOWER_TARGET){if(t===g.default.CRITICALLY_LOW&&this._enableDynamicLowerTarget&&this._adjustLowerTarget((this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET)*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET_INCREASE_STEP),e!==g.default.CRITICALLY_LOW&&e!==g.default.LOW||t!==g.default.MODERATE&&t!==g.default.HIGH||(this._lastLowToModerateBufferTimestamp=Date.now()),e!==g.default.MODERATE&&e!==g.default.HIGH||t!==g.default.CRITICALLY_LOW&&t!==g.default.LOW||(this._droppedUnderLow=!0),t===g.default.ZERO&&this._resetDynamicBufferLevels(),t===g.default.HIGH){if(this._enableDynamicLowerTarget=!0,null!=this._lastLowToModerateBufferTimestamp){var n=(Date.now()-this._lastLowToModerateBufferTimestamp)/1e3;this._lastLowToModerateBufferTimestamp=null;var r=(this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._currentLowerBufferTarget)*this._sharedState.conf.LIVE.FAST_BUFFER_FILL_FRACTION;(n<=r||0===r)&&this._adjustLowerTarget(-(this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET)*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET_DECREASE_STEP)}this._droppedUnderLow&&this._reboundCount++}this._reboundCount>0&&(this._sharedState.bufferStats.lowerBufferTargetNetChangePerRebound=this._netLowTargetChange/this._reboundCount)}}},{key:"_resetDynamicBufferLevels",value:function(){this._enableDynamicLowerTarget&&this._sharedState.bufferStats.lowerTargetResetCount++;var e=this._isLowBufferTarget();this._enableDynamicLowerTarget=!1,this._currentLowerBufferTarget=this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._droppedUnderLow=!1,e&&this._setLowTarget()}},{key:"_adjustLowerTarget",value:function(e){var t=this._currentLowerBufferTarget,n=this._isLowBufferTarget();this._currentLowerBufferTarget=(0,y.clamp)(this._currentLowerBufferTarget+e,this._sharedState.conf.LIVE.CRITICAL_LOWER_TARGET_RATIO*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET),this._netLowTargetChange+=Math.abs(t-this._currentLowerBufferTarget),n&&this._setLowTarget()}},{key:"_dynamicBufferCheck",value:function(){this._isHighBufferTarget()?(this._bufferedAmount>=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET||this._reachedLiveEdge)&&(this._sharedState.eventBus.emit(c.default.BufferManager.HIGH_BUFFER,this._bufferedAmount),this._setLowTarget()):this._isLowBufferTarget()||this._setHighTarget()}},{key:"_bufferTargetStateChanged",value:function(e){e!==this._bufferTargetState&&(this._bufferTargetState===p.default.LOW&&e===p.default.HIGH?this._sharedState.blockP2PDownload(this._sharedState.conf.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION):this._bufferTargetState===p.default.HIGH&&e===p.default.LOW&&this._sharedState.unblockP2PDownload(),this._bufferTargetState=e)}},{key:"_setRandomTarget",value:function(){this._bufferTargetStateChanged(p.default.RANDOM),this._bufferTarget=this._getRandomBufferLevel(),this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_setHighTarget",value:function(){this._bufferTargetStateChanged(p.default.HIGH),this._bufferTarget=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET,this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_setLowTarget",value:function(){this._bufferTargetStateChanged(p.default.LOW),this._bufferTarget=this._currentLowerBufferTarget,this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_isLowBufferTarget",value:function(){return this._bufferTarget===this._currentLowerBufferTarget}},{key:"_isHighBufferTarget",value:function(){return this._bufferTarget===this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET}},{key:"_getRandomBufferLevel",value:function(){return this._randomBufferLevel=this._randomBufferLevel||Math.floor(Math.random()*(this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._currentLowerBufferTarget+1))+this._currentLowerBufferTarget,this._randomBufferLevel}},{key:"dispose",value:function(){this._uploadCapacityCalculator.dispose(),this._targetGapSamplerTimeout&&this._targetGapSamplerTimeout.clear()}},{key:"bufferTarget",get:function(){return this._bufferTarget}},{key:"bufferedAmount",get:function(){return this._bufferedAmount}},{key:"mediaElementPlaceholder",set:function(e){this._mediaElementPlaceholder=e}},{key:"reachedLiveEdge",get:function(){return this._reachedLiveEdge}}]),e}();t.default=T,e.exports=t.default},function(e,t,n){e.exports={default:n(566),__esModule:!0}},function(e,t,n){n(567),e.exports=n(8).Object.values},function(e,t,n){var r=n(11),i=n(568)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){var r=n(79),i=n(68),a=n(90).f;e.exports=function(e){return function(t){for(var n,o=i(t),s=r(o),u=s.length,l=0,c=[];u>l;)a.call(o,n=s[l++])&&c.push(e?[n,o[n]]:o[n]);return c}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(50),l=n(15),c=n(97),f=r(c),d=1e3,h=function(){function e(t){(0,a.default)(this,e),this._uploadSpeedDelta=new u.Delta,this._uploadSpeedTimestampDelta=new u.Delta(Date.now()),this._sharedState=t,this._uploadCapacityEMWA=new f.default(0,this._sharedState.conf.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT),this._uploadSpeedInterval=(0,l.createInterval)(this._refreshUploadSpeed.bind(this),d)}return(0,s.default)(e,[{key:"_refreshUploadSpeed",value:function(){var e=this._sharedState.transferStats.p2pUploaded,t=this._uploadSpeedDelta.calcDelta(e),n=this._uploadSpeedTimestampDelta.calcDelta(Date.now()),r=8*t/n;r>0&&this._uploadCapacityEMWA.update(r)}},{key:"dispose",value:function(){this._uploadSpeedInterval.clear()}},{key:"uploadCapacityEMWA",get:function(){return this._uploadCapacityEMWA.value}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(4),l=r(u),c=n(253),f=r(c),d=function(){function e(t){(0,a.default)(this,e),this._ee=t,this.gotoIdle()}return(0,s.default)(e,[{key:"_setState",value:function(e){this._state!==e&&(this._prevState=this._state,this._state=e,this._prevState&&this._ee.emit(l.default.BufferManager.STATE_CHANGED,this._prevState,this._state))}},{key:"gotoIdle",value:function(){this._setState(f.default.IDLE)}},{key:"gotoNoPeer",value:function(){this._setState(f.default.NO_PEER)}},{key:"gotoRandom",value:function(){this._setState(f.default.RANDOM)}},{key:"gotoDynamic",value:function(){this._setState(f.default.DYNAMIC)}},{key:"gotoTopSeeder",value:function(){this._setState(f.default.TOP_SEEDER)}},{key:"getState",value:function(){return this._state}},{key:"isIdle",value:function(){return this._state===f.default.IDLE}},{key:"isNoPeer",value:function(){return this._state===f.default.NO_PEER}},{key:"isRandom",value:function(){return this._state===f.default.RANDOM}},{key:"isDynamic",value:function(){return this._state===f.default.DYNAMIC}},{key:"isTopSeeder",value:function(){return this._state===f.default.TOP_SEEDER}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={LOW:"target_low",HIGH:"target_high",RANDOM:"target_random",INIT:"target_init"};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={ZERO:"zero",CRITICALLY_LOW:"crit_low",LOW:"low",MODERATE:"moderate",HIGH:"high"};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(574),l=r(u),c=n(576),f=r(c),d=n(581),h=r(d),v=n(582),_=r(v),p=n(95),m=r(p),g=n(4),E=r(g),y=n(15),S=function(){function e(t,n){(0,a.default)(this,e),this._trafficIntervalCounter=0,this._conf=n.conf,this._timerStore=new m.default,this._configAnalytics=new h.default(n),this._trafficAnalytics=new l.default(n),this._statsAnalytics=new f.default(t,n),this._mediaEndedListener=new _.default(t,n),n.eventBus.once(E.default.Distributor.READY,this._init.bind(this))}return(0,s.default)(e,[{key:"_init",value:function(e){this._conf.CONTENT_ACTIVATED&&(this._sendConfigReport(),e?(this._scheduleTrafficReport(),this._scheduleStatReport(),this._scheduleControlReport()):this._conf.ALLOW_P2P=!1),this._onBU=this._onBeforeUnload.bind(this),window.addEventListener("beforeunload",this._onBU)}},{key:"_onBeforeUnload",value:function(){this._trafficAnalytics.sendUsage(!0)}},{key:"dispose",value:function(){this._timerStore.clearAll(),this._statsAnalytics.dispose(),this._mediaEndedListener.dispose(),window.removeEventListener("beforeunload",this._onBU)}},{key:"_sendConfigReport",value:function(){this._configAnalytics.sendConfig()}},{key:"_scheduleTrafficReport",value:function(){var e=this;if(this._trafficIntervalCounter<this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1){var t=(0,y.createTimeout)(function(){e._trafficAnalytics.sendUsage(),e._scheduleTrafficReport()},this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._trafficIntervalCounter]);this._timerStore.register(t),this._trafficIntervalCounter++}else{var n=this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1],r=this._trafficAnalytics.sendUsage.bind(this._trafficAnalytics,!1),i=(0,y.createInterval)(r,n);this._timerStore.register(i)}}},{key:"_scheduleStatReport",value:function(){var e=(0,y.createInterval)(this._statsAnalytics.sendStats.bind(this._statsAnalytics),this._conf.ANALYTICS.STATS_INTERVAL);this._timerStore.register(e)}},{key:"_scheduleControlReport",value:function(){var e=(0,y.createInterval)(this._statsAnalytics.sendControl.bind(this._statsAnalytics),this._conf.ANALYTICS.CONTROL_INTERVAL);this._timerStore.register(e)}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(176),l=r(u),c=n(50),f=n(4),d=r(f),h=function(){function e(t){var n=this;(0,a.default)(this,e);var r=t.moduleState,i=t.transferStats,o=t.eventBus;this._analyticsClient=new l.default(t,"traffic"),this._moduleState=r,this._transferStats=i,this._p2p=new c.Delta,this._cdn=new c.Delta,this._upload=new c.Delta,this._lastPayloadTimestamp=Date.now(),o.once(d.default.Media.ENDED,this.sendUsage.bind(this)),o.on(d.default.TrafficAnalytics.STOP_SENDING_USAGE,function(){n._disconnected=!0}),o.on(d.default.TrafficAnalytics.RESTART_SENDING_USAGE,function(){n._disconnected=!1})}return(0,s.default)(e,[{key:"_calculateUsagePayload",value:function(){var e=this._p2p.calcDelta(this._transferStats.p2pUseful),t=this._cdn.calcDelta(this._transferStats.cdnDownloaded),n=this._upload.calcDelta(this._transferStats.p2pUploaded),r=this._getTimespanSinceLastPayload(),i={live:this._moduleState.isLive(),cdn:t,p2p:e,upload:n,timespan:r};return this._updateLastPayloadTimestamp(),i}},{key:"_getTimespanSinceLastPayload",value:function(){return Date.now()-this._lastPayloadTimestamp}},{key:"_updateLastPayloadTimestamp",value:function(){this._lastPayloadTimestamp=Date.now()}},{key:"sendUsage",value:function(e){if(!this._disconnected){var t=this._calculateUsagePayload();e&&(t.unload=!0),this._analyticsClient.send(t,"usage")}}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(93),l=r(u),c=n(10),f=r(c),d=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"send",value:function(e,t,n){var r=n.conf,i=n.status,a={timeout:r.ANALYTICS.TIMEOUT_DELAY,retry:r.ANALYTICS.RETRY_NUMBER,retryDelay:r.ANALYTICS.RETRY_DELAY,headers:{Authorization:i.getBearerToken(),"Content-Type":"application/json;charset=UTF-8"}},o=new l.default(l.default.Methods.POST,e,a);o.isStreamroot=!0,o.send(t).catch(function(e){f.default.notifyError(new Error("Could not send analytics payload: "+e.message+". Status: "+e.status))})}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(69),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(176),f=r(c),d=n(577),h=r(d),v=n(578),_=r(v),p=n(50),m=n(70),g=n(579),E=r(g),y=function(){function e(t,n){(0,s.default)(this,e);var r=n.conf,i=n.moduleState,a=n.status,o=n.transferStats,u=n.efficiencyStats,l=n.controlStats,c=n.bufferStats,d=n.abrStats;this._conf=r,this._status=a,this._transferStats=o,this._efficiencyStats=u,this._controlStats=l,this._abrStats=d,this._moduleState=i,this._bufferStats=c,this._analyticsClient=new f.default(n,"stats"),this._peerStats=n.peerStats,this._mediaStats=n.mediaStats,this._sessionStartTime=Date.now(),this._p2pUseful=new p.Delta,this._cdnDownloaded=new p.Delta,this._p2pConsumed=new p.Delta,this._cdnConsumed=new p.Delta,this._p2pMediaDownloaded=new p.Delta,this._p2pMessagesDownloaded=new p.Delta,this._p2pHeadersDownloaded=new p.Delta,this._p2pMessagesCount=new p.Delta,this._p2pUploaded=new p.Delta,this._PP=new p.Delta,this._PC=new p.Delta,this._CP=new p.Delta,this._CC=new p.Delta,this._HP=new p.Delta,this._HD=new p.Delta,this._M=new p.Delta,this._total=new p.Delta,this._concurrentP2pDownloaded=new p.Delta,this._concurrentP2pDownloadCount=new p.Delta,this._cdnEstimationCount=new p.Delta,this._p2pSpeedWindowsCount=new p.Delta,this._zeroP2pSpeedWindowsCount=new p.Delta,this._peerPoolObserver=new h.default(n),this._optionsObserver=new _.default(n),this._receivedChunkRequest=new p.Delta,this._missedDequeuedChunkRequest=new p.Delta,this._dequeuedReceivedChunkRequest=new p.Delta,this._sentSafeChunkRequest=new p.Delta,this._sentUnsafeChunkRequest=new p.Delta,this._timeoutSentSafeChunkRequest=new p.Delta,this._timeoutSentUnsafeChunkRequest=new p.Delta,this._gracedChunk=new p.Delta,this._expiredGraceChunk=new p.Delta,this._openedMatch=new p.Delta,this._openedOffer=new p.Delta,this._match=new p.Delta,this._excessMatch=new p.Delta,this._unansweredOffer=new p.Delta,this._offer=new p.Delta,this._active=new p.Delta,this._transfer=new p.Delta,this._denied=new p.Delta,this._droppedSameTrack=new p.Delta,this._droppedOtherTrack=new p.Delta,this._offerTimeout=new p.Delta,this._answerTimeout=new p.Delta,this._timeoutNewConnection=new p.Delta,this._timeoutCheckingConnection=new p.Delta,this._timeoutFailedConnection=new p.Delta,this._timeoutNewIce=new p.Delta,this._timeoutGatheringIce=new p.Delta,this._timeoutCompleteIce=new p.Delta,this._disconnected=new p.Delta,this._lateMessage=new p.Delta,this._timeoutLocalSdp=new p.Delta,this._timeoutRemoteSdp=new p.Delta,this._timeoutLocalSdpWithStun=new p.Delta,this._timeoutRemoteSdpWithStun=new p.Delta,this._timeoutWithLocalStunIce=new p.Delta,this._timeoutWithRemoteStunIce=new p.Delta,this._missedIceCandidate=new p.Delta,this._gatheredIceCandidate=new p.Delta,this._iceCandidatesBucket=new p.Delta,this._earlyIceGatheringFinished=new p.Delta,this._p2pSgtCheckSuccess=new p.Delta,this._p2pSgtCheckFail=new p.Delta,this._hybridSgtCheckSuccess=new p.Delta,this._hybridSgtCheckFail=new p.Delta,this._checkHeartbeatFailed=new p.Delta,this._getSegmentSuccess=new p.Delta,this._getSegmentFallback=new p.Delta,this._segmentLockTimeout=new p.Delta,this._fillSegmentSuccess=new p.Delta,this._fillSegmentFallback=new p.Delta,this._fillSegmentTimeout=new p.Delta,this._counterControl=0,this._sentOfferSdpVolume=new p.Delta,this._sentAnswerSdpVolume=new p.Delta,this._sentIceCandidatesVolune=new p.Delta,this._signalingMessageCount=new p.Delta,this._sentDistributorRootCount=new p.Delta,this._sentTrackerInitCount=new p.Delta,this._sentTrackerPeersCount=new p.Delta,this._sentTrackerTracksCount=new p.Delta,this._timeSpentOnEdge=new p.Delta,this._timeSpentStatic=new p.Delta,this._timeSpentLow=new p.Delta,this._timeSpentHigh=new p.Delta,this._bufferedAmount=new p.Delta,this._bufferRefill=new p.Delta,this._lowerTargetResetCount=new p.Delta,this._abortFragmentCount=new p.Delta,this._emergencyTrackSwitchCount=new p.Delta,this._qosAnalyticsHandler=new E.default(t,n),this._feebackCount=new p.Delta,this._zeroDurationFeedbackCount=new p.Delta,this._lastPayloadTimestamps={},this._trackSwitchWithPeers=new p.Delta,this._sharedState=n}return(0,l.default)(e,[{key:"_getSessionDuration",value:function(){return Date.now()-this._sessionStartTime}},{key:"_getTimespanSinceLastPayload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return isNaN(this._lastPayloadTimestamps[e])?this._getSessionDuration():Date.now()-this._lastPayloadTimestamps[e]}},{key:"_updateLastPayloadTimestamp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";this._lastPayloadTimestamps[e]=Date.now()}},{key:"_getPeerStats",value:function(){var e=this._peerPoolObserver.getUncorrectedAverageAboveLimitPeerCount(),t=this._peerPoolObserver.getAbovePeerPoolLimitTime(),n=this._peerStats.dataChannelBufferEmptyingStats.fetchSample();return e=t>0?e*this._getTimespanSinceLastPayload()/t:0,{count:this._peerPoolObserver.getAveragePeerCount(),sameTrackCount:this._peerPoolObserver.getSameTrackPeerCount(),match:this._match.calcDelta(this._peerStats.match),excessMatch:this._excessMatch.calcDelta(this._peerStats.excessMatch),openedMatch:this._openedMatch.calcDelta(this._peerStats.openedMatch),openedOffer:this._openedOffer.calcDelta(this._peerStats.openedOffer),unansweredOffer:this._unansweredOffer.calcDelta(this._peerStats.unansweredOffer),offer:this._offer.calcDelta(this._peerStats.offer),locked:this._peerStats.locked.getAverage(),loosers:this._peerStats.loosers.getAverage(),active:this._active.calcDelta(this._peerStats.active),transfer:this._transfer.calcDelta(this._peerStats.transfer),denied:this._denied.calcDelta(this._peerStats.denied),droppedSameTrack:this._droppedSameTrack.calcDelta(this._peerStats.droppedSameTrack),droppedOtherTrack:this._droppedOtherTrack.calcDelta(this._peerStats.droppedOtherTrack),offerTimeout:this._offerTimeout.calcDelta(this._peerStats.offerTimeout),answerTimeout:this._answerTimeout.calcDelta(this._peerStats.answerTimeout),timeoutNewConnection:this._timeoutNewConnection.calcDelta(this._peerStats.timeoutNewConnection),timeoutCheckingConnection:this._timeoutCheckingConnection.calcDelta(this._peerStats.timeoutCheckingConnection),timeoutFailedConnection:this._timeoutFailedConnection.calcDelta(this._peerStats.timeoutFailedConnection),timeoutNewIce:this._timeoutNewIce.calcDelta(this._peerStats.timeoutNewIce),timeoutGatheringIce:this._timeoutGatheringIce.calcDelta(this._peerStats.timeoutGatheringIce),timeoutCompleteIce:this._timeoutCompleteIce.calcDelta(this._peerStats.timeoutCompleteIce),disconnected:this._disconnected.calcDelta(this._peerStats.disconnected),lateMessage:this._lateMessage.calcDelta(this._peerStats.lateMessage),sampledPUC:this._peerStats.sampledPUC,peerPoolUploadCapacity:this._peerStats.peerPoolUploadCapacity.getAverage(),exclusionSize:this._peerStats.exclusionSize,successPeerConnectionAttemptDuration:this._peerStats.successPeerConnectionAttemptDuration.fetchSample()||0,failedPeerConnectionAttemptDuration:this._peerStats.failedPeerConnectionAttemptDuration.fetchSample()||0,dataChannelBufferEmptyingTime:n?n.time:0,dataChannelBufferEmptyingAmount:n?n.amount:0,timeSpentAbovePeerLimit:t,averageOverLimitPeerCount:e,timeoutLocalSdp:this._timeoutLocalSdp.calcDelta(this._peerStats.timeoutLocalSdp),timeoutRemoteSdp:this._timeoutRemoteSdp.calcDelta(this._peerStats.timeoutRemoteSdp),timeoutLocalSdpWithStun:this._timeoutLocalSdpWithStun.calcDelta(this._peerStats.timeoutLocalSdpWithStun),timeoutRemoteSdpWithStun:this._timeoutRemoteSdpWithStun.calcDelta(this._peerStats.timeoutRemoteSdpWithStun),timeoutWithLocalStunIce:this._timeoutWithLocalStunIce.calcDelta(this._peerStats.timeoutWithLocalStunIce),timeoutWithRemoteStunIce:this._timeoutWithRemoteStunIce.calcDelta(this._peerStats.timeoutWithRemoteStunIce)}}},{key:"_getBufferStats",value:function(){if(this._bufferStats){var e=(0,m.toDecimal)(this._bufferStats.getTimeSpentOnEdgeRatio(),2),t=(0,m.toDecimal)(this._bufferStats.getTimeSpentWithoutPeerRatio(),2),n=(0,m.toDecimal)(this._bufferStats.getTimeSpentTopSeederRatio(),2),r=this._bufferStats.getTimeSpentDynamicIntegral(),i=r.intervalLength?(0,m.toDecimal)(r.value/r.intervalLength,2):(0,m.toDecimal)(r.value,2),a=(0,m.toDecimal)(1e3*this._bufferRefill.calcDelta(this._bufferStats.bufferRefill)/(r.value+this._bufferStats.bufferedAmount),2),o=this._bufferStats.alwaysDynamicBuffer,s=(0,m.toDecimal)(this._bufferStats.lowerBufferTargetNetChangePerRebound,2),u=this._bufferStats.sampledHighLowBufferTargetGap,l=(0,m.toDecimal)(this._bufferStats.timeLowerTargetAboveLiveEdgeStaircase.getAverage(),2);return{bufferState:this._bufferStats.bufferState,alwaysDynamicBuffer:o,timeSpentOnEdgeRatio:e,timeSpentWithoutPeerRatio:t,timeSpentDynamicRatio:i,timeSpentTopSeederRatio:n,bufferRefillRatio:a,lowerBufferTargetNetChangePerRebound:s,timeLowerTargetAboveLiveEdgeRatio:l,sampledHighLowBufferTargetGap:u,lowerTargetResetCount:this._lowerTargetResetCount.calcDelta(this._bufferStats.lowerTargetResetCount)}}}},{key:"_getAbrStats",value:function(){var e=this._abrStats.p2pUsefulEstimate,t=this._concurrentP2pDownloaded.calcDelta(this._abrStats.concurrentP2pDownloaded),n=this._concurrentP2pDownloadCount.calcDelta(this._abrStats.concurrentP2pDownloadCount),r=this._cdnEstimationCount.calcDelta(this._abrStats.cdnEstimationCount),i=this._p2pSpeedWindowsCount.calcDelta(this._abrStats.p2pSpeedWindowsCount),a=this._zeroP2pSpeedWindowsCount.calcDelta(this._abrStats.zeroP2pSpeedWindowsCount),o=this._abrStats.bandwidthEstimateCV,s=this._feebackCount.calcDelta(this._abrStats.feebackCount),u=this._zeroDurationFeedbackCount.calcDelta(this._abrStats.zeroDurationFeedbackCount),l=this._trackSwitchWithPeers.calcDelta(this._abrStats.trackSwitchWithPeers);return this._abrStats.flushBandwidthEstimates(),{p2pUsefulEstimate:e,concurrentP2pDownloaded:t,concurrentP2pDownloadCount:n,cdnEstimationCount:r,p2pSpeedWindowsCount:i,zeroP2pSpeedWindowsCount:a,bandwidthEstimateCV:o,feebackCount:s,zeroDurationFeedbackCount:u,trackSwitchWithPeers:l}}},{key:"_calculateStatsPayload",value:function(){var e=this._status.getConnectedToSignalingServer(),t=this._status.getConnected(),n=this._status.getTrackerVersion(),r=this._status.getTrackerId(),i={PP:this._transferStats.multipleDlPP,PC:this._transferStats.multipleDlPC,CP:this._transferStats.multipleDlCP,CC:this._transferStats.multipleDlCC,HP:this._transferStats.multipleDlHP,HD:this._transferStats.multipleDlHD,M:this._transferStats.multipleDlM},o=i.PP+i.PC+i.CP+i.CC+i.HP+i.HD+i.M,s=this._cdnDownloaded.calcDelta(this._transferStats.cdnDownloaded),u=s,l=this._p2pUseful.calcDelta(this._transferStats.p2pUseful),c=this._p2pConsumed.calcDelta(this._transferStats.p2pConsumed),f=this._cdnConsumed.calcDelta(this._transferStats.cdnConsumed),d=this._p2pMediaDownloaded.calcDelta(this._transferStats.p2pMediaDownloaded),h=this._p2pHeadersDownloaded.calcDelta(this._transferStats.p2pHeadersDownloaded),v=this._p2pMessagesDownloaded.calcDelta(this._transferStats.p2pMessagesDownloaded),_=this._p2pMessagesCount.calcDelta(this._transferStats.p2pMessagesCount),p=this._p2pUploaded.calcDelta(this._transferStats.p2pUploaded),g={p2pMediaDownloaded:d,p2pHeadersDownloaded:h,p2pMessagesDownloaded:v,p2pMessagesCount:_,cdnDownloaded:s,p2pUseful:l,cdnUseful:u,p2pConsumed:c,cdnConsumed:f,p2pUploaded:p,multipleDl:{PP:this._PP.calcDelta(i.PP),PC:this._PC.calcDelta(i.PC),CP:this._CP.calcDelta(i.CP),CC:this._CC.calcDelta(i.CC),HP:this._HP.calcDelta(i.HP),HD:this._HD.calcDelta(i.HD),M:this._M.calcDelta(i.M),total:this._total.calcDelta(o)}},E=this._receivedChunkRequest.calcDelta(this._efficiencyStats.receivedChunkRequestCount),y=this._dequeuedReceivedChunkRequest.calcDelta(this._efficiencyStats.dequeuedReceivedChunkRequestCount),S=this._missedDequeuedChunkRequest.calcDelta(this._efficiencyStats.missedDequeuedChunkRequestCount),T=this._sentSafeChunkRequest.calcDelta(this._efficiencyStats.safeChunkRequestCount),b=this._sentUnsafeChunkRequest.calcDelta(this._efficiencyStats.unsafeChunkRequestCount),R=this._timeoutSentSafeChunkRequest.calcDelta(this._efficiencyStats.safeChunkRequestTimeoutCount),A=this._timeoutSentUnsafeChunkRequest.calcDelta(this._efficiencyStats.unsafeChunkRequestTimeoutCount),D=this._getTimespanSinceLastPayload(),w=D>0?Math.round(E*this._conf.CHUNK_SIZE*8/D):0,O=D>0?Math.round((T+b)*this._conf.CHUNK_SIZE*8/D):0,k=this._gracedChunk.calcDelta(this._efficiencyStats.gracedChunksCount),C=this._expiredGraceChunk.calcDelta(this._efficiencyStats.expiredGraceChunksCount),L={receivedChunkRequestBitrate:w,sentChunkRequestBitrate:O,receivedChunkRequestsMissedRatio:y>0?(0,m.toDecimal)(S/y,2):0,sentSafeChunkRequests:T,sentUnsafeChunkRequests:b,sentSafeChunkRequestsTimeout:R,sentUnsafeChunkRequestsTimeout:A,uploadQueueExpirationRatio:E>0?(0,m.toDecimal)(1-y/E,2):0,gracedChunks:k,expiredGraceChunks:C},P=this._abortFragmentCount.calcDelta(this._mediaStats.abortFragmentCount),I=this._emergencyTrackSwitchCount.calcDelta(this._mediaStats.emergencyTrackSwitchCount),M={emergencyTrackSwitchCPM:I/(D/6e4)};this._qosAnalyticsHandler.initialized&&(M=(0,a.default)(M,this._qosAnalyticsHandler.getQoSAnalytics()));var N=this._moduleState.isAlwaysDvr&&this._moduleState.isLive();this._moduleState.resetIsAlwaysDvr();var x={transfers:g,efficiency:L,qos:M,peers:this._getPeerStats(),buffer:this._getBufferStats(),abr:this._getAbrStats(),live:this._moduleState.isLive(),signalingServerConnected:e,trackerConnected:t,trackerVersion:n,trackerId:r,sessionDuration:this._getSessionDuration(),timespan:D,options:{p2pDownloadAlwaysOn:this._optionsObserver.p2pDownloadAlwaysOn,p2pUploadAlwaysOn:this._optionsObserver.p2pUploadAlwaysOn},confLabel:this._conf.CONF_LABEL,qosTester:this._conf.QOS_P2P_DISABLED,mediaDuration:Math.round(this._mediaStats.duration),videoTrackCount:this._mediaStats.videoTrackCount,minBitrate:this._mediaStats.minBitrate,maxBitrate:this._mediaStats.maxBitrate,abortFragmentCount:P,isAlwaysDvr:N};return this._updateLastPayloadTimestamp(),this._optionsObserver.reset(),x}},{key:"_calculateControlPayload",value:function(){var e=this._missedIceCandidate.calcDelta(this._controlStats.missedIceCandidateCount),t=this._gatheredIceCandidate.calcDelta(this._controlStats.gatheredIceCandidateCount),n=this._iceCandidatesBucket.calcDelta(this._controlStats.iceCandidatesBucketCount),r=this._earlyIceGatheringFinished.calcDelta(this._controlStats.earlyIceGatheringFinishedCount),i=n>0?(0,m.toDecimal)(e/n,2):0,a=n>0?(0,m.toDecimal)(t/n,2):0,o=n>0?r/n:0,s=this._controlStats.getSampledIceGatheringDuration(),u=this._p2pSgtCheckSuccess.calcDelta(this._controlStats.nbRightHashP2P),l=this._p2pSgtCheckFail.calcDelta(this._controlStats.nbWrongHashP2P),c=this._hybridSgtCheckSuccess.calcDelta(this._controlStats.nbRightHashDLM),f=this._hybridSgtCheckFail.calcDelta(this._controlStats.nbWrongHashDLM),d=this._checkHeartbeatFailed.calcDelta(this._controlStats.checkHeartbeatFailed),h=this._getSegmentSuccess.calcDelta(this._controlStats.getSegmentSuccess),v=this._getSegmentFallback.calcDelta(this._controlStats.getSegmentFallback),_=this._segmentLockTimeout.calcDelta(this._controlStats.segmentLockTimeout),p=this._fillSegmentSuccess.calcDelta(this._controlStats.fillSegmentSuccess),g=this._fillSegmentFallback.calcDelta(this._controlStats.fillSegmentFallback),E=this._fillSegmentTimeout.calcDelta(this._controlStats.fillSegmentTimeout),y=this._sentOfferSdpVolume.calcDelta(this._controlStats.sentOfferSdpVolume),S=this._sentAnswerSdpVolume.calcDelta(this._controlStats.sentAnswerSdpVolume),T=this._sentIceCandidatesVolune.calcDelta(this._controlStats.sentIceCandidatesVolume),b=this._signalingMessageCount.calcDelta(this._controlStats.signalingMessagesCount),R=this._sentDistributorRootCount.calcDelta(this._controlStats.sentDistributorRootCount),A=this._sentTrackerInitCount.calcDelta(this._controlStats.sentTrackerInitCount),D=this._sentTrackerPeersCount.calcDelta(this._controlStats.sentTrackerPeersCount),w=this._sentTrackerTracksCount.calcDelta(this._controlStats.sentTrackerTracksCount),O={live:this._moduleState.isLive(),meanMissedIceCandidate:i,meanGatheredIceCandidate:a,earlyIceCandidateGatheringRatio:o,sampledIceGatheringDuration:s,p2pSgtCheckSuccess:u,p2pSgtCheckFail:l,hybridSgtCheckSuccess:c,hybridSgtCheckFail:f,checkHeartbeatFailed:d,getSegmentSuccess:h,getSegmentFallback:v,segmentLockTimeout:_,fillSegmentSuccess:p,fillSegmentFallback:g,fillSegmentTimeout:E,sessionDuration:this._getSessionDuration(),timespan:this._getTimespanSinceLastPayload("control"),confLabel:this._conf.CONF_LABEL,sentOfferSdpVolume:y,sentAnswerSdpVolume:S,sentIceCandidatesVolume:T,signalingMessagesCount:b,sentDistributorRootCount:R,sentTrackerInitCount:A,sentTrackerPeersCount:D,sentTrackerTracksCount:w};return this._updateLastPayloadTimestamp("control"),O}},{key:"sendStats",value:function(){var e=this._calculateStatsPayload();e.timespan<2*this._conf.ANALYTICS.STATS_INTERVAL&&this._analyticsClient.send(e)}},{key:"sendControl",value:function(){var e=this._calculateControlPayload();e.timespan<2*this._conf.ANALYTICS.CONTROL_INTERVAL&&this._analyticsClient.send(e,"control")}},{key:"dispose",value:function(){this._qosAnalyticsHandler.dispose()}}]),e}();t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(177),l=r(u),c=n(70),f=n(4),d=r(f),h=function(){function e(t){(0,a.default)(this,e),this._peerCountStaircaseFunctionIntegral=new l.default,this._sameTrackPeerCountStaircaseFunctionIntegral=new l.default,this._abovePeerPoolLimitPeerCount=new l.default,this._abovePeerPoolLimitTime=new l.default,this._sharedState=t,t.eventBus.on(d.default.PeerPool.PEER_STATS_UPDATE,this._processPeerPoolStats,this),t.eventBus.on(d.default.PeerPool.PEER_OPEN,this._trackPeerCount,this),t.eventBus.on(d.default.PeerPool.PEER_DESTROYED,this._trackPeerCount,this)}return(0,s.default)(e,[{key:"_trackPeerCount",value:function(e){var t=e.peerCount,n=Math.max(0,t-this._sharedState.conf.PEER_POOL_LIMIT);this._abovePeerPoolLimitPeerCount.updateMetric(n),this._abovePeerPoolLimitTime.updateMetric(n>0?1:0)}},{key:"_processPeerPoolStats",value:function(e){var t=e.peerCount,n=e.sameTrackPeerCount;this._peerCountStaircaseFunctionIntegral.updateMetric(t),this._sameTrackPeerCountStaircaseFunctionIntegral.updateMetric(n)}},{key:"getAveragePeerCount",value:function(){return(0,c.toDecimal)(this._peerCountStaircaseFunctionIntegral.getAverage(),2)}},{key:"getSameTrackPeerCount",value:function(){return(0,c.toDecimal)(this._sameTrackPeerCountStaircaseFunctionIntegral.getAverage(),2)}},{key:"getUncorrectedAverageAboveLimitPeerCount",value:function(){return this._abovePeerPoolLimitPeerCount.getAverage()}},{key:"getAbovePeerPoolLimitTime",value:function(){return this._abovePeerPoolLimitTime.getIntegral().value}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._sharedState=t,this._init()}return(0,s.default)(e,[{key:"_init",value:function(){var e=this;this.reset(),this._sharedState.eventBus.on("p2pUploadToggle",function(t){t||(e._p2pUploadAlwaysOn=!1)}),this._sharedState.eventBus.on("p2pDownloadToggle",function(t){t||(e._p2pDownloadAlwaysOn=!1)})}},{key:"reset",value:function(){this._p2pDownloadAlwaysOn=this._sharedState.isP2PDownloadOn,this._p2pUploadAlwaysOn=this._sharedState.isP2PUploadOn}},{key:"p2pDownloadAlwaysOn",get:function(){return this._p2pDownloadAlwaysOn}},{key:"p2pUploadAlwaysOn",get:function(){return this._p2pUploadAlwaysOn}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(254),l=r(u),c=n(580),f=r(c),d=n(15),h=n(4),v=r(h),_=function(){function e(t,n){(0,a.default)(this,e),this._trackSwitchCount=-1,n.eventBus.on(v.default.Metrics.TRACK_SWITCH,this._onTrackSwitch.bind(this)),null!==t.mediaElement&&(this._initialized=!0,this._qosAnalytics=new l.default(t.mediaElement,d.createInterval),this._qoSAnalyticsFormatter=new f.default)}return(0,s.default)(e,[{key:"_onTrackSwitch",value:function(){this._trackSwitchCount++}},{key:"getQoSAnalytics",value:function(){if(!this._initialized)throw new Error("getQoSAnalytics was called on non-initialized QoSAnalyticsHandler");var e=this._qosAnalytics.getQoSAnalytics();return this._qoSAnalyticsFormatter.format(e,this._trackSwitchCount)}},{key:"dispose",value:function(){this._qosAnalytics&&this._qosAnalytics.dispose()}},{key:"initialized",get:function(){return this._initialized}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(50),l=n(70),c=function(){function e(){(0,a.default)(this,e),this._timeSpentPlayingDelta=new u.Delta,this._timeSpentPausedDelta=new u.Delta,this._timeSpentRebufferingDelta=new u.Delta,this._timeSpentRebufferingWithBufferDelta=new u.Delta,this._timeSpentSeekingDelta=new u.Delta,this._timeSpentEndedDelta=new u.Delta,this._rebufferingCountDelta=new u.Delta,this._rebufferingWithBufferCountDelta=new u.Delta,this._lastTimeDelta=new u.Delta(Date.now()),this._droppedFrameCountDelta=new u.Delta,this._trackSwitchCountDelta=new u.Delta}return(0,s.default)(e,[{key:"_normalizePerMinute",value:function(e,t,n,r){var i=this._lastTimeDelta.calcDelta(Date.now()),a=this._rebufferingCountDelta.calcDelta(e),o=a/(i/6e4),s=this._rebufferingWithBufferCountDelta.calcDelta(t),u=s/(i/6e4),c=this._droppedFrameCountDelta.calcDelta(n),f=c/(i/6e4),d=this._trackSwitchCountDelta.calcDelta(r),h=d/(i/6e4);return{rebufferingCPM:(0,l.toDecimal)(o,2),rebufferingWithBufferCPM:(0,l.toDecimal)(u,2),droppedFrameCPM:(0,l.toDecimal)(f,2),trackSwitchCPM:(0,l.toDecimal)(h,2)}}},{key:"format",value:function(e,t){var n=this._normalizePerMinute(e.rebufferingCount,e.rebufferingCountWithBuffer,e.droppedFrameCount,t);return{rebufferingCPM:n.rebufferingCPM,rebufferingWithBufferCPM:n.rebufferingWithBufferCPM,droppedFrameCPM:n.droppedFrameCPM,trackSwitchCPM:n.trackSwitchCPM,timeSpentPlaying:(0,l.toDecimal)(this._timeSpentPlayingDelta.calcDelta(e.timeSpentPlaying),2),timeSpentPaused:(0,l.toDecimal)(this._timeSpentPausedDelta.calcDelta(e.timeSpentPaused),2),timeSpentEnded:(0,l.toDecimal)(this._timeSpentEndedDelta.calcDelta(e.timeSpentEnded),2),timeSpentRebuffering:(0,l.toDecimal)(this._timeSpentRebufferingDelta.calcDelta(e.timeSpentRebuffering),2),timeSpentRebufferingWithBuffer:(0,l.toDecimal)(this._timeSpentRebufferingWithBufferDelta.calcDelta(e.timeSpentRebufferingWithBuffer),2),timeSpentSeeking:(0,l.toDecimal)(this._timeSpentSeekingDelta.calcDelta(e.timeSpentSeeking),2),startupTime:e.startupTime,endedOnce:e.endedOnce}}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(176),l=r(u),c=function(){function e(t){(0,a.default)(this,e),this._sharedState=t,this._analyticsClient=new l.default(t,"p2pconfig")}return(0,s.default)(e,[{key:"sendConfig",value:function(){var e={};e.activateP2P=this._sharedState.conf.ALLOW_P2P,e.debug=this._sharedState.p2pConfig.debug||!1,e.deviceInfo=this._sharedState.conf.DEVICE_INFO,e.trackerUrl=this._sharedState.conf.TRACKER_URL,e.backendUrl=this._sharedState.conf.DISTRIBUTOR.URL,e.signalingUrl=this._sharedState.conf.SIGNALING_URL,e.analyticsUrl=this._sharedState.conf.ANALYTICS.KLARA_URL,e.vodCacheSize=this._sharedState.conf.P2P_CACHE_MAX_SIZE/(1024*1024),e.liveCacheSize=this._sharedState.conf.LIVE.P2P_CACHE_MAX_SIZE/(1024*1024),e.rangeRequestEnabled=this._sharedState.conf.RANGE_REQUEST_ALLOWED,e.mobileBrowserEnabled=this._sharedState.conf.ENABLE_MOBILE_BROWSER,e.enableStunServers=this._sharedState.conf.ENABLE_STUN;var t={live:this._sharedState.moduleState.isLive(),p2pConfig:e};this._analyticsClient.send(t)}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(4),l=r(u),c=n(15),f=.3,d=100,h=function(){function e(t,n){(0,a.default)(this,e),this._tickInterval=null,this._sharedState=n,null===t.mediaElement||this._sharedState.moduleState.isLive()||(this._mediaElement=t.mediaElement,this._tickInterval=(0,c.createInterval)(this._tick.bind(this),d))}return(0,s.default)(e,[{key:"_tick",value:function(){if(null!==this._mediaElement){var e=this._mediaElement.duration,t=this._mediaElement.currentTime;e&&e-t<f&&(null!==this._tickInterval&&(this._tickInterval.clear(),this._tickInterval=null),this._sharedState.eventBus.emit(l.default.Media.ENDED))}}},{key:"dispose",value:function(){null!==this._tickInterval&&this._tickInterval.clear()}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(96),s=r(o),u=n(255),l=r(u),c=n(95),f=r(c),d=n(15),h=n(588),v=r(h),_=n(600),p=r(_),m=n(4),g=r(m),E=n(258),y=r(E),S=n(601),T=r(S),b=n(602),R=r(b),A=n(603),D=r(A),w=n(259),O=r(w),k={EXCLUSION_REMOVED:"removed",EXCLUSION_DISCONNECTED:"disconnected",EXCLUSION_OFFER_DECLINED:"offer_declined",EXCLUSION_CONNECTION_ATTEMPT_TIMED_OUT:"timed_out"},C=function(e,t,n,r,i){var o=i.conf,u=i.status,c=i.peerStats,h=void 0,_=null,m=!1,E=void 0,S=null,b=void 0,A=!1,w=[],C=0,L=s.default,P=new T.default(e,t,i),I=r,M=this,N=i.eventBus,x=i.statsProvider,F=new f.default,U=function(){m=!0,G()},B=function(){m=!1,G()},G=function(e){if(F.clear(_),_=null,!m){var t=Date.now()-L,n=e-t;n>0?(_=(0,d.createTimeout)(z,n),F.register(_)):z()}},H=function(e){if(e.isVideo){var t=!0,n=!1,r=void 0;try{for(var s,u=(0,a.default)(w);!(t=(s=u.next()).done);t=!0){if(s.value.isOnSameTrack()){i.abrStats.trackSwitchWithPeers++;break}}}catch(e){n=!0,r=e}finally{try{!t&&u.return&&u.return()}finally{if(n)throw r}}_&&G(o.ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL)}},j=function(){fe()&&M.makeRoom();var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(w);!(n=(o=s.next()).done);n=!0){var u=o.value;u.locked()&&e++,u.isLooser()&&t++}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}c.locked.updateMetric(e),c.loosers.updateMetric(t);var l=0,f=!0,d=!1,h=void 0;try{for(var v,_=(0,a.default)(w);!(f=(v=_.next()).done);f=!0){v.value.isOnSameTrack()&&l++}}catch(e){d=!0,h=e}finally{try{!f&&_.return&&_.return()}finally{if(d)throw h}}N.emit(g.default.PeerPool.PEER_STATS_UPDATE,{peerCount:w.length,sameTrackPeerCount:l})},W=function(){for(var e=0,t=0,n=0;n<w.length;n++){var r=w[n];e+=r.getDlSpeed(),t+=r.getUpSpeed()}u.setDlSpeed(e),u.setUpSpeed(t),u.computeMaxAndAvgSpeed()},V=function(){null!==S&&S.dispose(),S=new p.default(u.getMyPeerId(),this,n,i),b=new R.default(S,i),E=new D.default(this,S,i),h=b.onPeersFromTracker.bind(b),A&&Y()},K=function(){_&&(F.clear(_),_=null)},Y=function(){if(u.getConnected()&&u.getConnectedToSignalingServer()){var e=Date.now()-L,t=Date.now()-i.moduleState.currentTracks.lastSwitchTimestamp,n=t<e?o.ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL:o.ASK_PEERS_INTERVAL;G(n),A=!0}},q=function(e,t){w=l.default.without(w,e),N.emit(g.default.PeerPool.PEER_DESTROYED,{remotePeer:e,peerCount:w.length}),t?(E.addSecondOrderExclusion(e.getId(),o.PEER_REMOVED_EXCLUSION_RANK,o.PEER_REMOVED_EXCLUSION_DURATION,k.EXCLUSION_REMOVED),e.isOnSameTrack()?c.droppedSameTrack++:c.droppedOtherTrack++):E.addSecondOrderExclusion(e.getId(),o.PEER_DISCONNECTED_EXCLUSION_RANK,o.PEER_DISCONNECTED_EXCLUSION_DURATION,k.EXCLUSION_DISCONNECTED)},X=function(e){e.close(!0),w=l.default.without(w,e)},z=function e(){L=Date.now();var t=E.exclusionList;c.exclusionSize=E.secondOrderExclusions.size,P.askPeers(t,h),_=(0,d.createTimeout)(e,o.ASK_PEERS_INTERVAL),F.register(_)},Q=function(){return w.length},Z=function(e){for(var t=0;t<w.length;t++){w[t].requestHasSegment(e)}},J=function(){for(;w.length>0;)w[w.length-1].close()},$=function(e,t,r){var a=ee(),o=new v.default(e,n,t,i,a);w.push(o),r?c.openedMatch++:c.openedOffer++,N.emit(g.default.PeerPool.PEER_OPEN,{remotePeer:o,peerCount:w.length}),oe()},ee=function(){for(var e=[],t=0,n=w.length;t<n;t++)e.push(w[t].getUploadCapacity());var r=y.default.median(e);return r?Math.max(r,o.MIN_PEER_UPLOAD_CAPACITY):o.DEFAULT_PEER_UPLOAD_CAPACITY},te=function(){for(var e=0,t=0,n=w.length;t<n;t++)e+=w[t].getUploadCapacity();c.peerPoolUploadCapacity.updateMetric(e)},ne=function(){return w.length>0?w[Math.floor(Math.random()*w.length)].getUploadCapacity():0},re=function(e){E.addSecondOrderExclusion(e,o.OFFER_DECLINED_EXCLUSION_RANK,o.OFFER_DECLINED_EXCLUSION_DURATION,k.EXCLUSION_OFFER_DECLINED),c.denied++},ie=function(e){E.addSecondOrderExclusion(e,o.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK,o.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION,k.EXCLUSION_CONNECTION_ATTEMPT_TIMED_OUT),ae()},ae=function(){++C>o.MAX_PEER_CONNECTION_FAILURES&&(se(),ue())},oe=function(){C=0},se=function(){N.emit(g.default.Tracker.PERM_TRACKER_DISCONNECTION_REQUEST)},ue=function(){N.emit(g.default.Signaling.PERM_SIGNALING_DISCONNECTION_REQUEST)},le=function(e){var t=I.getSegmentInfo(e),n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(w);!(n=(o=s.next()).done);n=!0){o.value.answerHasSegment(t,{pushed:!0})}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}},ce=function(){var e=[],t=[],n=1,r=1,i=!0,o=!1,s=void 0;try{for(var u,l=(0,a.default)(w);!(i=(u=l.next()).done);i=!0){var c=u.value;c.locked()||(c.isLooser()?e.push(c):t.push(c)),n=Math.max(n,c.getUpSpeedEMA()),r=Math.max(r,c.getUsefulDlSpeedEMA())}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}return{loosers:e,unlocked:t,maxUpSpeed:n,maxDownSpeed:r}},fe=function(){return w.length-o.PEER_POOL_LIMIT>0},de=function(e,t,n){var r=e.getUpSpeedEMA()/t+e.getUsefulDlSpeedEMA()/n;return 1||(e.lastCRank=r),r},he=function(){u.getEE().removeListener("tracker_ready",V),u.getEE().removeListener("tracker_disconnected",K),u.getEE().removeListener("signaling_ready",Y),u.getEE().removeListener("signaling_disconnected",K),null!==S&&S.dispose(),b&&b.dispose(),F.clearAll(),J(),P.dispose()};M.getPeerArray=function(){return w},M.lockedCount=function(){var e=0,t=!0,n=!1,r=void 0;try{for(var i,o=(0,a.default)(w);!(t=(i=o.next()).done);t=!0){i.value.locked()&&e++}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e},M.openSlotsCount=function(){return Math.max(o.PEER_POOL_LIMIT-M.lockedCount(),0)},M.makeRoom=function(){var e=ce(),t=e.loosers,n=e.unlocked,r=e.maxUpSpeed,i=e.maxDownSpeed;for(t.sort(function(e,t){return t.getUpSpeedEMA()-e.getUpSpeedEMA()});t.length>0&&fe();){var a=t.pop();X(a)}if(fe())for(n.sort(function(e,t){return de(t,r,i)-de(e,r,i)});n.length>0&&fe();){var o=n.pop();X(o)}},M.getPeerCount=Q,M.getPendingConnectionDebugInfos=function(){return S?S.getPendingConnectionDebugInfos():[]},M.requestHasSegment=Z,M.addPeerConnection=$,this.offerDeclined=re,this.connectionAttemptTimeout=ie,M.broadcastSegmentInfo=le,M.dispose=he,function(){var e=(0,d.createInterval)(W,o.SPEED_MONITOR_INTERVAL),t=(0,d.createInterval)(te,o.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL),n=(0,d.createInterval)(j,o.PEER_POOL_MAINTENANCE_INTERVAL);F.register(e),F.register(t),F.register(n),N.on(g.default.Peer.PEER_DISCONNECTED,q),N.on(g.default.Metrics.TRACK_SWITCH,H,this),N.on(g.default.PeerPool.STOP_ASKING_PEERS,U),N.on(g.default.PeerPool.START_ASKING_PEERS,B),u.getEE().on("tracker_ready",V,M),u.getEE().on("tracker_disconnected",K,M),u.getEE().on("signaling_ready",Y,M),u.getEE().on("signaling_disconnected",K,M),x.registerProvider(O.default.PeerStats.SAMPLED_PUC,ne)}()};t.default=C,e.exports=t.default},function(e,t,n){e.exports={default:n(585),__esModule:!0}},function(e,t,n){n(586),e.exports=n(8).Object.is},function(e,t,n){var r=n(11);r(r.S,"Object",{is:n(587)})},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(96),s=r(o),u=n(37),l=r(u),c=n(15),f=n(252),d=r(f),h=n(589),v=r(h),_=n(50),p=n(591),m=n(592),g=r(m),E=n(597),y=r(E),S=n(4),T=r(S),b=n(598),R=r(b),A=n(599),D=r(A),w=n(123),O=r(w),k=n(97),C=r(k),L=n(178),P=r(L),I=n(10),M=r(I),N=function(e,t,n,r,i){var o=r,u=r.conf,f=r.peerStats,h=new _.Delta,m=new _.Delta,E=new _.Delta,S=new _.Delta(Date.now()),b=r.eventBus,A=e,w=f,k=new v.default(n,r),L=this,I=C.default.fromHalfLife(0,u.PEER_UPLOAD_SPEED_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL),N=C.default.fromHalfLife(0,u.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL),x=Math.max(u.BLOCK_SEEDER_SCHEDULING_WINDOW,u.PEER_TIMEOUT_RATIO_WINDOW),F=new P.default(x),U=new P.default(x),B=Date.now(),G=0,H=0,j=!1,W=void 0,V=0,K=0,Y=void 0,q=0,X=0,z=0,Q=0,Z=!1,J=!1,$=void 0,ee=!1,te=new l.default,ne=new l.default,re=s.default,ie=!1,ae=function(){var e=S.calcDelta(Date.now()),t=h.calcDelta(G),n=m.calcDelta(H),i=E.calcDelta(k.dataUploaded);V=8*t/e,K=8*i/e;var a=8*n/e,o=Date.now()-r.moduleState.currentTracks.lastSwitchTimestamp;Z?u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&o<u.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION?N.update(a,C.default.halfLifeToEMAWeight(u.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL)):N.update(a):a>0&&(N.update(a,1),Z=!0),J?u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&o<u.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION?I.update(K,C.default.halfLifeToEMAWeight(u.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL)):I.update(K):K>0&&(I.update(K,1),J=!0),F.push(q),U.push(X)},oe=function(e){n.sendMessage("requestHasSegment",{segmentCoord:e})},se=function(e,t){var r=t.pushed;n.sendMessage("hasSegment",{segmentInfo:e,pushed:!!r})},ue=function(e){if(q++,X++,ne.set(e.id,te.get(e.id)),te.delete(e.id),(0,c.createTimeout)(function(){var t=ne.get(e.id);t&&t.timestamp===e.timestamp&&ne.delete(e.id)},u.CHUNK_GRACE_DURATION),!this.isBannedSeeder()){me(u.BLOCK_SEEDER_SCHEDULING_WINDOW)>u.BLOCK_SEEDER_SCHEDULING_TIMEOUT_THRESHOLD&&q>u.BLOCK_SEEDER_SCHEDULING_REQUEST_THRESHOLD&&(re=Date.now())}},le=function(e,t,r,i){var s=g.default.decode(t),u=!0,l=!1,c=void 0;try{for(var f,d=(0,a.default)(s);!(u=(f=d.next()).done);u=!0){var h=f.value,v=new R.default(e,h,this,o,i,r);te.set(v.id,v)}}catch(e){l=!0,c=e}finally{try{!u&&d.return&&d.return()}finally{if(l)throw c}}n.sendMessage("requestChunks",{segmentCoord:e,ids:t,safe:r===O.default.SAFE})},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];ie=e,$?$.clear():M.default.notifyError(new Error("clear() call on undefined Peer.speedMonitorTimer")),n.removeListener(T.default.PeerConnection.BINARY_DATA_RECEIVED,he),n.removeListener(T.default.PeerConnection.MESSAGE_RECEIVED,de),n.close()},fe=function(){$?$.clear():M.default.notifyError(new Error("clear() call on undefined Peer.speedMonitorTimer")),k.dispose(),Y.dispose(),n.destroy()},de=function(e,n){var i=void 0;switch(e){case"heartbeat":W=n.videoTrack;break;case"requestHasSegment":b.emit("segmentRequested",L,new t(n.segmentCoord));break;case"hasSegment":i=new t(n.segmentInfo.segmentCoord),i.fromPeer=!0;var o=new d.default(i,n.segmentInfo.size,n.segmentInfo.hash),s=!!n.pushed;b.emit("hasSegment",L,o,{pushed:s});break;case"requestChunks":if(!r.isP2PUploadOn)return;i=new t(n.segmentCoord);var u=g.default.decode(n.ids),l=n.safe?O.default.SAFE:O.default.UNSAFE,c=!0,f=!1,h=void 0;try{for(var v,_=(0,a.default)(u);!(c=(v=_.next()).done);c=!0){var p=v.value;r.efficiencyStats.receivedChunkRequestCount++,k.push(new D.default(i,p,r,l))}}catch(e){f=!0,h=e}finally{try{!c&&_.return&&_.return()}finally{if(f)throw h}}break;default:return void M.default.notifyError(new Error("Invalid message "+e+" sent by peerConnection"))}ee||(w.active++,ee=!0)},he=function(e,t,n){G+=e.byteLength;var i=te.get(R.default.getIdOf(n,t));i?(q++,i.dataDownloaded(e),H+=e.byteLength,te.delete(i.id)):(Q++,i=ne.get(R.default.getIdOf(n,t)),i?(z++,r.efficiencyStats.gracedChunksCount++,i.dataDownloaded(e),ne.delete(i.id)):(r.efficiencyStats.expiredGraceChunksCount++,r.transferStats.multipleDlM+=e.byteLength)),ve()},ve=function(){j||(w.transfer++,j=!0)},_e=function(){return!W||r.moduleState.currentTracks.video.viewToString()===W},pe=function(){return Date.now()-B<u.PEER_INIT_LOCKED_DURATION},me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.PEER_TIMEOUT_RATIO_WINDOW,t=F.subDelta(e),n=U.subDelta(e);return t>0?n/t:0},ge=function(e){for(var t=0;t<e.length;t++)oe(e[t])};L.getRtt=n.getRtt.bind(n),L.requestHasSegment=oe,L.answerHasSegment=se,L.requestChunks=le,L.timeoutChunk=ue,L.isOnSameTrack=_e,L.close=ce,L.getDataDownloaded=function(){return G},L.getDataUploaded=function(){return k.dataUploaded},L.getId=function(){return A},L.getDlSpeed=function(){return V},L.getUpSpeed=function(){return K},L.getUsefulDlSpeedEMA=function(){return N.value},L.getUpSpeedEMA=function(){return I.value},L.getChunkTimeoutCount=function(){return X},L.getChunkRequestedCount=function(){return q},L.getLateChunksCount=function(){return Q},L.getGracedChunksCount=function(){return z},L.getUploadCapacity=function(){return Y.value},L.isLooser=function(){var e=me()>u.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD,t=I.value<u.LOOSER_UPLOAD_THRESHOLD;return e&&t},L.isBannedSeeder=function(){return Date.now()-re<u.BLOCK_SEEDER_SCHEDULING_DURATION},L.getChunksQuantityForInterval=function(e){var t=Y.value*(e/1e3),n=Math.ceil(t*(1+u.PEER_UPLOAD_CAPACITY_EXTRA_RATIO)/(8*u.CHUNK_SIZE/1024)),r=Math.floor(n*u.PEER_UPLOAD_CAPACITY_SAFE_RATIO/(1+u.PEER_UPLOAD_CAPACITY_EXTRA_RATIO));return{safe:r,unsafe:n-r}},L.locked=function(){return(!!u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON||_e())&&(pe()||I.value/r.abrStats.estimatedBitrate>u.PEER_LOCKED_UPLOAD_THRESHOLD||N.value/r.abrStats.estimatedBitrate>u.PEER_LOCKED_DOWNLOAD_THRESHOLD)},L.getDebugInfos=function(){return{id:A.slice(-7),RawDownloadSpeed:new p.BitDataAmount(1e3*V,"ps"),RawUploadSpeed:new p.BitDataAmount(1e3*K,"ps"),DataDownloaded:new p.ByteDataAmount(G),DataUploaded:new p.ByteDataAmount(k.dataUploaded),RTT:n.getRtt()>=0?n.getRtt():"unavailable",UploadCapacity:new p.BitDataAmount(1e3*Y.value,"ps"),ConenctedDuration:Math.round((Date.now()-B)/1e3),OngoingRequests:te.size,GracingRequests:ne.size,RequestedChunks:q,GracedChunks:z,TimeoutChunks:X,LateChunks:Q,GracedRatio:(q?z/q:0).toFixed(2),TimeoutRatio:(q?X/q:0).toFixed(2),LateRatio:(q?Q/q:0).toFixed(2),SmoothedUsefulDownloadSpeed:new p.ByteDataAmount(1e3*this.getUsefulDlSpeedEMA()/8,"ps"),SmoothedUploadSpeed:new p.ByteDataAmount(1e3*this.getUpSpeedEMA()/8,"ps"),WindowedTimeoutRatio:me().toFixed(2),PeerStatus:(this.locked()?"locked":"unlocked")+"-"+(this.isLooser()?"looser":"normal"),LastCRank:this.lastCRank?this.lastCRank.toFixed(2):"unavailable",SeederTimeoutRatio:me(u.BLOCK_SEEDER_SCHEDULING_WINDOW).toFixed(2),SeederBanned:this.isBannedSeeder(),VideoTrack:W,SameTrack:_e()}},function(){Y=new y.default(r,L,i),$=(0,c.createInterval)(ae,u.PEER_SPEED_MONITOR_INTERVAL),k.onTransfering=ve,n.once(T.default.PeerConnection.DISCONNECTED,function(){w.disconnected++,b.emit(T.default.Peer.PEER_DISCONNECTED,L,ie),fe()}),n.on(T.default.PeerConnection.BINARY_DATA_RECEIVED,he),n.on(T.default.PeerConnection.MESSAGE_RECEIVED,de),b.once("segmentInfo",ge,L),F.push(0),U.push(0)}()};t.default=N,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(590),_=r(v),p=n(256),m=r(p),g=n(4),E=r(g),y=function(e){function t(e,n){(0,s.default)(this,t);var r=new _.default(n),i=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this,r));return i._dataUploaded=0,i._onTransfering=function(){},i._lastBufferedAmountMaxTimestamp=null,i._bufferedAmountAccumulator=0,i._peerConnection=e,i._sharedState=n,i._peerConnection.onbufferedamountlow=i._onBufferedAmountLow.bind(i),i._splittedQueue=r,i}return(0,h.default)(t,e),(0,l.default)(t,[{key:"_validateItem",value:function(e){return!e.isExpired}},{key:"_dequeuedCallback",value:function(e){this._sharedState.efficiencyStats.dequeuedReceivedChunkRequestCount++,this._sharedState.eventBus.emit(E.default.UploadQueue.CHUNK_REQUESTED,this,e)}},{key:"onChunkFound",value:function(e,t){var n=t.byteLength;this._lastBufferedAmountMaxTimestamp&&(this._bufferedAmountAccumulator+=n),this._peerConnection.sendBinaryData(t,e)&&(this._dataUploaded+=n,this._sharedState.transferStats.p2pUploaded+=n,this._onTransfering())}},{key:"onChunkMissed",value:function(){this._sharedState.efficiencyStats.missedDequeuedChunkRequestCount++,this._sharedState.conf.ENABLE_UPLOAD_DEQUEUE_ALL||this.tryDequeue()}},{key:"_canDequeue",value:function(){var e=this._peerConnection.getBufferedAmount()<=this._sharedState.conf.UP_MAX_BUFFERED_AMOUNT;return e||(this._lastBufferedAmountMaxTimestamp=Date.now(),this._bufferedAmountAccumulator=this._peerConnection.getBufferedAmount()),e}},{key:"_onBufferedAmountLow",value:function(){if(this._lastBufferedAmountMaxTimestamp){var e=Date.now()-this._lastBufferedAmountMaxTimestamp;e>0&&this._sharedState.peerStats.dataChannelBufferEmptyingStats.addSample({time:e,amount:this._bufferedAmountAccumulator}),this._lastBufferedAmountMaxTimestamp=null}this._sharedState.conf.ENABLE_UPLOAD_DEQUEUE_ALL?this.tryDequeueAll():this.tryDequeue()}},{key:"dispose",value:function(){this._splittedQueue.dispose()}},{key:"dataUploaded",get:function(){return this._dataUploaded}},{key:"onTransfering",set:function(e){this._onTransfering=e}}]),t}(m.default);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(123),l=r(u),c=function(){function e(t){(0,a.default)(this,e),this._safeQueue=[],this._unsafeQueue=[],this._sharedState=t}return(0,s.default)(e,[{key:"push",value:function(e){this._sharedState.conf.SPLIT_UPLOAD_QUEUE&&e.bandwidthSafety!==l.default.SAFE?this._unsafeQueue.push(e):this._safeQueue.push(e)}},{key:"shift",value:function(){return this._safeQueue.length?this._safeQueue.shift():this._unsafeQueue.shift()}},{key:"dispose",value:function(){this._safeQueue=[],this._unsafeQueue=[]}},{key:"length",get:function(){return this._safeQueue.length+this._unsafeQueue.length}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.BitDataAmount=t.ByteDataAmount=t.DataAmount=t.numToUint8Array4=t.uint16ToUint8Array2=void 0;var i=n(17),a=r(i),o=n(19),s=r(o),u=n(21),l=r(u),c=n(1),f=r(c),d=n(2),h=r(d),v=function(e){var t=Math.floor(e/256),n=e%256;return new Uint8Array([n,t])},_=function(e){var t=v(Math.floor(e/65536)),n=v(e%65536);return new Uint8Array([n[0],n[1],t[0],t[1]])},p=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2;(0,f.default)(this,e),this._rawValue=t,this._unit=n,this._k=r,this._suffix=i,this._decimals=a}return(0,h.default)(e,[{key:"_format",value:function(){if(this._rawValue<1)return"0";var e=["","K","M","G","T","P","E","Z","Y"],t=Math.min(Math.floor(Math.log(this._rawValue)/Math.log(this._k)),e.length-1);return parseFloat((this._rawValue/Math.pow(this._k,t)).toFixed(this._decimals))+e[t]}},{key:"valueOf",value:function(){return this._rawValue}},{key:"toString",value:function(){return this._format()+this._unit+this._suffix}}]),e}(),m=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return(0,f.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,"B",1e3,n,r))}return(0,l.default)(t,e),t}(p),g=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return(0,f.default)(this,t),(0,s.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,"b",1e3,n,r))}return(0,l.default)(t,e),t}(p);t.uint16ToUint8Array2=v,t.numToUint8Array4=_,t.DataAmount=p,t.ByteDataAmount=m,t.BitDataAmount=g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[],n=e.split(","),r=!0,i=!1,a=void 0;try{for(var s,c=(0,u.default)(n);!(r=(s=c.next()).done);r=!0){var f=s.value,d=f.split("-"),h=""!==d[0]?Number(d[0]):NaN,v=""!==d[1]?Number(d[1]):NaN;if(1===d.length&&(0,o.default)(h))t.push(h);else{if(2!==d.length||!(0,o.default)(h)||!(0,o.default)(v))throw new Error("P2P protocol error: could not decode chunk batch");t=t.concat((0,l.range)(h,v))}}}catch(e){i=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw a}}return t}Object.defineProperty(t,"__esModule",{value:!0});var a=n(593),o=r(a),s=n(28),u=r(s),l=n(70);t.default={decode:i},e.exports=t.default},function(e,t,n){e.exports={default:n(594),__esModule:!0}},function(e,t,n){n(595),e.exports=n(8).Number.isInteger},function(e,t,n){var r=n(11);r(r.S,"Number",{isInteger:n(596)})},function(e,t,n){var r=n(23),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(97),l=r(u),c=n(178),f=r(c),d=n(50),h=n(15),v=100,_=function(){function e(t,n,r){var i=this;(0,a.default)(this,e);var o=t.conf,s=this._getTrimmedWindowTimeout(t),u=new d.Delta(n.getDataDownloaded()),c=new d.Delta(Date.now()),v=new f.default(s),_=new f.default(s);this._capacityEmwa=new l.default(r,o.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP),v.push(n.getChunkTimeoutCount()),_.push(n.getChunkRequestedCount()),this._timer=(0,h.createInterval)(function(){v.push(n.getChunkTimeoutCount()),_.push(n.getChunkRequestedCount());var e=_.delta,t=v.delta,r=u.calcDelta(n.getDataDownloaded()),a=c.calcDelta(Date.now());if(null!==t&&null!==e){var s=8*r/1024*1e3/a,l=e>0?t/e:0;s>=i._capacityEmwa.value?i._capacityEmwa.update(s):l>=o.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO&&(o.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO?i._capacityEmwa.update(s,Math.min(l,o.PUC_EMWA_WEIGHT_CAP)):i._capacityEmwa.update(s,o.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN))}},o.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL)}return(0,s.default)(e,[{key:"_getTrimmedWindowTimeout",value:function(e){var t=e.conf,n=e.moduleState,r=t.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL,i=n.isLive()?t.LIVE.CHUNK_TIMEOUT:t.CHUNK_TIMEOUT;return r*Math.ceil(i/r)+v}},{key:"dispose",value:function(){this._timer.clear()}},{key:"value",get:function(){return this._capacityEmwa.value}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(257),_=r(v),p=n(15),m=n(123),g=r(m),E=n(10),y=r(E),S=function(e){function t(e,n,r,i,o,u){(0,s.default)(this,t);var l=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,u));l._chunkManager=o,l._peer=r,l._sharedState=i;var c=i.moduleState.isLive()?i.conf.LIVE.CHUNK_TIMEOUT:i.conf.CHUNK_TIMEOUT;return l._timeoutTimer=(0,p.createTimeout)(function(){l._chunkTimedOut()},c),l._timedOut=!1,l}return(0,h.default)(t,e),(0,l.default)(t,[{key:"isEqual",value:function(e){return this.id===e.id}},{key:"_chunkTimedOut",value:function(){this._timedOut=!0,this._chunkManager.timeout(this._chunkIndex,this._bandwidthSafety),this._bandwidthSafety===g.default.SAFE?(this._sharedState.efficiencyStats.safeChunkRequestCount++,this._sharedState.efficiencyStats.safeChunkRequestTimeoutCount++):this._bandwidthSafety===g.default.UNSAFE&&(this._sharedState.efficiencyStats.unsafeChunkRequestCount++,this._sharedState.efficiencyStats.unsafeChunkRequestTimeoutCount++),this._peer.timeoutChunk(this)}},{key:"dataDownloaded",value:function(e){this._chunkManager.chunkDownloaded(e,this._chunkIndex),this._timedOut||(this._bandwidthSafety===g.default.SAFE?this._sharedState.efficiencyStats.safeChunkRequestCount++:this._bandwidthSafety===g.default.UNSAFE&&this._sharedState.efficiencyStats.unsafeChunkRequestCount++,this._timeoutTimer?this._timeoutTimer.clear():y.default.notifyError(new Error("clear() call on undefined DownloadChunkRequest.timeoutTimer.")))}},{key:"id",get:function(){return t.getIdOf(this._segmentCoord,this._chunkIndex)}},{key:"timestamp",get:function(){return this._timestamp}}],[{key:"getIdOf",value:function(e,t){return e.viewToString()+"C"+t}}]),t}(_.default);t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(257),_=r(v),p=function(e){function t(e,n,r,i){(0,s.default)(this,t);var o=(0,f.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,i));return o._sharedState=r,o}return(0,h.default)(t,e),(0,l.default)(t,[{key:"isExpired",get:function(){var e=this._sharedState.moduleState.isLive()?this._sharedState.conf.LIVE.CHUNK_UP_TIMEOUT:this._sharedState.conf.CHUNK_UP_TIMEOUT;return Date.now()-this._timestamp>e}}]),t}(_.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e,t,n,r){return 0?new i(e,t,n,r):new i(e,t,r)}Object.defineProperty(t,"__esModule",{value:!0});var i=void 0;i=0?require("./BrowserPeerConnector"):n(248),t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){var i=t?y.default.Methods.POST:y.default.Methods.GET,a=new y.default(i,e,{headers:{Authorization:r}}),s=t?(0,o.default)(t):null;a.isStreamroot=!0,a.send(s).then(function(e){n(null,e)},function(e){n(e,null)})}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_TRACK_HASH=void 0;var a=n(84),o=r(a),s=n(69),u=r(s),l=n(1),c=r(l),f=n(2),d=r(f),h=n(49),v=r(h),_=n(95),p=r(_),m=n(15),g=n(179),E=n(93),y=r(E),S=n(4),T=r(S),b=n(10),R=r(b),A={TRACKS:"tracks",RECONNECT:"reconnect"},D={INIT:"init",PEERS:"peers",TRACKS:"tracks"},w=t.DEFAULT_TRACK_HASH="defautTrackHash",O=function(){function e(t,n,r){var i=this;(0,c.default)(this,e),this._conf=r.conf,this._status=r.status,this._moduleState=r.moduleState,this._controlStats=r.controlStats;var a=new v.default;this._trackerProtocolVersion=this._conf.CLIENT_TRACKER_PROTOCOL_VERSION,this._playerInterface=t,this._p2pCacheStats=n,this._connected=!1,this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._timerStore=new p.default,this._callQueue=[],this._pending=!1,this.getEE=function(){return a},r.eventBus.once(T.default.Distributor.READY,this._init.bind(this)),r.eventBus.on(T.default.Tracker.TRACKER_RECONNECTION_REQUEST,function(){i._init()}),r.eventBus.on(T.default.Tracker.TEMP_TRACKER_DISCONNECTION_REQUEST,function(){i.dispose()}),r.eventBus.on(T.default.Tracker.PERM_TRACKER_DISCONNECTION_REQUEST,function(){i.dispose(!0)})}return(0,d.default)(e,[{key:"_getVideoTrackHash",value:function(){var e=this._moduleState.currentTracks.video;return e?e.viewToString():w}},{key:"askPeers",value:function(e,t){var n=function(e,n){t(e,[n])},r={tracks:[this._getVideoTrackHash()],exclusions:e,peer_number:this._conf.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE,current_position:this._moduleState.videoCurrentTime,id:(0,g.unwrap)(this._peerID)};this._injectBufferIntoPayload(r),this._sendRequest(D.PEERS,r,n,!0)}},{key:"dispose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._disconnect(e),this._timerStore.clearAll()}},{key:"_init",value:function(){if(!0!==this._conf.QOS_P2P_DISABLED&&""!==this._conf.TRACKER_URL&&!this._isPermanentlyDisconnected&&this._conf.CONTENT_ACTIVATED){this._trackerURL=this._conf.TRACKER_URL,this._bearerToken=this._status.getBearerToken();var e=(0,g.unwrap)(this._moduleState.content),t=this._conf.P2P_PROTOCOL_VERSION,n=this._conf.ID_CLIENT,r=this._moduleState.isLive(),i=this._status.getTrackerId(),a=void 0;if(r){a={content:e,p2p_protocol:t,customer_id:n,is_live:r,buffer_level_max:this._playerInterface.getBufferLevelMax(),tracker_id:i}}else a={content:e,p2p_protocol:t,customer_id:n,is_live:r,tracker_id:i};this._sendRequest(D.INIT,a,this._onTrackerReady.bind(this),!0)}}},{key:"_onTrackerReady",value:function(e,t){if(e)return void R.default.notifyError(e);this._peerID=t.peer_id,this._status.setMyPeerId(this._peerID);var n=(0,m.createInterval)(this._publishTracks.bind(this),this._conf.SEND_TRACKS_INTERVAL);this._timerStore.registerAs(A.TRACKS,n),this._status.setConnected(!0),this._status.setTrackerId(t.tracker_id),this._connected=!0,this.getEE().emit("tracker_ready")}},{key:"_publishTracks",value:function(){var e={tracks:[this._getVideoTrackHash()],id:(0,g.unwrap)(this._peerID),current_position:this._moduleState.videoCurrentTime};this._injectBufferIntoPayload(e),this._sendRequest(D.TRACKS,e,function(){},!0)}},{key:"_injectBufferIntoPayload",value:function(e){var t=this._p2pCacheStats.getStats();t&&(this._moduleState.isLive()&&(t.near_edge=this._moduleState.isNearEdge),(0,u.default)(e,{buffer:t}))}},{key:"_sendRequest",value:function(e,t,n,r){var a=this;switch(e){case D.INIT:this._controlStats.sentTrackerInitCount++;break;case D.PEERS:this._controlStats.sentTrackerPeersCount++;break;case D.TRACKS:this._controlStats.sentTrackerTracksCount++;break;default:R.default.notifyError(new Error("Unexpected tracker route: "+e))}var o=function(e,t){if(e&&r)return a._disconnect(),a._scheduleReconnect(),void n(e,t);var o=a._callQueue.shift();void 0===o?a._pending=!1:i(o.url,o.data,o.callback,a._bearerToken),n(e,t)},s=this._trackerURL+e;this._pending?this._callQueue.push({url:s,data:t,callback:o}):(this._pending=!0,i(s,t,o,this._bearerToken))}},{key:"_disconnect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isPermanentlyDisconnected=e,this._timerStore.clearNamedTimer(A.TRACKS),this._timerStore.clearNamedTimer(A.RECONNECT),this._pending=!1,this._callQueue=[],!0===this._connected&&(this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._status.setConnected(!1),this._connected=!1,i(this._trackerURL+"bye",{id:(0,g.unwrap)(this._peerID)},function(){},this._bearerToken),this.getEE().emit("tracker_disconnected"))}},{key:"_scheduleReconnect",value:function(){var e=(0,m.createTimeout)(this._init.bind(this),this._delayReconnection);this._timerStore.registerAs(A.RECONNECT,e),this._delayReconnection=Math.min(2*this._delayReconnection,this._conf.TRACKER_DELAY_MAX)}}]),e}();t.default=O},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(94),a=r(i),o=n(28),s=r(o),u=n(17),l=r(u),c=n(1),f=r(c),d=n(2),h=r(d),v=n(19),_=r(v),p=n(21),m=r(p),g=n(256),E=r(g),y=n(4),S=r(y),T=n(10),b=r(T),R=n(15),A=function(e){function t(e,n){(0,f.default)(this,t);var r=[],i=(0,_.default)(this,(t.__proto__||(0,l.default)(t)).call(this,r));return i._peerIds=r,i._peerConnector=e,i._sharedState=n,i._sharedState.eventBus.on(S.default.Metrics.TRACK_SWITCH,i._onTrackSwitch,i),i}return(0,m.default)(t,e),(0,h.default)(t,[{key:"dispose",value:function(){this._tryDequeueTimer&&this._tryDequeueTimer.clear(),this._sharedState.eventBus.removeListener(S.default.Metrics.TRACK_SWITCH,this._onTrackSwitch,this)}},{key:"flush",value:function(){this._sharedState.peerStats.excessMatch+=this._peerIds.length,this._peerIds.length=0}},{key:"onPeersFromTracker",value:function(e,t){if(null!==e)return void b.default.notify("Error asking peers from tracker:",e.message);var n=[],r=!0,i=!1,o=void 0;try{for(var u,l=(0,s.default)(t);!(r=(u=l.next()).done);r=!0){var c=u.value,f=c.peers;n.push.apply(n,(0,a.default)(f))}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}if(!(n.length<1)){this.flush(),this._sharedState.peerStats.match+=n.length;var d=!0,h=!1,v=void 0;try{for(var _,p=(0,s.default)(n);!(d=(_=p.next()).done);d=!0){var m=_.value;this.push(m)}}catch(e){h=!0,v=e}finally{try{!d&&p.return&&p.return()}finally{if(h)throw v}}void 0===this._tryDequeueTimer&&this._createTryDequeueTimer()}}},{key:"_onTrackSwitch",value:function(e){e.isVideo&&this.flush()}},{key:"_createTryDequeueTimer",value:function(){this._tryDequeueTimer=(0,R.createInterval)(this._onTryDequeueTimer.bind(this),this._sharedState.conf.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL)}},{key:"_onTryDequeueTimer",value:function(){var e=Math.min(this._peerIds.length,this._peerConnector.getOpenConnectorSlotsCount());e>0&&this.tryDequeueN(e)}},{key:"_canDequeue",value:function(){return this._peerIds.length>0&&this._peerConnector.getOpenConnectorSlotsCount()>this._sharedState.conf.RESERVED_OFFER_SLOTS}},{key:"_dequeuedCallback",value:function(e){this._peerConnector.createPeerConnection(e)}}]),t}(E.default);t.default=A,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(121),a=r(i),o=n(94),s=r(o),u=n(180),l=r(u),c=n(28),f=r(c),d=n(37),h=r(d),v=n(1),_=r(v),p=n(2),m=r(p),g=function(){function e(t,n,r){(0,_.default)(this,e),this._peerPool=t,this._peerConnector=n,this._secondOrderExclusions=new h.default,this._sharedState=r}return(0,m.default)(e,[{key:"addSecondOrderExclusion",value:function(e,t,n,r){this._secondOrderExclusions.set(e,{rank:t,releaseTimestamp:Date.now()+n,tag:r})}},{key:"_clearExpiredExclusions",value:function(){var e=Date.now(),t=!0,n=!1,r=void 0;try{for(var i,a=(0,f.default)(this._secondOrderExclusions.entries());!(t=(i=a.next()).done);t=!0){var o=(0,l.default)(i.value,2),s=o[0];o[1].releaseTimestamp<=e&&this._secondOrderExclusions.delete(s)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"exclusionList",get:function(){this._clearExpiredExclusions();var e=this._peerConnector.getPendingConnectionPeers(),t=!0,n=!1,r=void 0;try{for(var i,o=(0,f.default)(this._peerPool.getPeerArray());!(t=(i=o.next()).done);t=!0){var u=i.value;e.push(u.getId())}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var c=this._sharedState.conf.MAX_TRACKER_EXCLUSION_LENGTH-e.length;if(c>=this._secondOrderExclusions.size)return[].concat((0,s.default)(e),(0,s.default)(this._secondOrderExclusions.keys()));var d=Date.now(),h=(0,a.default)(this._secondOrderExclusions.entries());h.sort(function(e,t){var n=(0,l.default)(e,2),r=(n[0],n[1]),i=(0,l.default)(t,2),a=(i[0],i[1]);return(a.releaseTimestamp-d)*a.rank-(r.releaseTimestamp-d)*r.rank});var v=h.map(function(e){var t=(0,l.default)(e,2),n=t[0];t[1];return n});return[].concat((0,s.default)(e),(0,s.default)(v.slice(0,c)))}},{key:"secondOrderExclusions",get:function(){return this._clearExpiredExclusions(),this._secondOrderExclusions}}]),e}();t.default=g,e.exports=t.default},function(e,t,n){e.exports={default:n(605),__esModule:!0}},function(e,t,n){n(80),n(67),e.exports=n(606)},function(e,t,n){var r=n(119),i=n(20)("iterator"),a=n(78);e.exports=n(8).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||a.hasOwnProperty(r(t))}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(95),l=r(u),c=n(10),f=r(c),d=n(15),h=n(50),v=n(70),_=n(608),p=r(_),m=n(97),g=r(m),E=function(){function e(t){var n=this;(0,a.default)(this,e);var r=t.conf,i=t.transferStats,o=t.abrStats;this._conf=r,this._transferStats=i,this._abrStats=o,this._p2pMediaDownloadedDelta=new h.Delta,this._p2pTimeElapsedDelta=new h.Delta(Date.now());var s=r.P2P_SPEED_ESTIMATION_BUCKET_COUNT*r.P2P_SPEED_ESTIMATION_BUCKET_DURATION;this._p2pMediaDownloadedSMWA=new p.default(s),this._p2pMediaDownloadedEMWA=new g.default(0,r.P2P_SPEED_EMA_WEIGHT),this._p2pMediaDownloadedLongSMA=new p.default(r.P2P_USEFUL_SMA_WINDOW),this._p2pMediaDownloadedLongDelta=new h.Delta,this._p2pUsefulLongSMA=new p.default(r.P2P_USEFUL_SMA_WINDOW),this._p2pUsefulLongDelta=new h.Delta,this._timerStore=new l.default,this._ewmaZeroWeight=1-Math.exp(Math.log(.5)*r.MEAN_SPEED_CALCULATION_INTERVAL/r.P2P_SPEED_EMA_ZERO_HALF_LIFE);var u=(0,d.createInterval)(function(){n._computeMeanInstantSpeed()},this._conf.MEAN_SPEED_CALCULATION_INTERVAL),c=(0,d.createInterval)(function(){n._computeDeltaP2PSpeed()},r.P2P_SPEED_ESTIMATION_BUCKET_DURATION),f=(0,d.createInterval)(function(){n._updateUsefulP2PRatio()},this._conf.P2P_USEFUL_CALCULATION_INTERVAL);this._timerStore.register(u),this._timerStore.register(c),this._timerStore.register(f)}return(0,s.default)(e,[{key:"getP2PSpeedEstimate",value:function(){var e=this._p2pMediaDownloadedEMWA.value;return e*(1-this._conf.P2P_USEFUL_RATIO_WEIGHT)+e*this._abrStats.p2pUsefulEstimate*this._conf.P2P_USEFUL_RATIO_WEIGHT}},{key:"_updateUsefulP2PRatio",value:function(){var e=this._p2pUsefulLongDelta.calcDelta(this._transferStats.p2pUseful),t=this._p2pMediaDownloadedLongDelta.calcDelta(this._transferStats.p2pMediaDownloaded);t>0&&(this._p2pMediaDownloadedLongSMA.addPoint(t),this._p2pUsefulLongSMA.addPoint(e));var n=this._p2pMediaDownloadedLongSMA.computeSum(),r=this._p2pUsefulLongSMA.computeSum(),i=8*n/this._conf.P2P_USEFUL_SMA_WINDOW<this._conf.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION?1:Math.min(1,r/n);this._abrStats.p2pUsefulEstimate=(0,v.toDecimal)(i,3)}},{key:"_computeMeanInstantSpeed",value:function(){var e=this._p2pMediaDownloadedSMWA.compute();this._abrStats.p2pSpeedWindowsCount++,0===e&&this._abrStats.zeroP2pSpeedWindowsCount++,e<0?f.default.notifyError(new Error("Negative p2pMediaDownloaded delta.")):this._p2pMediaDownloadedEMWA.value<this._conf.P2P_SPEED_ZERO_THRESHOLD?this._p2pMediaDownloadedEMWA.update(e,1):e>0?this._p2pMediaDownloadedEMWA.update(e):0===e&&this._p2pMediaDownloadedEMWA.update(e,this._ewmaZeroWeight),this._abrStats.p2pSpeed=this.getP2PSpeedEstimate()}},{key:"_computeDeltaP2PSpeed",value:function(){var e=this._p2pMediaDownloadedDelta.calcDelta(this._transferStats.p2pMediaDownloaded),t=this._p2pTimeElapsedDelta.calcDelta(Date.now());e>0&&t>0?this._p2pMediaDownloadedSMWA.addPoint(8*e/t):e<0&&f.default.notifyError(new Error("Negative p2pMediaDownloaded delta."))}},{key:"dispose",value:function(){this._timerStore.clearAll()}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(609),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e){var t=[],n=e,r=function(){for(var e=-1,r=Date.now(),i=0;i<t.length&&r-t[i].timestamp()>n;i++)e=i;return e},a=function(){var e=r();e>-1&&t.splice(0,e+1)},o=function(e){a();var n=new i.default(e);t.push(n)},s=function(){if(a(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e/t.length},u=function(){if(a(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e};this.addPoint=o,this.compute=s,this.computeSum=u};t.default=a,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){var t=e,n=Date.now();this.timestamp=function(){return n},this.value=function(){return t}};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(260),a=r(i),o=n(180),s=r(o),u=n(94),l=r(u),c=n(28),f=r(c),d=n(37),h=r(d),v=n(1),_=r(v),p=n(2),m=r(p),g=n(613),E=r(g),y=n(261),S=r(y),T=n(4),b=r(T),R=n(10),A=r(R),D=function(){function e(t,n,r){var i=this;(0,_.default)(this,e),this._peerPool=t,this._segmentInfoMap=n,this._sharedState=r,this._segmentHandlers=new h.default,this._sharedState.eventBus.on(b.default.P2PCache.REMOVE_SEGMENT_FROM_CACHE,function(e){i.removeSegmentHandler(e)})}return(0,m.default)(e,[{key:"getSegmentHandler",value:function(e){var t=this._segmentHandlers.get(e.viewToString());return t||null}},{key:"removePeer",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,f.default)(this._segmentHandlers.values());!(t=(i=a.next()).done);t=!0){i.value.seeders.remove(e)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"getOrCreateSegmentHandler",value:function(e){var t=this.getSegmentHandler(e);return null===t&&(t=new E.default(e,this,this._peerPool,this._segmentInfoMap,this._sharedState),this._segmentHandlers.set(t.segmentCoord.viewToString(),t),this._peerPool.requestHasSegment(e),this._manageP2PCache()),t}},{key:"removeSegmentHandler",value:function(e){var t=e.viewToString(),n=this._segmentHandlers.get(t);n&&(n.dispose(),this._segmentHandlers.delete(t))}},{key:"fillSegment",value:function(e,t){var n=this.getOrCreateSegmentHandler(e),r=n.chunkManager,i=new S.default(t,e,this._sharedState.eventBus);i.setComplete(),r.storeSegment(i),n.seeders.clear(),(this._sharedState.moduleState.isLive()&&this._sharedState.conf.ALLOW_LIVE_PUSH_SEGMENT||!this._sharedState.moduleState.isLive()&&this._sharedState.conf.ALLOW_VOD_PUSH_SEGMENT)&&this._peerPool.broadcastSegmentInfo(e)}},{key:"getPartialSegment",value:function(e){var t=this.getSegmentHandler(e),n=t?t.chunkManager:null;return n?n.getPartialSegment():null}},{key:"listSegmentsToSkipForTrack",value:function(e){return[].concat((0,l.default)(this._segmentHandlers)).filter(function(t){var n=(0,s.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&!r.chunkManager.shouldDownloadSegment()}).map(function(e){var t=(0,s.default)(e,2);t[0];return t[1].segmentCoord})}},{key:"listSegmentsDownloadStatus",value:function(){return[].concat((0,l.default)(this._segmentHandlers)).map(function(e){var t=(0,s.default)(e,2),n=(t[0],t[1]);return{segmentcoord:n.segmentCoord,downloadStatusList:n.chunkManager.downloadStatus,seederCount:n.seeders.length}})}},{key:"listDownloadedSegmentsForTrack",value:function(e){return[].concat((0,l.default)(this._segmentHandlers)).filter(function(t){var n=(0,s.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&r.chunkManager.isSegmentDownloaded()}).map(function(e){var t=(0,s.default)(e,2);t[0];return t[1].segmentCoord})}},{key:"getSegmentsStats",value:function(){if(!this._segmentHandlers.size)return{};var e=void 0,t=0,n=a.default,r=!0,i=!1,o=void 0;try{for(var s,u=(0,f.default)(this._segmentHandlers.values());!(r=(s=u.next()).done);r=!0){e=s.value.segmentCoord.getId(),n=Math.min(n,e),t=Math.max(t,e)}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return{minSegmentId:n,maxSegmentId:t}}},{key:"dispose",value:function(){this._segmentHandlers=new h.default}},{key:"_manageP2PCache",value:function(){var e=0,t=this._sharedState.moduleState.isLive()?this._sharedState.conf.LIVE.P2P_CACHE_MAX_SIZE:this._sharedState.conf.P2P_CACHE_MAX_SIZE,n=void 0,r=0,i=!0,a=!1,o=void 0;try{for(var s,u=(0,f.default)(this._segmentHandlers.values());!(i=(s=u.next()).done);i=!0){var l=s.value;if(l.chunkManager.size&&(e+=l.chunkManager.size),e>t){n=this._segmentHandlers.size-r;break}r++}}catch(e){a=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}if(n){var c=!0,d=!1,h=void 0;try{for(var v,_=(0,f.default)(this._segmentHandlers.values());!(c=(v=_.next()).done);c=!0){var p=v.value,m=p.segmentCoord;if(0===n)break;var g=this._sharedState.moduleState.videoTrackEdge&&m.viewToString()===this._sharedState.moduleState.videoTrackEdge.viewToString(),E=this._sharedState.moduleState.audioTrackEdge&&m.viewToString()===this._sharedState.moduleState.audioTrackEdge.viewToString();if(this._sharedState.conf.ENABLE_TRACK_EDGE_GC_BLOCK&&(g||E)){A.default.notify("Attempted to remove track edge from P2PCache."),this._sharedState.eventBus.emit(b.default.P2PCache.ATTEMPTED_GC_TRACK_EDGE_FROM_CACHE);break}this.removeSegmentHandler(m),this._segmentInfoMap.removeSegmentInfo(m),n--}}catch(e){d=!0,h=e}finally{try{!c&&_.return&&_.return()}finally{if(d)throw h}}}}}]),e}();t.default=D,e.exports=t.default},function(e,t,n){n(612),e.exports=9007199254740991},function(e,t,n){var r=n(11);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(122),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(614),f=r(c),d=n(619),h=r(d),v=n(175),_=r(v),p=n(124),m=function(){function e(t,n,r,i,o){(0,s.default)(this,e),(0,p.checkInterface)(_.default,t),this.segmentCoord=t,this.chunkManager=new f.default(t,n,r,i,o),this.seeders=new h.default(o.conf),(0,a.default)(this)}return(0,l.default)(e,[{key:"dispose",value:function(){this.chunkManager.dispose(),this.seeders.clear()}},{key:"hasChunksToDownload",get:function(){return this.chunkManager.hasChunksToDownload}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(49),l=r(u),c=n(615),f=r(c),d=n(261),h=r(d),v=n(4),_=r(v),p=n(255),m=r(p),g=1,E=-1,y={PENDING:"pending",DOWNLOADING:"downloading",DOWNLOADED:"downloaded",CDN_DOWNLOADED:"CDNdownloaded",FAILED:"failed"},S=function(){function e(t,n,r,i,o){(0,a.default)(this,e),this._sharedState=o,this._conf=o.conf,this._transferStats=o.transferStats,this._efficiencyStats=o.efficiencyStats,this._controlStats=o.controlStats,this._workerHelper=o.workerHelper,this._p2pCache=n,this._dataLocked=!1,this._downloadStatus=[],this._writeLock=!1,this._isEmpty=!0,this._partialSegmentRequested=!1,this._broadcastedSegmentInfoCalled=!1,this._segmentCoord=t,this._peerPool=r,this._segmentInfoMap=i,this._ee=new l.default,1||(this.downloadStatus=this._downloadStatus)}return(0,s.default)(e,[{key:"getEE",value:function(){return this._ee}},{key:"_initChunkStatus",value:function(e){var t=Math.ceil(e/this._conf.CHUNK_SIZE);m.default.clear(this._downloadStatus);for(var n=0;n<t;n++)this._downloadStatus.push(y.PENDING)}},{key:"setSegmentSize",value:function(e){this.size||(this.size=e,this.segment=new h.default(e,this._segmentCoord,this._sharedState.eventBus),this._initChunkStatus(e))}},{key:"getNumberOfChunks",value:function(){return this._downloadStatus.length}},{key:"getChunk",value:function(e,t){if(!this._dataLocked&&this._isChunkP2POrCDNDownloaded(e)){var n=this._conf.CHUNK_SIZE,r=e*this._conf.CHUNK_SIZE;r+n>this.size&&(n=this.size-r),this.segment.getBinaryData(r,n,t)}else this._dataLocked&&console.warn("locked data, not sending"),t(null)}},{key:"_getConsecutiveChunksCount",value:function(e,t,n){for(var r=1,i=t===g?0:e.length-1,a=t===g?e.length-1:0,o=i;o!==a;o+=t){var s=o+t;if(s>=0&&s<=e.length-1){if(1!==Math.abs(e[o]-e[s])||r===n)break;r++}}return r}},{key:"_getRemainingChunks",value:function(){for(var e=[],t=0,n=this._downloadStatus.length;t<n;t++)this._downloadStatus[t]!==y.FAILED&&this._downloadStatus[t]!==y.PENDING||e.push(t);return e}},{key:"_encodePartialBatchStr",value:function(e,t){var n=e;return e&&(n+=","),n+=""+t[0],t.length>1&&(n+="-"+t[t.length-1]),n}},{key:"getNextChunks",value:function(e,t){for(var n="",r=t,i=this._getRemainingChunks();i.length>0&&r>0;){var a=i[0],o=i[i.length-1],s=void 0,u=void 0;if(this._downloadStatus.length-1-o===a){var l=this._getConsecutiveChunksCount(i,g,r),c=this._getConsecutiveChunksCount(i,E,r);u=Math.max(l,c),s=u===l?g:E}else s=this._downloadStatus.length-1-o>a?g:E,u=this._getConsecutiveChunksCount(i,s,r);var f=s===g?0:i.length-u,d=i.splice(f,u);d=s===g?d:d.reverse(),n=this._encodePartialBatchStr(n,d),r-=d.length;for(var h=0,v=d.length;h<v;h++)this._downloadStatus[d[h]]=y.DOWNLOADING}return{encoded:n,size:t-r}}},{key:"chunkDownloaded",value:function(e,t){if(!this.segment||t>=this._downloadStatus.length)return void(this._transferStats.multipleDlM+=e.byteLength);if(this._isEmpty=!1,this._isChunkP2POrCDNDownloaded(t)||this._writeLock){var n=this._downloadStatus[t];n===y.DOWNLOADED?this._transferStats.multipleDlPP+=e.byteLength:(n===y.CDN_DOWNLOADED||this._writeLock)&&(this._transferStats.multipleDlCP+=e.byteLength)}else if(this._downloadStatus[t]=y.DOWNLOADED,this.segment.setBinaryData(e,t*this._conf.CHUNK_SIZE),(this._sharedState.moduleState.isLive()&&this._conf.ALLOW_LIVE_PUSH_SEGMENT||!this._sharedState.moduleState.isLive()&&this._conf.ALLOW_VOD_PUSH_SEGMENT)&&this._broadcastSegmentInfo(),this.isSegmentDownloaded()){var r=this._p2pCache.getSegmentHandler(this._segmentCoord);r&&r.seeders.clear(),this.lockSegmentData(),this._checkHashP2P(this.segment)}this._sharedState.eventBus.emit(_.default.ChunkManager.CHUNK_DOWNLOADED)}},{key:"timeout",value:function(e){this._downloadStatus[e]===y.DOWNLOADING&&(this._downloadStatus[e]=y.FAILED)}},{key:"isSegmentDownloaded",value:function(){var e=this;return!!this.size&&this._downloadStatus.every(function(t,n){return e._isChunkP2POrCDNDownloaded(n)})}},{key:"shouldDownloadSegment",value:function(){return!this.isSegmentDownloaded()&&!this.partialSegment&&!this._partialSegmentRequested}},{key:"getPartialSegment",value:function(){var e=this;return this._partialSegmentRequested=!0,!(this._isEmpty||!this.size)&&(function(){e.partialSegment||e._dataLocked||(e.partialSegment=new f.default(e._segmentCoord,e._p2pCache,e.segment,e._downloadStatus,e.size,e,e.isSegmentDownloaded(),e._segmentInfoMap,e._sharedState))}(),this._dataLocked||(this._writeLock=!0),this.partialSegment)}},{key:"getPercentageOfChunksDownloaded",value:function(){var e=this;return this._downloadStatus.reduce(function(t,n,r){return t+(e._isChunkP2POrCDNDownloaded(r)?100*(1/e.getNumberOfChunks()):0)},0)}},{key:"storeSegment",value:function(e){this._isEmpty=!1,this.segment=e,this.size||(this._initChunkStatus(e.byteLength),this.size=e.byteLength),this._updateDownloadStatus(),this._transferStats.p2pUseful+=this.getP2PAndCDNDownloads().p2pDownloaded}},{key:"_broadcastSegmentInfo",value:function(){var e=this.getPercentageOfChunksDownloaded();!this._broadcastedSegmentInfoCalled&&e>=this._conf.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER&&(this._broadcastedSegmentInfoCalled=!0,this._peerPool.broadcastSegmentInfo(this._segmentCoord))}},{key:"_updateDownloadStatus",value:function(){var e=void 0;e={start:0,end:this.getNumberOfChunks()},this.partialSegment&&this.partialSegment.getCDNIndexRange()&&(e=this.partialSegment.getCDNIndexRange());for(var t=e.start;t<e.end;t++){if(this._isChunkP2POrCDNDownloaded(t)){var n=this._conf.CHUNK_SIZE;t===this.getNumberOfChunks()-1&&(n=this.size-(this.getNumberOfChunks()-1)*this._conf.CHUNK_SIZE),this._downloadStatus[t]===y.DOWNLOADED?this._transferStats.multipleDlPC+=n:this._downloadStatus[t]===y.CDN_DOWNLOADED&&(this._transferStats.multipleDlCC+=n)}this._downloadStatus[t]=y.CDN_DOWNLOADED}}},{key:"getP2PAndCDNDownloads",value:function(){var e=0,t=0,n=this.getNumberOfChunks()-1;if(this.size)for(var r=0;r<this._downloadStatus.length;r++){var i=void 0,a=this._downloadStatus[r];i=r<n?this._conf.CHUNK_SIZE:this.size-n*this._conf.CHUNK_SIZE,a===y.DOWNLOADED?e+=i:a===y.CDN_DOWNLOADED&&(t+=i)}return{p2pDownloaded:e,cdnDownloaded:t}}},{key:"lockSegmentData",value:function(){this._dataLocked=!0}},{key:"unlockSegmentData",value:function(){this._dataLocked=!1}},{key:"removePartialSegment",value:function(){delete this.partialSegment}},{key:"_checkHashP2P",value:function(e){var t=this,n=this._segmentInfoMap.getSegmentInfo(this._segmentCoord),r=function(e,r){n.hash===r?(t._controlStats.nbRightHashP2P++,t.segment.setBinaryData(e),t.segment.setComplete(),t._transferStats.p2pUseful+=t.size,t.unlockSegmentData()):(t._controlStats.nbWrongHashP2P++,t._p2pCache.removeSegmentHandler(n.segmentCoord),t._transferStats.multipleDlHP+=t.size)};e.getBinaryData(0,e.byteLength,function(e){t._workerHelper.callHashWorker(e,r)})}},{key:"_isChunkP2POrCDNDownloaded",value:function(e){var t=this._downloadStatus[e];return t===y.DOWNLOADED||t===y.CDN_DOWNLOADED}},{key:"dispose",value:function(){this.segment&&this.segment.destroy()}},{key:"hasChunksToDownload",get:function(){return this._downloadStatus.indexOf(y.FAILED)>=0||this._downloadStatus.indexOf(y.PENDING)>=0}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(616),a=r(i),o=n(17),s=r(o),u=n(1),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(10),_=r(v),p=n(174),m=r(p),g=function(e){function t(e,n,r,i,o,u,c,d,h){function v(e,t,r,i){function a(a,o){t.hash===o?(N.nbRightHashDLM++,e.response=a,p(e),r(e,P)):(N.nbWrongHashDLM++,M.multipleDlHD+=H,M.multipleDlHP+=F,n.removeSegmentHandler(P),i(e,P))}w.callHashWorker(e.response,a)}function p(e){B=e.response,n.fillSegment(P,e.response),u.unlockSegmentData(),u.removePartialSegment()}function m(){L?F=o:(F=x.start*R.CHUNK_SIZE,x.end<G.length&&(F+=(G.length-x.end-1)*R.CHUNK_SIZE,F+=o-(G.length-1)*R.CHUNK_SIZE))}function g(){for(var e=0;e<G.length;e++)if("downloaded"!==G[e]&&"CDNdownloaded"!==G[e])return e}function E(){for(var e=G.length-1;e>=0;e--)if("downloaded"!==G[e]&&"CDNdownloaded"!==G[e])return e+1}function y(){x=R.RANGE_REQUEST_ALLOWED?{start:g(),end:E()}:{start:0,end:G.length}}function S(e){if(!R.RANGE_REQUEST_ALLOWED)return e;var t=void 0;if(void 0===x.start||void 0===x.end)throw new Error("PartialSegmentP2P: getUpdatedRange called with complete segment");var n=e?e.start+x.start*R.CHUNK_SIZE:x.start*R.CHUNK_SIZE;return x.end===G.length&&e?t=e.end:x.end<G.length&&(t=e?e.start+x.end*R.CHUNK_SIZE-1:x.end*R.CHUNK_SIZE-1),{start:n,end:t}}function T(e){if(void 0===x)throw new Error("assertion: _cdnIndexRange is not defined");if(void 0===B)throw new Error("assertion: _segmentData is not defined");try{B.setBinaryData(e,x.start*R.CHUNK_SIZE)}catch(e){throw _.default.notifyError(e),new Error("Invalid configuration: The current stream has no range request enabled and the p2p configuration has range request set to true.")}return B}function b(e){h.transferStats.cdnDownloaded+=e.byteLength}(0,l.default)(this,t);var R=h.conf,A=h.status,D=h.eventBus,w=h.workerHelper,O=h.controlStats,k=h.transferStats,C=(0,f.default)(this,(t.__proto__||(0,s.default)(t)).call(this)),L=c,P=e,I=d,M=k,N=O,x=void 0,F=void 0,U=void 0,B=void 0,G=void 0,H=0;return C.getFullSegment=function(e,t,n){if(this.isComplete())B.getBinaryData(0,B.byteLength,function(n){e.response=n,u.removePartialSegment(),t(e,null)});else{D.emit("CDNSegmentDownloaded",P);var r=e.response;b(r),H=r.byteLength,T(r).getBinaryData(0,B.byteLength,function(r){if(e.response=r,0!==F){u.lockSegmentData();var i=I.getSegmentInfo(P);v(e,i,t,n)}else p(e),t(e,P)})}},C.getUpdatedRange=S,C.getCDNIndexRange=function(){return x},C.isComplete=function(){return L},C.isLocked=function(){return u.dataLocked},function(){if(B=r,!i.length)throw new Error("PartialSegmentP2P should not be instantiated with an empty segment");G=i.slice(),y(),m(),U=A.getMeanInstantSpeed()}(),(0,a.default)(C,{p2pSpeed:{get:function(){return U},set:void 0},p2pAmount:{get:function(){return F},set:void 0}}),C}return(0,h.default)(t,e),t}(m.default);t.default=g,e.exports=t.default},function(e,t,n){e.exports={default:n(617),__esModule:!0}},function(e,t,n){n(618);var r=n(8).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,n){var r=n(11);r(r.S+r.F*!n(36),"Object",{defineProperties:n(223)})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t){var n=this;(0,a.default)(this,e),this._conf=t,this._peers=[],this._peerUpoadCapacityComparator=function(e,t){var r=e.getChunksQuantityForInterval(n._conf.CHUNK_BATCHING_INTERVAL).safe;return t.getChunksQuantityForInterval(n._conf.CHUNK_BATCHING_INTERVAL).safe-r}}return(0,s.default)(e,[{key:"add",value:function(e){this.remove(e),this._peers.push(e)}},{key:"remove",value:function(e){var t=e.getId();this._peers=this._peers.filter(function(e){return e.getId()!==t})}},{key:"all",value:function(){return this._peers.sort(this._peerUpoadCapacityComparator)}},{key:"allNotBanned",value:function(){return this._peers.filter(function(e){return!e.isBannedSeeder()}).sort(this._peerUpoadCapacityComparator)}},{key:"clear",value:function(){this._peers.length=0}},{key:"length",get:function(){return this._peers.length}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){function r(e,t){if(!1||n.isP2PUploadOn&&!n.isP2PUploadBlocked){var r=a.getSegmentHandler(t),o=r?r.chunkManager:null;if(o){if(o.getPercentageOfChunksDownloaded()>=n.conf.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER){var s=i.getSegmentInfo(t);e.answerHasSegment(s,{pushed:!1})}}}}var i=e,a=t;n.eventBus.on("segmentRequested",r)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e,t){function n(e,t){var n=r.getSegmentHandler(t.segmentCoord),i=n?n.chunkManager:null;i&&i.getChunk(t.chunkIndex,function(n){n?e.onChunkFound(t,n):e.onChunkMissed()})}var r=e;t.eventBus.on(i.default.UploadQueue.CHUNK_REQUESTED,n)};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){return r.moduleState.streamType===l.StreamTypes.HLS?new o.default(e,t,n,r):new u.default(e,t,n,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.createScheduler=i;var a=n(623),o=r(a),s=n(628),u=r(s),l=n(125)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(262),_=r(v),p=function(e){function t(){return(0,s.default)(this,t),(0,f.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.video;return t&&(e=this._getSegmentsToDownloadByTrack(t,"video")),this._cachedSegmentToDownload=e.sort(function(e,t){return e.getId()-t.getId()}).slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER),this._cachedSegmentToDownload}},{key:"updateTrackEdge",value:function(e){this._currentTracks.video&&e.isInTrack(this._currentTracks.video)&&this._edges.update({video:e,audio:null})}}]),t}(_.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(263),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(10),f=r(c),d=function(){function e(t,n){(0,s.default)(this,e),this.audio=void 0,this.video=void 0,this._mediaMapCache=t,this._moduleState=n.moduleState,(0,a.default)(this)}return(0,l.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(void 0===t&&void 0===n)throw new Error("There must be at least one updated track edge");if(t&&(this.audio=t,this._moduleState.audioTrackEdge=t),n){this.video=n;var r=this._mediaMapCache.getSegmentTime(n);this._moduleState.videoTrackEdge=n,null!==r?this._moduleState.videoCurrentTime=r:f.default.notifyError(new Error("Unexpected getSegmentTime error: track edge timestamp is not supposed to be unreliable"))}}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){n(626),e.exports=n(8).Object.seal},function(e,t,n){var r=n(23),i=n(89).onFreeze;n(77)("seal",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(37),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(179),f=n(125),d=n(10),h=r(d),v=function(){function e(t,n){(0,s.default)(this,e),this._mediaMap=t,this._sharedState=n,this._cachedSegmentList=new a.default,this._cachedSegmentTime=new a.default}return(0,l.default)(e,[{key:"getSegmentListAfterEdge",value:function(e,t,n){var r=t.viewToString(),i=this._cachedSegmentList.get(e.viewToString());if(i&&i.edgeString===r&&i.duration===n)return i.cachedSegmentList;var a=this.getSegmentTime(t),o=void 0;return null===a?(h.default.notifyError(new Error("Unexpected getSegmentTime error: track edge timestamp is not supposed to be unreliable")),o=[]):o=this._mediaMap.getSegmentList(e,a,n),(this._sharedState.conf.ENABLE_PREBUFFER_FEEDBACK||this._sharedState.conf.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME)&&(o=this._filterGreaterThanTrackEdge(o,t)),this._cachedSegmentList.set(e.viewToString(),{edgeString:r,cachedSegmentList:o,duration:n}),o}},{key:"_filterGreaterThanTrackEdge",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].getId()>t.getId())return e.slice(n);return[]}},{key:"getSegmentTime",value:function(e){if(e.fromPeer&&this._sharedState.moduleState.streamType===f.StreamTypes.HLS&&this._sharedState.conf.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME)return null;var t=this._cachedSegmentTime.get(e.viewToString());if(void 0!==t)return t;var n=this._mediaMap.getSegmentTime(e);if(this._cachedSegmentTime.set(e.viewToString(),n),this._cachedSegmentTime.size>this._sharedState.conf.GETSEGMENTTIME_CACHE_MAX_SIZE){var r=this._cachedSegmentTime.keys(),i=r.next().value,a=(0,c.unwrap)(i);this._cachedSegmentTime.delete(a)}return n}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(19),f=r(c),d=n(21),h=r(d),v=n(262),_=r(v),p=function(e){function t(){return(0,s.default)(this,t),(0,f.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.audio;t&&(e=this._getSegmentsToDownloadByTrack(t,"audio"),this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM&&(e=e.slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER)));var n=[],r=this._currentTracks.video;return r&&(n=this._getSegmentsToDownloadByTrack(r,"video"),this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM&&(n=n.slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER))),this._cachedSegmentToDownload=e.concat(n).sort(function(e,t){return e.getId()-t.getId()}).slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER),this._cachedSegmentToDownload}},{key:"updateTrackEdge",value:function(e){var t=this._findTrack(e);"audio"===t?this._edges.update({audio:e,video:null}):"video"===t&&this._edges.update({audio:null,video:e})}},{key:"_findTrack",value:function(e){var t=this._currentTracks.video;if(t&&e.isInTrack(t))return"video";var n=this._currentTracks.audio;return n&&e.isInTrack(n)?"audio":void 0}}]),t}(_.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(37),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=function(){function e(){(0,s.default)(this,e),this._map=new a.default}return(0,l.default)(e,[{key:"addSegmentInfo",value:function(e){var t=e.segmentCoord.viewToString();this._map.set(t,e)}},{key:"getSegmentInfo",value:function(e){var t=e.viewToString(),n=this._map.get(t);if(!n)throw new Error("segmentInfo not found in the map for the given SegmentCoord");return n}},{key:"removeSegmentInfo",value:function(e){var t=e.viewToString();this._map.delete(t)}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(180),a=r(i),o=n(28),s=r(o),u=n(37),l=r(u),c=n(1),f=r(c),d=n(2),h=r(d),v=n(179),_=n(10),p=r(_),m=function(){function e(t,n){(0,f.default)(this,e),this._segmentListMap=new l.default,this._conf=n.conf;for(var r=t.getTrackList(),i=0;i<r.length;i++)this._segmentListMap.set(r[i],[])}return(0,h.default)(e,[{key:"insert",value:function(e){var t=this._getMatchingTrack(e);if(t){var n=(0,v.unwrap)(this._segmentListMap.get(t));if(0===n.length)n.push(e);else if(n[0].getId()>e.getId())n.unshift(e);else for(var r=n.length;r>0;r--)if(e.getId()>n[r-1].getId()){n.splice(r,0,e);break}var i=n.length;if(i>this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH){var a=n.slice(i-this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH);this._segmentListMap.set(t,a)}}}},{key:"getSegmentListAfter",value:function(e){var t=this._getMatchingTrack(e);if(t){var n=(0,v.unwrap)(this._segmentListMap.get(t)),r=n.filter(function(t){return t.getId()>e.getId()});return this._segmentListMap.set(t,r),this._conf.ENABLE_PUSH_SEGMENT_OPTIM?r.slice(0,this._conf.NB_SEGMENT_P2P_PREBUFFER):r}return[]}},{key:"_getMatchingTrack",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,s.default)(this._segmentListMap);!(t=(i=o.next()).done);t=!0){var u=(0,a.default)(i.value,1),l=u[0];if(e.isInTrack(l))return l}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}p.default.notifyError(new Error("Pushed segment belongs to no track"))}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(69),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(10),f=r(c),d=n(93),h=r(d),v=n(4),_=r(v),p=n(15),m=n(632),g=r(m),E=function(){},y=function(){function e(t,n,r,i,a){var o=r.onProgress,u=void 0===o?E:o,l=r.onError,c=void 0===l?E:l,d=r.onSuccess,h=void 0===d?E:d,v=this;(0,s.default)(this,e),this._firstByteCdnTimestamp=null,this._request=n,this._initialHandlers={onProgress:u,onError:c,onSuccess:h},this._handlers={},this._srModule=t,this._transferStats=a.transferStats,this._controlStats=a.controlStats,this._mediaStats=a.mediaStats,this._abrStats=a.abrStats,this._conf=a.conf,this._eventBus=a.eventBus,this._stats={cdnDownloaded:0,cdnDuration:0,p2pDownloaded:0,p2pDuration:0},this._segmentCoord=i,this._handlers.onSuccess=function(e,t,n){if((0,g.default)(t,v._abrStats,v._conf),v._conf.ENABLE_LATENCY_FEEDBACK){var r=v._stats.latency||v._abrStats.latencyHistoricalValue;t.latency=Math.min(r,Math.ceil((t.cdnDuration+t.p2pDuration)*v._conf.LATENCY_CAPPING_RATIO))}if(!1){var i=window.Streamroot.Reaper;i.sync(i.scopes.PeerAgent,t,i.actions.ABRFeedback)}v._transferStats.p2pConsumed+=t.p2pDownloaded,v._transferStats.cdnConsumed+=t.cdnDownloaded;var a=e.slice(0);try{v._initialHandlers.onSuccess(a,t,n)}catch(e){console.error(e),f.default.notifyError(e)}v._eventBus.emit(_.default.SRModuleInterface.ABR_FEEDBACK,t),v._eventBus.emit(_.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE)},this._handlers.onError=function(e,t){try{v._initialHandlers.onError(e,t)}catch(e){console.error(e),f.default.notifyError(e)}},this._handlers.onProgress=function(e,t){try{v._initialHandlers.onProgress(e,t)}catch(e){console.error(e),f.default.notifyError(e)}}}return(0,l.default)(e,[{key:"getSegment",value:function(){try{null===this._segmentCoord?this._getFullSegmentFromCDN():(this._partialSegment=this._srModule.getP2PData(this._segmentCoord),this._setP2PStats(),this._partialSegment.isComplete()?(this._conf.ENABLE_LATENCY_FEEDBACK&&(this._stats.latency=Math.min(this._abrStats.latencyHistoricalValue,Math.ceil(this._stats.p2pDuration*this._conf.LATENCY_CAPPING_RATIO))),this._handlers.onProgress(this._stats,this._request),this._getFullP2PSegment()):(this._eventBus.emit(_.default.SRModuleInterface.UNCOMPLETE_SEGMENT_REQUESTED),this._getRemainingRangeFromCDN())),this._controlStats.getSegmentSuccess++}catch(e){console.error(e),f.default.notifyError(e),this._getFullSegmentFromCDN(),this._controlStats.getSegmentFallback++}return{abort:this._abort.bind(this)}}},{key:"_abort",value:function(){this._httpRequest&&this._httpRequest.abort(),this._handlers.onSuccess=E,null!==this._segmentCoord&&this._mediaStats.abortFragmentCount++}},{key:"_getFullP2PSegment",value:function(){var e=this;this._waitSegmentUnlocked(function(t){t?e._fillSegment(null):(e._controlStats.segmentLockTimeout++,e._getFullSegmentFromCDN())})}},{key:"_getRemainingRangeFromCDN",value:function(){var e=this,t=this._getRangeFromRequest();this._fallbackRange=t,this._rangeToDownload=this._partialSegment.getUpdatedRange(t),this._downloadFromCDN(this._rangeToDownload,function(t,n){if(t)return void e._handlers.onError(t,e._request);e._fillSegment(n)})}},{key:"_onCDNProgress",value:function(e){var t=Date.now();null===this._firstByteCdnTimestamp&&(this._firstByteCdnTimestamp=t,this._conf.ENABLE_LATENCY_FEEDBACK&&(this._stats.latency=this._firstByteCdnTimestamp-this._startDownloadCdn)),this._stats.cdnDuration=t-this._startDownloadCdn,this._stats.cdnDownloaded=e.loaded;var n={};if((0,a.default)(n,this._stats),this._conf.USE_CONTINOUS_PROGRESS_FEEDBACK)if(e.lengthComputable){var r=e.loaded/e.total;n.p2pDownloaded=Math.round(r*this._stats.p2pDownloaded),n.p2pDuration=Math.round(r*this._stats.p2pDuration)}else n.p2pDownloaded=0,n.p2pDuration=0;this._conf.PROGRESS_ADD_TOTAL&&(n.lengthComputable=e.lengthComputable,n.total=e.lengthComputable?e.total+this._stats.p2pDownloaded:0),this._handlers.onProgress(n,this._request)}},{key:"_downloadFromCDN",value:function(e,t){var n=this,r=h.default.Methods.GET,i={headers:this._getHttpRequestHeaders(e),responseType:h.default.ResponseTypes.ARRAY_BUFFER,withCredentials:!!this._request.withCredentials,events:{onprogress:this._onCDNProgress.bind(this)}};this._httpRequest=new h.default(r,this._request.url,i),this._httpRequest.send().then(function(e){var r=Date.now();n._stats.cdnDownloaded=e.byteLength||0,n._stats.cdnDuration=r-n._startDownloadCdn;var i=n._transferStats.p2pMediaDownloaded-n._p2pAmountOnStart;n._abrStats.concurrentP2pDownloaded+=i,n._abrStats.cdnEstimationCount++,0!==i&&n._abrStats.concurrentP2pDownloadCount++;var a=n._stats.cdnDownloaded+n._stats.p2pDownloaded;if(n._stats.cdnDownloaded/a>=n._conf.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD&&n._stats.cdnDownloaded>=n._conf.ABR_CDN_DL_THRESHOLD||a<n._conf.ABR_CDN_DL_THRESHOLD){if(n._conf.CDN_SPEED_ESTIMATE_CONSIDER_P2P){var o=Math.min(n._stats.cdnDownloaded+i,n._stats.cdnDownloaded*n._conf.CDN_CONCURRENT_SCALING_CAP);n._abrStats.cdnSpeed=8*o/n._stats.cdnDuration}else n._abrStats.cdnSpeed=8*n._stats.cdnDownloaded/n._stats.cdnDuration;n._abrStats.cdnTimestamp=Date.now()}t(null,e)}).catch(function(e){t(e,null)}),this._startDownloadCdn=Date.now(),this._p2pAmountOnStart=this._transferStats.p2pMediaDownloaded}},{key:"_getHttpRequestHeaders",value:function(e){var t={},n=this._request.headers;if(n&&void 0!==n.length)throw new Error("Custom headers object should not have a `length` attribute (you might use the previous API format)");return n&&((0,a.default)(t,n),this._rangeToDownload&&delete t.Range),void 0===t.Range&&e&&(t.Range=this._rangeValue(e)),t}},{key:"_rangeValue",value:function(e){return"bytes="+e.start+"-"+(e.end||"")}},{key:"_fillSegment",value:function(e){var t=this,n=!1,r=function(e){return function(r,i){n||(n=!0,e.call(t,r,i))}};try{this._partialSegment.getFullSegment({response:e},r(this._onSuccessAsynchronous),r(this._getFullSegmentFromCDN)),this._controlStats.fillSegmentSuccess++}catch(e){return console.error(e),f.default.notifyError(e),this._getFullSegmentFromCDN(),void this._controlStats.fillSegmentFallback++}(0,p.createTimeout)(function(){n||(n=!0,t._getFullSegmentFromCDN(),t._controlStats.fillSegmentSuccess--,t._controlStats.fillSegmentTimeout++)},this._conf.TIMEOUT_GET_FULL_SEGMENT)}},{key:"_waitSegmentUnlocked",value:function(e){var t=this;if(!this._partialSegment.isLocked())return void e(!0);var n=0,r=(0,p.createInterval)(function(){if(t._partialSegment=t._srModule.getP2PData(t._segmentCoord),!t._partialSegment.isLocked())return r.clear(),void e(!0);(n+=t._conf.LOCKED_RETRY_INTERVAL)>t._conf.LOCKED_RETRY_TIMEOUT&&(r.clear(),e(!1))},this._conf.LOCKED_RETRY_INTERVAL)}},{key:"_getRangeFromRequest",value:function(){var e=this._request.headers;if(e&&void 0!==e.Range){var t=e.Range.split("="),n=t[1].split("-");return{start:parseInt(n[0],10),end:parseInt(n[1],10)}}}},{key:"_getFullSegmentFromCDN",value:function(){var e=this;this._stats.p2pDownloaded=0,this._stats.p2pDuration=0,this._downloadFromCDN(this._fallbackRange,function(t,n){if(t)return void e._handlers.onError(t,e._request);e._handlers.onSuccess(n,e._stats,e._request)})}},{key:"_setP2PStats",value:function(){this._stats.p2pDownloaded=this._partialSegment.p2pAmount,this._stats.p2pDuration=0===this._partialSegment.p2pSpeed?0:Math.round(this._partialSegment.p2pAmount/this._partialSegment.p2pSpeed*1e3)}},{key:"_onSuccessAsynchronous",value:function(e){var t=this;0?(0,p.createTimeout)(function(){t._handlers.onSuccess(e.response,t._stats,t._request)},0):this._handlers.onSuccess(e.response,this._stats,this._request)}}]),e}();e.exports={getSegment:function(e,t,n,r,i){return new y(e,t,n,r,i).getSegment()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n.USE_COMBINED_ABR_FEEDBACK){var r=e.cdnDownloaded+e.p2pDownloaded,i=e.cdnDownloaded/r,a=void 0;if(i<n.ABR_SEGMENT_CDN_RATIO_THRESHOLD||e.cdnDownloaded<n.ABR_CDN_DL_THRESHOLD){var o=void 0;if(null!==t.cdnTimestamp){var s=Date.now()-t.cdnTimestamp,u=Math.max(0,1-s/n.ABR_CDN_DL_DECAY_TIME);o=(1-u)*t.p2pSpeed+u*t.cdnSpeed}else o=t.p2pSpeed;a=8*r/o}else a=8*e.cdnDownloaded/t.cdnSpeed/i;e.p2pDuration=(1-i)*a,e.cdnDuration=i*a}else t.p2pSpeed>0?e.p2pDuration=8*e.p2pDownloaded/t.p2pSpeed:e.p2pDuration=0,null!==t.cdnSpeed?e.cdnDuration=8*e.cdnDownloaded/t.cdnSpeed:e.cdnDuration=0},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getSegmentTime",value:function(e){}},{key:"getSegmentList",value:function(e,t,n){}},{key:"getTrackList",value:function(){}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(96),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(112),f=r(c),d=n(49),h=r(d),v=n(635),_=r(v),p=n(636),m=r(p),g=n(637),E=r(g),y=n(638),S=r(y),T=n(639),b=r(T),R=n(640),A=r(R),D=n(642),w=r(D),O=n(643),k=r(O),C=n(264),L=r(C),P=n(644),I=r(P),M=n(645),N=r(M),x=n(647),F=r(x),U=n(171),B=r(U),G=n(648),H=r(G),j=n(4),W=r(j),V=n(651),K=n(652),Y=n(660),q={WS:"ws",WSS:"wss",HTTPS:"https",HTTP:"http"},X=function(){function e(t,n,r,i,o,u,l){(0,s.default)(this,e),this._p2pDownloadBlockExpirationTimestamp=a.default,this._p2pUploadBlockExpirationTimestamp=a.default;var c=B.default.deepCopy(I.default);this.p2pConfig=t,(0,V.overloadP2PConfig)(c,t,r),this.conf=c;var d=(0,K.formatContentId)({contentId:t.contentId,contentUrl:n});this.eventBus=new h.default,this.workerHelper=new F.default,this.moduleState=new N.default(this.eventBus,i,l),this.moduleState.content=d,this.isP2PDownloadOn=!0,this.isP2PUploadOn=!0,this.peerToken=f.default.v4(),this.status=new _.default,this.statsProvider=new L.default,this.peerStats=new A.default(this.statsProvider),this.transferStats=new m.default,this.efficiencyStats=new E.default,this.controlStats=new S.default,this.mediaStats=new w.default(i,o,u),this.abrStats=new k.default(this.eventBus),this.bufferStats=new b.default(this.eventBus),this._backendManager=new H.default(this.conf,this.eventBus)}return(0,l.default)(e,[{key:"blockP2PDownload",value:function(e){var t=Date.now()+e;return t>this._p2pDownloadBlockExpirationTimestamp&&(this._p2pDownloadBlockExpirationTimestamp=t,!0)}},{key:"unblockP2PDownload",value:function(){this._p2pDownloadBlockExpirationTimestamp=a.default}},{key:"blockP2PUpload",value:function(e){var t=Date.now()+e;return t>this._p2pUploadBlockExpirationTimestamp&&(this._p2pUploadBlockExpirationTimestamp=t,!0)}},{key:"unblockP2PUpload",value:function(){this._p2pUploadBlockExpirationTimestamp=a.default}},{key:"injectConfigFromDistributor",value:function(e){e.configuration&&((0,V.overloadConfigFromDistributor)(this.conf,e.configuration,e.isClustered),this.eventBus.emit(W.default.Config.CONFIG_UPDATED));var t=this.conf.BACKEND_USE_SSL?q.HTTPS:q.HTTP,n=this.conf.BACKEND_USE_SSL?q.WSS:q.WS;this.conf.TRACKER_URL=(0,Y.formatUrl)(t+"://"+e.trackerDns),this.conf.ANALYTICS.KLARA_URL=(0,Y.formatUrl)(t+"://"+e.klaraDns),this.conf.SIGNALING_URL=(0,Y.formatUrl)(n+"://"+e.signalingDns),this.status.setBearerToken(e.token),this._decideIfQOSTester(),null!=e.contentActivated&&(this.conf.CONTENT_ACTIVATED=e.contentActivated)}},{key:"setBackendFallbackUrls",value:function(){var e=this.conf.FALLBACK_URLS;this.conf.ANALYTICS.KLARA_URL=(0,Y.formatUrl)(e.KLARA_URL),this._decideIfQOSTester()}},{key:"_decideIfQOSTester",value:function(){var e=this.moduleState.isLive()?this.conf.LIVE.QOS_REF_PERCENTAGE:this.conf.QOS_REF_PERCENTAGE;e===parseFloat(e,3)&&100*Math.random()<e&&(this.conf.QOS_P2P_DISABLED=!0)}},{key:"dispose",value:function(){this.workerHelper.dispose(),this._backendManager.dispose()}},{key:"isP2PDownloadBlocked",get:function(){return Date.now()<this._p2pDownloadBlockExpirationTimestamp}},{key:"isP2PUploadBlocked",get:function(){return Date.now()<this._p2pUploadBlockExpirationTimestamp}}]),e}();t.default=X,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(49),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(){var e=!1,t=void 0,n=0,r=0,a=0,o=0,s=0,u=0,l=0,c=0,f="",d=!1,h="",v=this,_=void 0,p=void 0,m=new i.default,g=null,E=function(){var e=void 0,t=void 0,i=void 0,l=void 0;n&&(n>a&&(a=n),e=r?(r*_+n)/(_+1):n,t=_?_+1:1,_=t,r=e),o&&(o>u&&(u=o),i=s?(s*p+o)/(p+1):o,l=p?p+1:1,p=l,s=i)};v.getMyPeerId=function(){return t},v.setMyPeerId=function(e){t!==e&&(t=e)},v.getDlSpeed=function(){return n},v.setDlSpeed=function(e){n=e},v.getAvgDlSpeed=function(){return r},v.getMaxDlSpeed=function(){return a},v.getUpSpeed=function(){return o},v.setUpSpeed=function(e){o=e},v.getAvgUpSpeed=function(){return s},v.getMaxUpSpeed=function(){return u},v.getCdnCancelled=function(){return c},v.increaseCdnCancelledBy=function(e){c+=e},v.getConnected=function(){return e},v.setTrackerVersion=function(e){f=e},v.getTrackerVersion=function(){return f},v.setTrackerId=function(e){h=e},v.getTrackerId=function(){return h},v.setConnected=function(t){t!==e&&(e=t,!0===t?m.emit("tracker_ready"):m.emit("tracker_disconnected"))},v.getEE=function(){return m},v.setConnectedToSignalingServer=function(){d=!0,m.emit("signaling_ready")},v.setDisconnectedToSignalingServer=function(){d=!1,m.emit("signaling_disconnected")},v.getConnectedToSignalingServer=function(){return d},v.computeMaxAndAvgSpeed=E,v.setMeanInstantSpeed=function(e){l=e},v.getMeanInstantSpeed=function(){return l},v.setBearerToken=function(e){g=e},v.getBearerToken=function(){return g}};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._p2pUseful=0,this.cdnDownloaded=0,this.p2pConsumed=0,this.cdnConsumed=0,this.p2pMediaDownloaded=0,this.p2pHeadersDownloaded=0,this.p2pMessagesDownloaded=0,this.p2pMessagesCount=0,this.p2pUploaded=0,this.multipleDlPP=0,this.multipleDlPC=0,this.multipleDlCP=0,this.multipleDlCC=0,this.multipleDlHP=0,this.multipleDlHD=0,this.multipleDlM=0}return(0,s.default)(e,[{key:"p2pUseful",get:function(){return this._p2pUseful},set:function(e){if(e<this._p2pUseful)throw new TypeError("p2pUseful increment is not a positive number");this._p2pUseful=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function e(){(0,i.default)(this,e),this.receivedChunkRequestCount=0,this.dequeuedReceivedChunkRequestCount=0,this.missedDequeuedChunkRequestCount=0,this.safeChunkRequestCount=0,this.unsafeChunkRequestCount=0,this.safeChunkRequestTimeoutCount=0,this.unsafeChunkRequestTimeoutCount=0,this.gracedChunksCount=0,this.expiredGraceChunksCount=0};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._sampledIceGatheringDuration=0,this.missedIceCandidateCount=0,this.gatheredIceCandidateCount=0,this.iceCandidatesBucketCount=0,this.earlyIceGatheringFinishedCount=0,this.newPeerConnectionCount=0,this.nbRightHashP2P=0,this.nbWrongHashP2P=0,this.nbRightHashDLM=0,this.nbWrongHashDLM=0,this.checkHeartbeatFailed=0,this.getSegmentSuccess=0,this.getSegmentFallback=0,this.segmentLockTimeout=0,this.fillSegmentSuccess=0,this.fillSegmentFallback=0,this.fillSegmentTimeout=0,this.signalingMessagesCount=0,this.sentOfferSdpVolume=0,this.sentAnswerSdpVolume=0,this.sentIceCandidatesVolume=0,this.sentDistributorRootCount=0,this.sentTrackerInitCount=0,this.sentTrackerPeersCount=0,this.sentTrackerTracksCount=0}return(0,s.default)(e,[{key:"getSampledIceGatheringDuration",value:function(){var e=this._sampledIceGatheringDuration;return this._sampledIceGatheringDuration=0,e}},{key:"setSampledIceGatheringDuration",value:function(e){0===this._sampledIceGatheringDuration&&(this._sampledIceGatheringDuration=e)}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(4),l=r(u),c=n(253),f=r(c),d=n(177),h=r(d),v=function(){function e(t){(0,a.default)(this,e),this._alwaysDynamicBuffer=!0,this._lastLowBuffer=0,this.bufferRefill=0,this.bufferedAmount=0,this.lowerBufferTargetNetChangePerRebound=0,this.sampledHighLowBufferTargetGap=0,this.lowerTargetResetCount=0,this._timeSpentOnEdgeStaircase=new h.default,this._timeSpentWithoutPeerStaircase=new h.default,this._timeSpentDynamicStaircase=new h.default,this._timeSpentTopSeederStaircase=new h.default,this.timeLowerTargetAboveLiveEdgeStaircase=new h.default,this._globalEventBus=t,this._globalEventBus.on(l.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,this._onLiveEdgeChanged.bind(this)),this._globalEventBus.on(l.default.BufferManager.LOW_BUFFER,this._onLowBuffer.bind(this)),this._globalEventBus.on(l.default.BufferManager.HIGH_BUFFER,this._onHighBuffer.bind(this)),this._globalEventBus.on(l.default.BufferManager.STATE_CHANGED,this._onBufferStateChange.bind(this))}return(0,s.default)(e,[{key:"_onLiveEdgeChanged",value:function(e){var t=e?1:0;this._timeSpentOnEdgeStaircase.updateMetric(t)}},{key:"_onBufferStateChange",value:function(e,t){switch(e){case f.default.NO_PEER:this._timeSpentWithoutPeerStaircase.updateMetric(0);break;case f.default.DYNAMIC:this._timeSpentDynamicStaircase.updateMetric(0);break;case f.default.TOP_SEEDER:this._timeSpentTopSeederStaircase.updateMetric(0)}switch(t){case f.default.NO_PEER:this._timeSpentWithoutPeerStaircase.updateMetric(1),e!==f.default.IDLE&&(this._alwaysDynamicBuffer=!1);break;case f.default.DYNAMIC:this._timeSpentDynamicStaircase.updateMetric(1);break;case f.default.TOP_SEEDER:this._timeSpentTopSeederStaircase.updateMetric(1),this._alwaysDynamicBuffer=!1;break;case f.default.RANDOM:this._alwaysDynamicBuffer=!1}this.bufferState=t}},{key:"_onLowBuffer",value:function(e){this._lastLowBuffer=e}},{key:"_onHighBuffer",value:function(e){this.bufferRefill+=e-this._lastLowBuffer}},{key:"_resetDynamicFlag",value:function(){this._alwaysDynamicBuffer=this.bufferState===f.default.DYNAMIC}},{key:"getTimeSpentOnEdgeRatio",value:function(){return this._timeSpentOnEdgeStaircase.getAverage()}},{key:"getTimeSpentWithoutPeerRatio",value:function(){return this._timeSpentWithoutPeerStaircase.getAverage()}},{key:"getTimeSpentTopSeederRatio",value:function(){return this._timeSpentTopSeederStaircase.getAverage()}},{key:"getTimeSpentDynamicIntegral",value:function(){return this._timeSpentDynamicStaircase.getIntegral()}},{key:"alwaysDynamicBuffer",get:function(){var e=void 0;return e=this.bufferState!==f.default.NO_PEER&&this._alwaysDynamicBuffer,this._resetDynamicFlag(),e}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(177),l=r(u),c=n(259),f=r(c),d=n(264),h=(r(d),n(265)),v=r(h),_=n(641),p=r(_),m=20,g=10,E=function(){function e(t){(0,a.default)(this,e),this.match=0,this.excessMatch=0,this.offer=0,this.openedMatch=0,this.openedOffer=0,this.unansweredOffer=0,this.active=0,this.transfer=0,this.denied=0,this.droppedSameTrack=0,this.droppedOtherTrack=0,this.offerTimeout=0,this.answerTimeout=0,this.timeoutNewConnection=0,this.timeoutCheckingConnection=0,this.timeoutFailedConnection=0,this.timeoutNewIce=0,this.timeoutGatheringIce=0,this.timeoutCompleteIce=0,this.disconnected=0,this.lateMessage=0,this.exclusionSize=0,this.timeoutLocalSdp=0,this.timeoutRemoteSdp=0,this.timeoutLocalSdpWithStun=0,this.timeoutRemoteSdpWithStun=0,this.timeoutWithLocalStunIce=0,this.timeoutWithRemoteStunIce=0,this._statsProvider=t,this.peerPoolUploadCapacity=new l.default,this.locked=new l.default,this.loosers=new l.default,this.successPeerConnectionAttemptDuration=new v.default(m),this.failedPeerConnectionAttemptDuration=new v.default(m),this.dataChannelBufferEmptyingStats=new p.default(g)}return(0,s.default)(e,[{key:"incrementTimeout",value:function(e,t,n,r){switch(n?this.offerTimeout++:this.answerTimeout++,r.hasLocalDescription&&this.timeoutLocalSdp++,r.hasRemoteDescription&&this.timeoutRemoteSdp++,r.hasLocalDescriptionWithStun&&this.timeoutLocalSdpWithStun++,r.hasRemoteDescriptionWithStun&&this.timeoutRemoteSdpWithStun++,r.hasLocalStunIceCandidate&&this.timeoutWithLocalStunIce++,r.hasRemoteStunIceCandidate&&this.timeoutWithRemoteStunIce++,e){case"new":this.timeoutNewConnection++;break;case"checking":this.timeoutCheckingConnection++;break;case"failed":this.timeoutFailedConnection++}switch(t){case"new":this.timeoutNewIce++;break;case"gathering":this.timeoutGatheringIce++;break;case"complete":this.timeoutCompleteIce++}}},{key:"sampledPUC",get:function(){return this._statsProvider.getStat(f.default.PeerStats.SAMPLED_PUC)}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._maxSize=t,this._internalQueue=[]}return(0,s.default)(e,[{key:"addSample",value:function(e){this._internalQueue.length>=this._maxSize&&this._internalQueue.shift(),this._internalQueue.push(e)}},{key:"fetchSample",value:function(){if(this._internalQueue.length>0){var e=Math.floor(Math.random()*this._internalQueue.length);return this._internalQueue.splice(e,1)[0]}}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=function(){function e(t,n,r){(0,s.default)(this,e),this.abortFragmentCount=0,this.emergencyTrackSwitchCount=0,this.maxBitrate=0,this.minBitrate=0,this._playerInterface=t,this._mediaElementPlaceholder=n,this._mediaMap=r}return(0,l.default)(e,[{key:"duration",get:function(){return!this._playerInterface.isLive()&&this._mediaElementPlaceholder.mediaElement?this._mediaElementPlaceholder.mediaElement.duration:0}},{key:"videoTrackCount",get:function(){var e=this._mediaMap.getTrackList(),t=0,n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(e);!(n=(o=s.next()).done);n=!0){var u=o.value;u.type&&"video"!==u.type||(t++,u.bitrate&&(this.maxBitrate=Math.max(this.maxBitrate,u.bitrate),this.minBitrate=0===this.minBitrate?u.bitrate:Math.min(this.minBitrate,u.bitrate)))}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return t}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(49),l=(r(u),n(4)),c=r(l),f=n(97),d=r(f),h=n(258),v=r(h),_=n(265),p=r(_),m=.1,g=10,E=50,y=function(){function e(t){var n=this;(0,a.default)(this,e),this._bandwidthEstimates=[],this._latencyHistory=new p.default(g),this.cdnSpeed=null,this.cdnTimestamp=null,this.p2pSpeed=0,this.estimatedBitrate=0,this.p2pUsefulEstimate=1,this.concurrentP2pDownloaded=0,this.concurrentP2pDownloadCount=0,this.cdnEstimationCount=0,this.zeroP2pSpeedWindowsCount=0,this.p2pSpeedWindowsCount=0,this.feebackCount=0,this.zeroDurationFeedbackCount=0,this.trackSwitchWithPeers=0,this._addBandwidthEstimate=function(e){n.feebackCount++;var t=e.p2pDuration+e.cdnDuration;if(0===t)return void n.zeroDurationFeedbackCount++;var r=e.p2pDownloaded+e.cdnDownloaded/t;n._bandwidthEWMA?n._bandwidthEWMA.update(r):n._bandwidthEWMA=new d.default(r,m),n._bandwidthEstimates.push(n._bandwidthEWMA.value),null!=e.latency&&e.cdnDownloaded>0&&n._latencyHistory.addSample(e.latency)},this._eventBus=t,this._eventBus.on(c.default.SRModuleInterface.ABR_FEEDBACK,this._addBandwidthEstimate)}return(0,s.default)(e,[{key:"flushBandwidthEstimates",value:function(){this._bandwidthEstimates=[]}},{key:"dispose",value:function(){this.flushBandwidthEstimates()}},{key:"bandwidthEstimateCV",get:function(){var e=v.default.meanAbsoluteDeviation(this._bandwidthEstimates),t=v.default.mean(this._bandwidthEstimates);return e&&t&&0!==t?e/t:0}},{key:"latencyHistoricalValue",get:function(){return 0===this._latencyHistory.length?E:Math.round(this._latencyHistory.mean)}}]),e}();t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(260),a=r(i),o=n(171),s=r(o),u={BACKEND_USE_SSL:!0,TRACKER_URL:"",SIGNALING_URL:"",FALLBACK_URLS:{KLARA_URL:"https://klara.streamroot.io"},DISTRIBUTOR:{URL:"https://distributor.streamroot.io",OVERRIDDEN:!1,TIMEOUT_DELAY:1e4,MAX_RETRY:1},SIGNALING_DELAY_STEP:10*1e3,SIGNALING_DELAY_MAX:5*60*1e3,SIGNALING_DELAY_MAX_INITIAL:30*1e3,TRACKER_DELAY_MAX:5*60*1e3,TRACKER_DELAY_INIT:2*1e3,MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE:10,ASK_PEERS_INTERVAL:1*60*1e3,ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL:1e4,SEND_TRACKS_INTERVAL:1*60*1e3,GEOLOCATION_REQUEST_TIMEOUT:3e3,GEOLOCATION_REQUEST_MAX_RETRY:1,CONF_LABEL:"default",ANALYTICS:{KLARA_URL:"",EXPOSE_CONF_LABEL:!1,RETRY_NUMBER:3,RETRY_DELAY:10*1e3,TIMEOUT_DELAY:3*1e3,TRAFFIC_INTERVAL_ARRAY:function(e){for(var t=e.from,n=e.to,r=e.step,i=[],a=t;a<n;a+=r)i.push(a);return i.push(n),i}({from:5*1e3,to:120*1e3,step:10*1e3}),STATS_INTERVAL:2*60*1e3,CONTROL_INTERVAL:10*60*1e3},QOS_REF_PERCENTAGE:0,QOS_P2P_DISABLED:!1,ERRORS:{API_KEY:"d04c6fa616c255ac55dec6b068ad7172",HANDLER:"xhr",STAGES:["staging","qa","production"]},PEER_CONNECTION_TIMEOUT:5e4,ICECANDIDATES_TIMEOUT:15e3,SEND_HEARTBEAT_INTERVAL:5*1e3,CHECK_HEARTBEAT_INTERVAL:10*1e3,DATACHANNEL_TYPE:"limited-retransmits",DATACHANNEL_MAX_PACKET_LIFETIME:1e3,DATACHANNEL_MAX_RETRANSMITS:1,ENABLE_STUN:!0,ENABLE_TURN:!1,TRANSFORM_SDP:!0,STUNSERVERS:["stun.l.google.com:19302"],TURNSERVERS:[{urls:"turn:23.97.160.254:3478?transport=udp",credential:"streamroot",username:"streamroot"}],CLIENT_TRACKER_PROTOCOL_VERSION:"3.0.0",P2P_PROTOCOL_VERSION:"3.3.1",CHUNK_SIZE:15*1024,ALLOW_LIVE_PUSH_SEGMENT:!0,ALLOW_VOD_PUSH_SEGMENT:!0,MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER:80,P2P_CACHE_MAX_SIZE:130*(1024*1024),MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH:300,GETSEGMENTTIME_CACHE_MAX_SIZE:1e3,NB_SEGMENT_P2P_PREBUFFER:10,MAX_BUFFER_DURATION:0?5*60:2*60,SEGMENT_ID_ACCEPTABLE_RANGE:a.default,CHUNK_BATCHING_INTERVAL:1e3,CHUNK_TIMEOUT:2500,CHUNK_GRACE_DURATION:1e4,UP_BUFFERED_AMOUNT_LOW_THRESHOLD:15e3,UP_MAX_BUFFERED_AMOUNT:6e4,CHUNK_UP_TIMEOUT:2500-600,SPLIT_UPLOAD_QUEUE:!1,ENABLE_UPLOAD_DEQUEUE_ALL:!1,LIVE:{LOWER_BUFFER_TARGET:15,HIGHER_BUFFER_TARGET:30,BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT:.1,UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING:6e3,P2P_CACHE_MAX_SIZE:60*(1024*1024),CHUNK_TIMEOUT:2e3,CHUNK_UP_TIMEOUT:2e3-600,QOS_REF_PERCENTAGE:0,NEAR_EDGE_MARGIN:2*60*1e3,LOW_TARGET_P2P_DL_BLOCK_DURATION:2e4,ENABLE_DYNAMIC_LOWER_TARGET:!1,CRITICAL_LOWER_TARGET_RATIO:.5,FAST_BUFFER_FILL_FRACTION:.5,LOWER_BUFFER_TARGET_DECREASE_STEP:.2,LOWER_BUFFER_TARGET_INCREASE_STEP:.3},BUFFER_CHECK_INTERVAL:100,BUFFER_ZERO_THRESHOLD:2,VOD_CRITICAL_BUFFER_THRESHOLD:-1,VOD_CRITICAL_BUFFER_P2P_STOP_DURATION:1e4,VOD_SAFE_BUFFER_THRESHOLD:20,SPEED_MONITOR_INTERVAL:1e3,MEAN_SPEED_CALCULATION_INTERVAL:500,PEER_UPLOAD_SPEED_EMA_HALF_LIFE:1e4,PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE:15e3,PEER_SPEED_MONITOR_INTERVAL:1e3,PEER_TIMEOUT_RATIO_WINDOW:3e4,PEER_UPLOAD_CAPACITY_SAFE_RATIO:.8,PEER_UPLOAD_CAPACITY_EXTRA_RATIO:.1,PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL:1e3,DEFAULT_PEER_UPLOAD_CAPACITY:1e3,MIN_PEER_UPLOAD_CAPACITY:200,MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO:.1,PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP:.3,PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN:.5,PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO:!1,PUC_EMWA_WEIGHT_CAP:.9,PEER_INIT_LOCKED_DURATION:1e4,PEER_LOCKED_UPLOAD_THRESHOLD:.05,PEER_LOCKED_DOWNLOAD_THRESHOLD:.1,POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON:!1,POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION:5e3,PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE:2e3,PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE:3e3,PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD:.6,LOOSER_UPLOAD_THRESHOLD:50,PEER_POOL_LIMIT:16,PEER_POOL_MAINTENANCE_INTERVAL:1e3,EXPECTED_CONNECTION_SUCCESS_RATE:.4,RESERVED_OFFER_SLOTS:3,CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL:1e3,MAX_TRACKER_EXCLUSION_LENGTH:100,PEER_DISCONNECTED_EXCLUSION_DURATION:1*60*1e3,PEER_DISCONNECTED_EXCLUSION_RANK:1,OFFER_DECLINED_EXCLUSION_DURATION:1*60*1e3,OFFER_DECLINED_EXCLUSION_RANK:1,PEER_REMOVED_EXCLUSION_DURATION:15*60*1e3,PEER_REMOVED_EXCLUSION_RANK:1,PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION:15*60*1e3,PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK:1,CDN_SPEED_ESTIMATE_CONSIDER_P2P:!0,CDN_CONCURRENT_SCALING_CAP:1.5,P2P_SPEED_ZERO_THRESHOLD:50,P2P_SPEED_ESTIMATION_BUCKET_DURATION:100,P2P_SPEED_ESTIMATION_BUCKET_COUNT:10,P2P_SPEED_EMA_WEIGHT:.5,P2P_SPEED_EMA_ZERO_HALF_LIFE:12e4,P2P_USEFUL_CALCULATION_INTERVAL:5e3,P2P_USEFUL_SMA_WINDOW:12e4,P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION:50,P2P_USEFUL_RATIO_WEIGHT:.8,ABR_SEGMENT_CDN_RATIO_THRESHOLD:.3,ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD:.3,ABR_CDN_DL_THRESHOLD:100,ABR_CDN_DL_DECAY_TIME:6e4,USE_COMBINED_ABR_FEEDBACK:!0,BITRATE_ESTIMATION_WINDOW:3e4,ENABLE_PREBUFFER_FEEDBACK:!1,BLOCK_SEEDER_SCHEDULING_WINDOW:6e4,BLOCK_SEEDER_SCHEDULING_DURATION:12e4,BLOCK_SEEDER_SCHEDULING_TIMEOUT_THRESHOLD:1.1,BLOCK_SEEDER_SCHEDULING_REQUEST_THRESHOLD:50,PEER_COMPUTE_RTT_INTERVAL:5e3,USE_CONTINOUS_PROGRESS_FEEDBACK:!1,PROGRESS_ADD_TOTAL:!1,ENABLE_LATENCY_FEEDBACK:!1,LATENCY_CAPPING_RATIO:.5,MAX_PEER_CONNECTION_FAILURES:a.default,SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS:null,TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND:null,LOCKED_RETRY_INTERVAL:30,LOCKED_RETRY_TIMEOUT:500,TIMEOUT_GET_FULL_SEGMENT:500,RETURN_COPY_SEGMENT:!0,ENABLE_FIX_UNRELIABLE_SEGMENT_TIME:!1,ALLOW_P2P:!0,RANGE_REQUEST_ALLOWED:!0,DEVICE_INFO:"",ID_CLIENT:"",ENABLE_MOBILE_BROWSER:!1,CONTENT_ACTIVATED:!0,ENABLE_TRACK_EDGE_GC_BLOCK:!1,P2P_CACHE_GC_TRACK_EDGE_BLOCK_DURATION:0,DEBUG:!1,ENABLE_FILTER_BANNED_SEEDERS:!1,ENABLE_PUSH_SEGMENT_OPTIM:!1,ENABLE_P2P_SCHEDULER_OPTIM:!1};s.default.deepFreeze(u),t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(646),l=function(){function e(t,n,r){(0,a.default)(this,e),this._isNearEdge=!1,this.isAlwaysDvr=!0,this.currentTracks=new u.CurrentTracks(t),this._playerInterface=n,this._streamType=r,this.nextSegmentPrebuffered={video:!1,audio:!1}}return(0,s.default)(e,[{key:"isLive",value:function(){return this._playerInterface.isLive()}},{key:"resetIsAlwaysDvr",value:function(){!this._isNearEdge&&this.isLive()&&(this.isAlwaysDvr=!0)}},{key:"isNearEdge",get:function(){return this._isNearEdge},set:function(e){e&&this.isAlwaysDvr&&(this.isAlwaysDvr=!1),this._isNearEdge=e}},{key:"streamType",get:function(){return this._streamType}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CurrentTracks=void 0;var i=n(263),a=r(i),o=n(96),s=r(o),u=n(1),l=r(u),c=n(2),f=r(c),d=n(4),h=r(d);t.CurrentTracks=function(){function e(t){(0,l.default)(this,e),this.audio=void 0,this.video=void 0,this._globalEventBus=t,this._lastSwitchTimestamp=s.default,(0,a.default)(this)}return(0,f.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(!t&&!n)throw new Error("There must be at least one updated track");!t||this.audio&&this.audio.viewToString()===t.viewToString()||(this.audio=t,this._globalEventBus.emit(h.default.Metrics.TRACK_SWITCH,{isVideo:!1})),!n||this.video&&this.video.viewToString()===n.viewToString()||(this.video=n||this.video,this._lastSwitchTimestamp=Date.now(),this._globalEventBus.emit(h.default.Metrics.TRACK_SWITCH,{isVideo:!0}))}},{key:"lastSwitchTimestamp",get:function(){return this._lastSwitchTimestamp}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=void 0;u=0?require("./browser/callHashWorker"):n(240).callHashWorker;var l=function(){function e(){(0,a.default)(this,e),this._disposed=!1}return(0,s.default)(e,[{key:"callHashWorker",value:function(e,t){var n=this;return u(e,function(){n._disposed||t.apply(void 0,arguments)})}},{key:"dispose",value:function(){this._disposed=!0}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(49),l=(r(u),n(649)),c=r(l),f=n(650),d=r(f),h=n(4),v=r(h),_=function(){function e(t,n){var r=this;(0,a.default)(this,e),this._conf=t,this._eventBus=n,this._eventBus.on(v.default.Config.CONFIG_UPDATED,function(){r._init()}),this._init()}return(0,s.default)(e,[{key:"dispose",value:function(){this._backendConnectionManager&&this._backendConnectionManager.dispose(),this._askPeersManager&&this._askPeersManager.dispose()}},{key:"_init",value:function(){this._conf.TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND&&!this._backendConnectionManager&&(this._backendConnectionManager=new c.default(this._conf,this._eventBus)),this._conf.SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS&&!this._askPeersManager&&(this._askPeersManager=new d.default(this._conf,this._eventBus))}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(49),l=(r(u),n(4)),c=r(l),f=n(15),d=1e3,h=function(){function e(t,n){var r=this;(0,a.default)(this,e),this._tempDisconnectedFromBackend=!1,this._conf=t,this._eventBus=n,this._updateTransferTimestamp(),this._initTickInerval(),n.on(c.default.UploadQueue.CHUNK_REQUESTED,function(){r._updateTransferTimestamp()}),n.on(c.default.ChunkManager.CHUNK_DOWNLOADED,function(){r._updateTransferTimestamp()}),n.on(c.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE,function(){r._updateTransferTimestamp()})}return(0,s.default)(e,[{key:"dispose",value:function(){this._tickInterval.clear()}},{key:"_initTickInerval",value:function(){var e=this;this._tickInterval=(0,f.createInterval)(function(){e._checkTimeSinceLastTransfer()},d)}},{key:"_updateTransferTimestamp",value:function(){this._lastTransferTimestamp=Date.now(),this._tempDisconnectedFromBackend&&this._reconnectToBackend()}},{key:"_checkTimeSinceLastTransfer",value:function(){Date.now()-this._lastTransferTimestamp>=Number(this._conf.TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND)&&this._temporarilyDisconnectFromBackend()}},{key:"_temporarilyDisconnectFromBackend",value:function(){!1===this._tempDisconnectedFromBackend&&(this._tempDisconnectedFromBackend=!0,this._eventBus.emit(c.default.Tracker.TEMP_TRACKER_DISCONNECTION_REQUEST),this._eventBus.emit(c.default.Signaling.TEMP_SIGNALING_DISCONNECTION_REQUEST),this._eventBus.emit(c.default.TrafficAnalytics.STOP_SENDING_USAGE),this._tickInterval.clear())}},{key:"_reconnectToBackend",value:function(){this._tempDisconnectedFromBackend&&(this._tempDisconnectedFromBackend=!1,this._eventBus.emit(c.default.Tracker.TRACKER_RECONNECTION_REQUEST),this._eventBus.emit(c.default.Signaling.SIGNALING_RECONNECTION_REQUEST),this._eventBus.emit(c.default.TrafficAnalytics.RESTART_SENDING_USAGE),this._initTickInerval())}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(49),l=(r(u),n(4)),c=r(l),f=n(15),d=1e3,h=function(){function e(t,n){var r=this;(0,a.default)(this,e),this._stoppedAskingPeers=!1,this._conf=t,this._eventBus=n,this._updateSegmentTransferToPlayerTimestamp(),this._initTickInerval(),n.on(c.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE,function(){r._updateSegmentTransferToPlayerTimestamp()})}return(0,s.default)(e,[{key:"dispose",value:function(){this._tickInterval.clear()}},{key:"_initTickInerval",value:function(){var e=this;this._tickInterval=(0,f.createInterval)(function(){e._checkTimeSinceLastSegmentTransferToPlayer()},d)}},{key:"_updateSegmentTransferToPlayerTimestamp",value:function(){this._lastSegmentToPlayerTransferTimestamp=Date.now(),this._stoppedAskingPeers&&this._startAskingPeers()}},{key:"_checkTimeSinceLastSegmentTransferToPlayer",value:function(){Date.now()-this._lastSegmentToPlayerTransferTimestamp>=Number(this._conf.SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS)&&this._stopAskingPeers()}},{key:"_stopAskingPeers",value:function(){!1===this._stoppedAskingPeers&&(this._stoppedAskingPeers=!0,this._eventBus.emit(c.default.PeerPool.STOP_ASKING_PEERS),this._tickInterval.clear())}},{key:"_startAskingPeers",value:function(){this._stoppedAskingPeers&&(this._stoppedAskingPeers=!1,this._eventBus.emit(c.default.PeerPool.START_ASKING_PEERS),this._initTickInerval())}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e,t,n){if(void 0!==t.backendUrl&&(e.DISTRIBUTOR.URL=t.backendUrl,e.DISTRIBUTOR.OVERRIDDEN=!0),t.cacheSize&&(e.P2P_CACHE_MAX_SIZE=1024*t.cacheSize*1024,e.LIVE.P2P_CACHE_MAX_SIZE=e.P2P_CACHE_MAX_SIZE),void 0!==t.activateP2P&&(e.ALLOW_P2P=!!t.activateP2P),void 0!==t.debug&&(e.DEBUG=!!t.debug),t.signalingUrl&&(e.SIGNALING_URL=t.signalingUrl),t.trackerUrl&&(e.TRACKER_URL=t.trackerUrl),t.analyticsUrl&&(e.ANALYTICS.KLARA_URL=t.analyticsUrl),t.deviceInfo&&(e.DEVICE_INFO=t.deviceInfo),void 0!==t.rangeRequestEnabled&&(e.RANGE_REQUEST_ALLOWED=!!t.rangeRequestEnabled),void 0!==t.enableStunServers&&(e.ENABLE_STUN=!!t.enableStunServers),!t.streamrootKey)throw new Error("There must be a streamrootKey in the P2PConfig object");e.ID_CLIENT=t.streamrootKey,e.ENABLE_MOBILE_BROWSER=!!t.mobileBrowserEnabled,e.P2P_PROTOCOL_VERSION+="-"+n}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t.CONF_LABEL)return void o.default.notify("Received config from distributor, but no CONF_LABEL was present");e.CONF_LABEL=t.CONF_LABEL,n&&(e.P2P_PROTOCOL_VERSION+="-"+e.CONF_LABEL),void 0!==t.BACKEND_USE_SSL&&(e.BACKEND_USE_SSL=t.BACKEND_USE_SSL),void 0!==t.CHUNK_BATCHING_INTERVAL&&(e.CHUNK_BATCHING_INTERVAL=t.CHUNK_BATCHING_INTERVAL),void 0!==t.NB_SEGMENT_P2P_PREBUFFER&&(e.NB_SEGMENT_P2P_PREBUFFER=t.NB_SEGMENT_P2P_PREBUFFER),void 0!==t.MAX_BUFFER_DURATION&&(e.MAX_BUFFER_DURATION=t.MAX_BUFFER_DURATION),void 0!==t.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE&&(e.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE=t.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE),void 0!==t.CHUNK_TIMEOUT&&(e.CHUNK_TIMEOUT=t.CHUNK_TIMEOUT),void 0!==t.CHUNK_UP_TIMEOUT&&(e.CHUNK_UP_TIMEOUT=t.CHUNK_UP_TIMEOUT),void 0!==t.ICECANDIDATES_TIMEOUT&&(e.ICECANDIDATES_TIMEOUT=t.ICECANDIDATES_TIMEOUT),void 0!==t.UP_BUFFERED_AMOUNT_LOW_THRESHOLD&&(e.UP_BUFFERED_AMOUNT_LOW_THRESHOLD=t.UP_BUFFERED_AMOUNT_LOW_THRESHOLD),void 0!==t.UP_MAX_BUFFERED_AMOUNT&&(e.UP_MAX_BUFFERED_AMOUNT=t.UP_MAX_BUFFERED_AMOUNT),void 0!==t.OFFER_DECLINED_EXCLUSION_DURATION&&(e.OFFER_DECLINED_EXCLUSION_DURATION=t.OFFER_DECLINED_EXCLUSION_DURATION),void 0!==t.PEER_REMOVED_EXCLUSION_DURATION&&(e.PEER_REMOVED_EXCLUSION_DURATION=t.PEER_REMOVED_EXCLUSION_DURATION),void 0!==t.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION&&(e.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION=t.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION),void 0!==t.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER&&(e.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER=t.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER),void 0!==t.P2P_CACHE_MAX_SIZE&&(e.P2P_CACHE_MAX_SIZE=t.P2P_CACHE_MAX_SIZE),void 0!==t.ALLOW_LIVE_PUSH_SEGMENT&&(e.ALLOW_LIVE_PUSH_SEGMENT=t.ALLOW_LIVE_PUSH_SEGMENT),void 0!==t.ALLOW_VOD_PUSH_SEGMENT&&(e.ALLOW_VOD_PUSH_SEGMENT=t.ALLOW_VOD_PUSH_SEGMENT),void 0!==t.STUNSERVERS&&(e.STUNSERVERS=t.STUNSERVERS),void 0!==t.TRANSFORM_SDP&&(e.TRANSFORM_SDP=t.TRANSFORM_SDP),void 0!==t.LIVE&&(void 0!==t.LIVE.P2P_CACHE_MAX_SIZE&&(e.LIVE.P2P_CACHE_MAX_SIZE=t.LIVE.P2P_CACHE_MAX_SIZE),void 0!==t.LIVE.CHUNK_TIMEOUT&&(e.LIVE.CHUNK_TIMEOUT=t.LIVE.CHUNK_TIMEOUT),void 0!==t.LIVE.CHUNK_UP_TIMEOUT&&(e.LIVE.CHUNK_UP_TIMEOUT=t.LIVE.CHUNK_UP_TIMEOUT),void 0!==t.LIVE.LOWER_BUFFER_TARGET&&(e.LIVE.LOWER_BUFFER_TARGET=t.LIVE.LOWER_BUFFER_TARGET),void 0!==t.LIVE.HIGHER_BUFFER_TARGET&&(e.LIVE.HIGHER_BUFFER_TARGET=t.LIVE.HIGHER_BUFFER_TARGET),void 0!==t.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT&&(e.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT=t.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT),void 0!==t.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING&&(e.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING=t.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING),void 0!==t.LIVE.QOS_REF_PERCENTAGE&&(e.LIVE.QOS_REF_PERCENTAGE=t.LIVE.QOS_REF_PERCENTAGE),void 0!==t.LIVE.NEAR_EDGE_MARGIN&&(e.LIVE.NEAR_EDGE_MARGIN=t.LIVE.NEAR_EDGE_MARGIN),void 0!==t.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION&&(e.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION=t.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION),void 0!==t.LIVE.CRITICAL_LOWER_TARGET_RATIO&&(e.LIVE.CRITICAL_LOWER_TARGET_RATIO=t.LIVE.CRITICAL_LOWER_TARGET_RATIO),void 0!==t.LIVE.FAST_BUFFER_FILL_FRACTION&&(e.LIVE.FAST_BUFFER_FILL_FRACTION=t.LIVE.FAST_BUFFER_FILL_FRACTION),void 0!==t.LIVE.LOWER_BUFFER_TARGET_DECREASE_STEP&&(e.LIVE.LOWER_BUFFER_TARGET_DECREASE_STEP=t.LIVE.LOWER_BUFFER_TARGET_DECREASE_STEP),void 0!==t.LIVE.LOWER_BUFFER_TARGET_INCREASE_STEP&&(e.LIVE.LOWER_BUFFER_TARGET_INCREASE_STEP=t.LIVE.LOWER_BUFFER_TARGET_INCREASE_STEP),void 0!==t.LIVE.ENABLE_DYNAMIC_LOWER_TARGET&&(e.LIVE.ENABLE_DYNAMIC_LOWER_TARGET=t.LIVE.ENABLE_DYNAMIC_LOWER_TARGET)),void 0!==t.QOS_REF_PERCENTAGE&&(e.QOS_REF_PERCENTAGE=t.QOS_REF_PERCENTAGE),void 0!==t.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL&&(e.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL=t.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL),void 0!==t.DEFAULT_PEER_UPLOAD_CAPACITY&&(e.DEFAULT_PEER_UPLOAD_CAPACITY=t.DEFAULT_PEER_UPLOAD_CAPACITY),void 0!==t.MIN_PEER_UPLOAD_CAPACITY&&(e.MIN_PEER_UPLOAD_CAPACITY=t.MIN_PEER_UPLOAD_CAPACITY),void 0!==t.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO&&(e.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO=t.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO),void 0!==t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP&&(e.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP=t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP),void 0!==t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN&&(e.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN=t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN),void 0!==t.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO&&(e.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO=t.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO),void 0!==t.PUC_EMWA_WEIGHT_CAP&&(e.PUC_EMWA_WEIGHT_CAP=t.PUC_EMWA_WEIGHT_CAP),void 0!==t.PEER_UPLOAD_CAPACITY_SAFE_RATIO&&(e.PEER_UPLOAD_CAPACITY_SAFE_RATIO=t.PEER_UPLOAD_CAPACITY_SAFE_RATIO),void 0!==t.PEER_UPLOAD_CAPACITY_EXTRA_RATIO&&(e.PEER_UPLOAD_CAPACITY_EXTRA_RATIO=t.PEER_UPLOAD_CAPACITY_EXTRA_RATIO),void 0!==t.SPLIT_UPLOAD_QUEUE&&(e.SPLIT_UPLOAD_QUEUE=t.SPLIT_UPLOAD_QUEUE),void 0!==t.ENABLE_UPLOAD_DEQUEUE_ALL&&(e.ENABLE_UPLOAD_DEQUEUE_ALL=t.ENABLE_UPLOAD_DEQUEUE_ALL),void 0!==t.USE_CONTINOUS_PROGRESS_FEEDBACK&&(e.USE_CONTINOUS_PROGRESS_FEEDBACK=t.USE_CONTINOUS_PROGRESS_FEEDBACK),void 0!==t.PROGRESS_ADD_TOTAL&&(e.PROGRESS_ADD_TOTAL=t.PROGRESS_ADD_TOTAL),void 0!==t.DATACHANNEL_MAX_PACKET_LIFETIME&&(e.DATACHANNEL_MAX_PACKET_LIFETIME=t.DATACHANNEL_MAX_PACKET_LIFETIME),void 0!==t.DATACHANNEL_TYPE&&(e.DATACHANNEL_TYPE=t.DATACHANNEL_TYPE),void 0!==t.DATACHANNEL_MAX_RETRANSMITS&&(e.DATACHANNEL_MAX_RETRANSMITS=t.DATACHANNEL_MAX_RETRANSMITS),void 0!==t.ANALYTICS&&void 0!==t.ANALYTICS.EXPOSE_CONF_LABEL&&(e.ANALYTICS.EXPOSE_CONF_LABEL=t.ANALYTICS.EXPOSE_CONF_LABEL),!0&&t.MOBILE&&void 0!==t.MOBILE.MAX_BUFFER_DURATION&&(e.MAX_BUFFER_DURATION=t.MOBILE.MAX_BUFFER_DURATION),void 0!==t.RANGE_REQUEST_ALLOWED&&(e.RANGE_REQUEST_ALLOWED=t.RANGE_REQUEST_ALLOWED),void 0!==t.ENABLE_STUN&&(e.ENABLE_STUN=t.ENABLE_STUN),void 0!==t.P2P_SPEED_ZERO_THRESHOLD&&(e.P2P_SPEED_ZERO_THRESHOLD=t.P2P_SPEED_ZERO_THRESHOLD),void 0!==t.P2P_SPEED_ESTIMATION_BUCKET_DURATION&&(e.P2P_SPEED_ESTIMATION_BUCKET_DURATION=t.P2P_SPEED_ESTIMATION_BUCKET_DURATION),void 0!==t.P2P_SPEED_ESTIMATION_BUCKET_COUNT&&(e.P2P_SPEED_ESTIMATION_BUCKET_COUNT=t.P2P_SPEED_ESTIMATION_BUCKET_COUNT),void 0!==t.P2P_SPEED_EMA_WEIGHT&&(e.P2P_SPEED_EMA_WEIGHT=t.P2P_SPEED_EMA_WEIGHT),void 0!==t.P2P_SPEED_EMA_ZERO_HALF_LIFE&&(e.P2P_SPEED_EMA_ZERO_HALF_LIFE=t.P2P_SPEED_EMA_ZERO_HALF_LIFE),void 0!==t.P2P_USEFUL_SMA_WINDOW&&(e.P2P_USEFUL_SMA_WINDOW=t.P2P_USEFUL_SMA_WINDOW),void 0!==t.P2P_USEFUL_CALCULATION_INTERVAL&&(e.P2P_USEFUL_CALCULATION_INTERVAL=t.P2P_USEFUL_CALCULATION_INTERVAL),void 0!==t.P2P_USEFUL_RATIO_WEIGHT&&(e.P2P_USEFUL_RATIO_WEIGHT=t.P2P_USEFUL_RATIO_WEIGHT),void 0!==t.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION&&(e.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION=t.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION),void 0!==t.CDN_SPEED_ESTIMATE_CONSIDER_P2P&&(e.CDN_SPEED_ESTIMATE_CONSIDER_P2P=t.CDN_SPEED_ESTIMATE_CONSIDER_P2P),void 0!==t.ABR_SEGMENT_CDN_RATIO_THRESHOLD&&(e.ABR_SEGMENT_CDN_RATIO_THRESHOLD=t.ABR_SEGMENT_CDN_RATIO_THRESHOLD),void 0!==t.ABR_CDN_DL_THRESHOLD&&(e.ABR_CDN_DL_THRESHOLD=t.ABR_CDN_DL_THRESHOLD),void 0!==t.ABR_CDN_DL_DECAY_TIME&&(e.ABR_CDN_DL_DECAY_TIME=t.ABR_CDN_DL_DECAY_TIME),void 0!==t.USE_COMBINED_ABR_FEEDBACK&&(e.USE_COMBINED_ABR_FEEDBACK=t.USE_COMBINED_ABR_FEEDBACK),void 0!==t.CDN_CONCURRENT_SCALING_CAP&&(e.CDN_CONCURRENT_SCALING_CAP=t.CDN_CONCURRENT_SCALING_CAP),void 0!==t.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD&&(e.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD=t.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD),void 0!==t.ENABLE_LATENCY_FEEDBACK&&(e.ENABLE_LATENCY_FEEDBACK=t.ENABLE_LATENCY_FEEDBACK),void 0!==t.ENABLE_PREBUFFER_FEEDBACK&&(e.ENABLE_PREBUFFER_FEEDBACK=t.ENABLE_PREBUFFER_FEEDBACK),void 0!==t.PEER_UPLOAD_SPEED_EMA_HALF_LIFE&&(e.PEER_UPLOAD_SPEED_EMA_HALF_LIFE=t.PEER_UPLOAD_SPEED_EMA_HALF_LIFE),void 0!==t.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE&&(e.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE=t.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE),void 0!==t.PEER_INIT_LOCKED_DURATION&&(e.PEER_INIT_LOCKED_DURATION=t.PEER_INIT_LOCKED_DURATION),void 0!==t.PEER_LOCKED_UPLOAD_THRESHOLD&&(e.PEER_LOCKED_UPLOAD_THRESHOLD=t.PEER_LOCKED_UPLOAD_THRESHOLD),void 0!==t.PEER_LOCKED_DOWNLOAD_THRESHOLD&&(e.PEER_LOCKED_DOWNLOAD_THRESHOLD=t.PEER_LOCKED_DOWNLOAD_THRESHOLD),void 0!==t.PEER_SPEED_MONITOR_INTERVAL&&(e.PEER_SPEED_MONITOR_INTERVAL=t.PEER_SPEED_MONITOR_INTERVAL),void 0!==t.PEER_TIMEOUT_RATIO_WINDOW&&(e.PEER_TIMEOUT_RATIO_WINDOW=t.PEER_TIMEOUT_RATIO_WINDOW),void 0!==t.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD&&(e.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD=t.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD),void 0!==t.LOOSER_UPLOAD_THRESHOLD&&(e.LOOSER_UPLOAD_THRESHOLD=t.LOOSER_UPLOAD_THRESHOLD),void 0!==t.CHUNK_GRACE_DURATION&&(e.CHUNK_GRACE_DURATION=t.CHUNK_GRACE_DURATION),void 0!==t.PEER_POOL_LIMIT&&(e.PEER_POOL_LIMIT=t.PEER_POOL_LIMIT),void 0!==t.RESERVED_OFFER_SLOTS&&(e.RESERVED_OFFER_SLOTS=t.RESERVED_OFFER_SLOTS),void 0!==t.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL&&(e.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL=t.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL),void 0!==t.EXPECTED_CONNECTION_SUCCESS_RATE&&(e.EXPECTED_CONNECTION_SUCCESS_RATE=t.EXPECTED_CONNECTION_SUCCESS_RATE),void 0!==t.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&(e.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON=t.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON),void 0!==t.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION&&(e.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION=t.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION),void 0!==t.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE&&(e.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE=t.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE),void 0!==t.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE&&(e.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE=t.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE),void 0!==t.MAX_TRACKER_EXCLUSION_LENGTH&&(e.MAX_TRACKER_EXCLUSION_LENGTH=t.MAX_TRACKER_EXCLUSION_LENGTH),void 0!==t.PEER_DISCONNECTED_EXCLUSION_DURATION&&(e.PEER_DISCONNECTED_EXCLUSION_DURATION=t.PEER_DISCONNECTED_EXCLUSION_DURATION),void 0!==t.PEER_DISCONNECTED_EXCLUSION_RANK&&(e.PEER_DISCONNECTED_EXCLUSION_RANK=t.PEER_DISCONNECTED_EXCLUSION_RANK),void 0!==t.OFFER_DECLINED_EXCLUSION_RANK&&(e.OFFER_DECLINED_EXCLUSION_RANK=t.OFFER_DECLINED_EXCLUSION_RANK),void 0!==t.PEER_REMOVED_EXCLUSION_RANK&&(e.PEER_REMOVED_EXCLUSION_RANK=t.PEER_REMOVED_EXCLUSION_RANK),void 0!==t.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK&&(e.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK=t.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK),void 0!==t.BLOCK_SEEDER_SCHEDULING_WINDOW&&(e.BLOCK_SEEDER_SCHEDULING_WINDOW=t.BLOCK_SEEDER_SCHEDULING_WINDOW),void 0!==t.BLOCK_SEEDER_SCHEDULING_DURATION&&(e.BLOCK_SEEDER_SCHEDULING_DURATION=t.BLOCK_SEEDER_SCHEDULING_DURATION),void 0!==t.BLOCK_SEEDER_SCHEDULING_TIMEOUT_THRESHOLD&&(e.BLOCK_SEEDER_SCHEDULING_TIMEOUT_THRESHOLD=t.BLOCK_SEEDER_SCHEDULING_TIMEOUT_THRESHOLD),void 0!==t.BLOCK_SEEDER_SCHEDULING_REQUEST_THRESHOLD&&(e.BLOCK_SEEDER_SCHEDULING_REQUEST_THRESHOLD=t.BLOCK_SEEDER_SCHEDULING_REQUEST_THRESHOLD),void 0!==t.VOD_CRITICAL_BUFFER_THRESHOLD&&(e.VOD_CRITICAL_BUFFER_THRESHOLD=t.VOD_CRITICAL_BUFFER_THRESHOLD),void 0!==t.VOD_CRITICAL_BUFFER_P2P_STOP_DURATION&&(e.VOD_CRITICAL_BUFFER_P2P_STOP_DURATION=t.VOD_CRITICAL_BUFFER_P2P_STOP_DURATION),void 0!==t.VOD_SAFE_BUFFER_THRESHOLD&&(e.VOD_SAFE_BUFFER_THRESHOLD=t.VOD_SAFE_BUFFER_THRESHOLD),void 0!==t.MAX_PEER_CONNECTION_FAILURES&&(e.MAX_PEER_CONNECTION_FAILURES=t.MAX_PEER_CONNECTION_FAILURES),void 0!==t.SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS&&(e.SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS=t.SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS),void 0!==t.TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND&&(e.TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND=t.TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND),void 0!==t.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME&&(e.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME=t.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME),void 0!==t.ENABLE_FILTER_BANNED_SEEDERS&&(e.ENABLE_FILTER_BANNED_SEEDERS=t.ENABLE_FILTER_BANNED_SEEDERS),void 0!==t.SEGMENT_ID_ACCEPTABLE_RANGE&&(e.SEGMENT_ID_ACCEPTABLE_RANGE=t.SEGMENT_ID_ACCEPTABLE_RANGE),void 0!==t.ENABLE_PUSH_SEGMENT_OPTIM&&(e.ENABLE_PUSH_SEGMENT_OPTIM=t.ENABLE_PUSH_SEGMENT_OPTIM),void 0!==t.ENABLE_P2P_SCHEDULER_OPTIM&&(e.ENABLE_P2P_SCHEDULER_OPTIM=t.ENABLE_P2P_SCHEDULER_OPTIM),void 0!==t.ENABLE_TRACK_EDGE_GC_BLOCK&&(e.ENABLE_TRACK_EDGE_GC_BLOCK=t.ENABLE_TRACK_EDGE_GC_BLOCK),void 0!==t.P2P_CACHE_GC_TRACK_EDGE_BLOCK_DURATION&&(e.P2P_CACHE_GC_TRACK_EDGE_BLOCK_DURATION=t.P2P_CACHE_GC_TRACK_EDGE_BLOCK_DURATION)}Object.defineProperty(t,"__esModule",{value:!0}),t.overloadConfigFromDistributor=t.overloadP2PConfig=void 0;var a=n(10),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.overloadP2PConfig=r,t.overloadConfigFromDistributor=i},function(e,t,n){"use strict";function r(e,t){if("string"!=typeof e||!e.length)throw new TypeError(t)}function i(e){var t=e.contentUrl,n=e.contentId;if(null!==n&&void 0!==n)return r(n,"Unvalid p2pConfig property: contentId needs to be a non-empty string"),n;r(t,"Unvalid PeerAgent constructor argument: contentUrl needs to be a non-empty string");var i=o.default.parse(t,!0,!0);return i.host+i.pathname}Object.defineProperty(t,"__esModule",{value:!0}),t.formatContentId=void 0;var a=n(653),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.formatContentId=i},function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&l.isObject(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}function a(e){return l.isString(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)}function o(e,t){return i(e,!1,!0).resolve(t)}function s(e,t){return e?i(e,!1,!0).resolveObject(t):t}var u=n(654),l=n(656);t.parse=i,t.resolve=o,t.resolveObject=s,t.format=a,t.Url=r;var c=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,d=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["<",">",'"',"`"," ","\r","\n","\t"],v=["{","}","|","\\","^","`"].concat(h),_=["'"].concat(v),p=["%","/","?",";","#"].concat(_),m=["/","?","#"],g=/^[+a-z0-9A-Z_-]{0,63}$/,E=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:!0,"javascript:":!0},S={javascript:!0,"javascript:":!0},T={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=n(657);r.prototype.parse=function(e,t,n){if(!l.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),i=-1!==r&&r<e.indexOf("#")?"?":"#",a=e.split(i),o=/\\/g;a[0]=a[0].replace(o,"/"),e=a.join(i);var s=e;if(s=s.trim(),!n&&1===e.split("#").length){var f=d.exec(s);if(f)return this.path=s,this.href=s,this.pathname=f[1],f[2]?(this.search=f[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=c.exec(s);if(h){h=h[0];var v=h.toLowerCase();this.protocol=v,s=s.substr(h.length)}if(n||h||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var R="//"===s.substr(0,2);!R||h&&S[h]||(s=s.substr(2),this.slashes=!0)}if(!S[h]&&(R||h&&!T[h])){for(var A=-1,D=0;D<m.length;D++){var w=s.indexOf(m[D]);-1!==w&&(-1===A||w<A)&&(A=w)}var O,k;k=-1===A?s.lastIndexOf("@"):s.lastIndexOf("@",A),-1!==k&&(O=s.slice(0,k),s=s.slice(k+1),this.auth=decodeURIComponent(O)),A=-1;for(var D=0;D<p.length;D++){var w=s.indexOf(p[D]);-1!==w&&(-1===A||w<A)&&(A=w)}-1===A&&(A=s.length),this.host=s.slice(0,A),s=s.slice(A),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var L=this.hostname.split(/\./),D=0,P=L.length;D<P;D++){var I=L[D];if(I&&!I.match(g)){for(var M="",N=0,x=I.length;N<x;N++)I.charCodeAt(N)>127?M+="x":M+=I[N];if(!M.match(g)){var F=L.slice(0,D),U=L.slice(D+1),B=I.match(E);B&&(F.push(B[1]),U.unshift(B[2])),U.length&&(s="/"+U.join(".")+s),this.hostname=F.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=u.toASCII(this.hostname));var G=this.port?":"+this.port:"",H=this.hostname||"";this.host=H+G,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!y[v])for(var D=0,P=_.length;D<P;D++){var j=_[D];if(-1!==s.indexOf(j)){var W=encodeURIComponent(j);W===j&&(W=escape(j)),s=s.split(j).join(W)}}var V=s.indexOf("#");-1!==V&&(this.hash=s.substr(V),s=s.slice(0,V));var K=s.indexOf("?");if(-1!==K?(this.search=s.substr(K),this.query=s.substr(K+1),t&&(this.query=b.parse(this.query)),s=s.slice(0,K)):t&&(this.search="",this.query={}),s&&(this.pathname=s),T[v]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var G=this.pathname||"",Y=this.search||"";this.path=G+Y}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,a="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&l.isObject(this.query)&&Object.keys(this.query).length&&(a=b.stringify(this.query));var o=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||T[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),o=o.replace("#","%23"),t+i+n+o+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(l.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,i=Object.keys(this),a=0;a<i.length;a++){var o=i[a];n[o]=this[o]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),u=0;u<s.length;u++){var c=s[u];"protocol"!==c&&(n[c]=e[c])}return T[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!T[e.protocol]){for(var f=Object.keys(e),d=0;d<f.length;d++){var h=f[d];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||S[e.protocol])n.pathname=e.pathname;else{for(var v=(e.pathname||"").split("/");v.length&&!(e.host=v.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==v[0]&&v.unshift(""),v.length<2&&v.unshift(""),n.pathname=v.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var _=n.pathname||"",p=n.search||"";n.path=_+p}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),E=g||m||n.host&&e.pathname,y=E,b=n.pathname&&n.pathname.split("/")||[],v=e.pathname&&e.pathname.split("/")||[],R=n.protocol&&!T[n.protocol];if(R&&(n.hostname="",n.port=null,n.host&&(""===b[0]?b[0]=n.host:b.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===v[0]?v[0]=e.host:v.unshift(e.host)),e.host=null),E=E&&(""===v[0]||""===b[0])),g)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,b=v;else if(v.length)b||(b=[]),b.pop(),b=b.concat(v),n.search=e.search,n.query=e.query;else if(!l.isNullOrUndefined(e.search)){if(R){n.hostname=n.host=b.shift();var A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");A&&(n.auth=A.shift(),n.host=n.hostname=A.shift())}return n.search=e.search,n.query=e.query,l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!b.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var D=b.slice(-1)[0],w=(n.host||e.host||b.length>1)&&("."===D||".."===D)||""===D,O=0,k=b.length;k>=0;k--)D=b[k],"."===D?b.splice(k,1):".."===D?(b.splice(k,1),O++):O&&(b.splice(k,1),O--);if(!E&&!y)for(;O--;O)b.unshift("..");!E||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),w&&"/"!==b.join("/").substr(-1)&&b.push("");var C=""===b[0]||b[0]&&"/"===b[0].charAt(0);if(R){n.hostname=n.host=C?"":b.length?b.shift():"";var A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");A&&(n.auth=A.shift(),n.host=n.hostname=A.shift())}return E=E||n.host&&b.length,E&&!C&&b.unshift(""),b.length?n.pathname=b.join("/"):(n.pathname=null,n.path=null),l.isNull(n.pathname)&&l.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=f.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,r){var i;!function(a){function o(e){throw new RangeError(N[e])}function s(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function u(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(M,"."),r+s(e.split("."),t).join(".")}function l(e){for(var t,n,r=[],i=0,a=e.length;i<a;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<a?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function c(e){return s(e,function(e){var t="";return e>65535&&(e-=65536,t+=U(e>>>10&1023|55296),e=56320|1023&e),t+=U(e)}).join("")}function f(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:R}function d(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function h(e,t,n){var r=0;for(e=n?F(e/O):e>>1,e+=F(e/t);e>x*D>>1;r+=R)e=F(e/x);return F(r+(x+1)*e/(e+w))}function v(e){var t,n,r,i,a,s,u,l,d,v,_=[],p=e.length,m=0,g=C,E=k;for(n=e.lastIndexOf(L),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&o("not-basic"),_.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<p;){for(a=m,s=1,u=R;i>=p&&o("invalid-input"),l=f(e.charCodeAt(i++)),(l>=R||l>F((b-m)/s))&&o("overflow"),m+=l*s,d=u<=E?A:u>=E+D?D:u-E,!(l<d);u+=R)v=R-d,s>F(b/v)&&o("overflow"),s*=v;t=_.length+1,E=h(m-a,t,0==a),F(m/t)>b-g&&o("overflow"),g+=F(m/t),m%=t,_.splice(m++,0,g)}return c(_)}function _(e){var t,n,r,i,a,s,u,c,f,v,_,p,m,g,E,y=[];for(e=l(e),p=e.length,t=C,n=0,a=k,s=0;s<p;++s)(_=e[s])<128&&y.push(U(_));for(r=i=y.length,i&&y.push(L);r<p;){for(u=b,s=0;s<p;++s)(_=e[s])>=t&&_<u&&(u=_);for(m=r+1,u-t>F((b-n)/m)&&o("overflow"),n+=(u-t)*m,t=u,s=0;s<p;++s)if(_=e[s],_<t&&++n>b&&o("overflow"),_==t){for(c=n,f=R;v=f<=a?A:f>=a+D?D:f-a,!(c<v);f+=R)E=c-v,g=R-v,y.push(U(d(v+E%g,0))),c=F(E/g);y.push(U(d(c,0))),a=h(n,m,r==i),n=0,++r}++n,++t}return y.join("")}function p(e){return u(e,function(e){return P.test(e)?v(e.slice(4).toLowerCase()):e})}function m(e){return u(e,function(e){return I.test(e)?"xn--"+_(e):e})}var g="object"==typeof t&&t&&!t.nodeType&&t,E="object"==typeof e&&e&&!e.nodeType&&e,y="object"==typeof r&&r;y.global!==y&&y.window!==y&&y.self!==y||(a=y);var S,T,b=2147483647,R=36,A=1,D=26,w=38,O=700,k=72,C=128,L="-",P=/^xn--/,I=/[^\x20-\x7E]/,M=/[\x2E\u3002\uFF0E\uFF61]/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=R-A,F=Math.floor,U=String.fromCharCode;if(S={version:"1.4.1",ucs2:{decode:l,encode:c},decode:v,encode:_,toASCII:m,toUnicode:p},0)if(g&&E)if(e.exports==g)E.exports=S;else for(T in S)S.hasOwnProperty(T)&&(g[T]=S[T]);else a.punycode=S;else void 0!==(i=function(){return S}.call(t,n,t,e))&&(e.exports=i)}(this)}).call(t,n(655)(e),n(71))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(658),t.encode=t.stringify=n(659)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,a){t=t||"&",n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var u=1e3;a&&"number"==typeof a.maxKeys&&(u=a.maxKeys);var l=e.length;u>0&&l>u&&(l=u);for(var c=0;c<l;++c){var f,d,h,v,_=e[c].replace(s,"%20"),p=_.indexOf(n);p>=0?(f=_.substr(0,p),d=_.substr(p+1)):(f=_,d=""),h=decodeURIComponent(f),v=decodeURIComponent(d),r(o,h)?i(o[h])?o[h].push(v):o[h]=[o[h],v]:o[h]=v}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(o(e),function(o){var s=encodeURIComponent(i(o))+n;return a(e[o])?r(e[o],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[o]))}).join(t):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(e)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";function r(){String.prototype.endsWith=function(e){var t=this.toString();return t.lastIndexOf(e)===t.length-1}}function i(e){return e.endsWith("/")?e:e+"/"}Object.defineProperty(t,"__esModule",{value:!0}),t.polyfillEndsWith=r,t.formatUrl=i,String.prototype.endsWith||r()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){for(var t=[],n=e.getPeerArray(),r=0,i=n.length;r<i;r++){var a=n[r].getDebugInfos();t.push(a)}return t}function a(e,t,n,r){var a=t.conf,o=t.status,s=t.controlStats,l=t.efficiencyStats,h=t.transferStats,v=t.abrStats,_=t.peerStats,p=t.bufferStats,m=t.moduleState,g={backend:{distributor:a.DISTRIBUTOR.URL,klara:a.ANALYTICS.KLARA_URL,signaling:{connected:o.getConnectedToSignalingServer(),url:a.SIGNALING_URL},tracker:{connected:o.getConnected(),url:a.TRACKER_URL}},control:s,efficiency:l,transfer:h,abr:{cdnSpeed:v.cdnSpeed||0,cdnTimestamp:v.cdnTimestamp||0,p2pSpeed:v.p2pSpeed,p2pUsefulEstimate:v.p2pUsefulEstimate,concurrentP2pDownloaded:v.concurrentP2pDownloaded,concurrentP2pDownloadCount:v.concurrentP2pDownloadCount,cdnEstimationCount:v.cdnEstimationCount,zeroP2pSpeedWindowsCount:v.zeroP2pSpeedWindowsCount,p2pSpeedWindowsCount:v.p2pSpeedWindowsCount,bandwidthEstimateCV:v.bandwidthEstimateCV,feedbackCount:v.feebackCount,zeroDurationFeedbackCount:v.zeroDurationFeedbackCount,latencyHistoricalValue:v.latencyHistoricalValue,currentTracks:{video:m.currentTracks.video?m.currentTracks.video.viewToString():void 0,audio:m.currentTracks.audio?m.currentTracks.audio.viewToString():void 0},nextSegmentPrebuffered:m.nextSegmentPrebuffered},peerId:o.getMyPeerId(),peers:{info:(0,u.default)({},_,{peerPoolUploadCapacity:void 0,successPeerConnectionAttemptDuration:void 0,failedPeerConnectionAttemptDuration:void 0,locked:void 0,loosers:void 0,dataChannelBufferEmptyingStats:void 0,_statsProvider:void 0}),pending:e?e.getPendingConnectionDebugInfos():[],connected:e?i(e):[]}};return p&&(g.buffer={buffered:p.bufferedAmount},n&&(g.buffer.alwaysDynamicBuffer=p.alwaysDynamicBuffer,g.buffer.bufferRefill=p.bufferRefill,g.buffer.reachedLiveEdge=n._reachedLiveEdge,g.buffer.target=n.bufferTarget,g.buffer.bufferState=p.bufferState,g.buffer.dynamicLowerTargetEnabled=n._enableDynamicLowerTarget,g.buffer.currentLowerTarget=n._currentLowerBufferTarget,g.buffer.lowerBufferTargetNetChangePerRebound=p.lowerBufferTargetNetChangePerRebound,g.buffer.bufferStatus=n._bufferStatus,g.buffer.lowerTargetResetCount=p.lowerTargetResetCount)),d?g.qos=d.getQoSAnalytics():d=new c.default(r.mediaElement,f.createInterval),g}function o(e,t,n,r){var i=t.transferStats,o=i.cdnDownloaded,s=i.p2pUseful,u=i.p2pUploaded,l=e?e.getPeerArray().length:0,c={cdn:o,p2p:s,peers:l,upload:u,confLabel:""};if(1||(c.advanced=a(e,t,n,r)),t.conf.ANALYTICS.EXPOSE_CONF_LABEL){var f=t.conf.QOS_P2P_DISABLED?"off":"on";c.confLabel=t.conf.CONF_LABEL+"|"+f}return c}Object.defineProperty(t,"__esModule",{value:!0});var s=n(662),u=r(s),l=n(254),c=r(l),f=n(15),d=null;t.default={get:o},e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var r=n(69),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._mediaElement=null}return(0,s.default)(e,[{key:"mediaElement",get:function(){return this._mediaElement},set:function(e){this._mediaElement=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.conf.DISTRIBUTOR.URL,n=e.conf.ID_CLIENT,r=e.moduleState.content,i="4.10.14",a=t+"?customer="+n+"&content="+r+"&version="+i,s={timeout:e.conf.DISTRIBUTOR.TIMEOUT_DELAY,retry:e.conf.DISTRIBUTOR.MAX_RETRY},l=new o.default(o.default.Methods.GET,a,s);e.controlStats.sentDistributorRootCount++,l.isStreamroot=!0,l.send().then(function(t){e.injectConfigFromDistributor(t),e.eventBus.emit(c.default.Distributor.READY,!0)}).catch(function(t){e.conf.DISTRIBUTOR.OVERRIDDEN||(e.setBackendFallbackUrls(),e.eventBus.emit(c.default.Distributor.READY,!1)),u.default.notifyError(new Error("Could not connect to distributor: "+t.message+". Status: "+t.status))})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(93),o=r(a),s=n(10),u=r(s),l=n(4),c=r(l);t.default={connect:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){window.Streamroot=window.Streamroot||{},window.Streamroot.Downloader=window.Streamroot.Downloader||e,window.Streamroot.peerAgents=window.Streamroot.peerAgents||{},window.Streamroot.uaHelper=c.default,Object.defineProperty(window.Streamroot,"p2pAvailable",{get:function(){var e=(0,u.default)(window.Streamroot.peerAgents);return e.length?window.Streamroot.peerAgents[e[0]].isP2PEnabled:(0,f.isP2PAvailable)()}})}function a(e,t){window.Streamroot.peerAgents&&(window.Streamroot.peerAgents[e]=t.PublicAPI)}function o(e){window.Streamroot.peerAgents[e]&&delete window.Streamroot.peerAgents[e]}Object.defineProperty(t,"__esModule",{value:!0});var s=n(172),u=r(s),l=n(152),c=r(l),f=n(266);t.default={setup:i,addToPeerAgentList:a,removeFromPeerAgentList:o},e.exports=t.default},function(e,t,n){"use strict";function r(e){var t=e.version,n={version:t,get isP2PEnabled(){return e.isP2PEnabled},get stats(){return e.stats},get p2pDownloadOn(){return e.p2pDownloadOn},set p2pDownloadOn(t){e.p2pDownloadOn=t},get p2pUploadOn(){return e.p2pUploadOn},set p2pUploadOn(t){e.p2pUploadOn=t}};return 1||Object.defineProperty(n,"internals",{get:function(){return e.internals}}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.default={get:r},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"init",value:function(e,t){this._p2pCache=e,this._scheduler=t}},{key:"getStats",value:function(){var e=this._scheduler.getEdgeSegment();if(e){var t=e.getId(),n=this._p2pCache.getSegmentsStats(),r=n.minSegmentId,i=n.maxSegmentId;return{min:r||t,max:i||t,current:t}}return null}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=new o.default(e.conf.BITRATE_ESTIMATION_WINDOW);e.eventBus.on(u.default.SRModuleInterface.ABR_FEEDBACK,function(){t.push(e.transferStats.p2pConsumed+e.transferStats.cdnConsumed);var n=t.delta,r=t.timeDelta;n&&r&&(e.abrStats.estimatedBitrate=8*n/r)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var a=n(178),o=r(a),s=n(4),u=r(s);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=n(670),l=r(u),c=n(124),f=n(671),d=r(f),h=function(){function e(t,n){(0,a.default)(this,e),this._externalEventManager=t,this._externalEventManager.cacheMediaEvent(d.default.TRACK_CHANGE_EVENT),this._sharedState=n}return(0,s.default)(e,[{key:"listenEvents",value:function(e){var t=this._updateCurrentTracks.bind(this),n=this._onFragLoadAborted.bind(this);this._externalEventManager.addMediaEventListener(d.default.TRACK_CHANGE_EVENT,t),this._externalEventManager.addMediaEventListener(d.default.EMERGENCY_FRAG_LOAD_ABORT,n);try{this._externalEventManager.triggerCachedEvent(d.default.TRACK_CHANGE_EVENT,t)}catch(t){if(!e)throw t}}},{key:"_onFragLoadAborted",value:function(){this._sharedState.mediaStats.emergencyTrackSwitchCount++}},{key:"_updateCurrentTracks",value:function(e){var t=e.audio,n=e.video;t&&(0,c.checkInterface)(l.default,t),n&&(0,c.checkInterface)(l.default,n),this._sharedState.moduleState.currentTracks.update({audio:t,video:n})}},{key:"updateWithSegmentView",value:function(e){var t={};t[e.trackView.type]=e.trackView,this._updateCurrentTracks(t)}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),o=n(2),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"viewToString",value:function(){return""}},{key:"isEqual",value:function(e){return!0}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";e.exports={TRACK_CHANGE_EVENT:"onTrackChange",EMERGENCY_FRAG_LOAD_ABORT:"onEmergencyFragLoadAborted"}},function(e,t,n){"use strict";function r(e){var t=!1;e.eventBus.on(a.default.BufferedAmountObserver.BUFFER_CHECK,function(n){n<=e.conf.BUFFER_ZERO_THRESHOLD?t=!1:!t&&n>e.conf.VOD_CRITICAL_BUFFER_THRESHOLD&&(t=!0),t&&n<e.conf.VOD_CRITICAL_BUFFER_THRESHOLD?e.blockP2PDownload(e.conf.VOD_CRITICAL_BUFFER_P2P_STOP_DURATION):n>e.conf.VOD_SAFE_BUFFER_THRESHOLD&&e.unblockP2PDownload()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var i=n(4),a=function(e){return e&&e.__esModule?e:{default:e}}(i);e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e="/Users/jlouazel/Streamroot/panama/lib/MediaElement.js",t="5eb0f3d64e3be5264f9a21d090c53fd37001d2c4",n=new Function("return this")(),r="__coverage__",i={path:"/Users/jlouazel/Streamroot/panama/lib/MediaElement.js",statementMap:{0:{start:{line:5,column:4},end:{line:5,column:29}},1:{start:{line:9,column:4},end:{line:9,column:34}},2:{start:{line:13,column:4},end:{line:13,column:24}},3:{start:{line:17,column:4},end:{line:17,column:33}},4:{start:{line:21,column:4},end:{line:21,column:25}},5:{start:{line:25,column:4},end:{line:25,column:34}},6:{start:{line:29,column:4},end:{line:29,column:26}},7:{start:{line:33,column:4},end:{line:33,column:31}},8:{start:{line:37,column:4},end:{line:37,column:26}},9:{start:{line:41,column:4},end:{line:41,column:47}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:4,column:2},end:{line:4,column:3}},loc:{start:{line:4,column:24},end:{line:6,column:3}},line:4},1:{name:"(anonymous_1)",decl:{start:{line:8,column:2},end:{line:8,column:3}},loc:{start:{line:8,column:20},end:{line:10,column:3}},line:8},2:{name:"(anonymous_2)",decl:{start:{line:12,column:2},end:{line:12,column:3}},loc:{start:{line:12,column:19},end:{line:14,column:3}},line:12},3:{name:"(anonymous_3)",decl:{start:{line:16,column:2},end:{line:16,column:3}},loc:{start:{line:16,column:15},end:{line:18,column:3}},line:16},4:{name:"(anonymous_4)",decl:{start:{line:20,column:2},end:{line:20,column:3}},loc:{start:{line:20,column:20},end:{line:22,column:3}},line:20},5:{name:"(anonymous_5)",decl:{start:{line:24,column:2},end:{line:24,column:3}},loc:{start:{line:24,column:16},end:{line:26,column:3}},line:24},6:{name:"(anonymous_6)",decl:{start:{line:28,column:2},end:{line:28,column:3}},loc:{start:{line:28,column:21},end:{line:30,column:3}},line:28},7:{name:"(anonymous_7)",decl:{start:{line:32,column:2},end:{line:32,column:3}},loc:{start:{line:32,column:17},end:{line:34,column:3}},line:32},8:{name:"(anonymous_8)",decl:{start:{line:36,column:2},end:{line:36,column:3}},loc:{start:{line:36,column:17},end:{line:38,column:3}},line:36},9:{name:"(anonymous_9)",decl:{start:{line:40,column:2},end:{line:40,column:3}},loc:{start:{line:40,column:28},end:{line:42,column:3}},line:40}},branchMap:{0:{loc:{start:{line:9,column:11},end:{line:9,column:33}},type:"binary-expr",locations:[{start:{line:9,column:11},end:{line:9,column:28}},{start:{line:9,column:32},end:{line:9,column:33}}],line:9},1:{loc:{start:{line:17,column:11},end:{line:17,column:32}},type:"binary-expr",locations:[{start:{line:17,column:11},end:{line:17,column:23}},{start:{line:17,column:27},end:{line:17,column:32}}],line:17},2:{loc:{start:{line:25,column:11},end:{line:25,column:33}},type:"binary-expr",locations:[{start:{line:25,column:11},end:{line:25,column:24}},{start:{line:25,column:28},end:{line:25,column:33}}],line:25},3:{loc:{start:{line:33,column:11},end:{line:33,column:30}},type:"binary-expr",locations:[{start:{line:33,column:11},end:{line:33,column:25}},{start:{line:33,column:29},end:{line:33,column:30}}],line:33}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(674),s=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(){function e(){r(this,e)}return a(e,[{key:"updateBuffered",value:function(e){i.f[9]++,i.s[9]++,this._buffered=new s.default(e)}},{key:"currentTime",set:function(e){i.f[0]++,i.s[0]++,this._currentTime=e},get:function(){return i.f[1]++,i.s[1]++,i.b[0][0]++,this._currentTime||(i.b[0][1]++,0)}},{key:"paused",set:function(e){i.f[2]++,i.s[2]++,this._paused=e},get:function(){return i.f[3]++,i.s[3]++,i.b[1][0]++,this._paused||(i.b[1][1]++,!1)}},{key:"seeking",set:function(e){i.f[4]++,i.s[4]++,this._seeking=e},get:function(){return i.f[5]++,i.s[5]++,i.b[2][0]++,this._seeking||(i.b[2][1]++,!1)}},{key:"duration",set:function(e){i.f[6]++,i.s[6]++,this._duration=e},get:function(){return i.f[7]++,i.s[7]++,i.b[3][0]++,this._duration||(i.b[3][1]++,0)}},{key:"buffered",get:function(){return i.f[8]++,i.s[8]++,this._buffered}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e="/Users/jlouazel/Streamroot/panama/lib/TimeRanges.js",t="21c5e03cc779cf542e9c7aa80892d6c3bc777e26",n=new Function("return this")(),r="__coverage__",i={path:"/Users/jlouazel/Streamroot/panama/lib/TimeRanges.js",statementMap:{0:{start:{line:1,column:24},end:{line:1,column:27}},1:{start:{line:2,column:24},end:{line:2,column:27}},2:{start:{line:4,column:20},end:{line:4,column:36}},3:{start:{line:8,column:4},end:{line:8,column:22}},4:{start:{line:10,column:19},end:{line:11,column:43}},5:{start:{line:13,column:4},end:{line:22,column:5}},6:{start:{line:14,column:20},end:{line:14,column:29}},7:{start:{line:17,column:10},end:{line:17,column:38}},8:{start:{line:19,column:6},end:{line:21,column:7}},9:{start:{line:20,column:8},end:{line:20,column:78}},10:{start:{line:26,column:4},end:{line:28,column:5}},11:{start:{line:27,column:6},end:{line:27,column:35}},12:{start:{line:30,column:4},end:{line:30,column:37}},13:{start:{line:34,column:4},end:{line:36,column:5}},14:{start:{line:35,column:6},end:{line:35,column:35}},15:{start:{line:38,column:4},end:{line:38,column:35}},16:{start:{line:42,column:4},end:{line:42,column:31}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:7,column:2},end:{line:7,column:3}},loc:{start:{line:7,column:25},end:{line:23,column:3}},line:7},1:{name:"(anonymous_1)",decl:{start:{line:25,column:2},end:{line:25,column:3}},loc:{start:{line:25,column:15},end:{line:31,column:3}},line:25},2:{name:"(anonymous_2)",decl:{start:{line:33,column:2},end:{line:33,column:3}},loc:{start:{line:33,column:13},end:{line:39,column:3}},line:33},3:{name:"(anonymous_3)",decl:{start:{line:41,column:2},end:{line:41,column:3}},loc:{start:{line:41,column:15},end:{line:43,column:3}},line:41}},branchMap:{0:{loc:{start:{line:10,column:19},end:{line:11,column:43}},type:"cond-expr",locations:[{start:{line:11,column:6},end:{line:11,column:38}},{start:{line:11,column:41},end:{line:11,column:43}}],line:10},1:{loc:{start:{line:19,column:6},end:{line:21,column:7}},type:"if",locations:[{start:{line:19,column:6},end:{line:21,column:7}},{start:{line:19,column:6},end:{line:21,column:7}}],line:19},2:{loc:{start:{line:19,column:10},end:{line:19,column:22}},type:"binary-expr",locations:[{start:{line:19,column:10},end:{line:19,column:15}},{start:{line:19,column:19},end:{line:19,column:22}}],line:19},3:{loc:{start:{line:26,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:26,column:4},end:{line:28,column:5}},{start:{line:26,column:4},end:{line:28,column:5}}],line:26},4:{loc:{start:{line:26,column:8},end:{line:26,column:49}},type:"binary-expr",locations:[{start:{line:26,column:8},end:{line:26,column:17}},{start:{line:26,column:21},end:{line:26,column:49}}],line:26},5:{loc:{start:{line:34,column:4},end:{line:36,column:5}},type:"if",locations:[{start:{line:34,column:4},end:{line:36,column:5}},{start:{line:34,column:4},end:{line:36,column:5}}],line:34},6:{loc:{start:{line:34,column:8},end:{line:34,column:49}},type:"binary-expr",locations:[{start:{line:34,column:8},end:{line:34,column:17}},{start:{line:34,column:21},end:{line:34,column:49}}],line:34}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),a=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(i.s[0]++,","),u=(i.s[1]++,"-"),l=(i.s[2]++,"INDEX_SIZE_ERR"),c=function(){function e(t){r(this,e),i.f[0]++,i.s[3]++,this._ranges=[];var n=(i.s[4]++,t?(i.b[0][0]++,t.split(s)):(i.b[0][1]++,[]));i.s[5]++;for(var o=0,l=n.length;o<l;o++){var c=(i.s[6]++,n[o]),f=(i.s[7]++,c.split(u)),d=a(f,2),h=d[0],v=d[1];i.s[8]++,i.b[2][0]++,h&&(i.b[2][1]++,v)?(i.b[1][0]++,i.s[9]++,this._ranges.push({start:parseFloat(h),end:parseFloat(v)})):i.b[1][1]++}}return o(e,[{key:"start",value:function(e){if(i.f[1]++,i.s[10]++,i.b[4][0]++,e<0||(i.b[4][1]++,e>=this._ranges.length))throw i.b[3][0]++,i.s[11]++,new Error(l);return i.b[3][1]++,i.s[12]++,this._ranges[e].start}},{key:"end",value:function(e){if(i.f[2]++,i.s[13]++,i.b[6][0]++,e<0||(i.b[6][1]++,e>=this._ranges.length))throw i.b[5][0]++,i.s[14]++,new Error(l);return i.b[5][1]++,i.s[15]++,this._ranges[e].end}},{key:"length",get:function(){return i.f[3]++,i.s[16]++,this._ranges.length}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){var e="/Users/jlouazel/Streamroot/panama/lib/PlayerInterface.js",t="abc567caa311d670657814bdcb6d47ddf22282a6",n=new Function("return this")(),r="__coverage__",i={path:"/Users/jlouazel/Streamroot/panama/lib/PlayerInterface.js",statementMap:{0:{start:{line:8,column:4},end:{line:8,column:12}},1:{start:{line:10,column:4},end:{line:10,column:19}},2:{start:{line:11,column:4},end:{line:11,column:49}},3:{start:{line:13,column:4},end:{line:13,column:67}},4:{start:{line:15,column:4},end:{line:17,column:7}},5:{start:{line:16,column:6},end:{line:16,column:29}},6:{start:{line:21,column:18},end:{line:21,column:28}},7:{start:{line:22,column:18},end:{line:22,column:46}},8:{start:{line:23,column:4},end:{line:25,column:7}},9:{start:{line:29,column:4},end:{line:31,column:5}},10:{start:{line:30,column:6},end:{line:30,column:77}},11:{start:{line:34,column:4},end:{line:38,column:5}},12:{start:{line:35,column:6},end:{line:37,column:7}},13:{start:{line:36,column:8},end:{line:36,column:36}},14:{start:{line:40,column:4},end:{line:40,column:73}},15:{start:{line:45,column:4},end:{line:45,column:14}},16:{start:{line:49,column:4},end:{line:49,column:44}},17:{start:{line:53,column:4},end:{line:53,column:33}},18:{start:{line:57,column:4},end:{line:57,column:45}},19:{start:{line:61,column:4},end:{line:61,column:66}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:7,column:2},end:{line:7,column:3}},loc:{start:{line:7,column:39},end:{line:18,column:3}},line:7},1:{name:"(anonymous_1)",decl:{start:{line:15,column:41},end:{line:15,column:42}},loc:{start:{line:15,column:58},end:{line:17,column:5}},line:15},2:{name:"(anonymous_2)",decl:{start:{line:20,column:2},end:{line:20,column:3}},loc:{start:{line:20,column:20},end:{line:26,column:3}},line:20},3:{name:"(anonymous_3)",decl:{start:{line:28,column:2},end:{line:28,column:3}},loc:{start:{line:28,column:11},end:{line:41,column:3}},line:28},4:{name:"(anonymous_4)",decl:{start:{line:44,column:2},end:{line:44,column:3}},loc:{start:{line:44,column:22},end:{line:46,column:3}},line:44},5:{name:"(anonymous_5)",decl:{start:{line:48,column:2},end:{line:48,column:3}},loc:{start:{line:48,column:35},end:{line:50,column:3}},line:48},6:{name:"(anonymous_6)",decl:{start:{line:52,column:2},end:{line:52,column:3}},loc:{start:{line:52,column:40},end:{line:54,column:3}},line:52},7:{name:"(anonymous_7)",decl:{start:{line:56,column:2},end:{line:56,column:3}},loc:{start:{line:56,column:43},end:{line:58,column:3}},line:56},8:{name:"(anonymous_8)",decl:{start:{line:60,column:2},end:{line:60,column:3}},loc:{start:{line:60,column:58},end:{line:62,column:3}},line:60}},branchMap:{0:{loc:{start:{line:13,column:31},end:{line:13,column:66}},type:"binary-expr",locations:[{start:{line:13,column:31},end:{line:13,column:60}},{start:{line:13,column:64},end:{line:13,column:66}}],line:13},1:{loc:{start:{line:29,column:4},end:{line:31,column:5}},type:"if",locations:[{start:{line:29,column:4},end:{line:31,column:5}},{start:{line:29,column:4},end:{line:31,column:5}}],line:29},2:{loc:{start:{line:35,column:6},end:{line:37,column:7}},type:"if",locations:[{start:{line:35,column:6},end:{line:37,column:7}},{start:{line:35,column:6},end:{line:37,column:7}}],line:35}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},b:{0:[0,0],1:[0,0],2:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(676),c=r(l),f=n(677),d=r(f),h=n(120),v=r(h),_=n(678),p=r(_),m=function(e){function t(e,n,r){i(this,t),s.f[0]++,s.s[0]++;var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s.s[1]++,o.hls=e,s.s[2]++,o._handler=new p.default(r),s.s[3]++,o.liveMinBufferMargin=(s.b[0][0]++,n.liveMinBufferMargin||(s.b[0][1]++,10)),s.s[4]++,o.hls.on(c.default.Events.LEVEL_SWITCH,function(e,t){s.f[1]++,s.s[5]++,o.levelSwitch(t)}),o}return o(t,e),u(t,[{key:"levelSwitch",value:function(e){s.f[2]++;var t=(s.s[6]++,e.level),n=(s.s[7]++,this.hls.levels[t].urlId);s.s[8]++,this.emit("onTrackChange",{video:new v.default({level:t,urlId:n})})}},{key:"isLive",value:function(){if(s.f[3]++,s.s[9]++,!this.hls.levels)throw s.b[1][0]++,s.s[10]++,new Error("Called isLive before the master playlist was parsed");s.b[1][1]++,s.s[11]++;var e=!0,t=!1,n=void 0;try{for(var r,i=this.hls.levels[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;if(s.s[12]++,a.details)return s.b[2][0]++,s.s[13]++,!!a.details.live;s.b[2][1]++}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}throw s.s[14]++,new Error("Called isLive before any levelplaylist was parsed")}},{key:"getBufferLevelMax",value:function(){return s.f[4]++,s.s[15]++,30}},{key:"setBufferMarginLive",value:function(e){s.f[5]++,s.s[16]++,this._handler.bufferLevel=e}},{key:"addEventListener",value:function(e,t){s.f[6]++,s.s[17]++,this.on(e,t)}},{key:"removeEventListener",value:function(e,t){s.f[7]++,s.s[18]++,this.removeListener(e,t)}},{key:"truncateManifest",value:function(e,t,n,r){s.f[8]++,s.s[19]++,this._handler.truncate(e,t,n,r)}}]),t}(d.default);t.default=m,e.exports=t.default},function(e,t,n){var r,r;!function(t){if(0)if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.Hls=t()}else e.exports=t()}(function(){var e;return function e(t,n,i){function a(s,u){if(!n[s]){if(!t[s]){var l="function"==typeof r&&r;if(!u&&l)return r(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return a(n||e)},f,f.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function a(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),r=l.length,u=0;u<r;u++)l[u].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,n,r){!function(t){var i=/^([^#]*)(.*)$/,a=/^([^\?]*)(.*)$/,o=/^(([a-z]+:\/\/)?[^:\/]+(?::[0-9]+)?)?(\/?.*)$/i,s={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var n=null,r=null,u=i.exec(t);u&&(r=u[2],t=u[1]);var l=a.exec(t);l&&(n=l[2],t=l[1]);var c=i.exec(e);c&&(e=c[1]);var f=a.exec(e);f&&(e=f[1]);var d=o.exec(e);if(!d)throw new Error("Error trying to parse base URL.");var h=d[2]||"",v=d[1]||"",_=d[3];0!==_.indexOf("/")&&""!==v&&(_="/"+_);var p=null;return p=/^\/\//.test(t)?h+s.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?v+"/"+s.buildAbsolutePath("",t.substring(1)):s.buildAbsolutePath(v+_,t),n&&(p+=n),r&&(p+=r),p},buildAbsolutePath:function(e,t){for(var n,r,i=t,a="",o=e.replace(/[^\/]*$/,i.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),s=0;(r=o.indexOf("/../",s))>-1;s=r+n)n=/^\/(?:\.\.\/)*/.exec(o.slice(r))[0].length,a=(a+o.substring(s,r)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(n-1)/3+"}$"),"/");return a+o.substr(s)}};"object"==typeof r&&"object"==typeof n?n.exports=s:"function"==typeof e&&e.amd?e([],function(){return s}):"object"==typeof r?r.URLToolkit=s:t.URLToolkit=s}(this)},{}],3:[function(e,t,n){var r=arguments[3],i=arguments[4],a=arguments[5],o=JSON.stringify;t.exports=function(e,t){function n(e){p[e]=!0;for(var t in i[e][1]){var r=i[e][1][t];p[r]||n(r)}}for(var s,u=Object.keys(a),l=0,c=u.length;l<c;l++){var f=u[l],d=a[f].exports;if(d===e||d&&d.default===e){s=f;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},l=0,c=u.length;l<c;l++){var f=u[l];h[f]=f}i[s]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),_={};_[s]=s,i[v]=[Function(["require"],"var f = require("+o(s)+");"+"(f.default ? f.default : f)(self);"),_];var p={};n(v);var m="("+r+")({"+Object.keys(p).map(function(e){return o(e)+":["+i[e][0]+","+o(i[e][1])+"]"}).join(",")+"},{},["+o(v)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return E;var y=g.createObjectURL(E),S=new Worker(y);return S.objectURL=y,S}},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(30),h=r(d),v=e(26),_=e(45),p=e(9),m=r(p),g=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.FRAG_LOADING,l.default.FRAG_LOADED,l.default.FRAG_BUFFERED,l.default.ERROR));return n.lastLoadedFragLevel=0,n._autoLevelCapping=-1,n._nextAutoLevel=-1,n.hls=e,n.onCheck=n.abandonRulesCheck.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.clearTimer(),f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var n=this.hls,r=e.frag.level,i=n.levels[r].details.live,a=n.config,o=void 0,s=void 0;i?(o=a.abrEwmaFastLive,s=a.abrEwmaSlowLive):(o=a.abrEwmaFastVoD,s=a.abrEwmaSlowVoD),this.bwEstimator=new m.default(n,s,o,a.abrEwmaDefaultEstimate)}this.fragCurrent=t}}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,n=this.fragCurrent,r=n.loader,i=this.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return _.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var a=r.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var o=performance.now()-a.trequest,s=Math.abs(t.playbackRate);if(o>500*n.duration/s){var u=e.levels,c=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/o),f=u[n.level],d=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,v=a.total?a.total:Math.max(a.loaded,Math.round(n.duration*d/8)),p=t.currentTime,m=(v-a.loaded)/c,g=(h.default.bufferInfo(t,p,e.config.maxBufferHole).end-p)/s;if(g<2*n.duration/s&&m>g){var E=void 0,y=void 0;for(y=n.level-1;y>i;y--){var S=u[y].realBitrate?Math.max(u[y].realBitrate,u[y].bitrate):u[y].bitrate;if((E=n.duration*S/(8*.8*c))<g)break}E<m&&(_.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+E.toFixed(1)+"<"+m.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=y,this.bwEstimator.sample(o,a.loaded),r.abort(),this.clearTimer(),e.trigger(l.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:a}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type){this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1;var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;if(n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i),e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&1===n.loadCounter&&"main"===n.type&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;_.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this.bwEstimator.sample(r,t.loaded),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(e,t,n,r,i,a,o,s,u){for(var l=i;l>=r;l--){var c=u[l],f=c.details,d=f?f.totalduration/f.fragments.length:t,h=!!f&&f.live,v=void 0;v=l<=e?o*n:s*n;var p=u[l].realBitrate?Math.max(u[l].realBitrate,u[l].bitrate):u[l].bitrate,m=p*d/v;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(v)+"/"+p+"/"+d+"/"+a+"/"+m),v>p&&(!m||h||m<a))return l}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator,n=this.hls,r=n.levels,i=n.config.minAutoBitrate;if(!(-1===e||t&&t.canEstimate()))return Math.min(e,this.maxAutoLevel);var a=this.nextABRAutoLevel;if(-1!==e&&(a=Math.min(e,a)),void 0!==i)for(var o=r[a].realBitrate?Math.max(r[a].realBitrate,r[a].bitrate):r[a].bitrate;o<i;)a++;return a},set:function(e){this._nextAutoLevel=e}},{key:"minAutoLevel",get:function(){for(var e=this.hls,t=e.levels,n=e.config.minAutoBitrate,r=t?t.length:0,i=0;i<r;i++){if((t[i].realBitrate?Math.max(t[i].realBitrate,t[i].bitrate):t[i].bitrate)>n)return i}return 0}},{key:"maxAutoLevel",get:function(){var e=this.hls.levels,t=this._autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextABRAutoLevel",get:function(){var e=this.hls,t=this.maxAutoLevel,n=e.levels,r=e.config,i=this.minAutoLevel,a=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,u=a?a.currentTime:0,l=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,f=(h.default.bufferInfo(a,u,r.maxBufferHole).end-u)/l,d=this.findBestLevel(o,s,c,i,t,f,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(d>=0)return d;_.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===f){var g=this.bitrateTestDelay;if(g){v=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-g,_.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),p=m=1}}return d=this.findBestLevel(o,s,c,i,t,f+v,p,m,n),Math.max(d,0)}}]),t}(f.default);n.default=g},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(41),c=r(l),f=e(30),d=r(f),h=e(22),v=r(h),_=e(28),p=r(_),m=e(27),g=r(m),E=e(31),y=r(E),S=e(46),T=r(S),b=e(26),R=e(45),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},D=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.AUDIO_TRACKS_UPDATED,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED,p.default.INIT_PTS_FOUND));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=A.STOPPED,n.ontick=n.tick.bind(n),n.initPTS=[],n.waitingFragment=null,n}return o(t,e),u(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),g.default.prototype.destroy.call(this),this.state=A.STOPPED}},{key:"onInitPtsFound",value:function(e){var t=e.id,n=e.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,R.logger.log("InitPTS for cc:"+n+" found from video track:"+r),this.state===A.WAITING_INIT_PTS&&(R.logger.log("sending pending audio frag to demuxer"),this.state=A.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&-1===e?(R.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,n,r,i,a,o=this,u=this.hls,l=u.config,f=function(){switch(o.state){case A.ERROR:case A.PAUSED:case A.BUFFER_FLUSHING:break;case A.STARTING:o.state=A.WAITING_TRACK,o.loadedmetadata=!1;break;case A.IDLE:var s=o.tracks;if(!s)break;if(!o.media&&(o.startFragRequested||!l.startFragPrefetch))break;e=o.loadedmetadata?o.media.currentTime:o.nextLoadPosition;var f=o.mediaBuffer?o.mediaBuffer:o.media,h=d.default.bufferInfo(f,e,l.maxBufferHole),v=h.len,_=h.end,m=o.fragPrevious,g=l.maxMaxBufferLength,E=o.audioSwitch,y=o.trackId;if(v<g&&y<s.length){if(void 0===(n=s[y].details)){o.state=A.WAITING_TRACK;break}if(!E&&!n.live&&m&&m.sn===n.endSN&&(!o.media.seeking||o.media.duration-_<m.duration/2)){o.hls.trigger(p.default.BUFFER_EOS,{type:"audio"}),o.state=A.ENDED;break}var S=n.fragments,T=S.length,D=S[0].start,w=S[T-1].start+S[T-1].duration,O=void 0;if(E)if(n.live&&!n.PTSKnown)R.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),_=0;else if(_=e,n.PTSKnown&&e<D){if(!(h.end>D||h.nextStart))return{v:void 0};R.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),o.media.currentTime=D+.05}if(_<=D){if(O=S[0],n.live&&O.loadIdx&&O.loadIdx===o.fragLoadIdx){var k=h.nextStart?h.nextStart:D;return R.logger.log("no alt audio available @currentTime:"+o.media.currentTime+", seeking @"+(k+.05)),o.media.currentTime=k+.05,{v:void 0}}}else!function(){var e=void 0,t=l.maxFragLookUpTolerance;_<w?(_>w-t&&(t=0),(e=c.default.search(S,function(e){return e.start+e.duration-t<=_?1:e.start-t>_?-1:0}))||R.logger.log("frag not found @bufferEnd/start:"+_+"/"+D)):e=S[T-1],e&&(O=e,D=e.start,m&&O.level===m.level&&O.sn===m.sn&&(O.sn<n.endSN?(O=S[O.sn+1-n.startSN],R.logger.log("SN just loaded, load next one: "+O.sn)):O=null))}();if(O)if(null!=O.decryptdata.uri&&null==O.decryptdata.key)R.logger.log("Loading key for "+O.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+y),o.state=A.KEY_LOADING,u.trigger(p.default.KEY_LOADING,{frag:O});else{if(R.logger.log("Loading "+O.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+y+", currentTime:"+e+",bufferEnd:"+_.toFixed(3)),void 0!==o.fragLoadIdx?o.fragLoadIdx++:o.fragLoadIdx=0,O.loadCounter){O.loadCounter++;var C=l.fragLoadingLoopThreshold;if(O.loadCounter>C&&Math.abs(o.fragLoadIdx-O.loadIdx)<C)return u.trigger(p.default.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:O}),{v:void 0}}else O.loadCounter=1;O.loadIdx=o.fragLoadIdx,o.fragCurrent=O,o.startFragRequested=!0,o.nextLoadPosition=O.start+O.duration,u.trigger(p.default.FRAG_LOADING,{frag:O}),o.state=A.FRAG_LOADING}}break;case A.WAITING_TRACK:t=o.tracks[o.trackId],t&&t.details&&(o.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:r=performance.now(),i=o.retryDate,f=o.media,a=f&&f.seeking,(!i||r>=i||a)&&(R.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),o.state=A.IDLE);break;case A.WAITING_INIT_PTS:case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}}();if("object"===(void 0===f?"undefined":s(f)))return f.v}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(R.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===A.ENDED&&(this.state=A.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){R.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.state=A.IDLE,this.fragCurrent=null,this.state=A.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=A.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,n=e.id,r=this.tracks[n],i=t.totalduration,a=0;if(R.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var o=r.details;o&&t.fragments.length>0?(y.default.mergeDetails(o,t),a=t.fragments[0].start,t.PTSKnown?R.logger.log("live audio playlist sliding:"+a.toFixed(3)):R.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,R.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;isNaN(s)?this.startPosition=0:(R.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s)}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_TRACK&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&"audio"===e.frag.type&&e.frag.level===t.level&&e.frag.sn===t.sn){this.state=A.PARSING,this.stats=e.stats;var n=this.tracks[this.trackId],r=n.details,i=r.totalduration,a=t.start,o=t.level,s=t.sn,u=t.cc,l=this.config.defaultAudioCodec||n.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new v.default(this.hls,"audio"));var c=this.initPTS[u];if(void 0!==c){this.pendingBuffering=!0,R.logger.log("Demuxing "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o);this.demuxer.push(e.payload,l,null,a,u,o,s,i,t.decryptdata,!1,c)}else R.logger.log("unknown video PTS for continuity counter "+u+", waiting for video PTS before demuxing audio frag "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o),this.waitingFragment=e,this.state=A.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING){var n=e.tracks,r=void 0;if(n.video&&delete n.video,r=n.audio){r.levelCodec="mp4a.40.2",r.id=e.id,this.hls.trigger(p.default.BUFFER_CODECS,n),R.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var i=r.initSegment;if(i){var a={type:"audio",data:i,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,a))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;n&&"audio"===e.id&&"audio"===e.type&&e.sn===n.sn&&e.level===n.level&&this.state===A.PARSING&&function(){var n=t.trackId,r=t.tracks[n],i=t.fragCurrent,a=t.hls;R.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),y.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS);var o=t.audioSwitch,s=t.media,u=!1;if(o&&s)if(s.readyState){var l=s.currentTime;R.logger.log("switching audio track : currentTime:"+l),l>=e.startPTS&&(R.logger.log("switching audio track : flushing all audio"),t.state=A.BUFFER_FLUSHING,a.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u=!0,t.audioSwitch=!1,a.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:n}))}else t.audioSwitch=!1,a.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:n});var c=t.pendingData;t.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&c.push({type:e.type,data:t,parent:"audio",content:"data"})}),!u&&c.length&&(c.forEach(function(e){t.pendingBuffering=!0,t.hls.trigger(p.default.BUFFER_APPENDING,e)}),t.pendingData=[],t.appended=!0)),t.tick()}()}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==A.PARSING&&t!==A.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==A.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),n.trigger(p.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;R.logger.log("audio buffered : "+T.default.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=A.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var n=this.fragLoadError;n?n++:n=1;var r=this.config;if(n<=r.fragLoadingMaxRetry){this.fragLoadError=n,t.loadCounter=0;var i=Math.min(Math.pow(2,n-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);R.logger.warn("audioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=A.FRAG_LOADING_WAITING_RETRY}else R.logger.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=A.ERROR}break;case b.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,R.logger.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(R.logger.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(p.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=A.PARSED):(this.state=A.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,R.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(g.default);n.default=D},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.AUDIO_TRACK_LOADED));return n.ticks=0,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,n=e.audioTracks||[],r=!1;this.tracks=n,this.hls.trigger(l.default.AUDIO_TRACKS_UPDATED,{audioTracks:n});var i=0;n.forEach(function(e){if(e.default)return t.audioTrack=i,void(r=!0);i++}),!1===r&&n.length&&(d.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(d.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,d.logger.log("switching to audioTrack "+e);var t=this.tracks[e],n=this.hls,r=t.type,i=t.url,a={id:e,type:r,url:i};n.trigger(l.default.AUDIO_TRACK_SWITCH,a),n.trigger(l.default.AUDIO_TRACK_SWITCHING,a);var o=t.details;!i||void 0!==o&&!0!==o.live||(d.logger.log("(re)loading playlist for audioTrack "+e),n.trigger(l.default.AUDIO_TRACK_LOADING,{url:i,id:e}))}}},{key:"updateTrack",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,d.logger.log("updating audioTrack "+e);var t=this.tracks[e],n=t.url,r=t.details;!n||void 0!==r&&!0!==r.live||(d.logger.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(l.default.AUDIO_TRACK_LOADING,{url:n,id:e}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(f.default);n.default=h},{27:27,28:28,45:45}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=e(26),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return o(t,e),s(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){i=!0,d.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(d.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){var t=e.audio,n=e.video,r=0;e.altAudio&&(t||n)&&(r=(t?1:0)+(n?1:0),d.logger.log(r+" sourceBuffer(s) expected")),this.sourceBufferNb=r}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function(){d.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){d.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(l.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){d.logger.log("media source opened"),this.hls.trigger(l.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){d.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){d.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;d.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,n=this.segments.reduce(function(e,n){return n.parent===t?e+1:e},0);this.hls.trigger(l.default.BUFFER_APPENDED,{parent:t,pending:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(e){d.logger.error("sourceBuffer error:"+e),this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this.onsbue),n.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var n=this.mediaSource;n&&"open"===n.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,n=this.mediaSource;for(var r in e)if(!t[r]){var i=e[r],a=i.levelCodec||i.codec,o=i.container+";codecs="+a;d.logger.log("creating sourceBuffer("+o+")");try{var s=t[r]=n.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[r]={codec:a,container:i.container},i.buffer=s}catch(e){d.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){d.logger.error("sourceBuffer error:",e.event),this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,n=e.type;for(var r in t)n&&r!==n||t[r].ended||(t[r].ended=!0,d.logger.log(r+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var n in e){var r=e[n];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}d.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){d.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e=this.media,t=this.mediaSource,n=this.sourceBuffer,r=this._levelDuration;if(null!==r&&e&&t&&n&&0!==e.readyState&&"open"===t.readyState){for(var i in n)if(n[i].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var a=e.duration;(r>this._msDuration&&r>a||a===1/0||isNaN(a))&&(d.logger.log("Updating mediasource duration to "+r.toFixed(3)),this._msDuration=t.duration=r)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n)t+=n[r].buffered.length}catch(e){d.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(l.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,n=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void d.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var r=n.shift();try{var i=r.type,a=t[i];a?a.updating?n.unshift(r):(a.ended=!1,this.parent=r.parent,a.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){d.logger.error("error while trying to append buffer:"+t.message),n.unshift(r);var o={type:h.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],o.details=h.ErrorDetails.BUFFER_FULL_ERROR,o.fatal=!1,void e.trigger(l.default.ERROR,o);if(this.appendError?this.appendError++:this.appendError=1,o.details=h.ErrorDetails.BUFFER_APPEND_ERROR,o.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return d.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),n=[],o.fatal=!0,void e.trigger(l.default.ERROR,o);o.fatal=!1,e.trigger(l.default.ERROR,o)}}}}},{key:"flushBuffer",value:function(e,t,n){var r,i,a,o,s,u,l=this.sourceBuffer;if(Object.keys(l).length){if(d.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var c in l)if(!n||c===n){if(r=l[c],r.ended=!1,r.updating)return d.logger.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<r.buffered.length;i++)if(a=r.buffered.start(i),o=r.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(s=e,u=t):(s=Math.max(a,e),u=Math.min(o,t)),Math.min(u,o)-s>.5)return this.flushBufferCounter++,d.logger.log("flush "+c+" ["+s+","+u+"], of ["+a+","+o+"], pos:"+this.media.currentTime),r.remove(s,u),!1}catch(e){d.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else d.logger.warn("abort flushing too many retries");d.logger.log("buffer flushed")}return!0}}]),t}(f.default);n.default=v},{26:26,27:27,28:28,45:45}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.FPS_DROP_LEVEL_CAPPING,l.default.MEDIA_ATTACHING,l.default.MANIFEST_PARSED))}return o(t,e),s(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var t=0,n=void 0,r=void 0,i=this.mediaWidth,a=this.mediaHeight,o=0,s=0;for(n=0;n<=e&&(r=this.levels[n],!this.isLevelRestricted(n))&&(t=n,o=r.width,s=r.height,!(i<=o||a<=s));n++);return t}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(e))}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(f.default);n.default=d},{27:27,28:28}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(44),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n,i,a){r(this,e),this.hls=t,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new o.default(n),this.fast_=new o.default(i)}return i(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var n=8e3*t/e,r=e/1e3;this.fast_.sample(r,n),this.slow_.sample(r,n)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();n.default=s},{44:44}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MEDIA_ATTACHING))}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){"function"==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,n){var r=performance.now();if(t){if(this.lastTime){var i=r-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/i,u=this.hls;if(u.trigger(l.default.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),s>0&&a>u.config.fpsDroppedMonitoringThreshold*o){var c=u.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=c)&&(c-=1,u.trigger(l.default.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,u.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(f.default);n.default=h},{27:27,28:28,45:45}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(45),h=e(26),v=e(30),_=r(v),p=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MANIFEST_LOADED,l.default.LEVEL_LOADED,l.default.FRAG_LOADED,l.default.ERROR));return n.ontick=n.tick.bind(n),n._manualLevel=n._autoLevelCapping=-1,n}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,n=[],r=[],i={},a=!1,o=!1,s=this.hls,u=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c=function(e,t){return MediaSource.isTypeSupported(e+"/mp4;codecs="+t)};if(e.levels.forEach(function(e){e.videoCodec&&(a=!0),u&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(o=!0);var t=i[e.bitrate];void 0===t?(i[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),a&&o?n.forEach(function(e){e.videoCodec&&r.push(e)}):r=n,r=r.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||c("audio",t))&&(!n||c("video",n))}),r.length){t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var f=0;f<r.length;f++)if(r[f].bitrate===t){this._firstLevel=f,d.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}s.trigger(l.default.MANIFEST_PARSED,{levels:r,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:a,altAudio:e.audioTracks.length>0})}else s.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e&&(d.logger.log("switching to level "+e),this._level=e,this.hls.trigger(l.default.LEVEL_SWITCH,{level:e}));var n=t[e],r=n.details;if(!r||!0===r.live){var i=n.urlId;this.hls.trigger(l.default.LEVEL_LOADING,{url:n.url[i],level:e,id:i})}}else this.hls.trigger(l.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,n=this.hls,r=void 0,i=void 0,a=!1,o=n.abrController,s=o.minAutoLevel;switch(t){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:r=e.frag.level;break;case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:r=e.context.level,a=!0;break;case h.ErrorDetails.REMUX_ALLOC_ERROR:r=e.level}if(void 0!==r){i=this._levels[r],i.loadError?i.loadError++:i.loadError=1;var u=i.url.length;if(u>1&&i.loadError<u)i.urlId=(i.urlId+1)%u,i.details=void 0,d.logger.warn("level controller,"+t+" for level "+r+": switching to redundant stream id "+i.urlId);else{if(-1===this._manualLevel&&r)d.logger.warn("level controller,"+t+": switch-down for next fragment"),o.nextAutoLevel=Math.max(s,r-1);else if(i&&i.details&&i.details.live)d.logger.warn("level controller,"+t+" on live stream, discard"),a&&(this._level=void 0);else if(t===h.ErrorDetails.LEVEL_LOAD_ERROR||t===h.ErrorDetails.LEVEL_LOAD_TIMEOUT){var c=n.media,f=c&&_.default.isBuffered(c,c.currentTime)&&_.default.isBuffered(c,c.currentTime+.5);if(f){var v=n.config.levelLoadingRetryDelay;d.logger.warn("level controller,"+t+", but media buffered, retry in "+v+"ms"),this.timer=setTimeout(this.ontick,v)}else d.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,n.trigger(l.default.ERROR,e)}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(t&&"main"===t.type){var n=this._levels[t.level];n&&(n.loadError=0)}}},{key:"onLevelLoaded",value:function(e){var t=e.level;if(t===this._level){var n=this._levels[t];n.loadError=0;var r=e.details;if(r.live){var i=1e3*(r.averagetargetduration?r.averagetargetduration:r.targetduration),a=n.details;a&&r.endSN===a.endSN&&(i/=2,d.logger.log("same live playlist, reload twice faster")),i-=performance.now()-e.stats.trequest,i=Math.max(1e3,Math.round(i)),d.logger.log("live playlist, reload in "+i+" ms"),this.timer=setTimeout(this.ontick,i)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],n=t.urlId;this.hls.trigger(l.default.LEVEL_LOADING,{url:t.url[n],level:e,id:n})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){-1!==e&&(e=Math.max(e,this.hls.abrController.minAutoLevel)),this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(f.default);n.default=p},{26:26,27:27,28:28,30:30,45:45}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(41),l=r(u),c=e(30),f=r(c),d=e(22),h=r(d),v=e(28),_=r(v),p=e(27),m=r(p),g=e(31),E=r(g),y=e(46),S=r(y),T=e(26),b=e(45),R={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},A=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,_.default.MEDIA_ATTACHED,_.default.MEDIA_DETACHING,_.default.MANIFEST_LOADING,_.default.MANIFEST_PARSED,_.default.LEVEL_LOADED,_.default.KEY_LOADED,_.default.FRAG_LOADED,_.default.FRAG_LOAD_EMERGENCY_ABORTED,_.default.FRAG_PARSING_INIT_SEGMENT,_.default.FRAG_PARSING_DATA,_.default.FRAG_PARSED,_.default.ERROR,_.default.AUDIO_TRACK_SWITCHING,_.default.AUDIO_TRACK_SWITCHED,_.default.BUFFER_CREATED,_.default.BUFFER_APPENDED,_.default.BUFFER_FLUSHED));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=R.STOPPED,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),m.default.prototype.destroy.call(this),this.state=R.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(b.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=R.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else b.logger.warn("cannot start loading as manifest not parsed yet"),this.state=R.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case R.ERROR:break;case R.BUFFER_FLUSHING:this.fragLoadError=0;break;case R.IDLE:if(!this._doTickIdle())return;break;case R.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=R.IDLE);break;case R.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(b.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=R.IDLE);break;case R.ERROR:case R.STOPPED:case R.FRAG_LOADING:case R.PARSING:case R.PARSED:case R.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&!n&&(this.startFragRequested||!t.startFragPrefetch))return!0;var r=void 0;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,a=this.levels[i],o=a.bitrate,s=void 0;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var u=f.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,t.maxBufferHole),l=u.len;if(l>=s)return!0;b.logger.trace("buffer length of "+l.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var c=a.details;if(void 0===c||c.live&&this.levelLastLoaded!==i)return this.state=R.WAITING_LEVEL,!0;var d=this.fragPrevious;if(!c.live&&d&&d.sn===c.endSN&&n.duration-Math.max(u.end,d.start)<=Math.max(.2,d.duration/2)){var h={};return this.altAudio&&(h.type="video"),this.hls.trigger(_.default.BUFFER_EOS,h),this.state=R.ENDED,!0}return this._fetchPayloadOrEos(r,u,c)}},{key:"_fetchPayloadOrEos",value:function(e,t,n){var r=this.fragPrevious,i=this.level,a=n.fragments,o=a.length;if(0===o)return!1;var s=a[0].start,u=a[o-1].start+a[o-1].duration,l=t.end,c=void 0;if(n.live){var f=this.config.initialLiveManifestSize;if(o<f)return b.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+f),!1;if(null===(c=this._ensureFragmentAtLivePoint(n,l,s,u,r,a,o)))return!1}else l<s&&(c=a[0]);return c||(c=this._findFragment(s,r,o,a,l,u,n)),!c||this._loadFragmentOrKey(c,i,n,e,l)}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,n,r,i,a,o){var s=this.hls.config,u=this.media,l=void 0,c=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(n-s.maxFragLookUpTolerance,r-c)){var f=this.liveSyncPosition=this.computeLivePosition(n,e);b.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),t=f,u&&u.readyState&&u.duration>f&&(u.currentTime=f)}if(e.PTSKnown&&t>r&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(i){var d=i.sn+1;d>=e.startSN&&d<=e.endSN&&(l=a[d-e.startSN],b.logger.log("live playlist, switching playlist, load frag with next SN: "+l.sn))}l||(l=a[Math.min(o-1,Math.round(o/2))],b.logger.log("live playlist, switching playlist, unknown, load middle frag : "+l.sn))}return l}},{key:"_findFragment",value:function(e,t,n,r,i,a,o){var s=this.hls.config,u=void 0,c=void 0,f=s.maxFragLookUpTolerance;if(i<a?(i>a-f&&(f=0),c=l.default.search(r,function(e){return e.start+e.duration-f<=i?1:e.start-f>i&&e.start?-1:0})):c=r[n-1],c&&(u=c,c.start,t&&u.level===t.level&&u.sn===t.sn))if(u.sn<o.endSN){var d=t.deltaPTS,h=u.sn-o.startSN;d&&d>s.maxBufferHole&&t.dropped&&h?(u=r[h-1],b.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(u=r[h+1],b.logger.log("SN just loaded, load next one: "+u.sn))}else u=null;return u}},{key:"_loadFragmentOrKey",value:function(e,t,n,r,i){var a=this.hls,o=a.config;if(null==e.decryptdata.uri||null!=e.decryptdata.key){if(b.logger.log("Loading "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t+", currentTime:"+r.toFixed(3)+",bufferEnd:"+i.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var s=o.fragLoadingLoopThreshold;if(e.loadCounter>s&&Math.abs(this.fragLoadIdx-e.loadIdx)<s)return a.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e}),!1}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,this.nextLoadPosition=e.start+e.duration,e.autoLevel=a.autoLevelEnabled,e.bitrateTest=this.bitrateTest,a.trigger(_.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new h.default(a,"main")),this.state=R.FRAG_LOADING,!0}b.logger.log("Loading key for "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t),this.state=R.KEY_LOADING,a.trigger(_.default.KEY_LOADING,{frag:e})}},{key:"getBufferRange",value:function(e){return l.default.search(this.bufferRange,function(t){return e<t.start?-1:e>t.end?1:0})}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&(t=n.currentTime,t>n.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),f.default.isBuffered(n,t)?e=this.getBufferRange(t):f.default.isBuffered(n,t+.1)&&(e=this.getBufferRange(t+.1)),e)){var r=e.frag;r!==this.fragPlaying&&(this.fragPlaying=r,this.hls.trigger(_.default.FRAG_CHANGED,{frag:r}))}}},{key:"immediateLevelSwitch",value:function(){if(b.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,n=void 0,r=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,n=this.getBufferRange(e.currentTime),n&&n.start>1&&this.flushMainBuffer(0,n.start-1),e.paused)t=0;else{var i=this.hls.nextLoadLevel,a=this.levels[i],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if((r=this.getBufferRange(e.currentTime+t))&&(r=this.followingBufferRange(r))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=R.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(_.default.BUFFER_FLUSHING,n)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(b.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.media,t=e?e.currentTime:void 0,n=this.config;if(b.logger.log("media seeking to "+t.toFixed(3)),this.state===R.FRAG_LOADING){var r=this.mediaBuffer?this.mediaBuffer:e,i=f.default.bufferInfo(r,t,this.config.maxBufferHole),a=this.fragCurrent;if(0===i.len&&a){var o=n.maxFragLookUpTolerance,s=a.start-o,u=a.start+a.duration+o;t<s||t>u?(a.loader&&(b.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=R.IDLE):b.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===R.ENDED&&(this.state=R.IDLE);e&&(this.lastCurrentTime=t),this.state!==R.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*n.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()}},{key:"onMediaSeeked",value:function(){b.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){b.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){b.logger.log("trigger BUFFER_RESET"),this.hls.trigger(_.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t,n=!1,r=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&b.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var i=this.config;i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,n=e.level,r=this.levels[n],i=t.totalduration,a=0;if(b.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),this.levelLastLoaded=n,t.live){var o=r.details;o&&t.fragments.length>0?(E.default.mergeDetails(o,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,o),t.PTSKnown?b.logger.log("live playlist sliding:"+a.toFixed(3)):b.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,b.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,this.hls.trigger(_.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var s=t.startTimeOffset;isNaN(s)?t.live?(this.startPosition=this.computeLivePosition(a,t),b.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(s<0&&(b.logger.log("negative start time offset "+s+", count from end of last fragment"),s=a+i+s),b.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===R.WAITING_LEVEL&&(this.state=R.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===R.KEY_LOADING&&(this.state=R.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,n=e.frag;if(this.state===R.FRAG_LOADING&&t&&"main"===n.type&&n.level===t.level&&n.sn===t.sn){var r=e.stats,i=this.levels[t.level],a=i.details;if(b.logger.log("Loaded  "+t.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t.level),this.bitrateTest=!1,!0===n.bitrateTest&&this.hls.nextLoadLevel)this.state=R.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=performance.now(),this.hls.trigger(_.default.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else{this.state=R.PARSING,this.stats=r;var o=a.totalduration,s=isNaN(t.startDTS)?t.start:t.startDTS,u=t.level,l=t.sn,c=this.config.defaultAudioCodec||i.audioCodec;this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),void 0===c&&(c=this.lastAudioCodec),c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,b.logger.log("Parsing "+l+" of ["+a.startSN+" ,"+a.endSN+"],level "+u+", cc "+t.cc);var f=this.demuxer;f||(f=this.demuxer=new h.default(this.hls,"main"));var d=this.media,v=d&&d.seeking,p=!v&&(a.PTSKnown||!a.live);f.push(e.payload,c,i.videoCodec,s,t.cc,u,l,o,t.decryptdata,p,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING){var n,r,i=e.tracks;if(i.audio&&this.altAudio&&delete i.audio,r=i.audio){var a=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===o.indexOf("firefox")&&(a="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==r.container&&(a="mp4a.40.2",b.logger.log("Android: force audio codec to "+a)),r.levelCodec=a,r.id=e.id}if(r=i.video,r&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=e.id),e.unique){var s={codec:"",levelCodec:""};for(n in e.tracks)r=i[n],s.container=r.container,s.codec&&(s.codec+=",",s.levelCodec+=","),r.codec&&(s.codec+=r.codec),r.levelCodec&&(s.levelCodec+=r.levelCodec);i={audiovideo:s}}this.hls.trigger(_.default.BUFFER_CODECS,i);for(n in i){r=i[n],b.logger.log("main track:"+n+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var u=r.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(_.default.BUFFER_APPENDING,{type:n,data:u,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;if(n&&"main"===e.id&&e.sn===n.sn&&e.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===R.PARSING){var r=this.levels[this.level],i=this.fragCurrent;b.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var a=E.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),o=this.hls;o.trigger(_.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:a,type:e.type,start:e.startPTS,end:e.endPTS}),"video"===e.type&&(i.dropped=e.dropped),[e.data1,e.data2].forEach(function(n){n&&(t.appended=!0,t.pendingBuffering=!0,o.trigger(_.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING&&(this.stats.tparsed=performance.now(),this.state=R.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,n=e.id;if(!t){if(this.mediaBuffer!==this.media){b.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(b.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.IDLE}var i=this.hls;i.trigger(_.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(b.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,n=void 0,r=void 0,i=!1;for(var a in t){var o=t[a];"main"===o.id?(r=a,n=o,"video"===a&&(this.videoBuffer=t[a].buffer)):i=!0}i&&n?(b.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==R.PARSING&&t!==R.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var e=this;if(!(this.state!==R.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;t&&function(){var n=e.mediaBuffer?e.mediaBuffer:e.media;b.logger.log("main buffered : "+S.default.toString(n.buffered));var r=e.bufferRange.filter(function(e){return f.default.isBuffered(n,(e.start+e.end)/2)});r.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:t}),e.bufferRange=r.sort(function(e,t){return e.start-t.start}),e.fragPrevious=t;var i=e.stats;i.tbuffered=performance.now(),e.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),e.hls.trigger(_.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),e.state=R.IDLE}(),this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=this.media,r=n&&f.default.isBuffered(n,n.currentTime)&&f.default.isBuffered(n,n.currentTime+.5);switch(e.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var a=this.config;if(i<=a.fragLoadingMaxRetry||r||t.autoLevel&&t.level){this.fragLoadError=i,t.loadCounter=0;var o=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);b.logger.warn("mediaController: frag loading failed, retry in "+o+" ms"),this.retryDate=performance.now()+o,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=R.FRAG_LOADING_WAITING_RETRY}else b.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(_.default.ERROR,e),this.state=R.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.hls.trigger(_.default.ERROR,e),this.state=R.ERROR));break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.ERROR&&(e.fatal?(this.state=R.ERROR,b.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):this.state===R.WAITING_LEVEL&&(this.state=R.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:this.state!==R.PARSING&&this.state!==R.PARSED||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):(b.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,b.logger.warn("reduce max buffer length to "+t.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,n=this.mediaBuffer?this.mediaBuffer:e,r=n.buffered;if(this.loadedmetadata||!r.length||e.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var i=f.default.bufferInfo(e,t,0),a=!(e.paused||e.ended||0===e.buffered.length),o=.5,s=t!==this.lastCurrentTime,u=this.config;if(s)this.stallReported&&(b.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(a){var l=performance.now(),c=this.hls;if(this.stalled){var d=l-this.stalled,h=i.len,v=this.nudgeRetry||0;if(h<=o&&d>1e3*u.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in low buffer @"+t),c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h}));var p=i.nextStart,m=p-t;if(p&&m<u.maxSeekHole&&m>0){this.nudgeRetry=++v;var g=v*u.nudgeOffset;b.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+p+" + nudge "+g),e.currentTime=p+g,this.stalled=void 0,c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:p+g-t})}}else if(h>o&&d>1e3*u.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in high buffer @"+t),c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h})),this.stalled=void 0,this.nudgeRetry=++v,v<u.nudgeMaxRetry){var E=e.currentTime,y=E+v*u.nudgeOffset;b.logger.log("adjust currentTime from "+E+" to "+y),e.currentTime=y,c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("still stuck in high buffer @"+t+" after "+u.nudgeMaxRetry+", raise fatal error"),c.trigger(_.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=l,this.stallReported=!1}}else{this.loadedmetadata=!0;var S=this.startPosition,R=f.default.isBuffered(n,S);t===S&&R||(b.logger.log("target start position:"+S),R||(S=r.start(0),b.logger.log("target start position not buffered, seek to buffered.start(0) "+S)),b.logger.log("adjust currentTime from "+t+" to "+S),e.currentTime=S)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=R.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(t){return f.default.isBuffered(e,(t.start+t.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=R.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,b.logger.log("main stream:"+t+"->"+e),this.hls.trigger(_.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferRange(e.currentTime);if(t)return t.frag.level}return-1}},{key:"nextBufferRange",get:function(){var e=this.media;return e?this.followingBufferRange(this.getBufferRange(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(m.default);n.default=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(42),h=r(d),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_USERDATA,l.default.MANIFEST_LOADING,l.default.FRAG_LOADED,l.default.LEVEL_SWITCH));if(n.hls=e,n.config=e.config,n.enabled=!0,n.Cues=e.config.cueHandler,n.config.enableCEA708Captions){var r=n,o=function(e,t){var n=null;try{n=new window.Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)},s={newCue:function(e,t,n){if(!r.textTrack1){var i=r.getExistingTrack("1");i?(r.textTrack1=i,r.clearCurrentCues(r.textTrack1),o(r.textTrack1,r.media)):(r.textTrack1=r.createTextTrack("captions","English","en"),r.textTrack1.textTrack1=!0)}r.Cues.newCue(r.textTrack1,e,t,n)}},u={newCue:function(e,t,n){if(!r.textTrack2){var i=r.getExistingTrack("2");i?(r.textTrack2=i,r.clearCurrentCues(r.textTrack2),o(r.textTrack2,r.media)):(r.textTrack2=r.createTextTrack("captions","Spanish","es"),r.textTrack2.textTrack2=!0)}r.Cues.newCue(r.textTrack2,e,t,n)}};n.cea608Parser=new h.default(0,s,u)}return n}return o(t,e),s(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n],i="textTrack"+e;if(!0===r[i])return r}return null}},{key:"createTextTrack",value:function(e,t,n){if(this.media)return this.media.addTextTrack(e,t,n)}},{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var n=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,n)}}},{key:"extractCea608Data",value:function(e){for(var t,n,r,i,a,o=31&e[0],s=2,u=[],l=0;l<o;l++)t=e[s++],n=127&e[s++],r=127&e[s++],i=0!=(4&t),a=3&t,0===n&&0===r||i&&0===a&&(u.push(n),u.push(r));return u}}]),t}(f.default);n.default=v},{27:27,28:28,42:42}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.aesIV=n}return i(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();n.default=a},{}],15:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return i(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<n.length;r++)n[r]=t.getUint32(4*r);return n}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,n=this.subMix[0],r=this.subMix[1],i=this.subMix[2],a=this.subMix[3],o=this.invSubMix[0],s=this.invSubMix[1],u=this.invSubMix[2],l=this.invSubMix[3],c=new Uint32Array(256),f=0,d=0,h=0;for(h=0;h<256;h++)c[h]=h<128?h<<1:h<<1^283;for(h=0;h<256;h++){var v=d^d<<1^d<<2^d<<3^d<<4;v=v>>>8^255&v^99,e[f]=v,t[v]=f;var _=c[f],p=c[_],m=c[p],g=257*c[v]^16843008*v;n[f]=g<<24|g>>>8,r[f]=g<<16|g>>>16,i[f]=g<<8|g>>>24,a[f]=g,g=16843009*m^65537*p^257*_^16843008*f,o[v]=g<<24|g>>>8,s[v]=g<<16|g>>>16,u[v]=g<<8|g>>>24,l[v]=g,f?(f=_^c[c[c[m^_]]],d^=c[c[d]]):f=d=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a=this.ksRows=4*(i+6+1),o=void 0,s=void 0,u=this.keySchedule=new Uint32Array(this.ksRows),l=this.invKeySchedule=new Uint32Array(this.ksRows),c=this.sBox,f=this.rcon,d=this.invSubMix[0],h=this.invSubMix[1],v=this.invSubMix[2],_=this.invSubMix[3],p=void 0,m=void 0;for(o=0;o<a;o++)o<i?p=u[o]=t[o]:(m=p,o%i==0?(m=m<<8|m>>>24,m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m],m^=f[o/i|0]<<24):i>6&&o%i==4&&(m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m]),u[o]=p=(u[o-i]^m)>>>0);for(s=0;s<a;s++)o=a-s,m=3&s?u[o]:u[o-4],l[s]=s<4||o<=4?m:d[c[m>>>24]]^h[c[m>>>16&255]]^v[c[m>>>8&255]]^_[c[255&m]],l[s]=l[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,n){for(var r,i,a=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,u=this.invSubMix[0],l=this.invSubMix[1],c=this.invSubMix[2],f=this.invSubMix[3],d=this.uint8ArrayToUint32Array_(n),h=d[0],v=d[1],_=d[2],p=d[3],m=new Int32Array(e),g=new Int32Array(m.length),E=void 0,y=void 0,S=void 0,T=void 0,b=void 0,R=void 0,A=void 0,D=void 0,w=void 0,O=void 0,k=void 0,C=void 0;t<m.length;){for(w=this.networkToHostOrderSwap(m[t]),O=this.networkToHostOrderSwap(m[t+1]),k=this.networkToHostOrderSwap(m[t+2]),C=this.networkToHostOrderSwap(m[t+3]),b=w^o[0],R=C^o[1],A=k^o[2],D=O^o[3],r=4,i=1;i<a;i++)E=u[b>>>24]^l[R>>16&255]^c[A>>8&255]^f[255&D]^o[r],y=u[R>>>24]^l[A>>16&255]^c[D>>8&255]^f[255&b]^o[r+1],S=u[A>>>24]^l[D>>16&255]^c[b>>8&255]^f[255&R]^o[r+2],T=u[D>>>24]^l[b>>16&255]^c[R>>8&255]^f[255&A]^o[r+3],b=E,R=y,A=S,D=T,r+=4;E=s[b>>>24]<<24^s[R>>16&255]<<16^s[A>>8&255]<<8^s[255&D]^o[r],y=s[R>>>24]<<24^s[A>>16&255]<<16^s[D>>8&255]<<8^s[255&b]^o[r+1],S=s[A>>>24]<<24^s[D>>16&255]<<16^s[b>>8&255]<<8^s[255&R]^o[r+2],T=s[D>>>24]<<24^s[b>>16&255]<<16^s[R>>8&255]<<8^s[255&A]^o[r+3],r+=3,g[t]=this.networkToHostOrderSwap(E^h),g[t+1]=this.networkToHostOrderSwap(T^v),g[t+2]=this.networkToHostOrderSwap(S^_),g[t+3]=this.networkToHostOrderSwap(y^p),h=w,v=O,_=k,p=C,t+=4}return g.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();n.default=a},{}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(14),s=r(o),u=e(17),l=r(u),c=e(15),f=r(c),d=e(26),h=e(45),v=function(){function e(t,n){i(this,e),this.observer=t,this.config=n;try{var r=crypto||self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return a(e,[{key:"decrypt",value:function(e,t,n,r){var i=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){h.logger.log("JS AES decrypt");var a=this.decryptor;a||(this.decryptor=a=new f.default),a.expandKey(t),r(a.decrypt(e,0,n))}else!function(){h.logger.log("WebCrypto AES decrypt");var a=i.subtle;i.key!==t&&(i.key=t,i.fastAesKey=new l.default(a,t)),i.fastAesKey.expandKey().then(function(t){new s.default(a,n).decrypt(e,t).then(function(e){r(e)})}).catch(function(a){i.onWebCryptoError(a,e,t,n,r)})}()}},{key:"onWebCryptoError",value:function(e,t,n,r,i){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(t,n,r,i)):(h.logger.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:d.ErrorTypes.MEDIA_ERROR,details:d.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();n.default=v},{14:14,15:15,17:17,26:26,45:45}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.key=n}return i(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();n.default=a},{}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),u=e(45),l=e(24),c=r(l),f=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.remuxer=new this.remuxerClass(t,n,a,o),this.insertDiscontinuity()}return a(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(e,t,n,r,i,a,o,l,f,d){var h,v,_,p,m,g,E,y,S,T,b=new c.default(e),R=90*b.timeStamp,A=!1;for(i!==this.lastCC?(u.logger.log(this.id+" discontinuity detected"),this.lastCC=i,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):a!==this.lastLevel?(u.logger.log("audio track switch detected"),this.lastLevel=a,this.remuxer.switchLevel(),this.insertDiscontinuity()):o===this.lastSN+1&&(A=!0),h=this._aacTrack,this.lastSN=o,this.lastLevel=a,g=b.length,S=e.length;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);for(h.audiosamplerate||(v=s.default.getAudioConfig(this.observer,e,g,t),h.config=v.config,h.audiosamplerate=v.samplerate,h.channelCount=v.channelCount,h.codec=v.codec,h.manifestCodec=v.manifestCodec,h.duration=l,u.logger.log("parsed codec:"+h.codec+",rate:"+v.samplerate+",nb channel:"+v.channelCount)),m=0,p=1024*9e4/h.audiosamplerate;g+5<S&&(E=1&e[g+1]?7:9,_=(3&e[g+3])<<11|e[g+4]<<3|(224&e[g+5])>>>5,(_-=E)>0&&g+E+_<=S);)for(y=R+m*p,T={unit:e.subarray(g+E,g+E+_),pts:y,dts:y},h.samples.push(T),h.len+=_,g+=_+E,m++;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);this.remuxer.remux(a,o,i,h,{samples:[]},{samples:[{pts:R,dts:R,unit:b.payload}]},{samples:[]},r,A,f,d)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,n,r=new c.default(e);if(r.hasTimeStamp)for(t=r.length,n=e.length;t<n-1;t++)if(255===e[t]&&240==(240&e[t+1]))return!0;return!1}}]),e}();n.default=f},{19:19,24:24,45:45}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=e(26),s=function(){function e(){r(this,e)}return i(e,null,[{key:"getAudioConfig",value:function(e,t,n,r){var i,s,u,l,c,f=navigator.userAgent.toLowerCase(),d=r,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return i=((192&t[n+2])>>>6)+1,(s=(60&t[n+2])>>>2)>h.length-1?void e.trigger(Event.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s}):(l=(1&t[n+2])<<2,l|=(192&t[n+3])>>>6,a.logger.log("manifest codec:"+r+",ADTS data:type:"+i+",sampleingIndex:"+s+"["+h[s]+"Hz],channelConfig:"+l),/firefox/i.test(f)?s>=6?(i=5,c=new Array(4),u=s-3):(i=2,c=new Array(2),u=s):-1!==f.indexOf("android")?(i=2,c=new Array(2),u=s):(i=5,c=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&s>=6?u=s-3:((r&&-1!==r.indexOf("mp4a.40.2")&&s>=6&&1===l||!r&&1===l)&&(i=2,c=new Array(2)),u=s)),c[0]=i<<3,c[0]|=(14&s)>>1,c[1]|=(1&s)<<7,c[1]|=l<<3,5===i&&(c[1]|=(14&u)>>1,c[2]=(1&u)<<7,c[2]|=2<<2,c[3]=0),{config:c,samplerate:h[s],channelCount:l,codec:"mp4a.40."+i,manifestCodec:d})}}]),e}();n.default=s},{26:26,45:45}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),u=e(26),l=e(16),c=r(l),f=e(18),d=r(f),h=e(25),v=r(h),_=e(38),p=r(_),m=e(39),g=r(m),E=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this.hls=t,this.id=n,this.config=this.hls.config||a,this.typeSupported=r}return a(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,n,r,i,a,o,u,l,f,d){if(e.byteLength>0&&null!=l&&null!=l.key&&"AES-128"===l.method){null==this.decrypter&&(this.decrypter=new c.default(this.hls,this.config));var h,v=this;try{h=performance.now()}catch(e){h=Date.now()}this.decrypter.decrypt(e,l.key.buffer,l.iv.buffer,function(e){var l;try{l=performance.now()}catch(e){l=Date.now()}v.hls.trigger(s.default.FRAG_DECRYPTED,{level:a,sn:o,stats:{tstart:h,tdecrypt:l}}),v.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,u,f,d)})}else this.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,u,f,d)}},{key:"pushDecrypted",value:function(e,t,n,r,i,a,o,l,c,f){var h=this.demuxer;if(!h||i!==this.cc&&!h.probe(e)){var _=this.hls,m=this.id,E=this.config,y=this.typeSupported;if(v.default.probe(e))h=!0===this.typeSupported.mp2t?new v.default(_,m,g.default,E,y):new v.default(_,m,p.default,E,y),h.probe=v.default.probe;else{if(!d.default.probe(e))return void _.trigger(s.default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,id:m,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});h=new d.default(_,m,p.default,E,y),h.probe=d.default.probe}this.demuxer=h}h.push(e,t,n,r,i,a,o,l,c,f),this.cc=i}}]),e}();n.default=E},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e(20),a=r(i),o=e(28),s=r(o),u=e(45),l=e(1),c=r(l),f=function(e){var t=new c.default;t.trigger=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var o=JSON.parse(i.config);e.demuxer=new a.default(t,i.id,i.typeSupported,o);try{(0,u.enableLogs)(!0===o.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":e.demuxer.push(i.data,i.audioCodec,i.videoCodec,i.timeOffset,i.cc,i.level,i.sn,i.duration,i.decryptdata,i.accurateTimeOffset,i.defaultInitPTS)}}),t.on(s.default.FRAG_DECRYPTED,n),t.on(s.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(s.default.FRAG_PARSED,n),t.on(s.default.ERROR,n),t.on(s.default.FRAG_PARSING_METADATA,n),t.on(s.default.FRAG_PARSING_USERDATA,n),t.on(s.default.INIT_PTS_FOUND,n),t.on(s.default.FRAG_PARSING_DATA,function(t,n){var r=n.data1.buffer,i=n.data2.buffer;delete n.data1,delete n.data2,e.postMessage({event:t,data:n,data1:r,data2:i},[r,i])})};n.default=f},{1:1,20:20,28:28,45:45}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),u=e(20),l=r(u),c=e(21),f=r(c),d=e(45),h=e(26),v=function(){function t(n,r){i(this,t),this.hls=n,this.id=r;var a={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:n.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(n.config.enableWorker&&"undefined"!=typeof Worker){d.logger.log("demuxing in webworker");var o=void 0;try{var u=e(3);o=this.w=u(f.default),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(e){n.trigger(s.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:a,id:r,config:JSON.stringify(n.config)})}catch(e){d.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&URL.revokeObjectURL(o.objectURL),this.demuxer=new l.default(n,r,a),this.w=void 0}}else this.demuxer=new l.default(n,r,a);this.demuxInitialized=!0}return a(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}}},{key:"push",value:function(e,t,n,r,i,a,o,s,u,l,c){var f=this.w;if(f)f.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:n,timeOffset:r,cc:i,level:a,sn:o,duration:s,decryptdata:u,accurateTimeOffset:l,defaultInitPTS:c},[e]);else{var d=this.demuxer;d&&d.push(e,t,n,r,i,a,o,s,u,l,c)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,n=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data.data2=new Uint8Array(t.data2);default:n.trigger(t.event,t.data)}}}]),t}();n.default=v},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,r=8,i=8;for(t=0;t<e;t++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i}},{key:"readSPS",value:function(){var e,t,n,r,i,a,o,s=0,u=0,l=0,c=0,f=this.readUByte.bind(this),d=this.readBits.bind(this),h=this.readUEG.bind(this),v=this.readBoolean.bind(this),_=this.skipBits.bind(this),p=this.skipEG.bind(this),m=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(f(),e=f(),d(5),_(3),f(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=h();if(3===E&&_(1),m(),m(),_(1),v())for(a=3!==E?8:12,o=0;o<a;o++)v()&&g(o<6?16:64)}m();var y=h();if(0===y)h();else if(1===y)for(_(1),p(),p(),t=h(),o=0;o<t;o++)p();m(),_(1),n=h(),r=h(),i=d(1),0===i&&_(1),_(1),v()&&(s=h(),u=h(),l=h(),c=h());var S=[1,1];if(v()&&v()){switch(f()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[f()<<8|f(),f()<<8|f()]}}return{width:Math.ceil(16*(n+1)-2*s-2*u),height:(2-i)*(r+1)*16-(i?2:4)*(l+c),pixelRatio:S}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();n.default=o},{45:45}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this._hasTimeStamp=!1;var n,i,o,s,u,l,c,f,d=0;do{if(c=this.readUTF(t,d,3),d+=3,"ID3"===c)d+=3,n=127&t[d++],i=127&t[d++],o=127&t[d++],s=127&t[d++],u=(n<<21)+(i<<14)+(o<<7)+s,l=d+u,this._parseID3Frames(t,d,l),d=l;else{if("3DI"!==c)return d-=3,void((f=d)&&(this.hasTimeStamp||a.logger.warn("ID3 tag found, but no timestamp"),this._length=f,this._payload=t.subarray(0,f)));d+=7,a.logger.log("3DI footer found, end: "+d)}}while(!0)}return i(e,[{key:"readUTF",value:function(e,t,n){var r="",i=t,a=t+n;do{r+=String.fromCharCode(e[i++])}while(i<a);return r}},{key:"_parseID3Frames",value:function(e,t,n){for(var r,i;t+8<=n;)switch(r=this.readUTF(e,t,4),t+=4,e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],e[t++]<<8+e[t++],t,r){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var o=1&e[t++];this._hasTimeStamp=!0,i=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,o&&(i+=47721858.84),i=Math.round(i),a.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();n.default=o},{45:45}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),u=e(28),l=r(u),c=e(23),f=r(c),d=e(45),h=e(26),v=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.typeSupported=o,this.lastCC=0,this.remuxer=new this.remuxerClass(t,n,a,o)}return a(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,n,r,i,a,o,s,u,c){var f,v,_,p,m,g=e.length,E=this.remuxer.passthrough,y=!1;this.audioCodec=t,this.videoCodec=n,this._duration=s,this.contiguous=!1,this.accurateTimeOffset=u,i!==this.lastCC&&(d.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=i),a!==this.lastLevel?(d.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=a):o===this.lastSN+1&&(this.contiguous=!0),this.lastSN=o;var S=this.pmtParsed,T=this._avcTrack,b=this._audioTrack,R=this._id3Track,A=T.id,D=b.id,w=R.id,O=this._pmtId,k=T.pesData,C=b.pesData,L=R.pesData,P=this._parsePAT,I=this._parsePMT,M=this._parsePES,N=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),F=this._parseMPEGPES.bind(this),U=this._parseID3PES.bind(this);for(g-=g%188,f=0;f<g;f+=188)if(71===e[f]){if(v=!!(64&e[f+1]),_=((31&e[f+1])<<8)+e[f+2],(48&e[f+3])>>4>1){if((p=f+5+e[f+4])===f+188)continue}else p=f+4;switch(_){case A:if(v){if(k&&(m=M(k))&&(N(m,!1),E&&T.codec&&(-1===D||b.codec)))return void this.remux(a,o,i,e,r);k={data:[],size:0}}k&&(k.data.push(e.subarray(p,f+188)),k.size+=f+188-p);break;case D:if(v){if(C&&(m=M(C))&&(b.isAAC?x(m):F(m),E&&b.codec&&(-1===A||T.codec)))return void this.remux(a,o,i,e,r);C={data:[],size:0}}C&&(C.data.push(e.subarray(p,f+188)),C.size+=f+188-p);break;case w:v&&(L&&(m=M(L))&&U(m),L={data:[],size:0}),L&&(L.data.push(e.subarray(p,f+188)),L.size+=f+188-p);break;case 0:v&&(p+=e[p]+1),O=this._pmtId=P(e,p);break;case O:v&&(p+=e[p]+1);var B=I(e,p,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3);A=B.avc,A>0&&(T.id=A),D=B.audio,D>0&&(b.id=D,b.isAAC=B.isAAC),w=B.id3,w>0&&(R.id=w),y&&!S&&(d.logger.log("reparse from beginning"),y=!1,f=-188),S=this.pmtParsed=!0;break;case 17:case 8191:break;default:y=!0}}else this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});k&&(m=M(k))?(N(m,!0),T.pesData=null):T.pesData=k,C&&(m=M(C))?(b.isAAC?x(m):F(m),b.pesData=null):(C&&C.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),b.pesData=C),L&&(m=M(L))?(U(m),R.pesData=null):R.pesData=L,this.remux(a,o,i,null,r,c)}},{key:"remux",value:function(e,t,n,r,i,a){for(var o=this._avcTrack,s=o.samples,u=0,l=0,c=0;c<s.length;c++){for(var f=s[c],d=f.units.units,h=d.length,v=0,_=0;_<h;_++)v+=d[_].data.length;l+=v,u+=h,f.length=v}o.len=l,o.nbNalu=u,this.remuxer.remux(e,t,n,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,i,this.contiguous,this.accurateTimeOffset,a,r)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,n){var r,i,a,o,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=(15&e[t+1])<<8|e[t+2],i=t+3+r-4,a=(15&e[t+10])<<8|e[t+11],t+=12+a;t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 15:-1===s.audio&&(s.audio=o);break;case 21:-1===s.id3&&(s.id3=o);break;case 27:-1===s.avc&&(s.avc=o);break;case 3:case 4:n?-1===s.audio&&(s.audio=o,s.isAAC=!1):d.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:d.logger.warn("HEVC stream type found, not supported for now");break;default:d.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}return s}},{key:"_parsePES",value:function(e){var t,n,r,i,a,o,s,u,l=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var f=new Uint8Array(c[0].length+c[1].length);f.set(c[0]),f.set(c[1],c[0].length),c[0]=f,c.splice(1,1)}if(t=c[0],1===(t[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;n=t[7],192&n&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&n?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,s>4294967295&&(s-=8589934592),o-s>60*9e4&&(d.logger.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),i=t[8],u=i+9,e.size-=u,a=new Uint8Array(e.size);for(var h=0,v=c.length;h<v;h++){t=c[h];var _=t.byteLength;if(u){if(u>_){u-=_;continue}t=t.subarray(u),_-=u,u=0}a.set(t,l),l+=_}return r&&(r-=i+3),{data:a,pts:o,dts:s,len:r}}return null}},{key:"pushAccesUnit",value:function(e,t){e.units.units.length&&e.frame&&(!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(t.samples.length||this.contiguous)?t.samples.push(e):t.dropped++),e.debug.length&&d.logger.log(e.pts+"/"+e.dts+":"+e.debug+","+e.units.length)}},{key:"_parseAVCPES",value:function(e,t){var n,r,i,a=this,o=this._avcTrack,s=this._parseAVCNALu(e.data),u=!1,l=this.avcSample;e.data=null,s.forEach(function(t){switch(t.type){case 1:r=!0,u&&l&&(l.debug+="NDR "),l.frame=!0;var s=t.data;if(s.length>4){var c=new f.default(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(l.key=!0)}break;case 5:r=!0,l||(l=a.avcSample=a._createAVCSample(!0,e.pts,e.dts,"")),u&&(l.debug+="IDR "),l.key=!0,l.frame=!0;break;case 6:r=!0,u&&l&&(l.debug+="SEI "),n=new f.default(a.discardEPB(t.data)),n.readUByte();for(var d=0,h=0,v=!1,_=0;!v&&n.bytesAvailable>1;){d=0;do{_=n.readUByte(),d+=_}while(255===_);h=0;do{_=n.readUByte(),h+=_}while(255===_);if(4===d&&0!==n.bytesAvailable){v=!0;if(181===n.readUByte()){if(49===n.readUShort()){if(1195456820===n.readUInt()){if(3===n.readUByte()){var p=n.readUByte(),m=n.readUByte(),g=31&p,E=[p,m];for(i=0;i<g;i++)E.push(n.readUByte()),E.push(n.readUByte()),E.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:E})}}}}}else if(h<n.bytesAvailable)for(i=0;i<h;i++)n.readUByte()}break;case 7:if(r=!0,u&&l&&(l.debug+="SPS "),!o.sps){n=new f.default(t.data);var y=n.readSPS();o.width=y.width,o.height=y.height,o.pixelRatio=y.pixelRatio,o.sps=[t.data],o.duration=a._duration;var S=t.data.subarray(1,4),T="avc1.";for(i=0;i<3;i++){var b=S[i].toString(16);b.length<2&&(b="0"+b),T+=b}o.codec=T}break;case 8:r=!0,u&&l&&(l.debug+="PPS "),o.pps||(o.pps=[t.data]);break;case 9:r=!1,l&&a.pushAccesUnit(l,o),l=a.avcSample=a._createAVCSample(!1,e.pts,e.dts,u?"AUD ":"");break;case 12:r=!1;break;default:r=!1,l&&(l.debug+="unknown NAL "+t.type+" ")}if(l&&r){l.units.units.push(t)}}),t&&l&&(this.pushAccesUnit(l,o),this.avcSample=null)}},{key:"_createAVCSample",value:function(e,t,n,r){return{key:e,pts:t,dts:n,units:{units:[],length:0},debug:r}}},{key:"_insertSampleInOrder",value:function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.units.length){var n=this._avcTrack,r=n.samples;e=r[r.length-1]}if(e){var i=e.units.units;t=i[i.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t,n,r,i,a,o=0,s=e.byteLength,u=this._avcTrack,l=u.naluState||0,c=l,f=[],d=-1;for(-1===l&&(d=0,a=31&e[0],l=0,o=1);o<s;)if(t=e[o++],l)if(1!==l)if(t)if(1===t){if(d>=0)r={data:e.subarray(d,o-l-1),type:a},f.push(r);else{var h=this._getLastNalUnit();if(h&&(c&&o<=4-c&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-c)),(n=o-l-1)>0)){var v=new Uint8Array(h.data.byteLength+n);v.set(h.data,0),v.set(e.subarray(0,n),h.data.byteLength),h.data=v}}o<s?(i=31&e[o],d=o,a=i,l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(d>=0&&l>=0&&(r={data:e.subarray(d,s),type:a,state:l},f.push(r)),0===f.length){var _=this._getLastNalUnit();if(_){var p=new Uint8Array(_.data.byteLength+e.byteLength);p.set(_.data,0),p.set(e,_.data.byteLength),_.data=p}}return u.naluState=l,f}},{key:"discardEPB",value:function(e){for(var t,n,r=e.byteLength,i=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var o=0;for(a=0;a<t;o++,a++)o===i[0]&&(o++,i.shift()),n[a]=e[o];return n}},{key:"_parseAACPES",value:function(e){var t,n,r,i,a,o,u,c,f,v=this._audioTrack,_=e.data,p=e.pts,m=0,g=this.aacOverFlow,E=this.aacLastPTS;if(g){var y=new Uint8Array(g.byteLength+_.byteLength);y.set(g,0),y.set(_,g.byteLength),_=y}for(a=m,c=_.length;a<c-1&&(255!==_[a]||240!=(240&_[a+1]));a++);if(a){var S,T;if(a<c-1?(S="AAC PES did not start with ADTS header,offset:"+a,T=!1):(S="no ADTS header found in AAC PES",T=!0),d.logger.warn("parsing error:"+S),this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:T,reason:S}),T)return}if(!v.audiosamplerate){var b=this.audioCodec;t=s.default.getAudioConfig(this.observer,_,a,b),v.config=t.config,v.audiosamplerate=t.samplerate,v.channelCount=t.channelCount,v.codec=t.codec,v.manifestCodec=t.manifestCodec,v.duration=this._duration,d.logger.log("parsed codec:"+v.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)}if(i=0,r=1024*9e4/v.audiosamplerate,g&&E){var R=E+r;Math.abs(R-p)>1&&(d.logger.log("AAC: align PTS for overlapping frames by "+Math.round((R-p)/90)),p=R)}for(;a+5<c&&(o=1&_[a+1]?7:9,n=(3&_[a+3])<<11|_[a+4]<<3|(224&_[a+5])>>>5,(n-=o)>0&&a+o+n<=c);)for(u=p+i*r,f={unit:_.subarray(a+o,a+o+n),pts:u,dts:u},v.samples.push(f),v.len+=n,a+=n+o,i++;a<c-1&&(255!==_[a]||240!=(240&_[a+1]));a++);g=a<c?_.subarray(a,c):null,this.aacOverFlow=g,this.aacLastPTS=u}},{key:"_parseMPEGPES",value:function(e){for(var t,n=e.data,r=e.pts,i=n.length,a=0,o=0;o<i&&(t=this._parseMpeg(n,o,i,a++,r))>0;)o+=t}},{key:"_onMpegFrame",value:function(e,t,n,r,i,a){var o=1152/n*1e3,s=a+i*o,u=this._audioTrack;u.config=[],u.channelCount=r,u.audiosamplerate=n,u.duration=this._duration,u.samples.push({unit:e,pts:s,dts:s}),u.len+=e.length}},{key:"_onMpegNoise",value:function(e){d.logger.warn("mpeg audio has noise: "+e.length+" bytes")}},{key:"_parseMpeg",value:function(e,t,n,r,i){var a=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(t+2>n)return-1;if(255===e[t]||224==(224&e[t+1])){if(t+24>n)return-1;var s=e[t+1]>>3&3,u=e[t+1]>>1&3,l=e[t+2]>>4&15,c=e[t+2]>>2&3,f=!!(2&e[t+2]);if(1!==s&&0!==l&&15!==l&&3!==c){var d=3===s?3-u:3===u?3:4,h=1e3*a[14*d+l-1],v=3===s?0:2===s?1:2,_=o[3*v+c],p=f?1:0,m=e[t+3]>>6==3?1:2,g=3===u?(3===s?12:6)*h/_+p<<2:(3===s?144:72)*h/_+p|0;return t+g>n?-1:(this._onMpegFrame&&this._onMpegFrame(e.subarray(t,t+g),h,_,m,r,i),g)}}for(var E=t+2;E<n;){if(255===e[E-1]&&224==(224&e[E]))return this._onMpegNoise&&this._onMpegNoise(e.subarray(t,E-1)),E-t-1;E++}return-1}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=3*188&&71===e[0]&&71===e[188]&&71===e[2*188]}}]),e}();n.default=v},{19:19,23:23,26:26,28:28,45:45}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(45),s=e(26),u=e(28),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(){function e(t){r(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return a(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===i(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(l.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();n.default=c},{26:26,28:28,45:45}],28:[function(e,t,n){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();n.default=a},{}],30:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"isBuffered",value:function(e,t){if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0;return!1}},{key:"bufferInfo",value:function(e,t,n){if(e){var r,i=e.buffered,a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,t,n)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,n){var r,i,a,o,s,u=[];for(e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end}),s=0;s<e.length;s++){var l=u.length;if(l){var c=u[l-1].end;e[s].start-c<n?e[s].end>c&&(u[l-1].end=e[s].end):u.push(e[s])}else u.push(e[s])}for(s=0,r=0,i=a=t;s<u.length;s++){var f=u[s].start,d=u[s].end;if(t+n>=f&&t<d)i=f,a=d,r=a-t;else if(t+n<f){o=f;break}}return{len:r,start:i,end:a,nextStart:o}}}]),e}();n.default=a},{}],31:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(){r(this,e)}return i(e,null,[{key:"mergeDetails",value:function(t,n){var r,i=Math.max(t.startSN,n.startSN)-n.startSN,o=Math.min(t.endSN,n.endSN)-n.startSN,s=n.startSN-t.startSN,u=t.fragments,l=n.fragments,c=0;if(o<i)return void(n.PTSKnown=!1);for(var f=i;f<=o;f++){var d=u[s+f],h=l[f];h&&d&&(c=d.cc-h.cc,isNaN(d.startPTS)||(h.start=h.startPTS=d.startPTS,h.endPTS=d.endPTS,h.duration=d.duration,r=h))}if(c)for(a.logger.log("discontinuity sliding from playlist, take drift into account"),f=0;f<l.length;f++)l[f].cc+=c;if(r)e.updateFragPTSDTS(n,r.sn,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(s>=0&&s<u.length){var v=u[s].start;for(f=0;f<l.length;f++)l[f].start+=v}n.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,n,r,i,a,o){var s,u,l,c;if(!t||n<t.startSN||n>t.endSN)return 0;if(s=n-t.startSN,u=t.fragments,l=u[s],!isNaN(l.startPTS)){var f=Math.abs(l.startPTS-r);isNaN(l.deltaPTS)?l.deltaPTS=f:l.deltaPTS=Math.max(f,l.deltaPTS),r=Math.min(r,l.startPTS),i=Math.max(i,l.endPTS),a=Math.min(a,l.startDTS),o=Math.max(o,l.endDTS)}var d=r-l.start;for(l.start=l.startPTS=r,l.endPTS=i,l.startDTS=a,l.endDTS=o,l.duration=i-r,c=s;c>0;c--)e.updatePTS(u,c,c-1);for(c=s;c<u.length-1;c++)e.updatePTS(u,c,c+1);return t.PTSKnown=!0,d}},{key:"updatePTS",value:function(e,t,n){var r=e[t],i=e[n],o=i.startPTS;isNaN(o)?i.start=n>t?r.start+r.duration:r.start-i.duration:n>t?(r.duration=o-r.start,r.duration<0&&a.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&a.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();n.default=o},{45:45}],32:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),u=e(26),l=e(36),c=r(l),f=e(34),d=r(f),h=e(4),v=r(h),_=e(7),p=r(_),m=e(8),g=r(m),E=e(5),y=r(E),S=e(12),T=r(S),b=e(11),R=r(b),A=e(13),D=r(A),w=e(10),O=r(w),k=e(6),C=r(k),L=e(45),P=e(47),I=r(P),M=e(1),N=r(M),x=e(35),F=r(x),U=e(43),B=r(U),G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var r in n)r in t||(t[r]=n[r]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,L.enableLogs)(t.debug),this.config=t;var a=this.observer=new N.default;a.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.emit.apply(a,[e,e].concat(n))},a.off=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.removeListener.apply(a,[e].concat(n))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a),this.playlistLoader=new c.default(this),this.fragmentLoader=new d.default(this),this.levelController=new R.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new C.default(this),this.keyLoader=new F.default(this)}return a(e,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.21"}},{key:"Events",get:function(){return s.default}},{key:"ErrorTypes",get:function(){return u.ErrorTypes}},{key:"ErrorDetails",get:function(){return u.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:I.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:v.default,bufferController:p.default,capLevelController:g.default,fpsController:O.default,streamController:T.default,audioStreamController:y.default,timelineController:D.default,cueHandler:B.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),a(e,[{key:"destroy",value:function(){L.logger.log("destroy"),this.trigger(s.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){L.logger.log("attachMedia"),this.media=e,this.trigger(s.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){L.logger.log("detachMedia"),this.trigger(s.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){L.logger.log("loadSource:"+e),this.url=e,this.trigger(s.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;L.logger.log("startLoad("+e+")"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){L.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){L.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){L.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){L.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){L.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){L.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(e){L.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){L.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){L.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();n.default=G},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(e,t,n){"use strict";t.exports=e(32).default},{32:32}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.FRAG_LOADING));return n.loaders={},n}return o(t,e),s(t,[{key:"destroy",value:function(){var e=this.loaders;for(var t in e){var n=e[t];n&&n.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=this.hls.config;t.loaded=0,r&&(h.logger.warn("abort previous fragment loader for type:"+n),r.abort()),r=this.loaders[n]=t.loader=void 0!==i.fLoader?new i.fLoader(i):new i.loader(i);var a=void 0,o=void 0,s=void 0;a={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var u=t.byteRangeStartOffset,l=t.byteRangeEndOffset;isNaN(u)||isNaN(l)||(a.rangeStart=u,a.rangeEnd=l),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},r.load(a,o,s)}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=n.frag;i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(l.default.FRAG_LOADED,{payload:r,frag:i,stats:t})}},{key:"loaderror",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(e,t,n){var r=t.frag;r.loaded=e.loaded,this.hls.trigger(l.default.FRAG_LOAD_PROGRESS,{frag:r,stats:e})}}]),t}(f.default);n.default=v},{26:26,27:27,28:28,45:45}],35:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(28),l=r(u),c=e(27),f=r(c),d=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l.default.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return o(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=t.decryptdata,a=i.uri;if(a!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;r&&(h.logger.warn("abort previous key loader for type:"+n),r.abort()),t.loader=this.loaders[n]=new o.loader(o),this.decrypturl=a,this.decryptkey=null;var s=void 0,u=void 0,c=void 0;s={url:a,frag:t,responseType:"arraybuffer"},u={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(s,u,c)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(l.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,n){var r=n.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(l.default.KEY_LOADED,{frag:r})}},{key:"loaderror",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(l.default.ERROR,{type:d.ErrorTypes.NETWORK_ERROR,details:d.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})}}]),t}(f.default);n.default=v},{26:26,27:27,28:28,45:45}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(2),l=r(u),c=e(28),f=r(c),d=e(27),h=r(d),v=e(26),_=e(40),p=r(_),m=e(45),g=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,E=/#EXT-X-MEDIA:(.*)/g,y=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,S=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,T=function(){function e(){o(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return s(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=l.default.buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),e}(),b=function(){function e(){o(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return s(e,[{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var n=e;return e&&e.method&&e.uri&&!e.iv&&(n=new T,n.method=e.method,n.baseuri=e.baseuri,n.reluri=e.reluri,n.iv=this.createInitializationVector(t)),n}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=l.default.buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var n=this.lastByteRangeEndOffset;e[0]=n||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),R=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MANIFEST_LOADING,f.default.LEVEL_LOADING,f.default.AUDIO_TRACK_LOADING));return n.loaders={},n}return a(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(e,t){var n=this.loaders[t.type];if(n){var r=n.context;if(r&&r.url===e)return void m.logger.trace("playlist request ongoing");m.logger.warn("abort previous loader for type:"+t.type),n.abort()}var i=this.hls.config,a=void 0,o=void 0,s=void 0,u=void 0;"manifest"===t.type?(a=i.manifestLoadingMaxRetry,o=i.manifestLoadingTimeOut,s=i.manifestLoadingRetryDelay,u=i.manifestLoadingMaxRetryTimeout):(a=i.levelLoadingMaxRetry,o=i.levelLoadingTimeOut,s=i.levelLoadingRetryDelay,u=i.levelLoadingMaxRetryTimeout,m.logger.log("loading playlist for "+t.type+" "+(t.level||t.id))),n=this.loaders[t.type]=t.loader=void 0!==i.pLoader?new i.pLoader(i):new i.loader(i),t.url=e,t.responseType="";var l=void 0,c=void 0;l={timeout:o,maxRetry:a,retryDelay:s,maxRetryDelay:u},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(t,l,c)}},{key:"resolve",value:function(e,t){return l.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){var n=[],r=void 0;for(g.lastIndex=0;null!=(r=g.exec(e));){var i={},a=i.attrs=new p.default(r[1]);i.url=this.resolve(r[2],t);var o=a.decimalResolution("RESOLUTION");o&&(i.width=o.width,i.height=o.height),i.bitrate=a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),i.name=a.NAME;var s=a.CODECS;if(s){s=s.split(/[ ,]+/);for(var u=0;u<s.length;u++){var l=s[u];-1!==l.indexOf("avc1")?i.videoCodec=this.avc1toavcoti(l):i.audioCodec=l}}n.push(i)}return n}},{key:"parseMasterPlaylistMedia",value:function(e,t,n){var r=void 0,i=[];for(E.lastIndex=0;null!=(r=E.exec(e));){var a={},o=new p.default(r[1]);o.TYPE===n&&(a.groupId=o["GROUP-ID"],a.name=o.NAME,a.type=n,a.default="YES"===o.DEFAULT,a.autoselect="YES"===o.AUTOSELECT,a.forced="YES"===o.FORCED,o.URI&&(a.url=this.resolve(o.URI,t)),a.lang=o.LANGUAGE,a.name||(a.name=a.lang),i.push(a))}return i}},{key:"avc1toavcoti",value:function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseLevelPlaylist",value:function(e,t,n,r){var i,a,o=0,s=0,u={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},l=new T,c=0,f=null,d=new b;for(y.lastIndex=0;null!==(i=y.exec(e));){var h=i[1];if(h){d.duration=parseFloat(h);var v=(" "+i[2]).slice(1);d.title=v||null,d.tagList.push(v?["INF",h,v]:["INF",h])}else if(i[3]){if(!isNaN(d.duration)){var _=o++;d.type=r,d.start=s,d.levelkey=l,d.sn=_,d.level=n,d.cc=c,d.baseurl=t,d.relurl=(" "+i[3]).slice(1),u.fragments.push(d),f=d,s+=d.duration,d=new b}}else if(i[4]){if(d.rawByteRange=(" "+i[4]).slice(1),f){var g=f.byteRangeEndOffset;g&&(d.lastByteRangeEndOffset=g)}}else if(i[5])d.rawProgramDateTime=(" "+i[5]).slice(1),d.tagList.push(["PROGRAM-DATE-TIME",d.rawProgramDateTime]);else{for(i=i[0].match(S),a=1;a<i.length&&void 0===i[a];a++);var E=(" "+i[a+1]).slice(1),R=(" "+i[a+2]).slice(1);switch(i[a]){case"#":d.tagList.push(R?[E,R]:[E]);break;case"PLAYLIST-TYPE":u.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":o=u.startSN=parseInt(E);break;case"TARGETDURATION":u.targetduration=parseFloat(E);break;case"VERSION":u.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":c++,d.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(E);break;case"KEY":var A=E,D=new p.default(A),w=D.enumeratedString("METHOD"),O=D.URI,k=D.hexadecimalInteger("IV");w&&(l=new T,O&&"AES-128"===w&&(l.method=w,l.baseuri=t,l.reluri=O,l.key=null,l.iv=k));break;case"START":var C=E,L=new p.default(C),P=L.decimalFloatingPoint("TIME-OFFSET");isNaN(P)||(u.startTimeOffset=P);break;case"MAP":var I=new p.default(E);d.relurl=I.URI,d.rawByteRange=I.BYTERANGE,d.baseurl=t,d.level=n,d.type=r,d.sn="initSegment",u.initSegment=d,d=new b;break;default:m.logger.warn("line parsed but not handled: "+i)}}}return d=f,d&&!d.relurl&&(u.fragments.pop(),s-=d.duration),u.totalduration=s,u.averagetargetduration=s/u.fragments.length,u.endSN=o-1,u}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=e.url,a=n.type,o=n.id,s=n.level,u=this.hls;if(this.loaders[a]=void 0,void 0!==i&&0!==i.indexOf("data:")||(i=n.url),t.tload=performance.now(),0===r.indexOf("#EXTM3U"))if(r.indexOf("#EXTINF:")>0){var l="audioTrack"!==a,c=this.parseLevelPlaylist(r,i,(l?s:o)||0,l?"main":"audio");"manifest"===a&&u.trigger(f.default.MANIFEST_LOADED,{levels:[{url:i,details:c}],audioTracks:[],url:i,stats:t}),t.tparsed=performance.now(),c.targetduration?l?u.trigger(f.default.LEVEL_LOADED,{details:c,level:s||0,id:o||0,stats:t}):u.trigger(f.default.AUDIO_TRACK_LOADED,{details:c,id:o,stats:t}):u.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"invalid targetduration"})}else{var d=this.parseMasterPlaylist(r,i);if(d.length){var h=this.parseMasterPlaylistMedia(r,i,"AUDIO");if(h.length){var _=!1;h.forEach(function(e){e.url||(_=!0)}),!1===_&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(m.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main"}))}u.trigger(f.default.MANIFEST_LOADED,{levels:d,audioTracks:h,url:i,stats:t})}else u.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no level found in manifest"})}else u.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,response:e,context:t})}},{key:"loadtimeout",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_TIMEOUT,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_TIMEOUT,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,context:t})}}]),t}(h.default);n.default=R},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,u,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;i--;)r+=n[i].byteLength;for(t=new Uint8Array(r),t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<a;i++)t.set(n[i],r),r+=n[i].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){return n*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))}},{key:"moov",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))}},{key:"mvhd",value:function(t,n){n*=t;var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,r)}},{key:"sdtp",value:function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,r,i,a=[],o=[];for(n=0;n<t.sps.length;n++)r=t.sps[n],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)r=t.pps[n],i=r.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],252|3,224|t.sps.length].concat(a).concat([t.pps.length]).concat(o))),u=t.width,l=t.height,c=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,f>>24,f>>16&255,f>>8&255,255&f])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var n=t.audiosamplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,a=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,n){var r=e.sdtp(t),i=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var r,i,a,o,s,u,l=t.samples||[],c=l.length,f=12+16*c,d=new Uint8Array(f);for(n+=8+f,d.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)i=l[r],a=i.duration,o=i.size,s=i.flags,u=i.cts,d.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,s.degradPrio&240<<8,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,d)}},{key:"initSegment",value:function(t){e.types||e.init();var n,r=e.moov(t);return n=new Uint8Array(e.FTYP.byteLength+r.byteLength),n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n}}]),e}();n.default=a},{}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(29),s=r(o),u=e(28),l=r(u),c=e(45),f=e(37),d=r(f),h=e(26),v=function(){function e(t,n,r,a){i(this,e),this.observer=t,this.id=n,this.config=r,this.typeSupported=a,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return a(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a,o,s,u,c,f){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(r,i,s,n),null!==f&&(this._initPTS=this._initDTS=f),this.ISGenerated)if(r.samples.length){var d=this.remuxAudio(r,s,u,c);if(i.samples.length){var h=void 0;d&&(h=d.endPTS-d.startPTS),this.remuxVideo(i,s,u,h)}}else{var v=void 0;i.samples.length&&(v=this.remuxVideo(i,s,u)),v&&r.codec&&this.remuxEmptyAudio(r,s,u,v)}a.samples.length&&this.remuxID3(a,s),o.samples.length&&this.remuxText(o,s),this.observer.trigger(l.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,n,r){var i,a,o=this.observer,s=e.samples,u=t.samples,f=this.PES_TIMESCALE,v=this.typeSupported,_="audio/mp4",p={},m={id:this.id,level:this.level,sn:this.sn,tracks:p,unique:!1},g=void 0===this._initPTS;g&&(i=a=1/0),e.config&&s.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&function(){e.timescale=e.audiosamplerate/function e(t,n){return n?e(n,t%n):t}(e.audiosamplerate,e.isAAC?1024:1152)}(),c.logger.log("audio mp4 timescale :"+e.timescale),e.isAAC||(v.mpeg?(_="audio/mpeg",e.codec=""):v.mp3&&(e.codec="mp3")),p.audio={container:_,codec:e.codec,initSegment:!e.isAAC&&v.mpeg?new Uint8Array:d.default.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(i=a=s[0].pts-f*n)),t.sps&&t.pps&&u.length&&(t.timescale=this.MP4_TIMESCALE,p.video={container:"video/mp4",codec:t.codec,initSegment:d.default.initSegment([t]),metadata:{width:t.width,height:t.height}},g&&(i=Math.min(i,u[0].pts-f*n),a=Math.min(a,u[0].dts-f*n),this.observer.trigger(l.default.INIT_PTS_FOUND,{id:this.id,initPTS:i,cc:r}))),Object.keys(p).length?(o.trigger(l.default.FRAG_PARSING_INIT_SEGMENT,m),this.ISGenerated=!0,g&&(this._initPTS=i,this._initDTS=a)):o.trigger(l.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,r){var i,a,o,s,u,f,v,_=8,p=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,g=e.samples,E=[],y=g.length,S=this._PTSNormalize,T=this._initDTS;g.sort(function(e,t){var n=e.dts-t.dts;return n||e.pts-t.pts});var b=g.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(b<0){c.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var R=0;R<g.length;R++)g[R].dts+=b}var A=void 0;A=n?this.nextAvcDts:t*p;var D=g[0];u=Math.max(S(D.dts-T,A),0),s=Math.max(S(D.pts-T,A),0);var w=Math.round((u-A)/90);n&&w&&(w>1?c.logger.log("AVC:"+w+" ms hole between fragments detected,filling it"):w<-1&&c.logger.log("AVC:"+-w+" ms overlapping between fragments detected"),u=A,g[0].dts=u+T,s=Math.max(s-w,A),g[0].pts=s+T,c.logger.log("Video/PTS/DTS adjusted: "+Math.round(s/90)+"/"+Math.round(u/90)+",delta:"+w+" ms")),D=g[g.length-1],v=Math.max(S(D.dts-T,A),0),f=Math.max(S(D.pts-T,A),0),f=Math.max(f,v);var O=navigator.vendor,k=navigator.userAgent,C=O&&O.indexOf("Apple")>-1&&k&&!k.match("CriOS");C&&(i=Math.round((v-u)/(m*(g.length-1))));for(var L=0;L<y;L++){var P=g[L];C?P.dts=u+L*m*i:(P.dts=Math.max(S(P.dts-T,A),u),P.dts=Math.round(P.dts/m)*m),P.pts=Math.max(S(P.pts-T,A),P.dts),P.pts=Math.round(P.pts/m)*m}var I=e.len+4*e.nbNalu+8;try{a=new Uint8Array(I)}catch(e){return void this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:I,reason:"fail allocating video mdat "+I})}var M=new DataView(a.buffer);M.setUint32(0,I),a.set(d.default.types.mdat,4);for(var N=0;N<y;N++){for(var x=g[N],F=x.units.units,U=0,B=void 0,G=0,H=F.length;G<H;G++){var j=F[G],W=j.data,V=j.data.byteLength;M.setUint32(_,V),_+=4,a.set(W,_),_+=V,U+=4+V}if(C)B=Math.max(0,i*Math.round((x.pts-x.dts)/(m*i)));else{if(N<y-1)i=g[N+1].dts-x.dts;else{var K=this.config,Y=x.dts-g[N>0?N-1:N].dts;if(K.stretchShortVideoTrack){var q=K.maxBufferHole,X=K.maxSeekHole,z=Math.floor(Math.min(q,X)*p),Q=(r?s+r*p:this.nextAudioPts)-x.pts;Q>z?(i=Q-Y,i<0&&(i=Y),c.logger.log("It is approximately "+Q/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=Y}else i=Y}i/=m,B=Math.round((x.pts-x.dts)/m)}E.push({size:U,duration:i,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:x.key?2:1,isNonSync:x.key?0:1}})}this.nextAvcDts=v+i*m;var Z=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,E.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var J=E[0].flags;J.dependsOn=2,J.isNonSync=0}e.samples=E,o=d.default.moof(e.sequenceNumber++,u/m,e),e.samples=[];var $={id:this.id,level:this.level,sn:this.sn,data1:o,data2:a,startPTS:s/p,endPTS:(f+m*i)/p,startDTS:u/p,endDTS:this.nextAvcDts/p,type:"video",nb:E.length,dropped:Z};return this.observer.trigger(l.default.FRAG_PARSING_DATA,$),$}},{key:"remuxAudio",value:function(e,t,n,r){var i,a,o,u,f,v,_,p,m,g,E,y,S,T,b,R,A=this.PES_TIMESCALE,D=e.timescale,w=A/D,O=e.timescale*(e.isAAC?1024:1152)/e.audiosamplerate,k=O*w,C=this._PTSNormalize,L=this._initDTS,P=!e.isAAC&&this.typeSupported.mpeg,I=P?0:8,M=[],N=[];if(e.samples.sort(function(e,t){return e.pts-t.pts}),N=e.samples,R=this.nextAudioPts,n|=N.length&&R&&(Math.abs(t-R/A)<.1||Math.abs(N[0].pts-R-this._initDTS)<20*k),n||(R=t*A),r&&e.isAAC)for(var x=0,F=R;x<N.length;){var U=N[x],B=C(U.pts-L,R),G=B-F;if(G<=-k)c.logger.warn("Dropping 1 audio frame @ "+Math.round(F/90)/1e3+"s due to "+Math.round(Math.abs(G/90))+" ms overlap."),N.splice(x,1),e.len-=U.unit.length;else if(G>=k&&F){var H=Math.round(G/k);c.logger.warn("Injecting "+H+" audio frame @ "+Math.round(F/90)/1e3+"s due to "+Math.round(G/90)+" ms gap.");for(var j=0;j<H;j++)b=F+L,b=Math.max(b,L),T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),T=U.unit.subarray()),N.splice(x,0,{unit:T,pts:b,dts:b}),e.len+=T.length,F+=k,x+=1;U.pts=U.dts=F+L,F+=k,x+=1}else Math.abs(G),F+=k,U.pts=U.dts=0===x?L+R:N[x-1].pts+k,x+=1}for(var W=0,V=N.length;W<V;W++){if(a=N[W],u=a.unit,g=a.pts-L,E=a.dts-L,void 0!==m)y=C(g,m),S=C(E,m),o.duration=Math.round((S-m)/w);else{y=C(g,R),S=C(E,R);var K=Math.round(1e3*(y-R)/A),Y=0;if(n&&e.isAAC&&K){if(K>0)Y=Math.round((y-R)/k),c.logger.log(K+" ms hole between AAC samples detected,filling it"),Y>0&&(T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(T=u.subarray()),e.len+=Y*T.length);else if(K<-12){c.logger.log(-K+" ms overlapping between AAC samples detected, drop frame"),e.len-=u.byteLength;continue}y=S=R}if(_=Math.max(0,y),p=Math.max(0,S),!(e.len>0))return;var q=P?e.len:e.len+8;try{f=new Uint8Array(q)}catch(e){return void this.observer.trigger(l.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:q,reason:"fail allocating audio mdat "+q})}P||(i=new DataView(f.buffer),i.setUint32(0,q),f.set(d.default.types.mdat,4));for(var X=0;X<Y;X++)b=y-(Y-X)*k,T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),T=u.subarray()),f.set(T,I),I+=T.byteLength,o={size:T.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o)}f.set(u,I);var z=u.byteLength;I+=z,o={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o),m=S}var Q=0,Z=M.length;if(Z>=2&&(Q=M[Z-2].duration,o.duration=Q),Z){this.nextAudioPts=y+w*Q,e.len=0,e.samples=M,v=P?new Uint8Array:d.default.moof(e.sequenceNumber++,p/w,e),e.samples=[];var J={id:this.id,level:this.level,sn:this.sn,data1:v,data2:f,startPTS:_/A,endPTS:this.nextAudioPts/A,startDTS:p/A,endDTS:(S+w*Q)/A,type:"audio",nb:Z};return this.observer.trigger(l.default.FRAG_PARSING_DATA,J),J}return null}},{key:"remuxEmptyAudio",value:function(e,t,n,r){var i=this.PES_TIMESCALE,a=e.timescale?e.timescale:e.audiosamplerate,o=i/a,u=this.nextAudioPts,l=(void 0!==u?u:r.startDTS*i)+this._initDTS,f=r.endDTS*i+this._initDTS,d=1024,h=o*d,v=Math.ceil((f-l)/h),_=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(c.logger.warn("remux empty Audio"),!_)return void c.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],m=0;m<v;m++){var g=l+m*h;p.push({unit:_,pts:g,dts:g}),e.len+=_.length}e.samples=p,this.remuxAudio(e,t,n)}},{key:"remuxID3",value:function(e,t){var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE,n.dts=(n.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(l.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(l.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}},{key:"passthrough",get:function(){return!1}}]),e}();n.default=v},{26:26,28:28,29:29,37:37,45:45}],39:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(28),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n){r(this,e),this.observer=t,this.id=n,this.ISGenerated=!1}return i(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a){var s=this.observer;if(!this.ISGenerated){var u={},l={id:this.id,tracks:u,unique:!0},c=t,f=c.codec;f&&(l.tracks.video={container:c.container,codec:f,metadata:{width:c.width,height:c.height}}),c=e,f=c.codec,f&&(l.tracks.audio={container:c.container,codec:f,metadata:{channelCount:c.channelCount}}),this.ISGenerated=!0,s.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,l)}s.trigger(o.default.FRAG_PARSING_DATA,{id:this.id,data1:a,startPTS:i,startDTS:i,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();n.default=s},{28:28}],40:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){r(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}return i(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=a.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,n={};for(o.lastIndex=0;null!==(t=o.exec(e));){var r=t[2],i='"';0===r.indexOf(i)&&r.lastIndexOf(i)===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n}}]),e}();n.default=s},{}],41:[function(e,t,n){"use strict";var r={search:function(e,t){for(var n=0,r=e.length-1,i=null,a=null;n<=r;){i=(n+r)/2|0,a=e[i];var o=t(a);if(o>0)n=i+1;else{if(!(o<0))return a;r=i-1}}return null}};t.exports=r},{}],42:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(e){var t=e;return a.hasOwnProperty(e)&&(t=a[e]),String.fromCharCode(t)},s=15,u=32,l={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},d={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],v={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},_=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},p=function(){function e(t,n,i,a,o){r(this,e),this.foreground=t||"white",this.underline=n||!1,this.italics=i||!1,this.background=a||"black",this.flash=o||!1}return i(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),m=function(){function e(t,n,i,a,o,s){r(this,e),this.uchar=t||" ",this.penState=new p(n,i,a,o,s)}return i(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),g=function(){function e(){r(this,e),this.chars=[];for(var t=0;t<u;t++)this.chars.push(new m);this.pos=0,this.currPenState=new p}return i(e,[{key:"equals",value:function(e){for(var t=!0,n=0;n<u;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<u;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<u;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(v.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(v.log("ERROR","Too large cursor position "+this.pos),this.pos=u)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=o(e);if(this.pos>=u)return void v.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<u;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,n=0;n<u;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),E=function(){function e(){r(this,e),this.rows=[];for(var t=0;t<s;t++)this.rows.push(new g);this.currRow=s-1,this.nrRollUpRows=null,this.reset()}return i(e,[{key:"reset",value:function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1}},{key:"equals",value:function(e){for(var t=!0,n=0;n<s;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){v.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e,t){v.log("INFO","pacData = "+JSON.stringify(e));var n=e.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==n){for(var r=0;r<s;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=t.rows[i].cueStartTime;if(a&&a<v.time)for(r=0;r<this.nrRollUpRows;r++)this.rows[n-this.nrRollUpRows+r+1].copy(t.rows[i+r])}this.currRow=n;var o=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,l=Math.max(u-1,0);o.setCursor(e.indent),e.color=o.chars[l].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)}},{key:"setBkgData",value:function(e){v.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void v.log("DEBUG","roll_up but nrRollUpRows not set yet");v.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),v.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<s;i++){var a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),y=function(){function e(t,n){r(this,e),this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new E,this.nonDisplayedMemory=new E,this.lastOutputScreen=new E,this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return i(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e,this.lastOutputScreen)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,v.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";v.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(v.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){v.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){v.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){v.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){v.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){v.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){v.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){v.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){v.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){v.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){v.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){v.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(v.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,v.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){v.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}v.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=v.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),S=function(){function e(t,n,i){r(this,e),this.field=t||1,this.outputs=[n,i],this.channels=[new y(1,n),new y(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return i(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var n,r,i,a=!1;this.lastTime=e,v.setTime(e);for(var o=0;o<t.length;o+=2)if(r=127&t[o],i=127&t[o+1],0!==r||0!==i){if(v.log("DATA","["+_([t[o],t[o+1]])+"] -> ("+_([r,i])+")"),n=this.parseCmd(r,i),n||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(a=this.parseChars(r,i)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(a)}else v.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,v.log("WARNING","Couldn't parse cleaned data "+_([r,i])+" orig: "+_([t[o],t[o+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var n=null,r=(20===e||28===e)&&32<=t&&t<=47,i=(23===e||31===e)&&33<=t&&t<=35;if(!r&&!i)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,v.log("DEBUG","Repeated command ("+_([e,t])+") is dropped"),!0;n=20===e||23===e?1:2;var a=this.channels[n-1];return 20===e||28===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"parseMidrow",value:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return v.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[n-1].ccMIDROW(t),v.log("DEBUG","MIDROW ("+_([e,t])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var n=null,r=null,i=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,a=(16===e||24===e)&&64<=t&&t<=95;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=e<=23?1:2,r=64<=t&&t<=95?1===n?l[e]:f[e]:1===n?c[e]:d[e];var o=this.interpretPAC(r,t);return this.channels[n-1].setPAC(o),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"interpretPAC",value:function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}},{key:"parseChars",value:function(e,t){var n=null,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),17<=i&&i<=19){var a=t;a=17===i?t+80:18===i?t+112:t+144,v.log("INFO","Special char '"+o(a)+"' in channel "+n),r=[a]}else 32<=e&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=_(r);v.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r}},{key:"parseBackgroundAttributes",value:function(e,t){var n,r,i,a,o=(16===e||24===e)&&32<=t&&t<=47,s=(23===e||31===e)&&45<=t&&t<=47;return!(!o&&!s)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=h[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,a=this.channels[i-1],a.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();n.default=S},{}],43:[function(e,t,n){"use strict";var r={newCue:function(e,t,n,r){for(var i,a,o,s,u,l=window.VTTCue||window.TextTrackCue,c=0;c<r.rows.length;c++)if(i=r.rows[c],o=!0,s=0,u="",!i.isEmpty()){for(var f=0;f<i.chars.length;f++)i.chars[f].uchar.match(/\s/)&&o?s++:(u+=i.chars[f].uchar,o=!1);i.cueStartTime=t,a=new l(t,n,u.trim()),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?a.line=c+1:a.line=c>7?c-2:c+1,a.align="left",a.position=Math.max(0,Math.min(100,100*(s/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}};t.exports=r},{}],44:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return i(e,[{key:"sample",value:function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();n.default=a},{}],45:[function(e,t,n){"use strict";function r(){}function i(e,t){return t="["+e+"] > "+t}function a(e){var t=self.console[e];return t?function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];r[0]&&(r[0]=i(e,r[0])),t.apply(self.console,r)}:r}function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){l[t]=e[t]?e[t].bind(e):a(t)})}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u={trace:r,debug:r,log:r,warn:r,info:r,error:r},l=u;n.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":s(e))){o(e,"debug","log","info","warn","error");try{l.log()}catch(e){l=u}}else l=u},n.logger=l},{}],46:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"toString",value:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}}]),e}();n.default=a},{}],47:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return i(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var n=this.stats;n.tfirst=0,n.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(performance.now(),r.trequest)),4===n){var s=t.status;if(s>=200&&s<300){r.tload=Math.max(r.tfirst,performance.now());var u=void 0,l=void 0;"arraybuffer"===i.responseType?(u=t.response,l=u.byteLength):(u=t.responseText,l=u.length),r.loaded=r.total=l;var c={url:t.responseURL,data:u};this.callbacks.onSuccess(c,r,i)}else r.retry>=o.maxRetry||s>=400&&s<499?(a.logger.error(s+" while loading "+i.url),this.callbacks.onError({code:s,text:t.statusText},i)):(a.logger.warn(s+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)}},{key:"loadtimeout",value:function(){a.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null)}}]),e}();n.default=o},{45:45}]},{},[33])(33)})},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),l=n.slice(),i=l.length,u=0;u<i;u++)l[u].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e="/Users/jlouazel/Streamroot/panama/lib/ManifestHandler.js",t="e01f62aefc71805f1e1bbb15a0cc1a7c10e204ec",n=new Function("return this")(),r="__coverage__",i={path:"/Users/jlouazel/Streamroot/panama/lib/ManifestHandler.js",statementMap:{0:{start:{line:1,column:33},end:{line:1,column:43}},1:{start:{line:2,column:27},end:{line:2,column:28}},2:{start:{line:3,column:26},end:{line:3,column:28}},3:{start:{line:7,column:4},end:{line:7,column:26}},4:{start:{line:8,column:4},end:{line:8,column:31}},5:{start:{line:9,column:4},end:{line:9,column:28}},6:{start:{line:10,column:4},end:{line:10,column:24}},7:{start:{line:14,column:4},end:{line:14,column:36}},8:{start:{line:18,column:4},end:{line:18,column:29}},9:{start:{line:22,column:4},end:{line:25,column:5}},10:{start:{line:23,column:6},end:{line:23,column:54}},11:{start:{line:24,column:6},end:{line:24,column:13}},12:{start:{line:27,column:18},end:{line:27,column:62}},13:{start:{line:29,column:35},end:{line:29,column:79}},14:{start:{line:30,column:4},end:{line:30,column:32}},15:{start:{line:32,column:4},end:{line:32,column:81}},16:{start:{line:34,column:4},end:{line:34,column:33}},17:{start:{line:38,column:4},end:{line:42,column:5}},18:{start:{line:39,column:20},end:{line:39,column:54}},19:{start:{line:40,column:28},end:{line:40,column:89}},20:{start:{line:41,column:6},end:{line:41,column:48}},21:{start:{line:44,column:4},end:{line:44,column:73}},22:{start:{line:48,column:22},end:{line:48,column:43}},23:{start:{line:50,column:15},end:{line:50,column:16}},24:{start:{line:51,column:16},end:{line:51,column:17}},25:{start:{line:53,column:4},end:{line:62,column:5}},26:{start:{line:54,column:23},end:{line:54,column:35}},27:{start:{line:56,column:6},end:{line:56,column:32}},28:{start:{line:57,column:6},end:{line:57,column:17}},29:{start:{line:59,column:6},end:{line:61,column:7}},30:{start:{line:60,column:8},end:{line:60,column:14}},31:{start:{line:64,column:4},end:{line:64,column:17}},32:{start:{line:68,column:17},end:{line:68,column:40}},33:{start:{line:70,column:22},end:{line:70,column:43}},34:{start:{line:71,column:27},end:{line:71,column:53}},35:{start:{line:73,column:16},end:{line:73,column:17}},36:{start:{line:74,column:4},end:{line:85,column:5}},37:{start:{line:75,column:23},end:{line:75,column:35}},38:{start:{line:77,column:28},end:{line:77,column:49}},39:{start:{line:78,column:30},end:{line:78,column:57}},40:{start:{line:80,column:6},end:{line:82,column:7}},41:{start:{line:81,column:8},end:{line:81,column:14}},42:{start:{line:84,column:6},end:{line:84,column:37}},43:{start:{line:87,column:4},end:{line:87,column:17}},44:{start:{line:91,column:22},end:{line:91,column:35}},45:{start:{line:92,column:16},end:{line:92,column:17}},46:{start:{line:93,column:22},end:{line:93,column:43}},47:{start:{line:94,column:27},end:{line:94,column:53}},48:{start:{line:96,column:4},end:{line:104,column:5}},49:{start:{line:97,column:23},end:{line:97,column:35}},50:{start:{line:98,column:6},end:{line:98,column:39}},51:{start:{line:99,column:6},end:{line:99,column:17}},52:{start:{line:101,column:6},end:{line:103,column:7}},53:{start:{line:102,column:8},end:{line:102,column:14}},54:{start:{line:106,column:4},end:{line:106,column:17}},55:{start:{line:110,column:19},end:{line:110,column:45}},56:{start:{line:111,column:18},end:{line:111,column:50}},57:{start:{line:113,column:28},end:{line:113,column:29}},58:{start:{line:114,column:22},end:{line:114,column:43}},59:{start:{line:116,column:23},end:{line:116,column:42}},60:{start:{line:118,column:36},end:{line:118,column:38}},61:{start:{line:119,column:4},end:{line:133,column:5}},62:{start:{line:120,column:6},end:{line:120,column:49}},63:{start:{line:121,column:6},end:{line:126,column:7}},64:{start:{line:122,column:8},end:{line:125,column:9}},65:{start:{line:123,column:10},end:{line:123,column:40}},66:{start:{line:124,column:10},end:{line:124,column:16}},67:{start:{line:128,column:6},end:{line:132,column:7}},68:{start:{line:131,column:8},end:{line:131,column:56}},69:{start:{line:135,column:4},end:{line:138,column:6}},70:{start:{line:143,column:4},end:{line:143,column:34}},71:{start:{line:147,column:4},end:{line:147,column:40}},72:{start:{line:152,column:4},end:{line:152,column:38}},73:{start:{line:156,column:22},end:{line:156,column:43}},74:{start:{line:157,column:4},end:{line:159,column:5}},75:{start:{line:158,column:6},end:{line:158,column:33}},76:{start:{line:160,column:4},end:{line:160,column:16}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:6,column:2},end:{line:6,column:3}},loc:{start:{line:6,column:23},end:{line:11,column:3}},line:6},1:{name:"(anonymous_1)",decl:{start:{line:13,column:2},end:{line:13,column:3}},loc:{start:{line:13,column:31},end:{line:15,column:3}},line:13},2:{name:"(anonymous_2)",decl:{start:{line:17,column:2},end:{line:17,column:3}},loc:{start:{line:17,column:20},end:{line:19,column:3}},line:17},3:{name:"(anonymous_3)",decl:{start:{line:21,column:2},end:{line:21,column:3}},loc:{start:{line:21,column:50},end:{line:35,column:3}},line:21},4:{name:"(anonymous_4)",decl:{start:{line:37,column:2},end:{line:37,column:3}},loc:{start:{line:37,column:42},end:{line:45,column:3}},line:37},5:{name:"(anonymous_5)",decl:{start:{line:47,column:2},end:{line:47,column:3}},loc:{start:{line:47,column:30},end:{line:65,column:3}},line:47},6:{name:"(anonymous_6)",decl:{start:{line:67,column:2},end:{line:67,column:3}},loc:{start:{line:67,column:50},end:{line:88,column:3}},line:67},7:{name:"(anonymous_7)",decl:{start:{line:90,column:2},end:{line:90,column:3}},loc:{start:{line:90,column:32},end:{line:107,column:3}},line:90},8:{name:"(anonymous_8)",decl:{start:{line:109,column:2},end:{line:109,column:3}},loc:{start:{line:109,column:47},end:{line:139,column:3}},line:109},9:{name:"(anonymous_9)",decl:{start:{line:142,column:2},end:{line:142,column:3}},loc:{start:{line:142,column:19},end:{line:144,column:3}},line:142},10:{name:"(anonymous_10)",decl:{start:{line:146,column:2},end:{line:146,column:3}},loc:{start:{line:146,column:24},end:{line:148,column:3}},line:146},11:{name:"(anonymous_11)",decl:{start:{line:151,column:2},end:{line:151,column:3}},loc:{start:{line:151,column:26},end:{line:153,column:3}},line:151},12:{name:"(anonymous_12)",decl:{start:{line:155,column:2},end:{line:155,column:3}},loc:{start:{line:155,column:26},end:{line:161,column:3}},line:155}},branchMap:{0:{loc:{start:{line:22,column:4},end:{line:25,column:5}},type:"if",locations:[{start:{line:22,column:4},end:{line:25,column:5}},{start:{line:22,column:4},end:{line:25,column:5}}],line:22},1:{loc:{start:{line:38,column:4},end:{line:42,column:5}},type:"if",locations:[{start:{line:38,column:4},end:{line:42,column:5}},{start:{line:38,column:4},end:{line:42,column:5}}],line:38},2:{loc:{start:{line:59,column:6},end:{line:61,column:7}},type:"if",locations:[{start:{line:59,column:6},end:{line:61,column:7}},{start:{line:59,column:6},end:{line:61,column:7}}],line:59},3:{loc:{start:{line:59,column:10},end:{line:59,column:66}},type:"binary-expr",locations:[{start:{line:59,column:10},end:{line:59,column:35}},{start:{line:59,column:39},end:{line:59,column:66}}],line:59},4:{loc:{start:{line:80,column:6},end:{line:82,column:7}},type:"if",locations:[{start:{line:80,column:6},end:{line:82,column:7}},{start:{line:80,column:6},end:{line:82,column:7}}],line:80},5:{loc:{start:{line:80,column:10},end:{line:80,column:43}},type:"binary-expr",locations:[{start:{line:80,column:10},end:{line:80,column:23}},{start:{line:80,column:27},end:{line:80,column:43}}],line:80},6:{loc:{start:{line:101,column:6},end:{line:103,column:7}},type:"if",locations:[{start:{line:101,column:6},end:{line:103,column:7}},{start:{line:101,column:6},end:{line:103,column:7}}],line:101},7:{loc:{start:{line:122,column:8},end:{line:125,column:9}},type:"if",locations:[{start:{line:122,column:8},end:{line:125,column:9}},{start:{line:122,column:8},end:{line:125,column:9}}],line:122},8:{loc:{start:{line:128,column:6},end:{line:132,column:7}},type:"if",locations:[{start:{line:128,column:6},end:{line:132,column:7}},{start:{line:128,column:6},end:{line:132,column:7}}],line:128},9:{loc:{start:{line:157,column:4},end:{line:159,column:5}},type:"if",locations:[{start:{line:157,column:4},end:{line:159,column:5}},{start:{line:157,column:4},end:{line:159,column:5}}],line:157}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(i.s[0]++,"#EXTINF:"),s=(i.s[1]++,3),u=(i.s[2]++,10),l=function(){function e(t){r(this,e),i.f[0]++,i.s[3]++,this._bufferLevel=0,i.s[4]++,this._firstPlaylist=!0,i.s[5]++,this._latency=t,i.s[6]++,this._lastSN=null}return a(e,[{key:"truncate",value:function(e,t,n,r){if(i.f[3]++,i.s[9]++,!t.details.live)return i.b[0][0]++,i.s[10]++,r(n,this._playlistDuration(t)),void i.s[11]++;i.b[0][1]++;var a=(i.s[12]++,this._extraSegmentsCount(e,t)),o=(i.s[13]++,this._truncateSegments(a,t,n)),s=o.manifest,u=o.duration;i.s[14]++,this._firstPlaylist=!1,i.s[15]++,this._lastSN=this._snAtIndex(t,this._playlistLength(t)-a-1),i.s[16]++,r(s,u)}},{key:"_extraSegmentsCount",value:function(e,t){if(i.f[4]++,i.s[17]++,this._firstPlaylist){i.b[1][0]++;var n=(i.s[18]++,this._latencyToSegmentsCount(t)),r=(i.s[19]++,this._playbackCount(t,this._playlistLength(t)-n));return i.s[20]++,Math.max(n-r,0)}return i.b[1][1]++,i.s[21]++,this._segmentCountFrom(e,t,this._bufferLevel)}},{key:"_playbackCount",value:function(e,t){i.f[5]++;var n=(i.s[22]++,this._fragments(e)),r=(i.s[23]++,0),a=(i.s[24]++,0);i.s[25]++;for(var o=t;o<n.length;o++){var l=(i.s[26]++,n[o]);if(i.s[27]++,r+=l.duration,i.s[28]++,a+=1,i.s[29]++,i.b[3][0]++,r>=u&&(i.b[3][1]++,a>=s)){i.b[2][0]++,i.s[30]++;break}i.b[2][1]++}return i.s[31]++,a}},{key:"_segmentCountFrom",value:function(e,t,n){i.f[6]++;var r=(i.s[32]++,e+n),a=(i.s[33]++,this._fragments(t)),o=(i.s[34]++,this._playlistLength(t)),s=(i.s[35]++,0);i.s[36]++;for(var u=o-1;u>=0;u--){var l=(i.s[37]++,a[u]),c=(i.s[38]++,l.start<r),f=(i.s[39]++,l.sn>=this._lastSN);if(i.s[40]++,i.b[5][0]++,c||(i.b[5][1]++,!f)){i.b[4][0]++,i.s[41]++;break}i.b[4][1]++,i.s[42]++,s=o-u-1}return i.s[43]++,s}},{key:"_latencyToSegmentsCount",value:function(e){i.f[7]++;var t=(i.s[44]++,this._latency),n=(i.s[45]++,0),r=(i.s[46]++,this._fragments(e)),a=(i.s[47]++,this._playlistLength(e));i.s[48]++;for(var o=a-1;o>=0;o--){var s=(i.s[49]++,r[o]);if(i.s[50]++,t-=s.duration,i.s[51]++,n+=1,i.s[52]++,t<=0){i.b[6][0]++,i.s[53]++;break}i.b[6][1]++}return i.s[54]++,n}},{key:"_truncateSegments",value:function(e,t,n){i.f[8]++;var r=(i.s[55]++,this._playlistLength(t)),a=(i.s[56]++,Math.min(e,r-1)),s=(i.s[57]++,0),u=(i.s[58]++,this._fragments(t)),l=(i.s[59]++,n.split("\n")),c=(i.s[60]++,-1);i.s[61]++;for(var f=0;f<a;f++){i.s[62]++,s+=u[f].duration,i.s[63]++;for(var d=l.length-1;d>=0;d--){if(i.s[64]++,l[d].startsWith(o)){i.b[7][0]++,i.s[65]++,c=d,i.s[66]++;break}i.b[7][1]++}i.s[67]++,c>-1?(i.b[8][0]++,i.s[68]++,l.splice(c,2)):i.b[8][1]++}return i.s[69]++,{manifest:l.join("\n"),duration:this._playlistDuration(t)-s}}},{key:"_fragments",value:function(e){return i.f[9]++,i.s[70]++,e.details.fragments}},{key:"_playlistLength",value:function(e){return i.f[10]++,i.s[71]++,this._fragments(e).length}},{key:"_playlistDuration",value:function(e){return i.f[11]++,i.s[72]++,e.details.totalduration}},{key:"_snAtIndex",value:function(e,t){i.f[12]++;var n=(i.s[73]++,this._fragments(e));return i.s[74]++,n.length>t?(i.b[9][0]++,i.s[75]++,n[t].sn):(i.b[9][1]++,i.s[76]++,null)}},{key:"bufferLevel",set:function(e){i.f[1]++,i.s[7]++,this._bufferLevel=e},get:function(){return i.f[2]++,i.s[8]++,this._bufferLevel}}]),e}();t.default=l,e.exports=t.default}]);