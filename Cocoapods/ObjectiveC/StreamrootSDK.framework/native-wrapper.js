/**
 * native-wrapper
 * v1.5.2
 * 2017-05-23
 * streamroot-p2p@4.9.3
 * streamroot-hlsjs-p2p-wrapper@4.3.4
 * @streamroot/hls-parser@2.0.8
 * 
 * Copyright Â© 2017
 */

!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=139)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(238),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={Distributor:{READY:"DISTRIBUTOR_READY"},Metrics:{TRACK_SWITCH:"metricsTrackSwitch"},Media:{ENDED:"mediaEnded"},Scheduler:{REACHED_LIVE_EDGE_STATE_CHANGED:"schedulerReachedLiveEdgeStateChanged"},SRModuleInterface:{ABR_FEEDBACK:"srModuleInterfaceAbrFeedback",UNCOMPLETE_SEGMENT_REQUESTED:"srmoduleinterfaceUncompleteSegmentRequested",CDN_DOWNLOADED:"cdnDownloaded"},PeerPool:{PEER_OPEN:"peerpoolPeerOpen",PEER_DESTROYED:"peerpoolPeerDestroyed",PEER_STATS_UPDATE:"peerPoolStat"},BufferManager:{LOW_BUFFER:"buffermanagerLowBuffer",HIGH_BUFFER:"buffermanagerHighBuffer",STATE_CHANGED:"buffermanagerStateChanged",BUFFER_TARGET_CHANGED:"bufferTargetChanged"},PeerConnection:{DISCONNECTED:"peerConnectionDisconnected",MESSAGE_RECEIVED:"peerConnectionMessageReceived",BINARY_DATA_RECEIVED:"peerConnectionBinaryDataReceived"},Peer:{REMOVE_PEER:"removePeer"},UploadQueue:{CHUNK_REQUESTED:"chunkRequested"}},e.exports=t.default},function(e,t,n){"use strict";function r(e,t){return new o(e,t,a.TIMER_TYPE.INTERVAL)}function i(e,t){return new o(e,t,a.TIMER_TYPE.TIMEOUT)}Object.defineProperty(t,"__esModule",{value:!0}),t.createInterval=r,t.createTimeout=i;var a=n(107),o=void 0;o=0?require("./BrowserTimer"):n(93).MobileTimer},function(e,t,n){var r=n(12),i=n(2),a=n(20),o=n(21),s="prototype",l=function(e,t,n){var u,c,d,f=e&l.F,h=e&l.G,v=e&l.S,p=e&l.P,_=e&l.B,m=e&l.W,g=h?i:i[t]||(i[t]={}),y=g[s],E=h?r:v?r[t]:(r[t]||{})[s];h&&(n=t);for(u in n)(c=!f&&E&&void 0!==E[u])&&u in g||(d=c?E[u]:n[u],g[u]=h&&"function"!=typeof E[u]?n[u]:_&&c?a(d,r):m&&E[u]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[s]=e[s],t}(d):p&&"function"==typeof d?a(Function.call,d):d,p&&((g.virtual||(g.virtual={}))[u]=d,e&l.R&&y&&!y[u]&&o(y,u,d)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,n){"use strict";e.exports=0?require("./BrowserError"):n(154)},function(e,t,n){e.exports={default:n(261),__esModule:!0}},function(e,t,n){var r=n(83)("wks"),i=n(59),a=n(12).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(241),a=r(i),o=n(236),s=r(o),l=n(52),u=r(l);t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,u.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(a.default?(0,a.default)(e,t):e.__proto__=t)}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(52),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){e.exports={default:n(248),__esModule:!0}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports={default:n(251),__esModule:!0}},function(e,t,n){e.exports=!n(25)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(19),i=n(115),a=n(85),o=Object.defineProperty;t.f=n(15)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function isAndroid(){return"android"===_platform2.default.get()}function androidInterface(e){switch(e){case"error":return AndroidError;case"log":return AndroidLog;case"truncated_manifest_notification":return AndroidManifest;case"get_segment_success_notification":case"get_segment_error_notification":case"segment_created":case"destroy_segment":case"set_binary_data":case"get_binary_data":return AndroidBinary;case"send_http_request":case"abort_http_request":return AndroidHttp;case"set_timer":case"clear_timer":return AndroidTimer;case"call_hash_worker":return AndroidHash;case"peer_connector_init_notification":case"signaling_create_peer_connection":return AndroidSignaling;case"peer_connection_send_message":case"peer_connection_send_data":case"peer_connection_close":return AndroidPeerConnection;default:return null}}function androidCall(e,t){var n=androidInterface(e);n?n[e]((0,_stringify2.default)(t)):AndroidError.error(e+" not supported.")}function iosCall(method,args){eval("ios_call_"+method+"("+(0,_stringify2.default)(args)+");")}function nativeCall(e,t){1&&(isAndroid()?androidCall(e,t):iosCall(e,t))}function nativeLog(e){nativeCall("log",e)}function nativeError(e){e instanceof Error?nativeCall("error",e.name+": "+e.message+"\n"+e.stack):nativeCall("error",e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.nativeError=exports.nativeLog=exports.nativeCall=void 0;var _stringify=__webpack_require__(38),_stringify2=_interopRequireDefault(_stringify),_platform=__webpack_require__(106),_platform2=_interopRequireDefault(_platform);exports.nativeCall=nativeCall,exports.nativeLog=nativeLog,exports.nativeError=nativeError},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return"number"==typeof e&&!isNaN(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isNumeric=t.Delta=void 0;var a=n(0),o=r(a),s=n(1),l=r(s),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,o.default)(this,e),this._lastDeltaValue=t}return(0,l.default)(e,[{key:"calcDelta",value:function(e){var t=e-this._lastDeltaValue;return this._lastDeltaValue=e,t}}]),e}();t.Delta=u,t.isNumeric=i},function(e,t,n){var r=n(13);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(74);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var r=n(16),i=n(43);e.exports=n(15)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(78),i=n(54);e.exports=function(e){return r(i(e))}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),a=r(i),o=n(14),s=r(o),l=n(0),u=r(l),c=n(1),d=r(c),f=n(6),h=r(f),v=function(){function e(){(0,u.default)(this,e),this._timers=new s.default}return(0,d.default)(e,[{key:"register",value:function(e){var t=e.name;return!this._timers.has(t)&&(this._timers.set(t,e),!0)}},{key:"registerAs",value:function(e,t){return!this._timers.has(e)&&(t.name=e,this._timers.set(e,t),!0)}},{key:"clear",value:function(e){return!!e&&this.clearNamedTimer(e.name)}},{key:"clearNamedTimer",value:function(e){var t=this._timers.get(e);return!!t&&(t.clear(),this._timers.delete(t.name))}},{key:"clearAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this._timers.values());!(e=(r=i.next()).done);e=!0){var o=r.value;this.clear(o)||h.default.notify("Cannot remove timer","Timer "+o.id+" was not found in timers map.")}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){e.exports={default:n(255),__esModule:!0}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(126),i=n(77);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){"use strict";var r=n(290)(!0);n(79)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";function r(e,t){return parseFloat(e.toFixed(t))}function i(e,t){for(var n=[],r=t>=e?1:-1,i=Math.min(e*r,t*r),a=Math.max(e*r,t*r),o=i;o<=a;o++)n.push(o*r);return n}Object.defineProperty(t,"__esModule",{value:!0}),t.toDecimal=r,t.range=i},function(e,t){e.exports={}},function(e,t,n){var r=n(5),i=n(2),a=n(25);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t,n){var r=n(54);e.exports=function(e){return Object(r(e))}},function(e,t,n){n(295);for(var r=n(12),i=n(21),a=n(30),o=n(8)("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],l=0;l<5;l++){var u=s[l],c=r[u],d=c&&c.prototype;d&&!d[o]&&i(d,o,u),a[u]=a.Array}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(){this._events=new r,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,s="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),a.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e,t){var n=s?s+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},a.prototype.emit=function(e,t,n,r,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,a),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var f,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,r);break;default:if(!l)for(f=1,l=new Array(d-1);f<d;f++)l[f-1]=arguments[f];c[u].fn.apply(c[u].context,l)}}return!0},a.prototype.on=function(e,t,n){var r=new i(t,n||this),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.once=function(e,t,n){var r=new i(t,n||this,!0),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.removeListener=function(e,t,n,i){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return 0==--this._eventsCount?this._events=new r:delete this._events[a],this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||(0==--this._eventsCount?this._events=new r:delete this._events[a]);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new r:delete this._events[a]}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=s,a.EventEmitter=a,0||(e.exports=a)},function(e,t,n){"use strict";e.exports=0?require("./BrowserHttpRequest"):n(157)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l="Unvalid weight parameter for EMWA: must be an number in ]0,1[",u=function(){function e(t,n){if((0,a.default)(this,e),n<=0||n>=1)throw new Error(l);this._emwaValue=t,this._weight=n}return(0,s.default)(e,[{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null!==t?t:this._weight;this._emwaValue=(1-n)*this._emwaValue+n*e}},{key:"value",get:function(){return this._emwaValue}}],[{key:"Errors",value:function(){return{UNVALID_WEIGHT:l}}},{key:"fromHalfLife",value:function(t,n,r){return new e(t,this.halfLifeToEMAWeight(n,r))}},{key:"halfLifeToEMAWeight",value:function(e,t){var n=e/t;return 1-1/Math.pow(2,1/n)}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=function(){function e(){(0,s.default)(this,e),this._scopes=new a.default}return(0,u.default)(e,[{key:"add",value:function(e,t,n){this._scopes.has(e)||this._scopes.set(e,new a.default);var r=this._scopes.get(e);r&&r.set(t,n)}},{key:"remove",value:function(e,t){var n=this._scopes.get(e);return!!n&&n.delete(t)}},{key:"removeAll",value:function(){this._scopes.clear()}},{key:"get",value:function(e,t){var n=this._scopes.get(e);return n&&n.has(t)?n.get(t):null}},{key:"count",value:function(e){var t=this._scopes.get(e);return t?t.size:0}}]),e}();t.default=new c,e.exports=t.default},function(e,t,n){e.exports={default:n(250),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(49),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(59)("meta"),i=n(13),a=n(26),o=n(16).f,s=0,l=Object.isExtensible||function(){return!0},u=!n(25)(function(){return l(Object.preventExtensions({}))}),c=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},d=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!l(e))return"F";if(!t)return"E";c(e)}return e[r].i},f=function(e,t){if(!a(e,r)){if(!l(e))return!0;if(!t)return!1;c(e)}return e[r].w},h=function(e){return u&&v.NEED&&l(e)&&!a(e,r)&&c(e),e},v=e.exports={KEY:r,NEED:!1,fastKey:d,getWeak:f,onFreeze:h}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(16).f,i=n(26),a=n(8)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.level=t.level,this.urlId=t.urlId,this.bitrate=t.bitrate}return i(e,[{key:"viewToString",value:function(){return"L"+this.level+"U"+this.urlId}},{key:"isEqual",value:function(e){return!!e&&(e.level===this.level&&e.urlId===this.urlId)}},{key:"type",get:function(){return"video"}}]),e}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=e.prototype,r=!0,i=!1,o=void 0;try{for(var s,l=(0,h.default)(a(n));!(r=(s=l.next()).done);r=!0){var u=s.value;if((0,d.default)(t[u])!==(0,d.default)(n[u])){var c=t.constructor.name;throw new Error("The method "+u+" of "+e.name+" is not defined in "+c)}}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}}function a(e){var t=(0,u.default)(e).filter(function(e){return"constructor"!==e}),n=Object.prototype;if((0,s.default)(e)===n)return t;var r=(0,s.default)(e);return t.concat(a(r))}Object.defineProperty(t,"__esModule",{value:!0}),t._getEveryPropertyNames=t.checkInterface=void 0;var o=n(7),s=r(o),l=n(108),u=r(l),c=n(52),d=r(c),f=n(11),h=r(f);t.checkInterface=i,t._getEveryPropertyNames=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="safe",i="unsafe",a={SAFE:r,UNSAFE:i};t.default=a,e.exports=t.default},function(e,t,n){e.exports={default:n(247),__esModule:!0}},function(e,t,n){e.exports={default:n(254),__esModule:!0}},function(e,t,n){e.exports={default:n(259),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(245),a=r(i),o=n(244),s=r(o),l="function"==typeof s.default&&"symbol"==typeof a.default?function(e){return typeof e}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":typeof e};t.default="function"==typeof s.default&&"symbol"===l(a.default)?function(e){return void 0===e?"undefined":l(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":l(e)}},function(e,t,n){var r=n(40),i=n(8)("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=o(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(20),i=n(118),a=n(116),o=n(19),s=n(58),l=n(88),u={},c={},t=e.exports=function(e,t,n,d,f){var h,v,p,_,m=f?function(){return e}:l(e),g=r(n,d,t?2:1),y=0;if("function"!=typeof m)throw TypeError(e+" is not iterable!");if(a(m)){for(h=s(e.length);h>y;y++)if((_=t?g(o(v=e[y])[0],v[1]):g(e[y]))===u||_===c)return _}else for(p=m.call(e);!(v=p.next()).done;)if((_=i(p,g,v.value,t))===u||_===c)return _};t.BREAK=u,t.RETURN=c},function(e,t){e.exports=!0},function(e,t,n){var r=n(19),i=n(121),a=n(77),o=n(82)("IE_PROTO"),s=function(){},l="prototype",u=function(){var e,t=n(76)("iframe"),r=a.length,i="<",o=">";for(t.style.display="none",n(114).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(i+"script"+o+"document.F=Object"+i+"/script"+o),e.close(),u=e.F;r--;)delete u[l][a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s[l]=r(e),n=new s,s[l]=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(84),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){},function(e,t,n){var r=n(329),i=n(330),a=i;a.v1=r,a.v4=i,e.exports=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(46),s=function(e){return e&&e.__esModule?e:{default:e}}(o),l=function(){function e(t){r(this,e),this.sn=t.sn,this.trackView=new s.default(t.trackView),this.time=t.time}return a(e,null,[{key:"fromArrayBuffer",value:function(t){var n=new Uint32Array(t),r=i(n,3),a=r[0],o=r[1],l=r[2];return new e({trackView:new s.default({level:a,urlId:o}),sn:l})}}]),a(e,[{key:"isEqual",value:function(e){if(!e)return!1;var t=e.sn,n=e.trackView;return this.sn===t&&this.trackView.isEqual(n)}},{key:"isInTrack",value:function(e){return this.trackView.isEqual(e)}},{key:"viewToString",value:function(){return this.trackView.viewToString()+"S"+this.sn}},{key:"toArrayBuffer",value:function(){var e=this.trackView,t=e.level,n=e.urlId;return new Uint32Array([t,n,this.sn]).buffer}},{key:"getId",value:function(){return this.sn}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(38),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(145),d=r(c),f=n(106),h=r(f),v=function(){function e(t,n){(0,s.default)(this,e),this._sharedState=t,this._namespace=n}return(0,u.default)(e,[{key:"send",value:function(e,t){var n=this._sharedState,r=n.conf,i=n.moduleState,o=n.peerToken,s=r.ANALYTICS.KLARA_URL;e.customer=r.ID_CLIENT,e.content=i.content,e.peerAgentVersion="4.9.3",e.token=o,e.platform=h.default.get();var l=(0,a.default)(e),u=""+s+this._namespace;t&&(u+="/"+t),d.default.send(u,l,this._sharedState)}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l="Method not implemented",u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getUpdatedRange",value:function(e){throw new Error(l)}},{key:"getFullSegment",value:function(e,t,n){throw new Error(l)}},{key:"isComplete",value:function(){throw new Error(l)}},{key:"isLocked",value:function(){throw new Error(l)}},{key:"p2pSpeed",get:function(){throw new Error(l)}},{key:"p2pAmount",get:function(){throw new Error(l)}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t,n){if((0,a.default)(this,e),!(t instanceof String||"number"==typeof n))throw new TypeError("Wrong parameter");this.id=t,this.byteLength=n}return(0,s.default)(e,[{key:"slice",value:function(e,t){if((void 0===e||0===e)&&void 0===t)return this;throw new Error("slice is not supported with those arguments")}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"isEqual",value:function(e){return!0}},{key:"viewToString",value:function(){return""}},{key:"toArrayBuffer",value:function(){return new ArrayBuffer(0)}},{key:"isInTrack",value:function(e){return!1}},{key:"getId",value:function(){return 0}}],[{key:"fromArrayBuffer",value:function(t){return new e}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return(0,S.default)(e,t)}function a(e){(0,y.default)(e);for(var t=(0,m.default)(e),n=0;n<t.length;n++){var r=t[n],i=e[r];null===i||"object"!==(void 0===i?"undefined":(0,p.default)(i))||(0,h.default)(i)||a(i)}}function o(e,t){for(var n={},r=(0,d.default)(e),i=0;i<r.length;i++){var a=r[i];t!==a&&(n[a]=e[a])}return n}function s(e){return JSON.parse((0,u.default)(e))}Object.defineProperty(t,"__esModule",{value:!0});var l=n(38),u=r(l),c=n(72),d=r(c),f=n(239),h=r(f),v=n(52),p=r(v),_=n(108),m=r(_),g=n(51),y=r(g),E=n(24),S=r(E);t.default={merge:i,deepFreeze:a,omit:o,deepCopy:s},e.exports=t.default},function(e,t,n){"use strict";function r(e){if(null===e)throw new Error("Panic! Attempted to unwrap null");if(void 0===e)throw new Error("Panic! Attempted to unwrap undefined");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.unwrap=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t){(0,a.default)(this,e),this._expirationThreshold=t,this._values=[]}return(0,s.default)(e,[{key:"push",value:function(e){this._cleanExpiredValues(),this._values.push({time:Date.now(),value:e})}},{key:"_cleanExpiredValues",value:function(){for(var e=Date.now();this._values.length>0&&e-this._expirationThreshold>=this._values[0].time;)this._values.shift()}},{key:"delta",get:function(){return this._cleanExpiredValues(),this._values.length>1?this._values[this._values.length-1].value-this._values[0].value:null}},{key:"timeDelta",get:function(){return this._cleanExpiredValues(),this._values.length>1?this._values[this._values.length-1].time-this._values[0].time:null}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(18),u=function(){function e(){(0,a.default)(this,e);var t=Date.now();this._metricSum=0,this._latestValue=0,this._integralTimestampDelta=new l.Delta(t),this._getterTimestampDelta=new l.Delta(t)}return(0,s.default)(e,[{key:"getAverage",value:function(){var e=this.getIntegral();return e.intervalLength?e.value/e.intervalLength:e.value}},{key:"getIntegral",value:function(){var e=Date.now(),t=this._integralTimestampDelta.calcDelta(e),n=this._getterTimestampDelta.calcDelta(e);this._metricSum+=this._latestValue*t;var r=this._metricSum;return this._metricSum=0,{value:r,intervalLength:n}}},{key:"updateMetric",value:function(e){var t=Date.now(),n=this._integralTimestampDelta.calcDelta(t);this._metricSum+=this._latestValue*n,this._latestValue=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(){var e=window&&window.navigator?window.navigator.userAgent:"";return(new o.default).setUA(e).getResult()}function i(){var e=r();return"mobile"===e.device.type||"tablet"===e.device.type||"console"===e.device.type||"Android"===e.os.name||"iOS"===e.os.name}Object.defineProperty(t,"__esModule",{value:!0});var a=n(326),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={getUAObject:r,isMobile:i},e.exports=t.default},function(e,t,n){e.exports={default:n(264),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(233),a=r(i),o=n(11),s=r(o);t.default=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=(0,s.default)(e);!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,a.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(13),i=n(12).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(40);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){"use strict";var r=n(56),i=n(5),a=n(127),o=n(21),s=n(26),l=n(30),u=n(282),c=n(44),d=n(125),f=n(8)("iterator"),h=!([].keys&&"next"in[].keys()),v="keys",p="values",_=function(){return this};e.exports=function(e,t,n,m,g,y,E){u(n,t,m);var S,T,b,R=function(e){if(!h&&e in w)return w[e];switch(e){case v:case p:return function(){return new n(this,e)}}return function(){return new n(this,e)}},A=t+" Iterator",D=g==p,k=!1,w=e.prototype,O=w[f]||w["@@iterator"]||g&&w[g],C=O||R(g),L=g?D?R("entries"):C:void 0,P="Array"==t?w.entries||O:O;if(P&&(b=d(P.call(new e)))!==Object.prototype&&(c(b,A,!0),r||s(b,f)||o(b,f,_)),D&&O&&O.name!==p&&(k=!0,C=function(){return O.call(this)}),r&&!E||!h&&!k&&w[f]||o(w,f,C),l[t]=C,l[A]=_,g)if(S={values:D?C:R(p),keys:y?C:R(v),entries:L},E)for(T in S)T in w||a(w,T,S[T]);else i(i.P+i.F*(h||k),t,S);return S}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(21);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},function(e,t,n){var r=n(83)("keys"),i=n(59);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(12),i="__core-js_shared__",a=r[i]||(r[i]={});e.exports=function(e){return a[e]||(a[e]={})}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(12),i=n(2),a=n(56),o=n(87),s=n(16).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,n){t.f=n(8)},function(e,t,n){var r=n(53),i=n(8)("iterator"),a=n(30);e.exports=n(2).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(61),p=r(v),_=n(196),m=r(_),g=n(65),y=r(g),E=n(37),S=r(E),T=n(6),b=r(T),R=n(17),A="segment",D=function(e){function t(e){(0,s.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this));if(n.id=n._generateId(),"number"==typeof e)n._byteLength=e,(0,R.nativeCall)("segment_created",{id:n.id,size:e});else{if(!(e instanceof y.default))throw new TypeError("Wrong parameter in Segment Constructor");n._byteLength=e.byteLength,(0,R.nativeCall)("segment_created",{id:n.id,binaryDataId:e.id})}return n.callbacks={},n}return(0,h.default)(t,e),(0,u.default)(t,[{key:"_generateId",value:function(){return"segment-"+p.default.v4()}},{key:"getBinaryData",value:function(e,t,n){var r="binary-data-callback-"+p.default.v4();S.default.add(A,r,n);var i={segmentId:this.id,offset:e,size:t,callbackId:r};(0,R.nativeCall)("get_binary_data",i)}},{key:"setBinaryData",value:function(e,t){if(!(e instanceof y.default||"number"==typeof t))throw new TypeError("Wrong parameter");var n={segmentId:this.id,offset:t,binaryDataId:e.id};(0,R.nativeCall)("set_binary_data",n)}},{key:"destroy",value:function(){var e={segmentId:this.id};(0,R.nativeCall)("destroy_segment",e)}}],[{key:"getBinaryDataCallback",value:function(e,t,n,r,i){var a=S.default.get(A,i);if(a){a(new y.default(n,parseInt(r,10))),S.default.remove(A,i)}else b.default.notifyError(new Error("Cannot get BinaryDataCallback with the given id"))}}]),t}(m.default);t.default=D,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(38),a=r(i),o=n(7),s=r(o),l=n(0),u=r(l),c=n(1),d=r(c),f=n(10),h=r(f),v=n(9),p=r(v),_=n(200),m=r(_),g=n(37),y=r(g),E=n(202),S=r(E),T=n(6),b=r(T),R=n(65),A=r(R),D=n(3),k=r(D),w=n(17),O="peer_connection",C="shared_state",L=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,s.default)(t)).call(this,n));return r._bufferedAmount=0,y.default.add(O,C,n),y.default.add(O,e,r),r._connectionId=e,r._manageHeartbeat(),r}return(0,p.default)(t,e),(0,d.default)(t,[{key:"_closeConnectionIfOpen",value:function(){(0,w.nativeCall)("peer_connection_close",{connection_id:this._connectionId}),this._setDisconnected()}},{key:"sendMessage",value:function(e,t){var n=S.default.encode(e,t),r=(0,a.default)(n),i={connection_id:this._connectionId,message:r};(0,w.nativeCall)("peer_connection_send_message",i)}},{key:"sendBinaryData",value:function(e,t){var n={connection_id:this._connectionId,binary_data_id:e.id,chunk_id:t.chunkIndex,segment_coord:t.segmentCoord};return(0,w.nativeCall)("peer_connection_send_data",n),!0}},{key:"destroy",value:function(){y.default.remove(O,this._connectionId),this._timerStore.clearAll()}},{key:"close",value:function(){(0,w.nativeCall)("peer_connection_close",{connection_id:this._connectionId}),this.destroy()}},{key:"getRtt",value:function(){return-1}},{key:"getBufferedAmount",value:function(){return this._bufferedAmount}},{key:"onbufferedamountlow",set:function(e){this._onBufferedAmountLow=e}}],[{key:"receivedMessage",value:function(e,t){var n=y.default.get(O,C);n&&(n.transferStats.p2pMessagesDownloaded+=t.length);var r=y.default.get(O,e);if(r){r._isCommunicating=!0;var i=S.default.decode(JSON.parse(t));"heartbeat"!==i.type&&r.emit(k.default.PeerConnection.MESSAGE_RECEIVED,i.type,i.args)}else b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}},{key:"receivedData",value:function(e,t,n,r,i,a){var o=parseInt(n,10),s=y.default.get(O,C);s&&(s.transferStats.p2pHeadersDownloaded+=parseInt(a,10),s.transferStats.p2pMediaDownloaded+=o);var l=new A.default(t,o),u=y.default.get(O,e);u?(u._isCommunicating=!0,u.emit(k.default.PeerConnection.BINARY_DATA_RECEIVED,l,r,i)):b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}},{key:"onDisconnect",value:function(e){var t=y.default.get(O,e);t?t.emit("disconnected"):b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}},{key:"onBufferedAmountChange",value:function(e,t,n){var r=y.default.get(O,e);r?(r._bufferedAmount=t,n&&r._onBufferedAmountLow&&r._onBufferedAmountLow()):b.default.notifyError(new Error("Cannot get PeerConnection with given id"))}}]),t}(m.default);e.exports=L},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(243),a=r(i),o=n(49),s=r(o),l=n(0),u=r(l),c=n(1),d=r(c),f=n(17),h=n(90),v=r(h),p=n(37),_=r(p),m="peer_connector",g="peer_pool",y="shared_state",E="peer_connection",S=function(){function e(t,n,r){(0,u.default)(this,e),_.default.add(m,g,n),_.default.add(m,y,r),this._peerId=t,this._conf=r.conf;var i={url:this._conf.SIGNALING_URL,peerId:this._peerId,timeout:this._conf.PEER_CONNECTION_TIMEOUT,bufferedAmountLowThreshold:this._conf.UP_BUFFERED_AMOUNT_LOW_THRESHOLD};(0,f.nativeCall)("peer_connector_init_notification",i)}return(0,d.default)(e,[{key:"createPeerConnection",value:function(e){(0,f.nativeCall)("signaling_create_peer_connection",{remotePeerId:e}),this._pendingPeerSet.add(e)}},{key:"getPeerConnectionCount",value:function(){return _.default.count(E)}},{key:"getOpenConnectorSlotsCount",value:function(){var e=_.default.get(m,g);return e?Math.max(Math.round(e.openSlotsCount()-this.getPeerConnectionCount()*this._conf.EXPECTED_CONNECTION_SUCCESS_RATE),0):void(0,f.nativeError)("[SIGNALING] peerPool cannot be null")}},{key:"getPendingConnectionDebugInfos",value:function(){return[]}},{key:"dispose",value:function(){}},{key:"getPendingConnectionPeers",value:function(){return(0,s.default)(e._pendingPeerSet)}}],[{key:"connectedToSignalingServer",value:function(){var e=_.default.get(m,y);e&&e.status&&e.status.setConnectedToSignalingServer()}},{key:"disconnectedFromSignalingServer",value:function(){var e=_.default.get(m,y);e&&e.status&&e.status.setDisconnectedToSignalingServer()}},{key:"peerConnectionCallback",value:function(e,t,n){var r=_.default.get(m,g);if(!r)return void(0,f.nativeError)("[SIGNALING] peerPool cannot be null");switch(e){case"success":var i=_.default.get(m,y);if(i){var a=new v.default(t,i);r.addPeerConnection(n,a),this._pendingPeerSet.delete(n)}break;case"timeout":r.connectionAttemptTimeout(n),this._pendingPeerSet.delete(n);break;case"declined":r.offerDeclined(n),this._pendingPeerSet.delete(n);break;default:(0,f.nativeError)("[SIGNALING] bad status")}}},{key:"peerConnectionDidTimeout",value:function(e){var t=_.default.get(m,g);t&&t.connectionAttemptTimeout(e)}},{key:"peerConnectionOffered",value:function(e){this._pendingPeerSet.add(e)}}]),e}();S._pendingPeerSet=new a.default,t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){s.default.add(d,e.id,t),s.default.add(f,e.id,e),(0,c.nativeCall)("call_hash_worker",{binaryDataId:e.id})}function a(e,t){var n=s.default.get(f,e),r=s.default.get(d,e);r&&n?(r(n,t),s.default.remove(d,e),s.default.remove(f,e)):u.default.notify("Cannot trigger hasher callback","Hasher callback or binary data not found with given id")}Object.defineProperty(t,"__esModule",{value:!0}),t.hasherCallback=t.callHashWorker=void 0;var o=n(37),s=r(o),l=n(6),u=r(l),c=n(17),d="hash_worker_callback",f="hash_worker_binary_data";t.callHashWorker=i,t.hasherCallback=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=T.default.get(A,e);n?(n(),t===m.TIMER_TYPE.TIMEOUT&&T.default.remove(A,e)):E.default.notify("Cannot trigger timer callback","Timer callback not found with given id")}function a(e){i(e,m.TIMER_TYPE.INTERVAL)}function o(e){i(e,m.TIMER_TYPE.TIMEOUT)}Object.defineProperty(t,"__esModule",{value:!0}),t.triggerTimeoutCallback=t.triggerIntervalCallback=t.MobileTimer=void 0;var s=n(7),l=r(s),u=n(0),c=r(u),d=n(1),f=r(d),h=n(10),v=r(h),p=n(9),_=r(p),m=n(107),g=n(17),y=n(6),E=r(y),S=n(37),T=r(S),b="set_timer",R="clear_timer",A="timer",D=function(e){function t(e,n,r){(0,c.default)(this,t);var i=(0,v.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e,n,r));return i._time>0?(T.default.add(A,i._id,e),(0,g.nativeCall)(b,{timer_id:i._id,interval:i._time,repeats:i._isRepeatable})):e(),i}return(0,_.default)(t,e),(0,f.default)(t,[{key:"clear",value:function(){this._time>0&&(0,g.nativeCall)(R,{timer_id:this._id})}}]),t}(m.AbstractTimer);t.MobileTimer=D,t.triggerIntervalCallback=a,t.triggerTimeoutCallback=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function e(t){(0,i.default)(this,e),this.message=t.error.message,this.stacktrace=t.error.stack,this.fileName=t.filename,this.lineNumber=t.lineno,this.columnNumber=t.colno?t.colno:void 0};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t,n,r){(0,a.default)(this,e),this._segmentCoord=t,this._chunkIndex=n,this._bandwidthSafety=r,this._timestamp=Date.now()}return(0,s.default)(e,[{key:"segmentCoord",get:function(){return this._segmentCoord}},{key:"chunkIndex",get:function(){return this._chunkIndex}},{key:"bandwidthSafety",get:function(){return this._bandwidthSafety}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";e.exports=0?require("./browser/Segment"):n(89)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={IDLE:"IDLE",NO_PEER:"NO_PEER",RANDOM:"RANDOM",DYNAMIC:"DYNAMIC",TOP_SEEDER:"TOP_SEEDER"};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={LOW:"target_low",HIGH:"target_high",RANDOM:"target_random",INIT:"target_init"};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(49),a=r(i),o=n(14),s=r(o),l=n(11),u=r(l),c=n(0),d=r(c),f=n(1),h=r(f),v=n(218),p=r(v),_=n(173),m=r(_),g=n(3),y=r(g),E=function(){function e(t,n,r,i){(0,d.default)(this,e),this._reachedLiveEdge=!1,this._sharedState=i,this._currentTracks=i.moduleState.currentTracks,this._p2pCache=n,this._distributedSegmentList=r,this._mediaMapCache=new m.default(t,i),this._edges=new p.default(this._mediaMapCache,i)}return(0,h.default)(e,[{key:"_getSegmentsToDownloadByTrack",value:function(e,t){var n=[],r=void 0;if(r="audio"===t?this._edges.audio:this._edges.video){var i=this._mediaMapCache.getSegmentTime(r),a=this._mediaMapCache.getSegmentList(e,i,this._sharedState.conf.MAX_BUFFER_DURATION),o=this._distributedSegmentList.getSegmentListAfter(r),s=this._mergeDedupe(a,o),l=this._p2pCache.listSegmentsToSkipForTrack(e);if("video"===t){var u=a.length<=1;u!==this._reachedLiveEdge&&(this._reachedLiveEdge=u,this._sharedState.eventBus.emit(y.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,u))}if(n=this._getDifference(s,l),this._sharedState.moduleState.isLive()&&n.length>0){var c=s[0],d=i-this._mediaMapCache.getSegmentTime(c);this._sharedState.moduleState.isNearEdge=d<=this._sharedState.conf.LIVE.NEAR_EDGE_MARGIN}}return n}},{key:"isSegmentRequested",value:function(e){var t=this.getSegmentListToDownload(),n=!0,r=!1,i=void 0;try{for(var a,o=(0,u.default)(t);!(n=(a=o.next()).done);n=!0){var s=a.value;if(e.isEqual(s))return!0}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return!1}},{key:"_getDifference",value:function(e,t){return e.filter(function(e){return void 0===t.find(function(t){return e.isEqual(t)})})}},{key:"_mergeDedupe",value:function(e,t){var n=new s.default,r=!0,i=!1,o=void 0;try{for(var l,c=(0,u.default)(e);!(r=(l=c.next()).done);r=!0){var d=l.value;n.set(d.viewToString(),d)}}catch(e){i=!0,o=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw o}}var f=!0,h=!1,v=void 0;try{for(var p,_=(0,u.default)(t);!(f=(p=_.next()).done);f=!0){var m=p.value;n.set(m.viewToString(),m)}}catch(e){h=!0,v=e}finally{try{!f&&_.return&&_.return()}finally{if(h)throw v}}return(0,a.default)(n.values())}},{key:"getSegmentListToDownload",value:function(){throw new Error("Cannot call abstract method")}},{key:"updateTrackEdge",value:function(e){throw new Error("Cannot call abstract method")}},{key:"getEdgeSegment",value:function(){return this._edges.video}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(3),u=r(l),c=n(97),d=r(c),f=n(70),h=r(f),v=function(){function e(t){(0,a.default)(this,e),this._alwaysDynamicBuffer=!0,this._lastLowBuffer=0,this.bufferRefill=0,this.bufferedAmount=0,this._timeSpentOnEdgeStaircase=new h.default,this._timeSpentWithoutPeerStaircase=new h.default,this._timeSpentDynamicStaircase=new h.default,this._timeSpentTopSeederStaircase=new h.default,this._globalEventBus=t,this._globalEventBus.on(u.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,this._onLiveEdgeChanged.bind(this)),this._globalEventBus.on(u.default.BufferManager.LOW_BUFFER,this._onLowBuffer.bind(this)),this._globalEventBus.on(u.default.BufferManager.HIGH_BUFFER,this._onHighBuffer.bind(this)),this._globalEventBus.on(u.default.BufferManager.STATE_CHANGED,this._onBufferStateChange.bind(this))}return(0,s.default)(e,[{key:"_onLiveEdgeChanged",value:function(e){var t=e?1:0;this._timeSpentOnEdgeStaircase.updateMetric(t)}},{key:"_onBufferStateChange",value:function(e,t){switch(e){case d.default.NO_PEER:this._timeSpentWithoutPeerStaircase.updateMetric(0);break;case d.default.DYNAMIC:this._timeSpentDynamicStaircase.updateMetric(0);break;case d.default.TOP_SEEDER:this._timeSpentTopSeederStaircase.updateMetric(0)}switch(t){case d.default.NO_PEER:this._timeSpentWithoutPeerStaircase.updateMetric(1),e!==d.default.IDLE&&(this._alwaysDynamicBuffer=!1);break;case d.default.DYNAMIC:this._timeSpentDynamicStaircase.updateMetric(1);break;case d.default.TOP_SEEDER:this._timeSpentTopSeederStaircase.updateMetric(1),this._alwaysDynamicBuffer=!1;break;case d.default.RANDOM:this._alwaysDynamicBuffer=!1}this.bufferState=t}},{key:"_onLowBuffer",value:function(e){this._lastLowBuffer=e}},{key:"_onHighBuffer",value:function(e){this.bufferRefill+=e-this._lastLowBuffer}},{key:"_resetDynamicFlag",value:function(){this._alwaysDynamicBuffer=this.bufferState===d.default.DYNAMIC}},{key:"getTimeSpentOnEdgeRatio",value:function(){return this._timeSpentOnEdgeStaircase.getAverage()}},{key:"getTimeSpentWithoutPeerRatio",value:function(){return this._timeSpentWithoutPeerStaircase.getAverage()}},{key:"getTimeSpentTopSeederRatio",value:function(){return this._timeSpentTopSeederStaircase.getAverage()}},{key:"getTimeSpentDynamicIntegral",value:function(){return this._timeSpentDynamicStaircase.getIntegral()}},{key:"alwaysDynamicBuffer",get:function(){var e=void 0;return e=this.bufferState!==d.default.NO_PEER&&this._alwaysDynamicBuffer,this._resetDynamicFlag(),e}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(51),a=r(i),o=n(0),s=r(o),l=n(18),u=n(66),c=r(u),d=n(47),f=function e(t,n,r){if((0,s.default)(this,e),(0,d.checkInterface)(c.default,t),!(0,l.isNumeric)(n))throw new Error("Invalid value for size");if(!r)throw new Error("No hash");this.segmentCoord=t,this.size=n,this.hash=r,(0,a.default)(this)};t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(){return!0||!!(window.RTCPeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection)}function i(e){return!(!r()||!e.ALLOW_P2P)&&(!0||(!o.default.isMobile()||e.ENABLE_MOBILE_BROWSER))}Object.defineProperty(t,"__esModule",{value:!0});var a=n(71),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={isP2PAvailable:r,isP2PEnabled:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t){(0,a.default)(this,e),this._internalQueue=t}return(0,s.default)(e,[{key:"_canDequeue",value:function(){return!0}},{key:"_dequeuedCallback",value:function(e){}},{key:"_emptyCallback",value:function(){}},{key:"_validateItem",value:function(e){return!0}},{key:"push",value:function(e){this._internalQueue.push(e),this.tryDequeue()}},{key:"tryDequeue",value:function(){if(this._canDequeue()){for(var e=this._internalQueue.shift();void 0!==e&&!this._validateItem(e);)e=this._internalQueue.shift();e?this._dequeuedCallback(e):this._emptyCallback()}}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(0===e.length)return null;e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}function i(e){if(0===e.length)return null;for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function a(e){var t=i(e);if(!t)return null;for(var n=0,r=0;r<e.length;r++)n+=Math.abs(e[r]-t);return n/e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.default={median:r,mean:i,meanAbsoluteDeviation:a},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.assertStreamType=t.StreamTypes=void 0;var i=n(242),a=r(i),o=n(51),s=r(o),l={HLS:"hls",DASH:"dash",SMOOTH:"smooth"};(0,s.default)(l);var u=function(e){if(-1===(0,a.default)(l).indexOf(e))throw new TypeError("'"+e+"' is not a valid value for stream type.")};t.StreamTypes=l,t.assertStreamType=u},function(e,t,n){"use strict";function r(){var e=a.default.getUAObject();if(!e.ua)return"unknown";var t=e.device,n=e.os;return 0?a.default.isMobile()?"web-mobile":"web-desktop":n&&"iOS"===n.name||t&&"Apple"===t.vendor?"ios":n&&"Android"===n.name?"android":"unknown"}Object.defineProperty(t,"__esModule",{value:!0});var i=n(71),a=function(e){return e&&e.__esModule?e:{default:e}}(i);t.default={get:r},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TIMER_TYPE=t.AbstractTimer=void 0;var i=n(0),a=r(i),o=n(1),s=r(o),l=n(61),u=r(l),c={TIMEOUT:0,INTERVAL:1},d=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.TIMEOUT;(0,a.default)(this,e),this._id="timer-"+u.default.v4(),this._name=this._id,this._callback=t,this._time=n,this._type=r,this._isRepeatable=r===c.INTERVAL}return(0,s.default)(e,[{key:"clear",value:function(){throw new Error("Cannot call abstract method")}},{key:"id",get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}}]),e}();t.AbstractTimer=d,t.TIMER_TYPE=c},function(e,t,n){e.exports={default:n(260),__esModule:!0}},function(e,t,n){e.exports={default:n(265),__esModule:!0}},function(e,t,n){e.exports={default:n(268),__esModule:!0}},function(e,t,n){"use strict";var r=n(16).f,i=n(57),a=n(81),o=n(20),s=n(75),l=n(54),u=n(55),c=n(79),d=n(120),f=n(128),h=n(15),v=n(41).fastKey,p=h?"_s":"size",_=function(e,t){var n,r=v(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var d=e(function(e,r){s(e,d,t,"_i"),e._i=i(null),e._f=void 0,e._l=void 0,e[p]=0,void 0!=r&&u(r,n,e[c],e)});return a(d.prototype,{clear:function(){for(var e=this,t=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete t[n.i];e._f=e._l=void 0,e[p]=0},delete:function(e){var t=this,n=_(t,e);if(n){var r=n.n,i=n.p;delete t._i[n.i],n.r=!0,i&&(i.n=r),r&&(r.p=i),t._f==n&&(t._f=r),t._l==n&&(t._l=i),t[p]--}return!!n},forEach:function(e){s(this,d,"forEach");for(var t,n=o(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!_(this,e)}}),h&&r(d.prototype,"size",{get:function(){return l(this[p])}}),d},def:function(e,t,n){var r,i,a=_(e,t);return a?a.v=n:(e._l=a={i:i=v(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[p]++,"F"!==i&&(e._i[i]=a)),e},getEntry:_,setStrong:function(e,t,n){c(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?d(0,n.k):"values"==t?d(0,n.v):d(0,[n.k,n.v]):(e._t=void 0,d(1))},n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){var r=n(53),i=n(273);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){"use strict";var r=n(12),i=n(5),a=n(41),o=n(25),s=n(21),l=n(81),u=n(55),c=n(75),d=n(13),f=n(44),h=n(16).f,v=n(275)(0),p=n(15);e.exports=function(e,t,n,_,m,g){var y=r[e],E=y,S=m?"set":"add",T=E&&E.prototype,b={};return p&&"function"==typeof E&&(g||T.forEach&&!o(function(){(new E).entries().next()}))?(E=t(function(t,n){c(t,E,e,"_c"),t._c=new y,void 0!=n&&u(n,m,t[S],t)}),v("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in T&&(!g||"clear"!=e)&&s(E.prototype,e,function(n,r){if(c(this,E,e),!t&&g&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),"size"in T&&h(E.prototype,"size",{get:function(){return this._c.size}})):(E=_.getConstructor(t,e,m,S),l(E.prototype,n),a.NEED=!0),f(E,e),b[e]=E,i(i.G+i.W+i.F,b),g||_.setStrong(E,e,m),E}},function(e,t,n){e.exports=n(12).document&&document.documentElement},function(e,t,n){e.exports=!n(15)&&!n(25)(function(){return 7!=Object.defineProperty(n(76)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(30),i=n(8)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){var r=n(40);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(19);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){var r=n(8)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(16),i=n(19),a=n(27);e.exports=n(15)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,l=0;s>l;)r.f(e,n=o[l++],t[n]);return e}},function(e,t,n){var r=n(42),i=n(43),a=n(22),o=n(85),s=n(26),l=n(115),u=Object.getOwnPropertyDescriptor;t.f=n(15)?u:function(e,t){if(e=a(e),t=o(t,!0),l)try{return u(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t,n){var r=n(22),i=n(124).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return i(e)}catch(e){return o.slice()}};e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?s(e):i(r(e))}},function(e,t,n){var r=n(126),i=n(77).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(26),i=n(32),a=n(82)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(26),i=n(22),a=n(274)(!1),o=n(82)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),l=0,u=[];for(n in s)n!=o&&r(s,n)&&u.push(n);for(;t.length>l;)r(s,n=t[l++])&&(~a(u,n)||u.push(n));return u}},function(e,t,n){e.exports=n(21)},function(e,t,n){"use strict";var r=n(12),i=n(2),a=n(16),o=n(15),s=n(8)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];o&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r,i,a,o=n(20),s=n(280),l=n(114),u=n(76),c=n(12),d=c.process,f=c.setImmediate,h=c.clearImmediate,v=c.MessageChannel,p=0,_={},m="onreadystatechange",g=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},y=function(e){g.call(e.data)};f&&h||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return _[++p]=function(){s("function"==typeof e?e:Function(e),t)},r(p),p},h=function(e){delete _[e]},"process"==n(40)(d)?r=function(e){d.nextTick(o(g,e,1))}:v?(i=new v,a=i.port2,i.port1.onmessage=y,r=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",y,!1)):r=m in u("script")?function(e){l.appendChild(u("script"))[m]=function(){l.removeChild(this),g.call(e)}}:function(e){setTimeout(o(g,e,1),0)}),e.exports={set:f,clear:h}},function(e,t,n){var r,r;!function(t){if(0)if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.QoSAnalytics=t()}else e.exports=t()}(function(){return function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!l&&u)return r(s,!0);if(o)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return a(n||e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),a=r(i),o=e("babel-runtime/helpers/createClass"),s=r(o);n.default=function(e,t){return new l(e,t)};var l=function(){function e(t,n){(0,a.default)(this,e),this._callback=t,this._time=n,this._timer=this._createTimer()}return(0,s.default)(e,[{key:"_createTimer",value:function(){return setInterval(this._callback,this._time)}},{key:"clear",value:function(){clearInterval(this._timer)}}]),e}();t.exports=n.default},{"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={IDLE:"IDLE",PLAYING:"PLAYING",SEEKING:"SEEKING",BUFFERING:"BUFFERING",PAUSED:"PAUSED",ENDED:"ENDED"};n.default=r,t.exports=n.default},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),a=r(i),o=e("babel-runtime/helpers/createClass"),s=r(o),l=e("./PlaybackState"),u=r(l),c=function(){function e(){(0,a.default)(this,e),this._stateChangedCallbacks=[],this.gotoIdle()}return(0,s.default)(e,[{key:"_setState",value:function(e){var t=this;this._state!==e&&(this._prevState=this._state,this._state=e,this._stateChangedCallbacks.forEach(function(e){e(t._state,t._prevState)}))}},{key:"gotoIdle",value:function(){this._setState(u.default.IDLE)}},{key:"gotoPlaying",value:function(){this._setState(u.default.PLAYING)}},{key:"gotoSeeking",value:function(){this._setState(u.default.SEEKING)}},{key:"gotoBuffering",value:function(){this._setState(u.default.BUFFERING)}},{key:"gotoPaused",value:function(){this._setState(u.default.PAUSED)}},{key:"gotoEnded",value:function(){this._setState(u.default.ENDED)}},{key:"getState",value:function(){return this._state}},{key:"addObserver",value:function(e){this._stateChangedCallbacks.indexOf(e)<0&&this._stateChangedCallbacks.push(e)}},{key:"removeObserver",value:function(e){var t=this._stateChangedCallbacks.indexOf(e);t>-1&&this._stateChangedCallbacks.splice(t,1)}},{key:"isIdle",value:function(){return this._state===u.default.IDLE}},{key:"isPlaying",value:function(){return this._state===u.default.PLAYING}},{key:"isSeeking",value:function(){return this._state===u.default.SEEKING}},{key:"isBuffering",value:function(){return this._state===u.default.BUFFERING}},{key:"isPaused",value:function(){return this._state===u.default.PAUSED}},{key:"isEnded",value:function(){return this._state===u.default.ENDED}}]),e}();n.default=c,t.exports=n.default},{"./PlaybackState":2,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),a=r(i),o=e("babel-runtime/helpers/createClass"),s=r(o),l=.3,u=100,c=function(){function e(t,n,r){(0,a.default)(this,e),this._createInterval=r,this._video=t,this._stateMachine=n,this._previousPlaybackTime=0,this.resume()}return(0,s.default)(e,[{key:"dispose",value:function(){this.pause()}},{key:"pause",value:function(){this._tickInterval.clear()}},{key:"resume",value:function(){this._tickInterval=this._createInterval(this._tickHandler.bind(this),u)}},{key:"_tickHandler",value:function(){var e=this._video.duration-this._video.currentTime,t=Math.abs(this._video.currentTime-this._previousPlaybackTime);isNaN(t)?this._stateMachine.gotoIdle():this._video.seeking?this._stateMachine.gotoSeeking():this._video.paused?this._stateMachine.isIdle()||(!isNaN(e)&&e<l?this._stateMachine.gotoEnded():this._stateMachine.gotoPaused()):t>0?this._stateMachine.gotoPlaying():this._stateMachine.isIdle()||this._stateMachine.isSeeking()||this._stateMachine.gotoBuffering(),this._previousPlaybackTime=this._video.currentTime}}]),e}();n.default=c,t.exports=n.default},{"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),a=r(i),o=e("babel-runtime/helpers/createClass"),s=r(o),l=e("./PlaybackStateMachine"),u=r(l),c=e("./PlaybackWatcher"),d=r(c),f=e("./StateTimeCalculator"),h=r(f),v=e("./CreateIntervalPlaceholder"),p=r(v),_=e("./QoSStats"),m=r(_),g={ATTACHED:"ATTACHED",DETACHED:"DETACHED",DISPOSED:"DISPOSED"},y=function(){function e(t,n){(0,a.default)(this,e),this._state=g.ATTACHED,this._stateMachine=new u.default,this._playbackWatcher=new d.default(t,this._stateMachine,n||p.default),this._stateTimeCalculator=new h.default(this._stateMachine),this._qosStats=new m.default(t,this._stateTimeCalculator)}return(0,s.default)(e,[{key:"getQoSAnalytics",value:function(){return this._qosStats.getAnalytics()}},{key:"attach",value:function(){this._state===g.DETACHED?(console.info("attaching QoSModule"),this._state=g.ATTACHED,this._playbackWatcher.resume(),this._stateTimeCalculator.resume()):console.info("can not attach QoSModule, state=",this._state)}},{key:"detach",value:function(){this._state===g.ATTACHED?(console.info("detaching QoSModule"),this._state=g.DETACHED,this._playbackWatcher.pause(),this._stateTimeCalculator.pause()):console.info("can not detach QoSModule, state=",this._state)}},{key:"dispose",value:function(){console.info("disposing QoSModule"),this._state=g.DISPOSED,this._playbackWatcher.dispose(),this._stateTimeCalculator.dispose()}}]),e}();n.default=y,t.exports=n.default},{"./CreateIntervalPlaceholder":1,"./PlaybackStateMachine":3,"./PlaybackWatcher":4,"./QoSStats":6,"./StateTimeCalculator":7,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),a=r(i),o=e("babel-runtime/helpers/createClass"),s=r(o),l=e("./PlaybackState"),u=r(l),c=function(){function e(t,n){(0,a.default)(this,e),this._video=t,this._stateTimeCalculator=n}return(0,s.default)(e,[{key:"getAnalytics",value:function(){var e=this._stateTimeCalculator.getStats();return{droppedFrameCount:this._video.webkitDroppedFrameCount||this._video.droppedFrameCount||0,timeSpentPlaying:e[u.default.PLAYING].timeSpent,timeSpentPaused:e[u.default.PAUSED].timeSpent,timeSpentSeeking:e[u.default.SEEKING].timeSpent,timeSpentEnded:e[u.default.ENDED].timeSpent,rebufferingCount:e[u.default.BUFFERING].count,timeSpentRebuffering:e[u.default.BUFFERING].timeSpent}}}]),e}();n.default=c,t.exports=n.default},{"./PlaybackState":2,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/keys"),a=r(i),o=e("babel-runtime/core-js/get-iterator"),s=r(o),l=e("babel-runtime/helpers/classCallCheck"),u=r(l),c=e("babel-runtime/helpers/createClass"),d=r(c),f=e("./PlaybackState"),h=r(f),v=function(){function e(t){(0,u.default)(this,e),this._stateMachine=t,this._stats={};var n=!0,r=!1,i=void 0;try{for(var o,l=(0,s.default)((0,a.default)(h.default));!(n=(o=l.next()).done);n=!0){var c=o.value;this._stats[c]={count:0,timeSpent:0}}}catch(e){r=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw i}}this.resume(),this._onStateChangedCallback=this._onStateChanged.bind(this),this._stateMachine.addObserver(this._onStateChangedCallback)}return(0,d.default)(e,[{key:"getStats",value:function(){return this._isAttached&&this._updateStateTimeSpent(this._stateMachine.getState()),this._stats}},{key:"pause",value:function(){this._isAttached=!1,this._terminateState(this._stateMachine.getState())}},{key:"resume",value:function(){this._isAttached=!0,this._resumeState(this._stateMachine.getState())}},{key:"dispose",value:function(){this.pause(),this._stateMachine.removeObserver(this._onStateChangedCallback)}},{key:"_onStateChanged",value:function(e,t){this._terminateState(t),this._resumeState(e)}},{key:"_terminateState",value:function(e){this._updateStateTimeSpent(e),this._stats[e].startTimeStamp=null}},{key:"_updateStateTimeSpent",value:function(e){var t=this._stats[e],n=Date.now();t.timeSpent+=(n-t.startTimeStamp)/1e3,t.startTimeStamp=n}},{key:"_resumeState",value:function(e){var t=this._stats[e];t.count++,t.startTimeStamp=Date.now()}}]),e}();n.default=v,t.exports=n.default},{"./PlaybackState":2,"babel-runtime/core-js/get-iterator":8,"babel-runtime/core-js/object/keys":10,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],8:[function(e,t,n){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":13}],9:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":14}],10:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":15}],11:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],12:[function(e,t,n){"use strict";n.__esModule=!0;var r=e("../core-js/object/define-property"),i=function(e){return e&&e.__esModule?e:{default:e}}(r);n.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},{"../core-js/object/define-property":9}],13:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":64,"../modules/es6.string.iterator":68,"../modules/web.dom.iterable":69}],14:[function(e,t,n){e("../../modules/es6.object.define-property");var r=e("../../modules/_core").Object;t.exports=function(e,t,n){return r.defineProperty(e,t,n)}},{"../../modules/_core":22,"../../modules/es6.object.define-property":66}],15:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":22,"../../modules/es6.object.keys":67}],16:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],17:[function(e,t,n){t.exports=function(){}},{}],18:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":36}],19:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_to-length"),a=e("./_to-index");t.exports=function(e){return function(t,n,o){var s,l=r(t),u=i(l.length),c=a(o,u);if(e&&n!=n){for(;u>c;)if((s=l[c++])!=s)return!0}else for(;u>c;c++)if((e||c in l)&&l[c]===n)return e||c||0;return!e&&-1}}},{"./_to-index":55,"./_to-iobject":57,"./_to-length":58}],20:[function(e,t,n){var r=e("./_cof"),i=e("./_wks")("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(e,t){try{return e[t]}catch(e){}};t.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=o(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},{"./_cof":21,"./_wks":62}],21:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],22:[function(e,t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},{}],23:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":16}],24:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],25:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":29}],26:[function(e,t,n){var r=e("./_is-object"),i=e("./_global").document,a=r(i)&&r(i.createElement);t.exports=function(e){return a?i.createElement(e):{}}},{"./_global":30,"./_is-object":36}],27:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],28:[function(e,t,n){var r=e("./_global"),i=e("./_core"),a=e("./_ctx"),o=e("./_hide"),s="prototype",l=function(e,t,n){var u,c,d,f=e&l.F,h=e&l.G,v=e&l.S,p=e&l.P,_=e&l.B,m=e&l.W,g=h?i:i[t]||(i[t]={}),y=g[s],E=h?r:v?r[t]:(r[t]||{})[s];h&&(n=t);for(u in n)(c=!f&&E&&void 0!==E[u])&&u in g||(d=c?E[u]:n[u],g[u]=h&&"function"!=typeof E[u]?n[u]:_&&c?a(d,r):m&&E[u]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[s]=e[s],t}(d):p&&"function"==typeof d?a(Function.call,d):d,p&&((g.virtual||(g.virtual={}))[u]=d,e&l.R&&y&&!y[u]&&o(y,u,d)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},{"./_core":22,"./_ctx":23,"./_global":30,"./_hide":32}],29:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],30:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],31:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],32:[function(e,t,n){var r=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":25,"./_object-dp":43,"./_property-desc":49}],33:[function(e,t,n){t.exports=e("./_global").document&&document.documentElement},{"./_global":30}],34:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":25,"./_dom-create":26,"./_fails":29}],35:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":21}],36:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],37:[function(e,t,n){"use strict";var r=e("./_object-create"),i=e("./_property-desc"),a=e("./_set-to-string-tag"),o={};e("./_hide")(o,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},{"./_hide":32,"./_object-create":42,"./_property-desc":49,"./_set-to-string-tag":51,"./_wks":62}],38:[function(e,t,n){"use strict";var r=e("./_library"),i=e("./_export"),a=e("./_redefine"),o=e("./_hide"),s=e("./_has"),l=e("./_iterators"),u=e("./_iter-create"),c=e("./_set-to-string-tag"),d=e("./_object-gpo"),f=e("./_wks")("iterator"),h=!([].keys&&"next"in[].keys()),v="keys",p="values",_=function(){return this};t.exports=function(e,t,n,m,g,y,E){u(n,t,m);var S,T,b,R=function(e){if(!h&&e in w)return w[e];switch(e){case v:case p:return function(){return new n(this,e)}}return function(){return new n(this,e)}},A=t+" Iterator",D=g==p,k=!1,w=e.prototype,O=w[f]||w["@@iterator"]||g&&w[g],C=O||R(g),L=g?D?R("entries"):C:void 0,P="Array"==t?w.entries||O:O;if(P&&(b=d(P.call(new e)))!==Object.prototype&&(c(b,A,!0),r||s(b,f)||o(b,f,_)),D&&O&&O.name!==p&&(k=!0,C=function(){return O.call(this)}),r&&!E||!h&&!k&&w[f]||o(w,f,C),l[t]=C,l[A]=_,g)if(S={values:D?C:R(p),keys:y?C:R(v),entries:L},E)for(T in S)T in w||a(w,T,S[T]);else i(i.P+i.F*(h||k),t,S);return S}},{"./_export":28,"./_has":31,"./_hide":32,"./_iter-create":37,"./_iterators":40,"./_library":41,"./_object-gpo":45,"./_redefine":50,"./_set-to-string-tag":51,"./_wks":62}],39:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],40:[function(e,t,n){t.exports={}},{}],41:[function(e,t,n){t.exports=!0},{}],42:[function(e,t,n){var r=e("./_an-object"),i=e("./_object-dps"),a=e("./_enum-bug-keys"),o=e("./_shared-key")("IE_PROTO"),s=function(){},l="prototype",u=function(){var t,n=e("./_dom-create")("iframe"),r=a.length,i="<",o=">";for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(i+"script"+o+"document.F=Object"+i+"/script"+o),t.close(),u=t.F;r--;)delete u[l][a[r]];return u()};t.exports=Object.create||function(e,t){var n;return null!==e?(s[l]=r(e),n=new s,s[l]=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},{"./_an-object":18,"./_dom-create":26,"./_enum-bug-keys":27,"./_html":33,"./_object-dps":44,"./_shared-key":52}],43:[function(e,t,n){var r=e("./_an-object"),i=e("./_ie8-dom-define"),a=e("./_to-primitive"),o=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":18,"./_descriptors":25,"./_ie8-dom-define":34,"./_to-primitive":60}],44:[function(e,t,n){var r=e("./_object-dp"),i=e("./_an-object"),a=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,l=0;s>l;)r.f(e,n=o[l++],t[n]);return e}},{"./_an-object":18,"./_descriptors":25,"./_object-dp":43,"./_object-keys":47}],45:[function(e,t,n){var r=e("./_has"),i=e("./_to-object"),a=e("./_shared-key")("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},{"./_has":31,"./_shared-key":52,"./_to-object":59}],46:[function(e,t,n){var r=e("./_has"),i=e("./_to-iobject"),a=e("./_array-includes")(!1),o=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,s=i(e),l=0,u=[];for(n in s)n!=o&&r(s,n)&&u.push(n);for(;t.length>l;)r(s,n=t[l++])&&(~a(u,n)||u.push(n));return u}},{"./_array-includes":19,"./_has":31,"./_shared-key":52,"./_to-iobject":57}],47:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,i)}},{"./_enum-bug-keys":27,"./_object-keys-internal":46}],48:[function(e,t,n){var r=e("./_export"),i=e("./_core"),a=e("./_fails");t.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},{"./_core":22,"./_export":28,"./_fails":29}],49:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],50:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":32}],51:[function(e,t,n){var r=e("./_object-dp").f,i=e("./_has"),a=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},{"./_has":31,"./_object-dp":43,"./_wks":62}],52:[function(e,t,n){var r=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return r[e]||(r[e]=i(e))}},{"./_shared":53,"./_uid":61}],53:[function(e,t,n){var r=e("./_global"),i="__core-js_shared__",a=r[i]||(r[i]={});t.exports=function(e){return a[e]||(a[e]={})}},{"./_global":30}],54:[function(e,t,n){var r=e("./_to-integer"),i=e("./_defined");t.exports=function(e){return function(t,n){var a,o,s=String(i(t)),l=r(n),u=s.length;return l<0||l>=u?e?"":void 0:(a=s.charCodeAt(l),a<55296||a>56319||l+1===u||(o=s.charCodeAt(l+1))<56320||o>57343?e?s.charAt(l):a:e?s.slice(l,l+2):(a-55296<<10)+(o-56320)+65536)}}},{"./_defined":24,"./_to-integer":56}],55:[function(e,t,n){var r=e("./_to-integer"),i=Math.max,a=Math.min;t.exports=function(e,t){return e=r(e),e<0?i(e+t,0):a(e,t)}},{"./_to-integer":56}],56:[function(e,t,n){var r=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},{}],57:[function(e,t,n){var r=e("./_iobject"),i=e("./_defined");t.exports=function(e){return r(i(e))}},{"./_defined":24,"./_iobject":35}],58:[function(e,t,n){var r=e("./_to-integer"),i=Math.min;t.exports=function(e){return e>0?i(r(e),9007199254740991):0}},{"./_to-integer":56}],59:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":24}],60:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":36}],61:[function(e,t,n){var r=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},{}],62:[function(e,t,n){var r=e("./_shared")("wks"),i=e("./_uid"),a=e("./_global").Symbol,o="function"==typeof a;(t.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},{"./_global":30,"./_shared":53,"./_uid":61}],63:[function(e,t,n){var r=e("./_classof"),i=e("./_wks")("iterator"),a=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},{"./_classof":20,"./_core":22,"./_iterators":40,"./_wks":62}],64:[function(e,t,n){var r=e("./_an-object"),i=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":18,"./_core":22,"./core.get-iterator-method":63}],65:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),i=e("./_iter-step"),a=e("./_iterators"),o=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":17,"./_iter-define":38,"./_iter-step":39,"./_iterators":40,"./_to-iobject":57}],66:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":25,"./_export":28,"./_object-dp":43}],67:[function(e,t,n){var r=e("./_to-object"),i=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return i(r(e))}})},{"./_object-keys":47,"./_object-sap":48,"./_to-object":59}],68:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":38,"./_string-at":54}],69:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),i=e("./_hide"),a=e("./_iterators"),o=e("./_wks")("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],l=0;l<5;l++){var u=s[l],c=r[u],d=c&&c.prototype;d&&!d[o]&&i(d,o,u),a[u]=a.Array}},{"./_global":30,"./_hide":32,"./_iterators":40,"./_wks":62,"./es6.array.iterator":65}]},{},[5])(5)})},function(e,t){function n(e,t){var n=t||0,i=r;return i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]}for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);e.exports=n},function(e,t,n){(function(t){var n,r=t.crypto||t.msCrypto;if(r&&r.getRandomValues){var i=new Uint8Array(16);n=function(){return r.getRandomValues(i),i}}if(!n){var a=new Array(16);n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}e.exports=n}).call(t,n(45))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e="/home/ubuntu/native-wrapper/lib/P2PService.js",t="36cd247301e1024c245cc2e4a8792b14e5938ad8",n=new Function("return this")(),r="__coverage__",i={path:"/home/ubuntu/native-wrapper/lib/P2PService.js",statementMap:{0:{start:{line:22,column:4},end:{line:22,column:28}},1:{start:{line:24,column:4},end:{line:24,column:51}},2:{start:{line:25,column:4},end:{line:25,column:55}},3:{start:{line:27,column:4},end:{line:27,column:43}},4:{start:{line:29,column:4},end:{line:29,column:34}},5:{start:{line:30,column:4},end:{line:30,column:50}},6:{start:{line:32,column:4},end:{line:32,column:27}},7:{start:{line:33,column:4},end:{line:33,column:39}},8:{start:{line:35,column:22},end:{line:37,column:5}},9:{start:{line:38,column:4},end:{line:40,column:5}},10:{start:{line:39,column:6},end:{line:39,column:38}},11:{start:{line:41,column:4},end:{line:43,column:5}},12:{start:{line:42,column:6},end:{line:42,column:44}},13:{start:{line:44,column:4},end:{line:44,column:58}},14:{start:{line:46,column:4},end:{line:46,column:84}},15:{start:{line:48,column:4},end:{line:48,column:52}},16:{start:{line:52,column:4},end:{line:77,column:6}},17:{start:{line:53,column:6},end:{line:53,column:144}},18:{start:{line:54,column:6},end:{line:54,column:55}},19:{start:{line:56,column:6},end:{line:64,column:7}},20:{start:{line:57,column:23},end:{line:57,column:52}},21:{start:{line:58,column:35},end:{line:58,column:88}},22:{start:{line:59,column:8},end:{line:59,column:29}},23:{start:{line:60,column:8},end:{line:60,column:47}},24:{start:{line:61,column:8},end:{line:61,column:69}},25:{start:{line:61,column:29},end:{line:61,column:42}},26:{start:{line:62,column:8},end:{line:62,column:62}},27:{start:{line:62,column:29},end:{line:62,column:39}},28:{start:{line:63,column:8},end:{line:63,column:36}},29:{start:{line:66,column:6},end:{line:70,column:7}},30:{start:{line:67,column:8},end:{line:67,column:31}},31:{start:{line:69,column:8},end:{line:69,column:32}},32:{start:{line:72,column:6},end:{line:76,column:7}},33:{start:{line:73,column:8},end:{line:73,column:33}},34:{start:{line:75,column:8},end:{line:75,column:34}},35:{start:{line:79,column:4},end:{line:79,column:39}},36:{start:{line:81,column:4},end:{line:86,column:6}},37:{start:{line:82,column:6},end:{line:85,column:9}},38:{start:{line:88,column:4},end:{line:102,column:6}},39:{start:{line:89,column:6},end:{line:98,column:11}},40:{start:{line:93,column:10},end:{line:93,column:48}},41:{start:{line:94,column:10},end:{line:97,column:13}},42:{start:{line:100,column:6},end:{line:100,column:45}},43:{start:{line:101,column:6},end:{line:101,column:39}},44:{start:{line:106,column:18},end:{line:106,column:28}},45:{start:{line:107,column:21},end:{line:107,column:50}},46:{start:{line:108,column:22},end:{line:108,column:69}},47:{start:{line:110,column:4},end:{line:113,column:7}},48:{start:{line:111,column:26},end:{line:111,column:95}},49:{start:{line:112,column:6},end:{line:112,column:52}},50:{start:{line:117,column:4},end:{line:117,column:37}},51:{start:{line:119,column:4},end:{line:119,column:43}},52:{start:{line:121,column:4},end:{line:123,column:17}},53:{start:{line:124,column:4},end:{line:124,column:59}},54:{start:{line:127,column:4},end:{line:127,column:37}},55:{start:{line:131,column:21},end:{line:155,column:5}},56:{start:{line:136,column:8},end:{line:139,column:11}},57:{start:{line:140,column:8},end:{line:140,column:54}},58:{start:{line:144,column:75},end:{line:144,column:80}},59:{start:{line:145,column:30},end:{line:145,column:59}},60:{start:{line:146,column:29},end:{line:146,column:54}},61:{start:{line:149,column:28},end:{line:149,column:88}},62:{start:{line:151,column:8},end:{line:151,column:116}},63:{start:{line:153,column:8},end:{line:153,column:54}},64:{start:{line:157,column:24},end:{line:157,column:46}},65:{start:{line:158,column:4},end:{line:158,column:35}},66:{start:{line:160,column:20},end:{line:164,column:5}},67:{start:{line:165,column:27},end:{line:165,column:83}},68:{start:{line:166,column:4},end:{line:166,column:63}},69:{start:{line:170,column:27},end:{line:170,column:69}},70:{start:{line:171,column:4},end:{line:177,column:5}},71:{start:{line:172,column:6},end:{line:172,column:29}},72:{start:{line:176,column:6},end:{line:176,column:96}},73:{start:{line:181,column:4},end:{line:183,column:5}},74:{start:{line:182,column:6},end:{line:182,column:33}},75:{start:{line:184,column:4},end:{line:184,column:16}},76:{start:{line:188,column:4},end:{line:192,column:5}},77:{start:{line:189,column:6},end:{line:189,column:39}},78:{start:{line:191,column:6},end:{line:191,column:38}},79:{start:{line:196,column:4},end:{line:200,column:5}},80:{start:{line:197,column:6},end:{line:197,column:40}},81:{start:{line:199,column:6},end:{line:199,column:39}},82:{start:{line:204,column:4},end:{line:208,column:5}},83:{start:{line:205,column:6},end:{line:205,column:41}},84:{start:{line:207,column:6},end:{line:207,column:40}},85:{start:{line:212,column:4},end:{line:216,column:5}},86:{start:{line:213,column:6},end:{line:213,column:42}},87:{start:{line:215,column:6},end:{line:215,column:41}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:14,column:2},end:{line:14,column:3}},loc:{start:{line:21,column:35},end:{line:49,column:3}},line:21},1:{name:"(anonymous_1)",decl:{start:{line:51,column:2},end:{line:51,column:3}},loc:{start:{line:51,column:40},end:{line:103,column:3}},line:51},2:{name:"(anonymous_2)",decl:{start:{line:52,column:31},end:{line:52,column:32}},loc:{start:{line:52,column:37},end:{line:77,column:5}},line:52},3:{name:"(anonymous_3)",decl:{start:{line:61,column:23},end:{line:61,column:24}},loc:{start:{line:61,column:29},end:{line:61,column:42}},line:61},4:{name:"(anonymous_4)",decl:{start:{line:62,column:23},end:{line:62,column:24}},loc:{start:{line:62,column:29},end:{line:62,column:39}},line:62},5:{name:"(anonymous_5)",decl:{start:{line:79,column:30},end:{line:79,column:31}},loc:{start:{line:79,column:36},end:{line:79,column:38}},line:79},6:{name:"(anonymous_6)",decl:{start:{line:81,column:30},end:{line:81,column:31}},loc:{start:{line:81,column:36},end:{line:86,column:5}},line:81},7:{name:"(anonymous_7)",decl:{start:{line:88,column:27},end:{line:88,column:28}},loc:{start:{line:88,column:37},end:{line:102,column:5}},line:88},8:{name:"(anonymous_8)",decl:{start:{line:92,column:22},end:{line:92,column:23}},loc:{start:{line:92,column:55},end:{line:98,column:9}},line:92},9:{name:"(anonymous_9)",decl:{start:{line:105,column:2},end:{line:105,column:3}},loc:{start:{line:105,column:30},end:{line:114,column:3}},line:105},10:{name:"(anonymous_10)",decl:{start:{line:110,column:35},end:{line:110,column:36}},loc:{start:{line:110,column:49},end:{line:113,column:5}},line:110},11:{name:"(anonymous_11)",decl:{start:{line:116,column:2},end:{line:116,column:3}},loc:{start:{line:116,column:45},end:{line:128,column:3}},line:116},12:{name:"(anonymous_12)",decl:{start:{line:130,column:2},end:{line:130,column:3}},loc:{start:{line:130,column:34},end:{line:167,column:3}},line:130},13:{name:"(anonymous_13)",decl:{start:{line:133,column:18},end:{line:133,column:19}},loc:{start:{line:133,column:38},end:{line:133,column:40}},line:133},14:{name:"(anonymous_14)",decl:{start:{line:135,column:15},end:{line:135,column:16}},loc:{start:{line:135,column:35},end:{line:141,column:7}},line:135},15:{name:"(anonymous_15)",decl:{start:{line:143,column:17},end:{line:143,column:18}},loc:{start:{line:143,column:47},end:{line:154,column:7}},line:143},16:{name:"(anonymous_16)",decl:{start:{line:169,column:2},end:{line:169,column:3}},loc:{start:{line:169,column:38},end:{line:178,column:3}},line:169},17:{name:"(anonymous_17)",decl:{start:{line:180,column:2},end:{line:180,column:3}},loc:{start:{line:180,column:13},end:{line:185,column:3}},line:180},18:{name:"(anonymous_18)",decl:{start:{line:187,column:2},end:{line:187,column:3}},loc:{start:{line:187,column:20},end:{line:193,column:3}},line:187},19:{name:"(anonymous_19)",decl:{start:{line:195,column:2},end:{line:195,column:3}},loc:{start:{line:195,column:21},end:{line:201,column:3}},line:195},20:{name:"(anonymous_20)",decl:{start:{line:203,column:2},end:{line:203,column:3}},loc:{start:{line:203,column:22},end:{line:209,column:3}},line:203},21:{name:"(anonymous_21)",decl:{start:{line:211,column:2},end:{line:211,column:3}},loc:{start:{line:211,column:23},end:{line:217,column:3}},line:211}},branchMap:{0:{loc:{start:{line:38,column:4},end:{line:40,column:5}},type:"if",locations:[{start:{line:38,column:4},end:{line:40,column:5}},{start:{line:38,column:4},end:{line:40,column:5}}],line:38},1:{loc:{start:{line:41,column:4},end:{line:43,column:5}},type:"if",locations:[{start:{line:41,column:4},end:{line:43,column:5}},{start:{line:41,column:4},end:{line:43,column:5}}],line:41},2:{loc:{start:{line:56,column:6},end:{line:64,column:7}},type:"if",locations:[{start:{line:56,column:6},end:{line:64,column:7}},{start:{line:56,column:6},end:{line:64,column:7}}],line:56},3:{loc:{start:{line:66,column:6},end:{line:70,column:7}},type:"if",locations:[{start:{line:66,column:6},end:{line:70,column:7}},{start:{line:66,column:6},end:{line:70,column:7}}],line:66},4:{loc:{start:{line:72,column:6},end:{line:76,column:7}},type:"if",locations:[{start:{line:72,column:6},end:{line:76,column:7}},{start:{line:72,column:6},end:{line:76,column:7}}],line:72},5:{loc:{start:{line:119,column:21},end:{line:119,column:42}},type:"binary-expr",locations:[{start:{line:119,column:21},end:{line:119,column:35}},{start:{line:119,column:39},end:{line:119,column:42}}],line:119},6:{loc:{start:{line:121,column:19},end:{line:123,column:16}},type:"cond-expr",locations:[{start:{line:122,column:12},end:{line:122,column:19}},{start:{line:123,column:12},end:{line:123,column:16}}],line:121},7:{loc:{start:{line:124,column:28},end:{line:124,column:58}},type:"binary-expr",locations:[{start:{line:124,column:28},end:{line:124,column:47}},{start:{line:124,column:51},end:{line:124,column:58}}],line:124},8:{loc:{start:{line:149,column:28},end:{line:149,column:88}},type:"cond-expr",locations:[{start:{line:149,column:47},end:{line:149,column:84}},{start:{line:149,column:87},end:{line:149,column:88}}],line:149},9:{loc:{start:{line:171,column:4},end:{line:177,column:5}},type:"if",locations:[{start:{line:171,column:4},end:{line:177,column:5}},{start:{line:171,column:4},end:{line:177,column:5}}],line:171},10:{loc:{start:{line:181,column:4},end:{line:183,column:5}},type:"if",locations:[{start:{line:181,column:4},end:{line:183,column:5}},{start:{line:181,column:4},end:{line:183,column:5}}],line:181},11:{loc:{start:{line:188,column:4},end:{line:192,column:5}},type:"if",locations:[{start:{line:188,column:4},end:{line:192,column:5}},{start:{line:188,column:4},end:{line:192,column:5}}],line:188},12:{loc:{start:{line:196,column:4},end:{line:200,column:5}},type:"if",locations:[{start:{line:196,column:4},end:{line:200,column:5}},{start:{line:196,column:4},end:{line:200,column:5}}],line:196},13:{loc:{start:{line:204,column:4},end:{line:208,column:5}},type:"if",locations:[{start:{line:204,column:4},end:{line:208,column:5}},{start:{line:204,column:4},end:{line:208,column:5}}],line:204},14:{loc:{start:{line:212,column:4},end:{line:216,column:5}},type:"if",locations:[{start:{line:212,column:4},end:{line:216,column:5}},{start:{line:212,column:4},end:{line:216,column:5}}],line:212}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0],13:[0,0],14:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(134),l=r(s),u=n(140),c=r(u),d=n(62),f=r(d),h=n(46),v=r(h),p=n(185),_=r(p),m=n(17),g=n(136),y=r(g),E=n(137),S=r(E),T=function(){function e(t,n,r,o,s,u,d,f){i(this,e),++a.f[0],++a.s[0],this._crowUrl=o,++a.s[1],this.p2pUploadStartValue=f,++a.s[2],this.p2pDownloadStartValue=d,++a.s[3],this.mediaElement=new y.default,++a.s[4],this.parser=new l.default,++a.s[5],this.mediaMap=new c.default(this.parser.hls),++a.s[6],this.segmentViews={},++a.s[7],this.segmentRequestMap=new Map;var h=(++a.s[8],{streamrootKey:t});++a.s[9],""!==n?(++a.b[0][0],++a.s[10],h.contentId=n):++a.b[0][1],++a.s[11],s?(++a.b[1][0],++a.s[12],h.backendUrl=s):++a.b[1][1],++a.s[13],h.rangeRequestEnabled=u,++a.s[14],this.playerInterface=new S.default(this.parser.hls,h,r),++a.s[15],this._setupParserEvents(this.parser,h)}return o(e,[{key:"_setupParserEvents",value:function(e,t){var n=this;++a.f[1],++a.s[16],e.onManifestLoading=function(){if(++a.f[2],++a.s[17],n.srModule=new _.default(n.playerInterface,e.hls.url,n.mediaMap,t,f.default,_.default.StreamTypes.HLS,"v2"),++a.s[18],n.srModule.setMediaElement(n.mediaElement),++a.s[19],1)++a.b[2][1];else{++a.b[2][0];var r=(++a.s[20],require("@streamroot/reaper")),i=(++a.s[21],require("streamroot-p2p/app/js/utils/timers/factory")),o=i.createInterval;++a.s[22],r.mobile=!0,++a.s[23],r.createInterval=o,++a.s[24],r.collect(function(){return++a.f[3],++a.s[25],n.srModule},r.scopes.PeerAgent),++a.s[26],r.collect(function(){return++a.f[4],++a.s[27],e.hls},r.scopes.HlsJS),++a.s[28],r.crow=n._crowUrl}++a.s[29],n.p2pUploadStartValue?(++a.b[3][0],++a.s[30],n.enableP2PUpload()):(++a.b[3][1],++a.s[31],n.disableP2PUpload()),++a.s[32],n.p2pDownloadStartValue?(++a.b[4][0],++a.s[33],n.enableP2PDownload()):(++a.b[4][1],++a.s[34],n.disableP2PDownload())},++a.s[35],e.onManifestLoaded=function(){++a.f[5]},++a.s[36],e.onManifestParsed=function(){++a.f[6],++a.s[37],(0,m.nativeCall)("truncated_manifest_notification",{url:n.masterURL,manifest:n.masterPlayerlist})},++a.s[38],e.onLevelLoaded=function(e){++a.f[7],++a.s[39],n.playerInterface.truncateManifest(n.playbackTime,e,n.content,function(t,r){++a.f[8],++a.s[40],n.mediaElement.duration=r,++a.s[41],(0,m.nativeCall)("truncated_manifest_notification",{url:e.details.url,manifest:t})}),++a.s[42],n.playerInterface.levelSwitch(e),++a.s[43],n._generateSegmentViews(e)}}},{key:"_generateSegmentViews",value:function(e){var t=this;++a.f[9];var n=(++a.s[44],e.level),r=(++a.s[45],this.parser.hls.levels[n]),i=(++a.s[46],new v.default({level:n,urlId:r.urlId}));++a.s[47],e.details.fragments.forEach(function(e){++a.f[10];var n=(++a.s[48],new f.default({sn:e.sn,trackView:i,time:e.start}));++a.s[49],t.segmentViews[e.url]=n})}},{key:"updateManifest",value:function(e,t,n){++a.f[11],++a.s[50],this.playbackTime=e,++a.s[51],this.masterURL=(++a.b[5][0],this.masterURL||(++a.b[5][1],n)),++a.s[52],this.content=this.masterPlayerlist?(++a.b[6][0],t):(++a.b[6][1],null),++a.s[53],this.masterPlayerlist=(++a.b[7][0],this.masterPlaylist||(++a.b[7][1],t)),++a.s[54],this.parser.update(t,n)}},{key:"getSegment",value:function(e,t){var n=this;++a.f[12];var r=(++a.s[55],{onProgress:function(e,t){++a.f[13]},onError:function(t,r){++a.f[14],++a.s[56],(0,m.nativeCall)("get_segment_error_notification",{error:t,proxyRequestId:e}),++a.s[57],n.segmentRequestMap.delete(e)},onSuccess:function(t,r,i){++a.f[15];var o=(++a.s[58],r),s=o.cdnDownloaded,l=o.p2pDownloaded,u=o.cdnDuration,c=o.p2pDuration,d=(++a.s[59],s+l),f=(++a.s[60],u+c),h=(++a.s[61],f>0?(++a.b[8][0],8e3*d/f):(++a.b[8][1],0));++a.s[62],(0,m.nativeCall)("get_segment_success_notification",{bandwidth:h,proxyRequestId:e,response:t,stats:r}),++a.s[63],n.segmentRequestMap.delete(e)}}),i=(++a.s[64],this.segmentViews[t]);++a.s[65],window.lastSN=i.sn;var o=(++a.s[66],{url:t,headers:{},withCredentials:!1}),s=(++a.s[67],this.srModule.getSegment(o,r,i));++a.s[68],this.segmentRequestMap.set(e,s)}},{key:"abortSegmentRequest",value:function(e){++a.f[16];var t=(++a.s[69],this.segmentRequestMap.get(e));++a.s[70],t?(++a.b[9][0],++a.s[71],t.abort()):(++a.b[9][1],++a.s[72],(0,m.nativeError)("Could not abort segment request: no request found for id "+e))}},{key:"getStats",value:function(){return++a.f[17],++a.s[73],this.srModule?(++a.b[10][0],++a.s[74],this.srModule.stats):(++a.b[10][1],++a.s[75],null)}},{key:"enableP2PUpload",value:function(){++a.f[18],++a.s[76],this.srModule?(++a.b[11][0],++a.s[77],this.srModule.p2pUploadOn=!0):(++a.b[11][1],++a.s[78],this.p2pUploadStartValue=!0)}},{key:"disableP2PUpload",value:function(){++a.f[19],++a.s[79],this.srModule?(++a.b[12][0],++a.s[80],this.srModule.p2pUploadOn=!1):(++a.b[12][1],++a.s[81],this.p2pUploadStartValue=!1)}},{key:"enableP2PDownload",value:function(){++a.f[20],++a.s[82],this.srModule?(++a.b[13][0],++a.s[83],this.srModule.p2pDownloadOn=!0):(++a.b[13][1],++a.s[84],this.p2pDownloadStartValue=!0)}},{key:"disableP2PDownload",value:function(){++a.f[21],++a.s[85],this.srModule?(++a.b[14][0],++a.s[86],this.srModule.p2pDownloadOn=!1):(++a.b[14][1],++a.s[87],this.p2pDownloadStartValue=!1)}}]),e}();t.default=T,e.exports=t.default},function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,[{key:"load",value:function(t,n,r){(0,r.onSuccess)({data:e.Resources[t.url],url:t.url},{},t)}}]),e}();a.Resources={},t.default=a,e.exports=t.default},function(e,t,n){var r,r;!function(t){e.exports=function(){var e;return function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!l&&u)return r(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return a(n||e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function a(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,a,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),r=u.length,l=0;l<r;l++)u[l].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,n,r){!function(t){var i=/^([^#]*)(.*)$/,a=/^([^\?]*)(.*)$/,o=/^(([a-z]+:\/\/)?[^:\/]+(?::[0-9]+)?)?(\/?.*)$/i,s={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var n=null,r=null,l=i.exec(t);l&&(r=l[2],t=l[1]);var u=a.exec(t);u&&(n=u[2],t=u[1]);var c=i.exec(e);c&&(e=c[1]);var d=a.exec(e);d&&(e=d[1]);var f=o.exec(e);if(!f)throw new Error("Error trying to parse base URL.");var h=f[2]||"",v=f[1]||"",p=f[3];0!==p.indexOf("/")&&""!==v&&(p="/"+p);var _=null;return _=/^\/\//.test(t)?h+s.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?v+"/"+s.buildAbsolutePath("",t.substring(1)):s.buildAbsolutePath(v+p,t),n&&(_+=n),r&&(_+=r),_},buildAbsolutePath:function(e,t){for(var n,r,i=t,a="",o=e.replace(/[^\/]*$/,i.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),s=0;(r=o.indexOf("/../",s))>-1;s=r+n)n=/^\/(?:\.\.\/)*/.exec(o.slice(r))[0].length,a=(a+o.substring(s,r)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(n-1)/3+"}$"),"/");return a+o.substr(s)}};"object"==typeof r&&"object"==typeof n?n.exports=s:"function"==typeof e&&e.amd?e([],function(){return s}):"object"==typeof r?r.URLToolkit=s:t.URLToolkit=s}(this)},{}],3:[function(e,t,n){var r=arguments[3],i=arguments[4],a=arguments[5],o=JSON.stringify;t.exports=function(e,t){function n(e){_[e]=!0;for(var t in i[e][1]){var r=i[e][1][t];_[r]||n(r)}}for(var s,l=Object.keys(a),u=0,c=l.length;u<c;u++){var d=l[u],f=a[d].exports;if(f===e||f&&f.default===e){s=d;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},u=0,c=l.length;u<c;u++){var d=l[u];h[d]=d}i[s]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[s]=s,i[v]=[Function(["require"],"var f = require("+o(s)+");(f.default ? f.default : f)(self);"),p];var _={};n(v);var m="("+r+")({"+Object.keys(_).map(function(e){return o(e)+":["+i[e][0]+","+o(i[e][1])+"]"}).join(",")+"},{},["+o(v)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return y;var E=g.createObjectURL(y),S=new Worker(E);return S.objectURL=E,S}},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(30),h=r(f),v=e(26),p=e(45),_=e(9),m=r(_),g=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return n.lastLoadedFragLevel=0,n._autoLevelCapping=-1,n._nextAutoLevel=-1,n.hls=e,n.onCheck=n.abandonRulesCheck.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.clearTimer(),d.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var n=this.hls,r=e.frag.level,i=n.levels[r].details.live,a=n.config,o=void 0,s=void 0;i?(o=a.abrEwmaFastLive,s=a.abrEwmaSlowLive):(o=a.abrEwmaFastVoD,s=a.abrEwmaSlowVoD),this.bwEstimator=new m.default(n,s,o,a.abrEwmaDefaultEstimate)}this.fragCurrent=t}}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,n=this.fragCurrent,r=n.loader,i=this.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var a=r.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var o=performance.now()-a.trequest,s=Math.abs(t.playbackRate);if(o>500*n.duration/s){var l=e.levels,c=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/o),d=l[n.level],f=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,v=a.total?a.total:Math.max(a.loaded,Math.round(n.duration*f/8)),_=t.currentTime,m=(v-a.loaded)/c,g=(h.default.bufferInfo(t,_,e.config.maxBufferHole).end-_)/s;if(g<2*n.duration/s&&m>g){var y=void 0,E=void 0;for(E=n.level-1;E>i;E--){var S=l[E].realBitrate?Math.max(l[E].realBitrate,l[E].bitrate):l[E].bitrate;if((y=n.duration*S/(6.4*c))<g)break}y<m&&(p.logger.warn("loading too slow, abort fragment loading and switch to level "+E+":fragLoadedDelay["+E+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+y.toFixed(1)+"<"+m.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=E,this.bwEstimator.sample(o,a.loaded),r.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:a}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type){this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1;var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;if(n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i),e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&1===n.loadCounter&&"main"===n.type&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;p.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this.bwEstimator.sample(r,t.loaded),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(e,t,n,r,i,a,o,s,l){for(var u=i;u>=r;u--){var c=l[u],d=c.details,f=d?d.totalduration/d.fragments.length:t,h=!!d&&d.live,v=void 0;v=u<=e?o*n:s*n;var _=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,m=_*f/v;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(v)+"/"+_+"/"+f+"/"+a+"/"+m),v>_&&(!m||h||m<a))return u}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator,n=this.hls,r=n.levels,i=n.config.minAutoBitrate;if(!(-1===e||t&&t.canEstimate()))return Math.min(e,this.maxAutoLevel);var a=this.nextABRAutoLevel;if(-1!==e&&(a=Math.min(e,a)),void 0!==i)for(var o=r[a].realBitrate?Math.max(r[a].realBitrate,r[a].bitrate):r[a].bitrate;o<i;)a++;return a},set:function(e){this._nextAutoLevel=e}},{key:"minAutoLevel",get:function(){for(var e=this.hls,t=e.levels,n=e.config.minAutoBitrate,r=t?t.length:0,i=0;i<r;i++){if((t[i].realBitrate?Math.max(t[i].realBitrate,t[i].bitrate):t[i].bitrate)>n)return i}return 0}},{key:"maxAutoLevel",get:function(){var e=this.hls.levels,t=this._autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextABRAutoLevel",get:function(){var e=this.hls,t=this.maxAutoLevel,n=e.levels,r=e.config,i=this.minAutoLevel,a=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,d=(h.default.bufferInfo(a,l,r.maxBufferHole).end-l)/u,f=this.findBestLevel(o,s,c,i,t,d,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(f>=0)return f;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay,_=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===d){var g=this.bitrateTestDelay;if(g){v=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-g,p.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),_=m=1}}return f=this.findBestLevel(o,s,c,i,t,d+v,_,m,n),Math.max(f,0)}}]),t}(d.default);n.default=g},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(41),c=r(u),d=e(30),f=r(d),h=e(22),v=r(h),p=e(28),_=r(p),m=e(27),g=r(m),y=e(31),E=r(y),S=e(46),T=r(S),b=e(26),R=e(45),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},D=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,_.default.MEDIA_ATTACHED,_.default.MEDIA_DETACHING,_.default.AUDIO_TRACKS_UPDATED,_.default.AUDIO_TRACK_SWITCHING,_.default.AUDIO_TRACK_LOADED,_.default.KEY_LOADED,_.default.FRAG_LOADED,_.default.FRAG_PARSING_INIT_SEGMENT,_.default.FRAG_PARSING_DATA,_.default.FRAG_PARSED,_.default.ERROR,_.default.BUFFER_CREATED,_.default.BUFFER_APPENDED,_.default.BUFFER_FLUSHED,_.default.INIT_PTS_FOUND));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=A.STOPPED,n.ontick=n.tick.bind(n),n.initPTS=[],n.waitingFragment=null,n}return o(t,e),l(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),g.default.prototype.destroy.call(this),this.state=A.STOPPED}},{key:"onInitPtsFound",value:function(e){var t=e.id,n=e.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,R.logger.log("InitPTS for cc:"+n+" found from video track:"+r),this.state===A.WAITING_INIT_PTS&&(R.logger.log("sending pending audio frag to demuxer"),this.state=A.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&-1===e?(R.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,n,r,i,a,o=this,l=this.hls,u=l.config,d=function(){switch(o.state){case A.ERROR:case A.PAUSED:case A.BUFFER_FLUSHING:break;case A.STARTING:o.state=A.WAITING_TRACK,o.loadedmetadata=!1;break;case A.IDLE:var s=o.tracks;if(!s)break;if(!o.media&&(o.startFragRequested||!u.startFragPrefetch))break;e=o.loadedmetadata?o.media.currentTime:o.nextLoadPosition;var d=o.mediaBuffer?o.mediaBuffer:o.media,h=f.default.bufferInfo(d,e,u.maxBufferHole),v=h.len,p=h.end,m=o.fragPrevious,g=u.maxMaxBufferLength,y=o.audioSwitch,E=o.trackId;if(v<g&&E<s.length){if(void 0===(n=s[E].details)){o.state=A.WAITING_TRACK;break}if(!y&&!n.live&&m&&m.sn===n.endSN&&(!o.media.seeking||o.media.duration-p<m.duration/2)){o.hls.trigger(_.default.BUFFER_EOS,{type:"audio"}),o.state=A.ENDED;break}var S=n.fragments,T=S.length,D=S[0].start,k=S[T-1].start+S[T-1].duration,w=void 0;if(y)if(n.live&&!n.PTSKnown)R.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),p=0;else if(p=e,n.PTSKnown&&e<D){if(!(h.end>D||h.nextStart))return{v:void 0};R.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),o.media.currentTime=D+.05}if(p<=D){if(w=S[0],n.live&&w.loadIdx&&w.loadIdx===o.fragLoadIdx){var O=h.nextStart?h.nextStart:D;return R.logger.log("no alt audio available @currentTime:"+o.media.currentTime+", seeking @"+(O+.05)),o.media.currentTime=O+.05,{v:void 0}}}else!function(){var e=void 0,t=u.maxFragLookUpTolerance;p<k?(p>k-t&&(t=0),(e=c.default.search(S,function(e){return e.start+e.duration-t<=p?1:e.start-t>p?-1:0}))||R.logger.log("frag not found @bufferEnd/start:"+p+"/"+D)):e=S[T-1],e&&(w=e,D=e.start,m&&w.level===m.level&&w.sn===m.sn&&(w.sn<n.endSN?(w=S[w.sn+1-n.startSN],R.logger.log("SN just loaded, load next one: "+w.sn)):w=null))}();if(w)if(null!=w.decryptdata.uri&&null==w.decryptdata.key)R.logger.log("Loading key for "+w.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+E),o.state=A.KEY_LOADING,l.trigger(_.default.KEY_LOADING,{frag:w});else{if(R.logger.log("Loading "+w.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+E+", currentTime:"+e+",bufferEnd:"+p.toFixed(3)),void 0!==o.fragLoadIdx?o.fragLoadIdx++:o.fragLoadIdx=0,w.loadCounter){w.loadCounter++;var C=u.fragLoadingLoopThreshold;if(w.loadCounter>C&&Math.abs(o.fragLoadIdx-w.loadIdx)<C)return l.trigger(_.default.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:w}),{v:void 0}}else w.loadCounter=1;w.loadIdx=o.fragLoadIdx,o.fragCurrent=w,o.startFragRequested=!0,o.nextLoadPosition=w.start+w.duration,l.trigger(_.default.FRAG_LOADING,{frag:w}),o.state=A.FRAG_LOADING}}break;case A.WAITING_TRACK:(t=o.tracks[o.trackId])&&t.details&&(o.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:r=performance.now(),i=o.retryDate,d=o.media,a=d&&d.seeking,(!i||r>=i||a)&&(R.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),o.state=A.IDLE);break;case A.WAITING_INIT_PTS:case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}}();if("object"===(void 0===d?"undefined":s(d)))return d.v}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(R.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===A.ENDED&&(this.state=A.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){R.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.state=A.IDLE,this.fragCurrent=null,this.state=A.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=A.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,n=e.id,r=this.tracks[n],i=t.totalduration,a=0;if(R.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var o=r.details;o&&t.fragments.length>0?(E.default.mergeDetails(o,t),a=t.fragments[0].start,t.PTSKnown?R.logger.log("live audio playlist sliding:"+a.toFixed(3)):R.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,R.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;isNaN(s)?this.startPosition=0:(R.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s)}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_TRACK&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&"audio"===e.frag.type&&e.frag.level===t.level&&e.frag.sn===t.sn){this.state=A.PARSING,this.stats=e.stats;var n=this.tracks[this.trackId],r=n.details,i=r.totalduration,a=t.start,o=t.level,s=t.sn,l=t.cc,u=this.config.defaultAudioCodec||n.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new v.default(this.hls,"audio"));var c=this.initPTS[l];if(void 0!==c){this.pendingBuffering=!0,R.logger.log("Demuxing "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o);this.demuxer.push(e.payload,u,null,a,l,o,s,i,t.decryptdata,!1,c)}else R.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o),this.waitingFragment=e,this.state=A.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING){var n=e.tracks,r=void 0;if(n.video&&delete n.video,r=n.audio){r.levelCodec="mp4a.40.2",r.id=e.id,this.hls.trigger(_.default.BUFFER_CODECS,n),R.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var i=r.initSegment;if(i){var a={type:"audio",data:i,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(_.default.BUFFER_APPENDING,a))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;n&&"audio"===e.id&&"audio"===e.type&&e.sn===n.sn&&e.level===n.level&&this.state===A.PARSING&&function(){var n=t.trackId,r=t.tracks[n],i=t.fragCurrent,a=t.hls;R.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),E.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS);var o=t.audioSwitch,s=t.media,l=!1;if(o&&s)if(s.readyState){var u=s.currentTime;R.logger.log("switching audio track : currentTime:"+u),u>=e.startPTS&&(R.logger.log("switching audio track : flushing all audio"),t.state=A.BUFFER_FLUSHING,a.trigger(_.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l=!0,t.audioSwitch=!1,a.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:n}))}else t.audioSwitch=!1,a.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:n});var c=t.pendingData;t.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&c.push({type:e.type,data:t,parent:"audio",content:"data"})}),!l&&c.length&&(c.forEach(function(e){t.pendingBuffering=!0,t.hls.trigger(_.default.BUFFER_APPENDING,e)}),t.pendingData=[],t.appended=!0)),t.tick()}()}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==A.PARSING&&t!==A.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==A.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),n.trigger(_.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;R.logger.log("audio buffered : "+T.default.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=A.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var n=this.fragLoadError;n?n++:n=1;var r=this.config;if(n<=r.fragLoadingMaxRetry){this.fragLoadError=n,t.loadCounter=0;var i=Math.min(Math.pow(2,n-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);R.logger.warn("audioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=A.FRAG_LOADING_WAITING_RETRY}else R.logger.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(_.default.ERROR,e),this.state=A.ERROR}break;case b.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,R.logger.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(R.logger.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(_.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=A.PARSED):(this.state=A.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,R.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(g.default);n.default=D},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.AUDIO_TRACK_LOADED));return n.ticks=0,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){d.default.prototype.destroy.call(this)}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,n=e.audioTracks||[],r=!1;this.tracks=n,this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:n});var i=0;n.forEach(function(e){return e.default?(t.audioTrack=i,void(r=!0)):void i++}),!1===r&&n.length&&(f.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(f.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,f.logger.log("switching to audioTrack "+e);var t=this.tracks[e],n=this.hls,r=t.type,i=t.url,a={id:e,type:r,url:i};n.trigger(u.default.AUDIO_TRACK_SWITCH,a),n.trigger(u.default.AUDIO_TRACK_SWITCHING,a);var o=t.details;!i||void 0!==o&&!0!==o.live||(f.logger.log("(re)loading playlist for audioTrack "+e),n.trigger(u.default.AUDIO_TRACK_LOADING,{url:i,id:e}))}}},{key:"updateTrack",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,f.logger.log("updating audioTrack "+e);var t=this.tracks[e],n=t.url,r=t.details;!n||void 0!==r&&!0!==r.live||(f.logger.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:n,id:e}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(d.default);n.default=h},{27:27,28:28,45:45}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=e(26),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return o(t,e),s(t,[{key:"destroy",value:function(){d.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){i=!0,f.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(f.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){var t=e.audio,n=e.video,r=0;e.altAudio&&(t||n)&&(r=(t?1:0)+(n?1:0),f.logger.log(r+" sourceBuffer(s) expected")),this.sourceBufferNb=r}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function(){f.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){f.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){f.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){f.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){f.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;f.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,n=this.segments.reduce(function(e,n){return n.parent===t?e+1:e},0);this.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(e){f.logger.error("sourceBuffer error:"+e),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this.onsbue),n.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var n=this.mediaSource;n&&"open"===n.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,n=this.mediaSource;for(var r in e)if(!t[r]){var i=e[r],a=i.levelCodec||i.codec,o=i.container+";codecs="+a;f.logger.log("creating sourceBuffer("+o+")");try{var s=t[r]=n.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[r]={codec:a,container:i.container},i.buffer=s}catch(e){f.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){f.logger.error("sourceBuffer error:",e.event),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,n=e.type;for(var r in t)n&&r!==n||t[r].ended||(t[r].ended=!0,f.logger.log(r+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var n in e){var r=e[n];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}f.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){f.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e=this.media,t=this.mediaSource,n=this.sourceBuffer,r=this._levelDuration;if(null!==r&&e&&t&&n&&0!==e.readyState&&"open"===t.readyState){for(var i in n)if(n[i].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var a=e.duration;(r>this._msDuration&&r>a||a===1/0||isNaN(a))&&(f.logger.log("Updating mediasource duration to "+r.toFixed(3)),this._msDuration=t.duration=r)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n)t+=n[r].buffered.length}catch(e){f.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,n=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void f.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var r=n.shift();try{var i=r.type,a=t[i];a?a.updating?n.unshift(r):(a.ended=!1,this.parent=r.parent,a.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){f.logger.error("error while trying to append buffer:"+t.message),n.unshift(r);var o={type:h.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],o.details=h.ErrorDetails.BUFFER_FULL_ERROR,o.fatal=!1,void e.trigger(u.default.ERROR,o);if(this.appendError?this.appendError++:this.appendError=1,o.details=h.ErrorDetails.BUFFER_APPEND_ERROR,o.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return f.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),n=[],o.fatal=!0,void e.trigger(u.default.ERROR,o);o.fatal=!1,e.trigger(u.default.ERROR,o)}}}}},{key:"flushBuffer",value:function(e,t,n){var r,i,a,o,s,l,u=this.sourceBuffer;if(Object.keys(u).length){if(f.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var c in u)if(!n||c===n){if(r=u[c],r.ended=!1,r.updating)return f.logger.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<r.buffered.length;i++)if(a=r.buffered.start(i),o=r.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(s=e,l=t):(s=Math.max(a,e),l=Math.min(o,t)),Math.min(l,o)-s>.5)return this.flushBufferCounter++,f.logger.log("flush "+c+" ["+s+","+l+"], of ["+a+","+o+"], pos:"+this.media.currentTime),r.remove(s,l),!1}catch(e){f.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else f.logger.warn("abort flushing too many retries");f.logger.log("buffer flushed")}return!0}}]),t}(d.default);n.default=v},{26:26,27:27,28:28,45:45}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED))}return o(t,e),s(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var t=0,n=void 0,r=void 0,i=this.mediaWidth,a=this.mediaHeight,o=0,s=0;for(n=0;n<=e&&(r=this.levels[n],!this.isLevelRestricted(n))&&(t=n,o=r.width,s=r.height,!(i<=o||a<=s));n++);return t}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(e))}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(d.default);n.default=f},{27:27,28:28}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(44),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n,i,a){r(this,e),this.hls=t,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new o.default(n),this.fast_=new o.default(i)}return i(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var n=8e3*t/e,r=e/1e3;this.fast_.sample(r,n),this.slow_.sample(r,n)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();n.default=s},{44:44}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING))}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){"function"==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,n){var r=performance.now();if(t){if(this.lastTime){var i=r-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/i,l=this.hls;if(l.trigger(u.default.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),s>0&&a>l.config.fpsDroppedMonitoringThreshold*o){var c=l.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=c)&&(c-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,l.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(d.default);n.default=h},{27:27,28:28,45:45}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=e(26),v=e(30),p=r(v),_=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.FRAG_LOADED,u.default.ERROR));return n.ontick=n.tick.bind(n),n._manualLevel=n._autoLevelCapping=-1,n}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,n=[],r=[],i={},a=!1,o=!1,s=this.hls,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c=function(e,t){return MediaSource.isTypeSupported(e+"/mp4;codecs="+t)};if(e.levels.forEach(function(e){e.videoCodec&&(a=!0),l&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(o=!0);var t=i[e.bitrate];void 0===t?(i[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),a&&o?n.forEach(function(e){e.videoCodec&&r.push(e)}):r=n,r=r.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||c("audio",t))&&(!n||c("video",n))}),r.length){t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var d=0;d<r.length;d++)if(r[d].bitrate===t){this._firstLevel=d,f.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}s.trigger(u.default.MANIFEST_PARSED,{levels:r,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:a,altAudio:e.audioTracks.length>0})}else s.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e&&(f.logger.log("switching to level "+e),this._level=e,this.hls.trigger(u.default.LEVEL_SWITCH,{level:e}));var n=t[e],r=n.details;if(!r||!0===r.live){var i=n.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:n.url[i],level:e,id:i})}}else this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,n=this.hls,r=void 0,i=void 0,a=!1,o=n.abrController,s=o.minAutoLevel;switch(t){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:r=e.frag.level;break;case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:r=e.context.level,a=!0;break;case h.ErrorDetails.REMUX_ALLOC_ERROR:r=e.level}if(void 0!==r){i=this._levels[r],i.loadError?i.loadError++:i.loadError=1;var l=i.url.length;if(l>1&&i.loadError<l)i.urlId=(i.urlId+1)%l,i.details=void 0,f.logger.warn("level controller,"+t+" for level "+r+": switching to redundant stream id "+i.urlId);else{if(-1===this._manualLevel&&r)f.logger.warn("level controller,"+t+": switch-down for next fragment"),o.nextAutoLevel=Math.max(s,r-1);else if(i&&i.details&&i.details.live)f.logger.warn("level controller,"+t+" on live stream, discard"),a&&(this._level=void 0);else if(t===h.ErrorDetails.LEVEL_LOAD_ERROR||t===h.ErrorDetails.LEVEL_LOAD_TIMEOUT){var c=n.media,d=c&&p.default.isBuffered(c,c.currentTime)&&p.default.isBuffered(c,c.currentTime+.5);if(d){var v=n.config.levelLoadingRetryDelay;f.logger.warn("level controller,"+t+", but media buffered, retry in "+v+"ms"),this.timer=setTimeout(this.ontick,v)}else f.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,n.trigger(u.default.ERROR,e)}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(t&&"main"===t.type){var n=this._levels[t.level];n&&(n.loadError=0)}}},{key:"onLevelLoaded",value:function(e){var t=e.level;if(t===this._level){var n=this._levels[t];n.loadError=0;var r=e.details;if(r.live){var i=1e3*(r.averagetargetduration?r.averagetargetduration:r.targetduration),a=n.details;a&&r.endSN===a.endSN&&(i/=2,f.logger.log("same live playlist, reload twice faster")),i-=performance.now()-e.stats.trequest,i=Math.max(1e3,Math.round(i)),f.logger.log("live playlist, reload in "+i+" ms"),this.timer=setTimeout(this.ontick,i)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],n=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:t.url[n],level:e,id:n})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){-1!==e&&(e=Math.max(e,this.hls.abrController.minAutoLevel)),this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(d.default);n.default=_},{26:26,27:27,28:28,30:30,45:45}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(41),u=r(l),c=e(30),d=r(c),f=e(22),h=r(f),v=e(28),p=r(v),_=e(27),m=r(_),g=e(31),y=r(g),E=e(46),S=r(E),T=e(26),b=e(45),R={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},A=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.MANIFEST_LOADING,p.default.MANIFEST_PARSED,p.default.LEVEL_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_LOAD_EMERGENCY_ABORTED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_SWITCHED,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=R.STOPPED,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),m.default.prototype.destroy.call(this),this.state=R.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(b.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=R.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else b.logger.warn("cannot start loading as manifest not parsed yet"),this.state=R.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case R.ERROR:break;case R.BUFFER_FLUSHING:this.fragLoadError=0;break;case R.IDLE:if(!this._doTickIdle())return;break;case R.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=R.IDLE);break;case R.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(b.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=R.IDLE);break;case R.ERROR:case R.STOPPED:case R.FRAG_LOADING:case R.PARSING:case R.PARSED:case R.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&!n&&(this.startFragRequested||!t.startFragPrefetch))return!0;var r=void 0;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,a=this.levels[i],o=a.bitrate,s=void 0;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=d.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,t.maxBufferHole),u=l.len;if(u>=s)return!0;b.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var c=a.details;if(void 0===c||c.live&&this.levelLastLoaded!==i)return this.state=R.WAITING_LEVEL,!0;var f=this.fragPrevious;if(!c.live&&f&&f.sn===c.endSN&&n.duration-Math.max(l.end,f.start)<=Math.max(.2,f.duration/2)){var h={};return this.altAudio&&(h.type="video"),this.hls.trigger(p.default.BUFFER_EOS,h),this.state=R.ENDED,!0}return this._fetchPayloadOrEos(r,l,c)}},{key:"_fetchPayloadOrEos",value:function(e,t,n){var r=this.fragPrevious,i=this.level,a=n.fragments,o=a.length;if(0===o)return!1;var s=a[0].start,l=a[o-1].start+a[o-1].duration,u=t.end,c=void 0;if(n.live){var d=this.config.initialLiveManifestSize;if(o<d)return b.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+d),!1;if(null===(c=this._ensureFragmentAtLivePoint(n,u,s,l,r,a,o)))return!1}else u<s&&(c=a[0]);return c||(c=this._findFragment(s,r,o,a,u,l,n)),!c||this._loadFragmentOrKey(c,i,n,e,u)}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,n,r,i,a,o){var s=this.hls.config,l=this.media,u=void 0,c=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(n-s.maxFragLookUpTolerance,r-c)){var d=this.liveSyncPosition=this.computeLivePosition(n,e);b.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),t=d,l&&l.readyState&&l.duration>d&&(l.currentTime=d)}if(e.PTSKnown&&t>r&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(i){var f=i.sn+1;f>=e.startSN&&f<=e.endSN&&(u=a[f-e.startSN],b.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=a[Math.min(o-1,Math.round(o/2))],b.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u}},{key:"_findFragment",value:function(e,t,n,r,i,a,o){var s=this.hls.config,l=void 0,c=void 0,d=s.maxFragLookUpTolerance;if(i<a?(i>a-d&&(d=0),c=u.default.search(r,function(e){return e.start+e.duration-d<=i?1:e.start-d>i&&e.start?-1:0})):c=r[n-1],c&&(l=c,c.start,t&&l.level===t.level&&l.sn===t.sn))if(l.sn<o.endSN){var f=t.deltaPTS,h=l.sn-o.startSN;f&&f>s.maxBufferHole&&t.dropped&&h?(l=r[h-1],b.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(l=r[h+1],b.logger.log("SN just loaded, load next one: "+l.sn))}else l=null;return l}},{key:"_loadFragmentOrKey",value:function(e,t,n,r,i){var a=this.hls,o=a.config;if(null==e.decryptdata.uri||null!=e.decryptdata.key){if(b.logger.log("Loading "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t+", currentTime:"+r.toFixed(3)+",bufferEnd:"+i.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var s=o.fragLoadingLoopThreshold;if(e.loadCounter>s&&Math.abs(this.fragLoadIdx-e.loadIdx)<s)return a.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e}),!1}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,this.nextLoadPosition=e.start+e.duration,e.autoLevel=a.autoLevelEnabled,e.bitrateTest=this.bitrateTest,a.trigger(p.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new h.default(a,"main")),this.state=R.FRAG_LOADING,!0}b.logger.log("Loading key for "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t),this.state=R.KEY_LOADING,a.trigger(p.default.KEY_LOADING,{frag:e})}},{key:"getBufferRange",value:function(e){return u.default.search(this.bufferRange,function(t){return e<t.start?-1:e>t.end?1:0})}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&(t=n.currentTime,t>n.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),d.default.isBuffered(n,t)?e=this.getBufferRange(t):d.default.isBuffered(n,t+.1)&&(e=this.getBufferRange(t+.1)),e)){var r=e.frag;r!==this.fragPlaying&&(this.fragPlaying=r,this.hls.trigger(p.default.FRAG_CHANGED,{frag:r}))}}},{key:"immediateLevelSwitch",value:function(){if(b.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,d.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,n=void 0,r=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,n=this.getBufferRange(e.currentTime),n&&n.start>1&&this.flushMainBuffer(0,n.start-1),e.paused)t=0;else{var i=this.hls.nextLoadLevel,a=this.levels[i],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if((r=this.getBufferRange(e.currentTime+t))&&(r=this.followingBufferRange(r))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=R.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(p.default.BUFFER_FLUSHING,n)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(b.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.media,t=e?e.currentTime:void 0,n=this.config;if(b.logger.log("media seeking to "+t.toFixed(3)),this.state===R.FRAG_LOADING){var r=this.mediaBuffer?this.mediaBuffer:e,i=d.default.bufferInfo(r,t,this.config.maxBufferHole),a=this.fragCurrent;if(0===i.len&&a){var o=n.maxFragLookUpTolerance,s=a.start-o,l=a.start+a.duration+o;t<s||t>l?(a.loader&&(b.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=R.IDLE):b.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===R.ENDED&&(this.state=R.IDLE);e&&(this.lastCurrentTime=t),this.state!==R.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*n.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()}},{key:"onMediaSeeked",value:function(){b.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){b.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){b.logger.log("trigger BUFFER_RESET"),this.hls.trigger(p.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t,n=!1,r=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&b.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var i=this.config;i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,n=e.level,r=this.levels[n],i=t.totalduration,a=0;if(b.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),this.levelLastLoaded=n,t.live){var o=r.details;o&&t.fragments.length>0?(y.default.mergeDetails(o,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,o),t.PTSKnown?b.logger.log("live playlist sliding:"+a.toFixed(3)):b.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,b.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,this.hls.trigger(p.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var s=t.startTimeOffset;isNaN(s)?t.live?(this.startPosition=this.computeLivePosition(a,t),b.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(s<0&&(b.logger.log("negative start time offset "+s+", count from end of last fragment"),s=a+i+s),b.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===R.WAITING_LEVEL&&(this.state=R.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===R.KEY_LOADING&&(this.state=R.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,n=e.frag;if(this.state===R.FRAG_LOADING&&t&&"main"===n.type&&n.level===t.level&&n.sn===t.sn){var r=e.stats,i=this.levels[t.level],a=i.details;if(b.logger.log("Loaded  "+t.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t.level),this.bitrateTest=!1,!0===n.bitrateTest&&this.hls.nextLoadLevel)this.state=R.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=performance.now(),this.hls.trigger(p.default.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else{this.state=R.PARSING,this.stats=r;var o=a.totalduration,s=isNaN(t.startDTS)?t.start:t.startDTS,l=t.level,u=t.sn,c=this.config.defaultAudioCodec||i.audioCodec;this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),void 0===c&&(c=this.lastAudioCodec),c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,b.logger.log("Parsing "+u+" of ["+a.startSN+" ,"+a.endSN+"],level "+l+", cc "+t.cc);var d=this.demuxer;d||(d=this.demuxer=new h.default(this.hls,"main"));var f=this.media,v=f&&f.seeking,_=!v&&(a.PTSKnown||!a.live);d.push(e.payload,c,i.videoCodec,s,t.cc,l,u,o,t.decryptdata,_,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING){var n,r,i=e.tracks;if(i.audio&&this.altAudio&&delete i.audio,r=i.audio){var a=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===o.indexOf("firefox")&&(a="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==r.container&&(a="mp4a.40.2",b.logger.log("Android: force audio codec to "+a)),r.levelCodec=a,r.id=e.id}if(r=i.video,r&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=e.id),e.unique){var s={codec:"",levelCodec:""};for(n in e.tracks)r=i[n],s.container=r.container,s.codec&&(s.codec+=",",s.levelCodec+=","),r.codec&&(s.codec+=r.codec),r.levelCodec&&(s.levelCodec+=r.levelCodec);i={audiovideo:s}}this.hls.trigger(p.default.BUFFER_CODECS,i);for(n in i){r=i[n],b.logger.log("main track:"+n+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var l=r.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,{type:n,data:l,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;if(n&&"main"===e.id&&e.sn===n.sn&&e.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===R.PARSING){var r=this.levels[this.level],i=this.fragCurrent;b.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var a=y.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),o=this.hls;o.trigger(p.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:a,type:e.type,start:e.startPTS,end:e.endPTS}),"video"===e.type&&(i.dropped=e.dropped),[e.data1,e.data2].forEach(function(n){n&&(t.appended=!0,t.pendingBuffering=!0,o.trigger(p.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING&&(this.stats.tparsed=performance.now(),this.state=R.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,n=e.id;if(!t){if(this.mediaBuffer!==this.media){b.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(b.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.IDLE}var i=this.hls;i.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(b.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,n=void 0,r=void 0,i=!1;for(var a in t){var o=t[a];"main"===o.id?(r=a,n=o,"video"===a&&(this.videoBuffer=t[a].buffer)):i=!0}i&&n?(b.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==R.PARSING&&t!==R.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var e=this;if(!(this.state!==R.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;t&&function(){var n=e.mediaBuffer?e.mediaBuffer:e.media;b.logger.log("main buffered : "+S.default.toString(n.buffered));var r=e.bufferRange.filter(function(e){return d.default.isBuffered(n,(e.start+e.end)/2)});r.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:t}),e.bufferRange=r.sort(function(e,t){return e.start-t.start}),e.fragPrevious=t;var i=e.stats;i.tbuffered=performance.now(),e.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),e.hls.trigger(p.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),e.state=R.IDLE}(),this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=this.media,r=n&&d.default.isBuffered(n,n.currentTime)&&d.default.isBuffered(n,n.currentTime+.5);switch(e.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var a=this.config;if(i<=a.fragLoadingMaxRetry||r||t.autoLevel&&t.level){this.fragLoadError=i,t.loadCounter=0;var o=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);b.logger.warn("mediaController: frag loading failed, retry in "+o+" ms"),this.retryDate=performance.now()+o,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=R.FRAG_LOADING_WAITING_RETRY}else b.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=R.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=R.ERROR));break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.ERROR&&(e.fatal?(this.state=R.ERROR,b.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):this.state===R.WAITING_LEVEL&&(this.state=R.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:this.state!==R.PARSING&&this.state!==R.PARSED||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):(b.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,b.logger.warn("reduce max buffer length to "+t.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,n=this.mediaBuffer?this.mediaBuffer:e,r=n.buffered;if(this.loadedmetadata||!r.length||e.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var i=d.default.bufferInfo(e,t,0),a=!(e.paused||e.ended||0===e.buffered.length),o=.5,s=t!==this.lastCurrentTime,l=this.config;if(s)this.stallReported&&(b.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(a){var u=performance.now(),c=this.hls;if(this.stalled){var f=u-this.stalled,h=i.len,v=this.nudgeRetry||0;if(h<=o&&f>1e3*l.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in low buffer @"+t),c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h}));var _=i.nextStart,m=_-t;if(_&&m<l.maxSeekHole&&m>0){this.nudgeRetry=++v;var g=v*l.nudgeOffset;b.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+_+" + nudge "+g),e.currentTime=_+g,this.stalled=void 0,c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:_+g-t})}}else if(h>o&&f>1e3*l.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in high buffer @"+t),c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h})),this.stalled=void 0,this.nudgeRetry=++v,v<l.nudgeMaxRetry){var y=e.currentTime,E=y+v*l.nudgeOffset;b.logger.log("adjust currentTime from "+y+" to "+E),e.currentTime=E,c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("still stuck in high buffer @"+t+" after "+l.nudgeMaxRetry+", raise fatal error"),c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=u,this.stallReported=!1}}else{this.loadedmetadata=!0;var S=this.startPosition,R=d.default.isBuffered(n,S);t===S&&R||(b.logger.log("target start position:"+S),R||(S=r.start(0),b.logger.log("target start position not buffered, seek to buffered.start(0) "+S)),b.logger.log("adjust currentTime from "+t+" to "+S),e.currentTime=S)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=R.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(t){return d.default.isBuffered(e,(t.start+t.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=R.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,b.logger.log("main stream:"+t+"->"+e),this.hls.trigger(p.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferRange(e.currentTime);if(t)return t.frag.level}return-1}},{key:"nextBufferRange",get:function(){var e=this.media;return e?this.followingBufferRange(this.getBufferRange(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(m.default);n.default=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(42),h=r(f),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.MANIFEST_LOADING,u.default.FRAG_LOADED,u.default.LEVEL_SWITCH));if(n.hls=e,n.config=e.config,n.enabled=!0,n.Cues=e.config.cueHandler,n.config.enableCEA708Captions){var r=n,o=function(e,t){var n=null;try{n=new window.Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)},s={newCue:function(e,t,n){if(!r.textTrack1){var i=r.getExistingTrack("1");i?(r.textTrack1=i,r.clearCurrentCues(r.textTrack1),o(r.textTrack1,r.media)):(r.textTrack1=r.createTextTrack("captions","English","en"),r.textTrack1.textTrack1=!0)}r.Cues.newCue(r.textTrack1,e,t,n)}},l={newCue:function(e,t,n){if(!r.textTrack2){var i=r.getExistingTrack("2");i?(r.textTrack2=i,r.clearCurrentCues(r.textTrack2),o(r.textTrack2,r.media)):(r.textTrack2=r.createTextTrack("captions","Spanish","es"),r.textTrack2.textTrack2=!0)}r.Cues.newCue(r.textTrack2,e,t,n)}};n.cea608Parser=new h.default(0,s,l)}return n}return o(t,e),s(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n],i="textTrack"+e;if(!0===r[i])return r}return null}},{key:"createTextTrack",value:function(e,t,n){if(this.media)return this.media.addTextTrack(e,t,n)}},{key:"destroy",value:function(){d.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var n=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,n)}}},{key:"extractCea608Data",value:function(e){for(var t,n,r,i,a,o=31&e[0],s=2,l=[],u=0;u<o;u++)t=e[s++],n=127&e[s++],r=127&e[s++],i=0!=(4&t),a=3&t,0===n&&0===r||i&&0===a&&(l.push(n),l.push(r));return l}}]),t}(d.default);n.default=v},{27:27,28:28,42:42}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.aesIV=n}return i(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();n.default=a},{}],15:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return i(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<n.length;r++)n[r]=t.getUint32(4*r);return n}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,n=this.subMix[0],r=this.subMix[1],i=this.subMix[2],a=this.subMix[3],o=this.invSubMix[0],s=this.invSubMix[1],l=this.invSubMix[2],u=this.invSubMix[3],c=new Uint32Array(256),d=0,f=0,h=0;for(h=0;h<256;h++)c[h]=h<128?h<<1:h<<1^283;for(h=0;h<256;h++){var v=f^f<<1^f<<2^f<<3^f<<4;v=v>>>8^255&v^99,e[d]=v,t[v]=d;var p=c[d],_=c[p],m=c[_],g=257*c[v]^16843008*v;n[d]=g<<24|g>>>8,r[d]=g<<16|g>>>16,i[d]=g<<8|g>>>24,a[d]=g,g=16843009*m^65537*_^257*p^16843008*d,o[v]=g<<24|g>>>8,s[v]=g<<16|g>>>16,l[v]=g<<8|g>>>24,u[v]=g,d?(d=p^c[c[c[m^p]]],f^=c[c[f]]):d=f=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a=this.ksRows=4*(i+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(this.ksRows),u=this.invKeySchedule=new Uint32Array(this.ksRows),c=this.sBox,d=this.rcon,f=this.invSubMix[0],h=this.invSubMix[1],v=this.invSubMix[2],p=this.invSubMix[3],_=void 0,m=void 0;for(o=0;o<a;o++)o<i?_=l[o]=t[o]:(m=_,o%i==0?(m=m<<8|m>>>24,m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m],m^=d[o/i|0]<<24):i>6&&o%i==4&&(m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m]),l[o]=_=(l[o-i]^m)>>>0);for(s=0;s<a;s++)o=a-s,m=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?m:f[c[m>>>24]]^h[c[m>>>16&255]]^v[c[m>>>8&255]]^p[c[255&m]],u[s]=u[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,n){for(var r,i,a=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,l=this.invSubMix[0],u=this.invSubMix[1],c=this.invSubMix[2],d=this.invSubMix[3],f=this.uint8ArrayToUint32Array_(n),h=f[0],v=f[1],p=f[2],_=f[3],m=new Int32Array(e),g=new Int32Array(m.length),y=void 0,E=void 0,S=void 0,T=void 0,b=void 0,R=void 0,A=void 0,D=void 0,k=void 0,w=void 0,O=void 0,C=void 0;t<m.length;){for(k=this.networkToHostOrderSwap(m[t]),w=this.networkToHostOrderSwap(m[t+1]),O=this.networkToHostOrderSwap(m[t+2]),C=this.networkToHostOrderSwap(m[t+3]),b=k^o[0],R=C^o[1],A=O^o[2],D=w^o[3],r=4,i=1;i<a;i++)y=l[b>>>24]^u[R>>16&255]^c[A>>8&255]^d[255&D]^o[r],E=l[R>>>24]^u[A>>16&255]^c[D>>8&255]^d[255&b]^o[r+1],S=l[A>>>24]^u[D>>16&255]^c[b>>8&255]^d[255&R]^o[r+2],T=l[D>>>24]^u[b>>16&255]^c[R>>8&255]^d[255&A]^o[r+3],b=y,R=E,A=S,D=T,r+=4;y=s[b>>>24]<<24^s[R>>16&255]<<16^s[A>>8&255]<<8^s[255&D]^o[r],E=s[R>>>24]<<24^s[A>>16&255]<<16^s[D>>8&255]<<8^s[255&b]^o[r+1],S=s[A>>>24]<<24^s[D>>16&255]<<16^s[b>>8&255]<<8^s[255&R]^o[r+2],T=s[D>>>24]<<24^s[b>>16&255]<<16^s[R>>8&255]<<8^s[255&A]^o[r+3],r+=3,g[t]=this.networkToHostOrderSwap(y^h),g[t+1]=this.networkToHostOrderSwap(T^v),g[t+2]=this.networkToHostOrderSwap(S^p),g[t+3]=this.networkToHostOrderSwap(E^_),h=k,v=w,p=O,_=C,t+=4}return g.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();n.default=a},{}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(14),s=r(o),l=e(17),u=r(l),c=e(15),d=r(c),f=e(26),h=e(45),v=function(){function e(t,n){i(this,e),this.observer=t,this.config=n;try{var r=crypto||self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return a(e,[{key:"decrypt",value:function(e,t,n,r){var i=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){h.logger.log("JS AES decrypt");var a=this.decryptor;a||(this.decryptor=a=new d.default),a.expandKey(t),r(a.decrypt(e,0,n))}else!function(){h.logger.log("WebCrypto AES decrypt");var a=i.subtle;i.key!==t&&(i.key=t,i.fastAesKey=new u.default(a,t)),i.fastAesKey.expandKey().then(function(t){new s.default(a,n).decrypt(e,t).then(function(e){r(e)})}).catch(function(a){i.onWebCryptoError(a,e,t,n,r)})}()}},{key:"onWebCryptoError",value:function(e,t,n,r,i){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(t,n,r,i)):(h.logger.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();n.default=v},{14:14,15:15,17:17,26:26,45:45}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.key=n}return i(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();n.default=a},{}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),l=e(45),u=e(24),c=r(u),d=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.remuxer=new this.remuxerClass(t,n,a,o),this.insertDiscontinuity()}return a(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(e,t,n,r,i,a,o,u,d,f){var h,v,p,_,m,g,y,E,S,T,b=new c.default(e),R=90*b.timeStamp,A=!1;for(i!==this.lastCC?(l.logger.log(this.id+" discontinuity detected"),this.lastCC=i,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):a!==this.lastLevel?(l.logger.log("audio track switch detected"),this.lastLevel=a,this.remuxer.switchLevel(),this.insertDiscontinuity()):o===this.lastSN+1&&(A=!0),h=this._aacTrack,this.lastSN=o,this.lastLevel=a,g=b.length,S=e.length;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);for(h.audiosamplerate||(v=s.default.getAudioConfig(this.observer,e,g,t),h.config=v.config,h.audiosamplerate=v.samplerate,h.channelCount=v.channelCount,h.codec=v.codec,h.manifestCodec=v.manifestCodec,h.duration=u,l.logger.log("parsed codec:"+h.codec+",rate:"+v.samplerate+",nb channel:"+v.channelCount)),m=0,_=9216e4/h.audiosamplerate;g+5<S&&(y=1&e[g+1]?7:9,p=(3&e[g+3])<<11|e[g+4]<<3|(224&e[g+5])>>>5,(p-=y)>0&&g+y+p<=S);)for(E=R+m*_,T={unit:e.subarray(g+y,g+y+p),pts:E,dts:E},h.samples.push(T),h.len+=p,g+=p+y,m++;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);this.remuxer.remux(a,o,i,h,{samples:[]},{samples:[{pts:R,dts:R,unit:b.payload}]},{samples:[]},r,A,d,f)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,n,r=new c.default(e);if(r.hasTimeStamp)for(t=r.length,n=e.length;t<n-1;t++)if(255===e[t]&&240==(240&e[t+1]))return!0;return!1}}]),e}();n.default=d},{19:19,24:24,45:45}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=e(26),s=function(){function e(){r(this,e)}return i(e,null,[{key:"getAudioConfig",value:function(e,t,n,r){var i,s,l,u,c,d=navigator.userAgent.toLowerCase(),f=r,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return i=((192&t[n+2])>>>6)+1,s=(60&t[n+2])>>>2,s>h.length-1?void e.trigger(Event.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s}):(u=(1&t[n+2])<<2,u|=(192&t[n+3])>>>6,a.logger.log("manifest codec:"+r+",ADTS data:type:"+i+",sampleingIndex:"+s+"["+h[s]+"Hz],channelConfig:"+u),/firefox/i.test(d)?s>=6?(i=5,c=new Array(4),l=s-3):(i=2,c=new Array(2),l=s):-1!==d.indexOf("android")?(i=2,c=new Array(2),l=s):(i=5,c=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&s>=6?l=s-3:((r&&-1!==r.indexOf("mp4a.40.2")&&s>=6&&1===u||!r&&1===u)&&(i=2,c=new Array(2)),l=s)),c[0]=i<<3,c[0]|=(14&s)>>1,c[1]|=(1&s)<<7,c[1]|=u<<3,5===i&&(c[1]|=(14&l)>>1,c[2]=(1&l)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:h[s],channelCount:u,codec:"mp4a.40."+i,manifestCodec:f})}}]),e}();n.default=s},{26:26,45:45}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),l=e(26),u=e(16),c=r(u),d=e(18),f=r(d),h=e(25),v=r(h),p=e(38),_=r(p),m=e(39),g=r(m),y=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this.hls=t,this.id=n,this.config=this.hls.config||a,this.typeSupported=r}return a(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,n,r,i,a,o,l,u,d,f){if(e.byteLength>0&&null!=u&&null!=u.key&&"AES-128"===u.method){null==this.decrypter&&(this.decrypter=new c.default(this.hls,this.config));var h,v=this;try{h=performance.now()}catch(e){h=Date.now()}this.decrypter.decrypt(e,u.key.buffer,u.iv.buffer,function(e){var u;try{u=performance.now()}catch(e){u=Date.now()}v.hls.trigger(s.default.FRAG_DECRYPTED,{level:a,sn:o,stats:{tstart:h,tdecrypt:u}}),v.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,l,d,f)})}else this.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,l,d,f)}},{key:"pushDecrypted",value:function(e,t,n,r,i,a,o,u,c,d){var h=this.demuxer;if(!h||i!==this.cc&&!h.probe(e)){var p=this.hls,m=this.id,y=this.config,E=this.typeSupported;if(v.default.probe(e))h=!0===this.typeSupported.mp2t?new v.default(p,m,g.default,y,E):new v.default(p,m,_.default,y,E),h.probe=v.default.probe;else{if(!f.default.probe(e))return void p.trigger(s.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,id:m,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});h=new f.default(p,m,_.default,y,E),h.probe=f.default.probe}this.demuxer=h}h.push(e,t,n,r,i,a,o,u,c,d),this.cc=i}}]),e}();n.default=y},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e(20),a=r(i),o=e(28),s=r(o),l=e(45),u=e(1),c=r(u),d=function(e){var t=new c.default;t.trigger=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var o=JSON.parse(i.config);e.demuxer=new a.default(t,i.id,i.typeSupported,o);try{(0,l.enableLogs)(!0===o.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":e.demuxer.push(i.data,i.audioCodec,i.videoCodec,i.timeOffset,i.cc,i.level,i.sn,i.duration,i.decryptdata,i.accurateTimeOffset,i.defaultInitPTS)}}),t.on(s.default.FRAG_DECRYPTED,n),t.on(s.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(s.default.FRAG_PARSED,n),t.on(s.default.ERROR,n),t.on(s.default.FRAG_PARSING_METADATA,n),t.on(s.default.FRAG_PARSING_USERDATA,n),t.on(s.default.INIT_PTS_FOUND,n),t.on(s.default.FRAG_PARSING_DATA,function(t,n){var r=n.data1.buffer,i=n.data2.buffer;delete n.data1,delete n.data2,e.postMessage({event:t,data:n,data1:r,data2:i},[r,i])})};n.default=d},{1:1,20:20,28:28,45:45}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),l=e(20),u=r(l),c=e(21),d=r(c),f=e(45),h=e(26),v=function(){function t(n,r){i(this,t),this.hls=n,this.id=r;var a={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:n.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(n.config.enableWorker&&"undefined"!=typeof Worker){f.logger.log("demuxing in webworker");var o=void 0;try{var l=e(3);o=this.w=l(d.default),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(e){n.trigger(s.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:a,id:r,config:JSON.stringify(n.config)})}catch(e){f.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&URL.revokeObjectURL(o.objectURL),this.demuxer=new u.default(n,r,a),this.w=void 0}}else this.demuxer=new u.default(n,r,a);this.demuxInitialized=!0}return a(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}}},{key:"push",value:function(e,t,n,r,i,a,o,s,l,u,c){var d=this.w;if(d)d.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:n,timeOffset:r,cc:i,level:a,sn:o,duration:s,decryptdata:l,accurateTimeOffset:u,defaultInitPTS:c},[e]);else{var f=this.demuxer;f&&f.push(e,t,n,r,i,a,o,s,l,u,c)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,n=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data.data2=new Uint8Array(t.data2);default:n.trigger(t.event,t.data)}}}]),t}();n.default=v},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,r=8,i=8;for(t=0;t<e;t++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i}},{key:"readSPS",value:function(){var e,t,n,r,i,a,o,s=0,l=0,u=0,c=0,d=this.readUByte.bind(this),f=this.readBits.bind(this),h=this.readUEG.bind(this),v=this.readBoolean.bind(this),p=this.skipBits.bind(this),_=this.skipEG.bind(this),m=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(d(),e=d(),f(5),p(3),d(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var y=h();if(3===y&&p(1),m(),m(),p(1),v())for(a=3!==y?8:12,o=0;o<a;o++)v()&&g(o<6?16:64)}m();var E=h();if(0===E)h();else if(1===E)for(p(1),_(),_(),t=h(),o=0;o<t;o++)_();m(),p(1),n=h(),r=h(),i=f(1),0===i&&p(1),p(1),v()&&(s=h(),l=h(),u=h(),c=h());var S=[1,1];if(v()&&v()){switch(d()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[d()<<8|d(),d()<<8|d()]}}return{width:Math.ceil(16*(n+1)-2*s-2*l),height:(2-i)*(r+1)*16-(i?2:4)*(u+c),pixelRatio:S}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();n.default=o},{45:45}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this._hasTimeStamp=!1;for(var n,i,o,s,l,u,c,d,f=0;;)if(c=this.readUTF(t,f,3),f+=3,"ID3"===c)f+=3,n=127&t[f++],i=127&t[f++],o=127&t[f++],s=127&t[f++],l=(n<<21)+(i<<14)+(o<<7)+s,u=f+l,this._parseID3Frames(t,f,u),f=u;else{if("3DI"!==c)return f-=3,void((d=f)&&(this.hasTimeStamp||a.logger.warn("ID3 tag found, but no timestamp"),this._length=d,this._payload=t.subarray(0,d)));f+=7,a.logger.log("3DI footer found, end: "+f)}}return i(e,[{key:"readUTF",value:function(e,t,n){var r="",i=t,a=t+n;do{r+=String.fromCharCode(e[i++])}while(i<a);return r}},{key:"_parseID3Frames",value:function(e,t,n){for(var r,i;t+8<=n;)switch(r=this.readUTF(e,t,4),t+=4,e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],e[t++]<<8+e[t++],t,r){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var o=1&e[t++];this._hasTimeStamp=!0,i=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,o&&(i+=47721858.84),i=Math.round(i),a.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();n.default=o},{45:45}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),l=e(28),u=r(l),c=e(23),d=r(c),f=e(45),h=e(26),v=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.typeSupported=o,this.lastCC=0,this.remuxer=new this.remuxerClass(t,n,a,o)}return a(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,n,r,i,a,o,s,l,c){var d,v,p,_,m,g=e.length,y=this.remuxer.passthrough,E=!1;this.audioCodec=t,this.videoCodec=n,this._duration=s,this.contiguous=!1,this.accurateTimeOffset=l,i!==this.lastCC&&(f.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=i),a!==this.lastLevel?(f.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=a):o===this.lastSN+1&&(this.contiguous=!0),this.lastSN=o;var S=this.pmtParsed,T=this._avcTrack,b=this._audioTrack,R=this._id3Track,A=T.id,D=b.id,k=R.id,w=this._pmtId,O=T.pesData,C=b.pesData,L=R.pesData,P=this._parsePAT,I=this._parsePMT,M=this._parsePES,N=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),U=this._parseMPEGPES.bind(this),F=this._parseID3PES.bind(this);for(g-=g%188,d=0;d<g;d+=188)if(71===e[d]){if(v=!!(64&e[d+1]),p=((31&e[d+1])<<8)+e[d+2],(48&e[d+3])>>4>1){if((_=d+5+e[d+4])===d+188)continue}else _=d+4;switch(p){case A:if(v){if(O&&(m=M(O))&&(N(m,!1),y&&T.codec&&(-1===D||b.codec)))return void this.remux(a,o,i,e,r);O={data:[],size:0}}O&&(O.data.push(e.subarray(_,d+188)),O.size+=d+188-_);break;case D:if(v){if(C&&(m=M(C))&&(b.isAAC?x(m):U(m),y&&b.codec&&(-1===A||T.codec)))return void this.remux(a,o,i,e,r);C={data:[],size:0}}C&&(C.data.push(e.subarray(_,d+188)),C.size+=d+188-_);break;case k:v&&(L&&(m=M(L))&&F(m),L={data:[],size:0}),L&&(L.data.push(e.subarray(_,d+188)),L.size+=d+188-_);break;case 0:v&&(_+=e[_]+1),w=this._pmtId=P(e,_);break;case w:v&&(_+=e[_]+1);var B=I(e,_,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3);A=B.avc,A>0&&(T.id=A),D=B.audio,D>0&&(b.id=D,b.isAAC=B.isAAC),k=B.id3,k>0&&(R.id=k),E&&!S&&(f.logger.log("reparse from beginning"),E=!1,d=-188),S=this.pmtParsed=!0;break;case 17:case 8191:break;default:E=!0}}else this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});O&&(m=M(O))?(N(m,!0),T.pesData=null):T.pesData=O,C&&(m=M(C))?(b.isAAC?x(m):U(m),b.pesData=null):(C&&C.size&&f.logger.log("last AAC PES packet truncated,might overlap between fragments"),b.pesData=C),L&&(m=M(L))?(F(m),R.pesData=null):R.pesData=L,this.remux(a,o,i,null,r,c)}},{key:"remux",value:function(e,t,n,r,i,a){for(var o=this._avcTrack,s=o.samples,l=0,u=0,c=0;c<s.length;c++){for(var d=s[c],f=d.units.units,h=f.length,v=0,p=0;p<h;p++)v+=f[p].data.length;u+=v,l+=h,d.length=v}o.len=u,o.nbNalu=l,this.remuxer.remux(e,t,n,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,i,this.contiguous,this.accurateTimeOffset,a,r)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,n){var r,i,a,o,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=(15&e[t+1])<<8|e[t+2],i=t+3+r-4,a=(15&e[t+10])<<8|e[t+11],t+=12+a;t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 15:-1===s.audio&&(s.audio=o);break;case 21:-1===s.id3&&(s.id3=o);break;case 27:-1===s.avc&&(s.avc=o);break;case 3:case 4:n?-1===s.audio&&(s.audio=o,s.isAAC=!1):f.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:f.logger.warn("HEVC stream type found, not supported for now");break;default:f.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}return s}},{key:"_parsePES",value:function(e){var t,n,r,i,a,o,s,l,u=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var d=new Uint8Array(c[0].length+c[1].length);d.set(c[0]),d.set(c[1],c[0].length),c[0]=d,c.splice(1,1)}if(t=c[0],1===(t[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;n=t[7],192&n&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&n?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,s>4294967295&&(s-=8589934592),o-s>54e5&&(f.logger.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),i=t[8],l=i+9,e.size-=l,a=new Uint8Array(e.size);for(var h=0,v=c.length;h<v;h++){t=c[h];var p=t.byteLength;if(l){if(l>p){l-=p;continue}t=t.subarray(l),p-=l,l=0}a.set(t,u),u+=p}return r&&(r-=i+3),{data:a,pts:o,dts:s,len:r}}return null}},{key:"pushAccesUnit",value:function(e,t){e.units.units.length&&e.frame&&(!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(t.samples.length||this.contiguous)?t.samples.push(e):t.dropped++),e.debug.length&&f.logger.log(e.pts+"/"+e.dts+":"+e.debug+","+e.units.length)}},{key:"_parseAVCPES",value:function(e,t){var n,r,i,a=this,o=this._avcTrack,s=this._parseAVCNALu(e.data),l=!1,u=this.avcSample;e.data=null,s.forEach(function(t){switch(t.type){case 1:r=!0,l&&u&&(u.debug+="NDR "),u.frame=!0;var s=t.data;if(s.length>4){var c=new d.default(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(u.key=!0)}break;case 5:r=!0,u||(u=a.avcSample=a._createAVCSample(!0,e.pts,e.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:r=!0,l&&u&&(u.debug+="SEI "),n=new d.default(a.discardEPB(t.data)),n.readUByte();for(var f=0,h=0,v=!1,p=0;!v&&n.bytesAvailable>1;){f=0;do{p=n.readUByte(),f+=p}while(255===p);h=0;do{p=n.readUByte(),h+=p}while(255===p);if(4===f&&0!==n.bytesAvailable){v=!0;if(181===n.readUByte()){if(49===n.readUShort()){if(1195456820===n.readUInt()){if(3===n.readUByte()){var _=n.readUByte(),m=n.readUByte(),g=31&_,y=[_,m];for(i=0;i<g;i++)y.push(n.readUByte()),y.push(n.readUByte()),y.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:y})}}}}}else if(h<n.bytesAvailable)for(i=0;i<h;i++)n.readUByte()}break;case 7:if(r=!0,l&&u&&(u.debug+="SPS "),!o.sps){n=new d.default(t.data);var E=n.readSPS();o.width=E.width,o.height=E.height,o.pixelRatio=E.pixelRatio,o.sps=[t.data],o.duration=a._duration;var S=t.data.subarray(1,4),T="avc1.";for(i=0;i<3;i++){var b=S[i].toString(16);b.length<2&&(b="0"+b),T+=b}o.codec=T}break;case 8:r=!0,l&&u&&(u.debug+="PPS "),o.pps||(o.pps=[t.data]);break;case 9:r=!1,u&&a.pushAccesUnit(u,o),u=a.avcSample=a._createAVCSample(!1,e.pts,e.dts,l?"AUD ":"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}if(u&&r){u.units.units.push(t)}}),t&&u&&(this.pushAccesUnit(u,o),this.avcSample=null)}},{key:"_createAVCSample",value:function(e,t,n,r){return{key:e,pts:t,dts:n,units:{units:[],length:0},debug:r}}},{key:"_insertSampleInOrder",value:function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.units.length){var n=this._avcTrack,r=n.samples;e=r[r.length-1]}if(e){var i=e.units.units;t=i[i.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t,n,r,i,a,o=0,s=e.byteLength,l=this._avcTrack,u=l.naluState||0,c=u,d=[],f=-1;for(-1===u&&(f=0,a=31&e[0],u=0,o=1);o<s;)if(t=e[o++],u)if(1!==u)if(t)if(1===t){if(f>=0)r={data:e.subarray(f,o-u-1),type:a},d.push(r);else{var h=this._getLastNalUnit();if(h&&(c&&o<=4-c&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-c)),(n=o-u-1)>0)){var v=new Uint8Array(h.data.byteLength+n);v.set(h.data,0),v.set(e.subarray(0,n),h.data.byteLength),h.data=v}}o<s?(i=31&e[o],f=o,a=i,u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(f>=0&&u>=0&&(r={data:e.subarray(f,s),type:a,state:u},d.push(r)),0===d.length){var p=this._getLastNalUnit();if(p){var _=new Uint8Array(p.data.byteLength+e.byteLength);_.set(p.data,0),_.set(e,p.data.byteLength),p.data=_}}return l.naluState=u,d}},{key:"discardEPB",value:function(e){for(var t,n,r=e.byteLength,i=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var o=0;for(a=0;a<t;o++,a++)o===i[0]&&(o++,i.shift()),n[a]=e[o];return n}},{key:"_parseAACPES",value:function(e){var t,n,r,i,a,o,l,c,d,v=this._audioTrack,p=e.data,_=e.pts,m=0,g=this.aacOverFlow,y=this.aacLastPTS;if(g){var E=new Uint8Array(g.byteLength+p.byteLength);E.set(g,0),E.set(p,g.byteLength),p=E}for(a=m,c=p.length;a<c-1&&(255!==p[a]||240!=(240&p[a+1]));a++);if(a){var S,T;if(a<c-1?(S="AAC PES did not start with ADTS header,offset:"+a,T=!1):(S="no ADTS header found in AAC PES",T=!0),f.logger.warn("parsing error:"+S),this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:T,reason:S}),T)return}if(!v.audiosamplerate){var b=this.audioCodec;t=s.default.getAudioConfig(this.observer,p,a,b),v.config=t.config,v.audiosamplerate=t.samplerate,v.channelCount=t.channelCount,v.codec=t.codec,v.manifestCodec=t.manifestCodec,v.duration=this._duration,f.logger.log("parsed codec:"+v.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)}if(i=0,r=9216e4/v.audiosamplerate,g&&y){var R=y+r;Math.abs(R-_)>1&&(f.logger.log("AAC: align PTS for overlapping frames by "+Math.round((R-_)/90)),_=R)}for(;a+5<c&&(o=1&p[a+1]?7:9,n=(3&p[a+3])<<11|p[a+4]<<3|(224&p[a+5])>>>5,(n-=o)>0&&a+o+n<=c);)for(l=_+i*r,d={unit:p.subarray(a+o,a+o+n),pts:l,dts:l},v.samples.push(d),v.len+=n,a+=n+o,i++;a<c-1&&(255!==p[a]||240!=(240&p[a+1]));a++);g=a<c?p.subarray(a,c):null,this.aacOverFlow=g,this.aacLastPTS=l}},{key:"_parseMPEGPES",value:function(e){for(var t,n=e.data,r=e.pts,i=n.length,a=0,o=0;o<i&&(t=this._parseMpeg(n,o,i,a++,r))>0;)o+=t}},{key:"_onMpegFrame",value:function(e,t,n,r,i,a){var o=1152/n*1e3,s=a+i*o,l=this._audioTrack;l.config=[],l.channelCount=r,l.audiosamplerate=n,l.duration=this._duration,l.samples.push({unit:e,pts:s,dts:s}),l.len+=e.length}},{key:"_onMpegNoise",value:function(e){f.logger.warn("mpeg audio has noise: "+e.length+" bytes")}},{key:"_parseMpeg",value:function(e,t,n,r,i){var a=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(t+2>n)return-1;if(255===e[t]||224==(224&e[t+1])){if(t+24>n)return-1;var s=e[t+1]>>3&3,l=e[t+1]>>1&3,u=e[t+2]>>4&15,c=e[t+2]>>2&3,d=!!(2&e[t+2]);if(1!==s&&0!==u&&15!==u&&3!==c){var f=3===s?3-l:3===l?3:4,h=1e3*a[14*f+u-1],v=3===s?0:2===s?1:2,p=o[3*v+c],_=d?1:0,m=e[t+3]>>6==3?1:2,g=3===l?(3===s?12:6)*h/p+_<<2:(3===s?144:72)*h/p+_|0;return t+g>n?-1:(this._onMpegFrame&&this._onMpegFrame(e.subarray(t,t+g),h,p,m,r,i),g)}}for(var y=t+2;y<n;){if(255===e[y-1]&&224==(224&e[y]))return this._onMpegNoise&&this._onMpegNoise(e.subarray(t,y-1)),y-t-1;y++}return-1}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();n.default=v},{19:19,23:23,26:26,28:28,45:45}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(45),s=e(26),l=e(28),u=function(e){return e&&e.__esModule?e:{default:e}}(l),c=function(){function e(t){r(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return a(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===i(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();n.default=c},{26:26,28:28,45:45}],28:[function(e,t,n){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();n.default=a},{}],30:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"isBuffered",value:function(e,t){if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0;return!1}},{key:"bufferInfo",value:function(e,t,n){if(e){var r,i=e.buffered,a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,t,n)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,n){var r,i,a,o,s,l=[];for(e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end}),s=0;s<e.length;s++){var u=l.length;if(u){var c=l[u-1].end;e[s].start-c<n?e[s].end>c&&(l[u-1].end=e[s].end):l.push(e[s])}else l.push(e[s])}for(s=0,r=0,i=a=t;s<l.length;s++){var d=l[s].start,f=l[s].end;if(t+n>=d&&t<f)i=d,a=f,r=a-t;else if(t+n<d){o=d;break}}return{len:r,start:i,end:a,nextStart:o}}}]),e}();n.default=a},{}],31:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(){r(this,e)}return i(e,null,[{key:"mergeDetails",value:function(t,n){var r,i=Math.max(t.startSN,n.startSN)-n.startSN,o=Math.min(t.endSN,n.endSN)-n.startSN,s=n.startSN-t.startSN,l=t.fragments,u=n.fragments,c=0;if(o<i)return void(n.PTSKnown=!1);for(var d=i;d<=o;d++){var f=l[s+d],h=u[d];h&&f&&(c=f.cc-h.cc,isNaN(f.startPTS)||(h.start=h.startPTS=f.startPTS,h.endPTS=f.endPTS,h.duration=f.duration,r=h))}if(c)for(a.logger.log("discontinuity sliding from playlist, take drift into account"),d=0;d<u.length;d++)u[d].cc+=c;if(r)e.updateFragPTSDTS(n,r.sn,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(s>=0&&s<l.length){var v=l[s].start;for(d=0;d<u.length;d++)u[d].start+=v}n.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,n,r,i,a,o){var s,l,u,c;if(!t||n<t.startSN||n>t.endSN)return 0;if(s=n-t.startSN,l=t.fragments,u=l[s],!isNaN(u.startPTS)){var d=Math.abs(u.startPTS-r);isNaN(u.deltaPTS)?u.deltaPTS=d:u.deltaPTS=Math.max(d,u.deltaPTS),r=Math.min(r,u.startPTS),i=Math.max(i,u.endPTS),a=Math.min(a,u.startDTS),o=Math.max(o,u.endDTS)}var f=r-u.start;for(u.start=u.startPTS=r,u.endPTS=i,u.startDTS=a,u.endDTS=o,u.duration=i-r,c=s;c>0;c--)e.updatePTS(l,c,c-1);for(c=s;c<l.length-1;c++)e.updatePTS(l,c,c+1);return t.PTSKnown=!0,f}},{key:"updatePTS",value:function(e,t,n){var r=e[t],i=e[n],o=i.startPTS;isNaN(o)?i.start=n>t?r.start+r.duration:r.start-i.duration:n>t?(r.duration=o-r.start,r.duration<0&&a.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&a.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();n.default=o},{45:45}],32:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),l=e(26),u=e(36),c=r(u),d=e(34),f=r(d),h=e(4),v=r(h),p=e(7),_=r(p),m=e(8),g=r(m),y=e(5),E=r(y),S=e(12),T=r(S),b=e(11),R=r(b),A=e(13),D=r(A),k=e(10),w=r(k),O=e(6),C=r(O),L=e(45),P=e(47),I=r(P),M=e(1),N=r(M),x=e(35),U=r(x),F=e(43),B=r(F),G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var r in n)r in t||(t[r]=n[r]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,L.enableLogs)(t.debug),this.config=t;var a=this.observer=new N.default;a.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.emit.apply(a,[e,e].concat(n))},a.off=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.removeListener.apply(a,[e].concat(n))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a),this.playlistLoader=new c.default(this),this.fragmentLoader=new f.default(this),this.levelController=new R.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new C.default(this),this.keyLoader=new U.default(this)}return a(e,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.21"}},{key:"Events",get:function(){return s.default}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:I.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:v.default,bufferController:_.default,capLevelController:g.default,fpsController:w.default,streamController:T.default,audioStreamController:E.default,timelineController:D.default,cueHandler:B.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),a(e,[{key:"destroy",value:function(){L.logger.log("destroy"),this.trigger(s.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){L.logger.log("attachMedia"),this.media=e,this.trigger(s.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){L.logger.log("detachMedia"),this.trigger(s.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){L.logger.log("loadSource:"+e),this.url=e,this.trigger(s.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;L.logger.log("startLoad("+e+")"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){L.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){L.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){L.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){L.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){L.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){L.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(e){L.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){L.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){L.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();n.default=G},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(e,t,n){"use strict";t.exports=e(32).default},{32:32}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING));return n.loaders={},n}return o(t,e),s(t,[{key:"destroy",value:function(){var e=this.loaders;for(var t in e){var n=e[t];n&&n.destroy()}this.loaders={},d.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=this.hls.config;t.loaded=0,r&&(h.logger.warn("abort previous fragment loader for type:"+n),r.abort()),r=this.loaders[n]=t.loader=void 0!==i.fLoader?new i.fLoader(i):new i.loader(i);var a=void 0,o=void 0,s=void 0;a={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var l=t.byteRangeStartOffset,u=t.byteRangeEndOffset;isNaN(l)||isNaN(u)||(a.rangeStart=l,a.rangeEnd=u),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},r.load(a,o,s)}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=n.frag;i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:r,frag:i,stats:t})}},{key:"loaderror",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(e,t,n){var r=t.frag;r.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:r,stats:e})}}]),t}(d.default);n.default=v},{26:26,27:27,28:28,45:45}],35:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return o(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},d.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=t.decryptdata,a=i.uri;if(a!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;r&&(h.logger.warn("abort previous key loader for type:"+n),r.abort()),t.loader=this.loaders[n]=new o.loader(o),this.decrypturl=a,this.decryptkey=null;var s=void 0,l=void 0,c=void 0;s={url:a,frag:t,responseType:"arraybuffer"},l={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(s,l,c)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,n){var r=n.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(u.default.KEY_LOADED,{frag:r})}},{key:"loaderror",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})}}]),t}(d.default);n.default=v},{26:26,27:27,28:28,45:45}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(2),u=r(l),c=e(28),d=r(c),f=e(27),h=r(f),v=e(26),p=e(40),_=r(p),m=e(45),g=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,y=/#EXT-X-MEDIA:(.*)/g,E=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,S=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,T=function(){function e(){o(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return s(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=u.default.buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),e}(),b=function(){function e(){o(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return s(e,[{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var n=e;return e&&e.method&&e.uri&&!e.iv&&(n=new T,n.method=e.method,n.baseuri=e.baseuri,n.reluri=e.reluri,n.iv=this.createInitializationVector(t)),n}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=u.default.buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var n=this.lastByteRangeEndOffset;e[0]=n||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),R=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,d.default.MANIFEST_LOADING,d.default.LEVEL_LOADING,d.default.AUDIO_TRACK_LOADING));return n.loaders={},n}return a(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(e,t){var n=this.loaders[t.type];if(n){var r=n.context;if(r&&r.url===e)return void m.logger.trace("playlist request ongoing");m.logger.warn("abort previous loader for type:"+t.type),n.abort()}var i=this.hls.config,a=void 0,o=void 0,s=void 0,l=void 0;"manifest"===t.type?(a=i.manifestLoadingMaxRetry,o=i.manifestLoadingTimeOut,s=i.manifestLoadingRetryDelay,l=i.manifestLoadingMaxRetryTimeout):(a=i.levelLoadingMaxRetry,o=i.levelLoadingTimeOut,s=i.levelLoadingRetryDelay,l=i.levelLoadingMaxRetryTimeout,m.logger.log("loading playlist for "+t.type+" "+(t.level||t.id))),n=this.loaders[t.type]=t.loader=void 0!==i.pLoader?new i.pLoader(i):new i.loader(i),t.url=e,t.responseType="";var u=void 0,c=void 0;u={timeout:o,maxRetry:a,retryDelay:s,maxRetryDelay:l},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(t,u,c)}},{key:"resolve",value:function(e,t){return u.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){var n=[],r=void 0;for(g.lastIndex=0;null!=(r=g.exec(e));){var i={},a=i.attrs=new _.default(r[1]);i.url=this.resolve(r[2],t);var o=a.decimalResolution("RESOLUTION");o&&(i.width=o.width,i.height=o.height),i.bitrate=a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),i.name=a.NAME;var s=a.CODECS;if(s){s=s.split(/[ ,]+/);for(var l=0;l<s.length;l++){var u=s[l];-1!==u.indexOf("avc1")?i.videoCodec=this.avc1toavcoti(u):i.audioCodec=u}}n.push(i)}return n}},{key:"parseMasterPlaylistMedia",value:function(e,t,n){var r=void 0,i=[];for(y.lastIndex=0;null!=(r=y.exec(e));){var a={},o=new _.default(r[1]);o.TYPE===n&&(a.groupId=o["GROUP-ID"],a.name=o.NAME,a.type=n,a.default="YES"===o.DEFAULT,a.autoselect="YES"===o.AUTOSELECT,a.forced="YES"===o.FORCED,o.URI&&(a.url=this.resolve(o.URI,t)),a.lang=o.LANGUAGE,a.name||(a.name=a.lang),i.push(a))}return i}},{key:"avc1toavcoti",value:function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseLevelPlaylist",value:function(e,t,n,r){var i,a,o=0,s=0,l={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},u=new T,c=0,d=null,f=new b;for(E.lastIndex=0;null!==(i=E.exec(e));){var h=i[1];if(h){f.duration=parseFloat(h);var v=(" "+i[2]).slice(1);f.title=v||null,f.tagList.push(v?["INF",h,v]:["INF",h])}else if(i[3]){if(!isNaN(f.duration)){var p=o++;f.type=r,f.start=s,f.levelkey=u,f.sn=p,f.level=n,f.cc=c,f.baseurl=t,f.relurl=(" "+i[3]).slice(1),l.fragments.push(f),d=f,s+=f.duration,f=new b}}else if(i[4]){if(f.rawByteRange=(" "+i[4]).slice(1),d){var g=d.byteRangeEndOffset;g&&(f.lastByteRangeEndOffset=g)}}else if(i[5])f.rawProgramDateTime=(" "+i[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]);else{for(i=i[0].match(S),a=1;a<i.length&&void 0===i[a];a++);var y=(" "+i[a+1]).slice(1),R=(" "+i[a+2]).slice(1);switch(i[a]){case"#":f.tagList.push(R?[y,R]:[y]);break;case"PLAYLIST-TYPE":l.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(y);break;case"TARGETDURATION":l.targetduration=parseFloat(y);break;case"VERSION":l.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":c++,f.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(y);break;case"KEY":var A=y,D=new _.default(A),k=D.enumeratedString("METHOD"),w=D.URI,O=D.hexadecimalInteger("IV");k&&(u=new T,w&&"AES-128"===k&&(u.method=k,u.baseuri=t,u.reluri=w,u.key=null,u.iv=O));break;case"START":var C=y,L=new _.default(C),P=L.decimalFloatingPoint("TIME-OFFSET");isNaN(P)||(l.startTimeOffset=P);break;case"MAP":var I=new _.default(y);f.relurl=I.URI,f.rawByteRange=I.BYTERANGE,f.baseurl=t,f.level=n,f.type=r,f.sn="initSegment",l.initSegment=f,f=new b;break;default:m.logger.warn("line parsed but not handled: "+i)}}}return f=d,f&&!f.relurl&&(l.fragments.pop(),s-=f.duration),l.totalduration=s,l.averagetargetduration=s/l.fragments.length,l.endSN=o-1,l}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=e.url,a=n.type,o=n.id,s=n.level,l=this.hls;if(this.loaders[a]=void 0,void 0!==i&&0!==i.indexOf("data:")||(i=n.url),t.tload=performance.now(),0===r.indexOf("#EXTM3U"))if(r.indexOf("#EXTINF:")>0){var u="audioTrack"!==a,c=this.parseLevelPlaylist(r,i,(u?s:o)||0,u?"main":"audio");"manifest"===a&&l.trigger(d.default.MANIFEST_LOADED,{levels:[{url:i,details:c}],audioTracks:[],url:i,stats:t}),t.tparsed=performance.now(),c.targetduration?u?l.trigger(d.default.LEVEL_LOADED,{details:c,level:s||0,id:o||0,stats:t}):l.trigger(d.default.AUDIO_TRACK_LOADED,{details:c,id:o,stats:t}):l.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"invalid targetduration"})}else{var f=this.parseMasterPlaylist(r,i);if(f.length){var h=this.parseMasterPlaylistMedia(r,i,"AUDIO");if(h.length){var p=!1;h.forEach(function(e){e.url||(p=!0)}),!1===p&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(m.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main"}))}l.trigger(d.default.MANIFEST_LOADED,{levels:f,audioTracks:h,url:i,stats:t})}else l.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no level found in manifest"})}else l.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,response:e,context:t})}},{key:"loadtimeout",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_TIMEOUT,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_TIMEOUT,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,context:t})}}]),t}(h.default);n.default=R},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,l,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;i--;)r+=n[i].byteLength;for(t=new Uint8Array(r),t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<a;i++)t.set(n[i],r),r+=n[i].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){return n*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))}},{key:"moov",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))}},{key:"mvhd",value:function(t,n){n*=t;var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,r)}},{key:"sdtp",value:function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,r,i,a=[],o=[];for(n=0;n<t.sps.length;n++)r=t.sps[n],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)r=t.pps[n],i=r.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(o))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var n=t.audiosamplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,a=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,n){var r=e.sdtp(t),i=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var r,i,a,o,s,l,u=t.samples||[],c=u.length,d=12+16*c,f=new Uint8Array(d);for(n+=8+d,f.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)i=u[r],a=i.duration,o=i.size,s=i.flags,l=i.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*r);return e.box(e.types.trun,f)}},{key:"initSegment",value:function(t){e.types||e.init();var n,r=e.moov(t);return n=new Uint8Array(e.FTYP.byteLength+r.byteLength),n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n}}]),e}();n.default=a},{}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(29),s=r(o),l=e(28),u=r(l),c=e(45),d=e(37),f=r(d),h=e(26),v=function(){function e(t,n,r,a){i(this,e),this.observer=t,this.id=n,this.config=r,this.typeSupported=a,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return a(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a,o,s,l,c,d){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(r,i,s,n),null!==d&&(this._initPTS=this._initDTS=d),this.ISGenerated)if(r.samples.length){var f=this.remuxAudio(r,s,l,c);if(i.samples.length){var h=void 0;f&&(h=f.endPTS-f.startPTS),this.remuxVideo(i,s,l,h)}}else{var v=void 0;i.samples.length&&(v=this.remuxVideo(i,s,l)),v&&r.codec&&this.remuxEmptyAudio(r,s,l,v)}a.samples.length&&this.remuxID3(a,s),o.samples.length&&this.remuxText(o,s),this.observer.trigger(u.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,n,r){var i,a,o=this.observer,s=e.samples,l=t.samples,d=this.PES_TIMESCALE,v=this.typeSupported,p="audio/mp4",_={},m={id:this.id,level:this.level,sn:this.sn,tracks:_,unique:!1},g=void 0===this._initPTS;g&&(i=a=1/0),e.config&&s.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&function(){e.timescale=e.audiosamplerate/function e(t,n){return n?e(n,t%n):t}(e.audiosamplerate,e.isAAC?1024:1152)}(),c.logger.log("audio mp4 timescale :"+e.timescale),e.isAAC||(v.mpeg?(p="audio/mpeg",e.codec=""):v.mp3&&(e.codec="mp3")),_.audio={container:p,codec:e.codec,initSegment:!e.isAAC&&v.mpeg?new Uint8Array:f.default.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(i=a=s[0].pts-d*n)),t.sps&&t.pps&&l.length&&(t.timescale=this.MP4_TIMESCALE,_.video={container:"video/mp4",codec:t.codec,initSegment:f.default.initSegment([t]),metadata:{width:t.width,height:t.height}},g&&(i=Math.min(i,l[0].pts-d*n),a=Math.min(a,l[0].dts-d*n),this.observer.trigger(u.default.INIT_PTS_FOUND,{id:this.id,initPTS:i,cc:r}))),Object.keys(_).length?(o.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,m),this.ISGenerated=!0,g&&(this._initPTS=i,this._initDTS=a)):o.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,r){var i,a,o,s,l,d,v,p=8,_=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,g=e.samples,y=[],E=g.length,S=this._PTSNormalize,T=this._initDTS;g.sort(function(e,t){var n=e.dts-t.dts;return n||e.pts-t.pts});var b=g.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(b<0){c.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var R=0;R<g.length;R++)g[R].dts+=b}var A=void 0;A=n?this.nextAvcDts:t*_;var D=g[0];l=Math.max(S(D.dts-T,A),0),s=Math.max(S(D.pts-T,A),0);var k=Math.round((l-A)/90);n&&k&&(k>1?c.logger.log("AVC:"+k+" ms hole between fragments detected,filling it"):k<-1&&c.logger.log("AVC:"+-k+" ms overlapping between fragments detected"),l=A,g[0].dts=l+T,s=Math.max(s-k,A),g[0].pts=s+T,c.logger.log("Video/PTS/DTS adjusted: "+Math.round(s/90)+"/"+Math.round(l/90)+",delta:"+k+" ms")),l,D=g[g.length-1],v=Math.max(S(D.dts-T,A),0),d=Math.max(S(D.pts-T,A),0),d=Math.max(d,v);var w=navigator.vendor,O=navigator.userAgent,C=w&&w.indexOf("Apple")>-1&&O&&!O.match("CriOS");C&&(i=Math.round((v-l)/(m*(g.length-1))));for(var L=0;L<E;L++){var P=g[L];C?P.dts=l+L*m*i:(P.dts=Math.max(S(P.dts-T,A),l),P.dts=Math.round(P.dts/m)*m),P.pts=Math.max(S(P.pts-T,A),P.dts),P.pts=Math.round(P.pts/m)*m}var I=e.len+4*e.nbNalu+8;try{a=new Uint8Array(I)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:I,reason:"fail allocating video mdat "+I})}var M=new DataView(a.buffer);M.setUint32(0,I),a.set(f.default.types.mdat,4);for(var N=0;N<E;N++){for(var x=g[N],U=x.units.units,F=0,B=void 0,G=0,j=U.length;G<j;G++){var H=U[G],W=H.data,V=H.data.byteLength;M.setUint32(p,V),p+=4,a.set(W,p),p+=V,F+=4+V}if(C)B=Math.max(0,i*Math.round((x.pts-x.dts)/(m*i)));else{if(N<E-1)i=g[N+1].dts-x.dts;else{var K=this.config,q=x.dts-g[N>0?N-1:N].dts;if(K.stretchShortVideoTrack){var Y=K.maxBufferHole,X=K.maxSeekHole,z=Math.floor(Math.min(Y,X)*_),Q=(r?s+r*_:this.nextAudioPts)-x.pts;Q>z?(i=Q-q,i<0&&(i=q),c.logger.log("It is approximately "+Q/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=q}else i=q}i/=m,B=Math.round((x.pts-x.dts)/m)}y.push({size:F,duration:i,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:x.key?2:1,isNonSync:x.key?0:1}})}this.nextAvcDts=v+i*m;var Z=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,y.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var J=y[0].flags;J.dependsOn=2,J.isNonSync=0}e.samples=y,o=f.default.moof(e.sequenceNumber++,l/m,e),e.samples=[];var $={id:this.id,level:this.level,sn:this.sn,data1:o,data2:a,startPTS:s/_,endPTS:(d+m*i)/_,startDTS:l/_,endDTS:this.nextAvcDts/_,type:"video",nb:y.length,dropped:Z};return this.observer.trigger(u.default.FRAG_PARSING_DATA,$),$}},{key:"remuxAudio",value:function(e,t,n,r){var i,a,o,l,d,v,p,_,m,g,y,E,S,T,b,R,A=this.PES_TIMESCALE,D=e.timescale,k=A/D,w=e.timescale*(e.isAAC?1024:1152)/e.audiosamplerate,O=w*k,C=this._PTSNormalize,L=this._initDTS,P=!e.isAAC&&this.typeSupported.mpeg,I=P?0:8,M=[],N=[];if(e.samples.sort(function(e,t){return e.pts-t.pts}),N=e.samples,R=this.nextAudioPts,n|=N.length&&R&&(Math.abs(t-R/A)<.1||Math.abs(N[0].pts-R-this._initDTS)<20*O),n||(R=t*A),r&&e.isAAC)for(var x=0,U=R;x<N.length;){var F=N[x],B=C(F.pts-L,R),G=B-U;if(G<=-O)c.logger.warn("Dropping 1 audio frame @ "+Math.round(U/90)/1e3+"s due to "+Math.round(Math.abs(G/90))+" ms overlap."),N.splice(x,1),e.len-=F.unit.length;else if(G>=O&&U){var j=Math.round(G/O);c.logger.warn("Injecting "+j+" audio frame @ "+Math.round(U/90)/1e3+"s due to "+Math.round(G/90)+" ms gap.");for(var H=0;H<j;H++)b=U+L,b=Math.max(b,L),T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),T=F.unit.subarray()),N.splice(x,0,{unit:T,pts:b,dts:b}),e.len+=T.length,U+=O,x+=1;F.pts=F.dts=U+L,U+=O,x+=1}else Math.abs(G),U+=O,F.pts=F.dts=0===x?L+R:N[x-1].pts+O,x+=1}for(var W=0,V=N.length;W<V;W++){if(a=N[W],l=a.unit,g=a.pts-L,y=a.dts-L,void 0!==m)E=C(g,m),S=C(y,m),o.duration=Math.round((S-m)/k);else{E=C(g,R),S=C(y,R);var K=Math.round(1e3*(E-R)/A),q=0;if(n&&e.isAAC&&K){if(K>0)q=Math.round((E-R)/O),c.logger.log(K+" ms hole between AAC samples detected,filling it"),q>0&&(T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(T=l.subarray()),e.len+=q*T.length);else if(K<-12){c.logger.log(-K+" ms overlapping between AAC samples detected, drop frame"),e.len-=l.byteLength;continue}E=S=R}if(p=Math.max(0,E),_=Math.max(0,S),!(e.len>0))return;var Y=P?e.len:e.len+8;try{d=new Uint8Array(Y)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Y,reason:"fail allocating audio mdat "+Y})}P||(i=new DataView(d.buffer),i.setUint32(0,Y),d.set(f.default.types.mdat,4));for(var X=0;X<q;X++)b=E-(q-X)*O,T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),T=l.subarray()),d.set(T,I),I+=T.byteLength,o={size:T.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o)}d.set(l,I);var z=l.byteLength;I+=z,o={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o),m=S}var Q=0,Z=M.length;if(Z>=2&&(Q=M[Z-2].duration,o.duration=Q),Z){this.nextAudioPts=E+k*Q,e.len=0,e.samples=M,v=P?new Uint8Array:f.default.moof(e.sequenceNumber++,_/k,e),e.samples=[];var J={id:this.id,level:this.level,sn:this.sn,data1:v,data2:d,startPTS:p/A,endPTS:this.nextAudioPts/A,startDTS:_/A,endDTS:(S+k*Q)/A,type:"audio",nb:Z};return this.observer.trigger(u.default.FRAG_PARSING_DATA,J),J}return null}},{key:"remuxEmptyAudio",value:function(e,t,n,r){var i=this.PES_TIMESCALE,a=e.timescale?e.timescale:e.audiosamplerate,o=i/a,l=this.nextAudioPts,u=(void 0!==l?l:r.startDTS*i)+this._initDTS,d=r.endDTS*i+this._initDTS,f=1024,h=o*f,v=Math.ceil((d-u)/h),p=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(c.logger.warn("remux empty Audio"),!p)return void c.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var _=[],m=0;m<v;m++){var g=u+m*h;_.push({unit:p,pts:g,dts:g}),e.len+=p.length}e.samples=_,this.remuxAudio(e,t,n)}},{key:"remuxID3",value:function(e,t){var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE,n.dts=(n.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}},{key:"passthrough",get:function(){return!1}}]),e}();n.default=v},{26:26,28:28,29:29,37:37,45:45}],39:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(28),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n){r(this,e),this.observer=t,this.id=n,this.ISGenerated=!1}return i(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a){var s=this.observer;if(!this.ISGenerated){var l={},u={id:this.id,tracks:l,unique:!0},c=t,d=c.codec;d&&(u.tracks.video={container:c.container,codec:d,metadata:{width:c.width,height:c.height}}),c=e,d=c.codec,d&&(u.tracks.audio={container:c.container,codec:d,metadata:{channelCount:c.channelCount}}),this.ISGenerated=!0,s.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,u)}s.trigger(o.default.FRAG_PARSING_DATA,{id:this.id,data1:a,startPTS:i,startDTS:i,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();n.default=s},{28:28}],40:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){r(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}return i(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=a.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,n={};for(o.lastIndex=0;null!==(t=o.exec(e));){var r=t[2],i='"';0===r.indexOf(i)&&r.lastIndexOf(i)===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n}}]),e}();n.default=s},{}],41:[function(e,t,n){"use strict";var r={search:function(e,t){for(var n=0,r=e.length-1,i=null,a=null;n<=r;){i=(n+r)/2|0,a=e[i];var o=t(a);if(o>0)n=i+1;else{if(!(o<0))return a;r=i-1}}return null}};t.exports=r},{}],42:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(e){var t=e;return a.hasOwnProperty(e)&&(t=a[e]),String.fromCharCode(t)},s=15,l=32,u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],v={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},p=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},_=function(){function e(t,n,i,a,o){r(this,e),this.foreground=t||"white",this.underline=n||!1,this.italics=i||!1,this.background=a||"black",this.flash=o||!1}return i(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),m=function(){function e(t,n,i,a,o,s){r(this,e),this.uchar=t||" ",this.penState=new _(n,i,a,o,s)}return i(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),g=function(){function e(){r(this,e),this.chars=[];for(var t=0;t<l;t++)this.chars.push(new m);this.pos=0,this.currPenState=new _}return i(e,[{key:"equals",value:function(e){for(var t=!0,n=0;n<l;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<l;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<l;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(v.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(v.log("ERROR","Too large cursor position "+this.pos),this.pos=l)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=o(e);return this.pos>=l?void v.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<l;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,n=0;n<l;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),y=function(){function e(){r(this,e),this.rows=[];for(var t=0;t<s;t++)this.rows.push(new g);this.currRow=s-1,this.nrRollUpRows=null,this.reset()}return i(e,[{key:"reset",value:function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1}},{key:"equals",value:function(e){for(var t=!0,n=0;n<s;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){v.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e,t){v.log("INFO","pacData = "+JSON.stringify(e));var n=e.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==n){for(var r=0;r<s;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=t.rows[i].cueStartTime;if(a&&a<v.time)for(r=0;r<this.nrRollUpRows;r++)this.rows[n-this.nrRollUpRows+r+1].copy(t.rows[i+r])}this.currRow=n;var o=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,u=Math.max(l-1,0);o.setCursor(e.indent),e.color=o.chars[u].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)}},{key:"setBkgData",value:function(e){v.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void v.log("DEBUG","roll_up but nrRollUpRows not set yet");v.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),v.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<s;i++){var a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),E=function(){function e(t,n){r(this,e),this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new y,this.nonDisplayedMemory=new y,this.lastOutputScreen=new y,this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return i(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e,this.lastOutputScreen)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,v.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";v.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(v.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){v.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){v.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){v.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){v.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){v.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){v.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){v.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){v.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){v.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){v.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){v.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(v.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,v.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){v.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}v.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=v.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),S=function(){function e(t,n,i){r(this,e),this.field=t||1,this.outputs=[n,i],this.channels=[new E(1,n),new E(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return i(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var n,r,i,a=!1;this.lastTime=e,v.setTime(e);for(var o=0;o<t.length;o+=2)if(r=127&t[o],i=127&t[o+1],0!==r||0!==i){if(v.log("DATA","["+p([t[o],t[o+1]])+"] -> ("+p([r,i])+")"),n=this.parseCmd(r,i),n||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(a=this.parseChars(r,i)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(a)}else v.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,v.log("WARNING","Couldn't parse cleaned data "+p([r,i])+" orig: "+p([t[o],t[o+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var n=null,r=(20===e||28===e)&&32<=t&&t<=47,i=(23===e||31===e)&&33<=t&&t<=35;if(!r&&!i)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,v.log("DEBUG","Repeated command ("+p([e,t])+") is dropped"),!0;n=20===e||23===e?1:2;var a=this.channels[n-1];return 20===e||28===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"parseMidrow",value:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return v.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[n-1].ccMIDROW(t),v.log("DEBUG","MIDROW ("+p([e,t])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var n=null,r=null,i=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,a=(16===e||24===e)&&64<=t&&t<=95;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=e<=23?1:2,r=64<=t&&t<=95?1===n?u[e]:d[e]:1===n?c[e]:f[e];var o=this.interpretPAC(r,t);return this.channels[n-1].setPAC(o),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"interpretPAC",value:function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}},{key:"parseChars",value:function(e,t){var n=null,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),17<=i&&i<=19){var a=t;a=17===i?t+80:18===i?t+112:t+144,v.log("INFO","Special char '"+o(a)+"' in channel "+n),r=[a]}else 32<=e&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=p(r);v.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r}},{key:"parseBackgroundAttributes",value:function(e,t){var n,r,i,a,o=(16===e||24===e)&&32<=t&&t<=47,s=(23===e||31===e)&&45<=t&&t<=47;return!(!o&&!s||(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=h[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,a=this.channels[i-1],a.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,0))}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();n.default=S},{}],43:[function(e,t,n){"use strict";var r={newCue:function(e,t,n,r){for(var i,a,o,s,l,u=window.VTTCue||window.TextTrackCue,c=0;c<r.rows.length;c++)if(i=r.rows[c],o=!0,s=0,l="",!i.isEmpty()){for(var d=0;d<i.chars.length;d++)i.chars[d].uchar.match(/\s/)&&o?s++:(l+=i.chars[d].uchar,o=!1);i.cueStartTime=t,a=new u(t,n,l.trim()),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?a.line=c+1:a.line=c>7?c-2:c+1,a.align="left",a.position=Math.max(0,Math.min(100,100*(s/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}};t.exports=r},{}],44:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return i(e,[{key:"sample",value:function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();n.default=a},{}],45:[function(e,t,n){"use strict";function r(){}function i(e,t){return t="["+e+"] > "+t}function a(e){var t=self.console[e];return t?function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];r[0]&&(r[0]=i(e,r[0])),t.apply(self.console,r)}:r}function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){u[t]=e[t]?e[t].bind(e):a(t)})}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l={trace:r,debug:r,log:r,warn:r,info:r,error:r},u=l;n.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":s(e))){o(e,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},n.logger=u},{}],46:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"toString",value:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}}]),e}();n.default=a},{}],47:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return i(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var n=this.stats;n.tfirst=0,n.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(performance.now(),r.trequest)),4===n){var s=t.status;if(s>=200&&s<300){r.tload=Math.max(r.tfirst,performance.now());var l=void 0,u=void 0;"arraybuffer"===i.responseType?(l=t.response,u=l.byteLength):(l=t.responseText,u=l.length),r.loaded=r.total=u;var c={url:t.responseURL,data:l};this.callbacks.onSuccess(c,r,i)}else r.retry>=o.maxRetry||s>=400&&s<499?(a.logger.error(s+" while loading "+i.url),this.callbacks.onError({code:s,text:t.statusText},i)):(a.logger.warn(s+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)}},{key:"loadtimeout",value:function(){a.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null)}}]),e}();n.default=o},{45:45}]},{},[33])(33)}()}()},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(r){function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=i(s),u=n(0),c=i(u),d=function(){};r.performance=Date,r.MediaSource={isTypeSupported:function(){return!0}},r.navigator||(r.navigator={userAgent:""});var f=function(){function e(){var t=this;a(this,e);var n={autoStartLoad:!1,loader:c.default};this.levels=[],this.manifestParsed=!1,this.callbacks={onLevelLoading:d,onLevelLoaded:d,onManifestLoading:d,onManifestLoaded:d,onManifestParsed:d,onError:d},this.hls=new l.default(n),this.hls.on(l.default.Events.ERROR,function(e,n){return t.callbacks.onError(n)}),this.hls.on(l.default.Events.LEVEL_LOADING,function(e,n){return t.callbacks.onLevelLoading(n)}),this.hls.on(l.default.Events.LEVEL_LOADED,function(e,n){return t.callbacks.onLevelLoaded(n)}),this.hls.on(l.default.Events.MANIFEST_LOADING,function(e,n){return t.callbacks.onManifestLoading(n)}),this.hls.on(l.default.Events.MANIFEST_LOADED,function(e,n){return t.callbacks.onManifestLoaded(n)}),this.hls.on(l.default.Events.MANIFEST_PARSED,function(e,n){t.manifestParsed=!0,t.levels=n.levels,t.callbacks.onManifestParsed(n)})}return o(e,[{key:"update",value:function(e,t){var n=e.toString("utf8");if(c.default.Resources[t]=n,this.manifestParsed){var r=this.getLevelIndex(t);if(-1===r)throw this.hls.loadSource(t),new Error("HlsParser error: Attempting to load manifest that does not match any level playlist. That could happen when the player reloads master playlist.");var i=this.levels[r].urlId;this.hls.playlistLoader.onLevelLoading({id:i,url:t,level:r})}else this.hls.loadSource(t)}},{key:"getLevelIndex",value:function(e){return this.levels.findIndex(function(t){return t.url.indexOf(e)>=0})}},{key:"onError",set:function(e){this.callbacks.onError=e}},{key:"onManifestLoading",set:function(e){this.callbacks.onManifestLoading=e}},{key:"onManifestLoaded",set:function(e){this.callbacks.onManifestLoaded=e}},{key:"onManifestParsed",set:function(e){this.callbacks.onManifestParsed=e}},{key:"onLevelLoaded",set:function(e){this.callbacks.onLevelLoaded=e}}]),e}();t.default=f,e.exports=t.default}).call(t,n(2))}])},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e="/home/ubuntu/native-wrapper/lib/ManifestHandler.js",t="5d33880d8864e35abcf7d4809fef4b49dec6a1a0",n=new Function("return this")(),r="__coverage__",i={path:"/home/ubuntu/native-wrapper/lib/ManifestHandler.js",statementMap:{0:{start:{line:1,column:33},end:{line:1,column:43}},1:{start:{line:2,column:27},end:{line:2,column:28}},2:{start:{line:3,column:26},end:{line:3,column:28}},3:{start:{line:8,column:4},end:{line:8,column:26}},4:{start:{line:9,column:4},end:{line:9,column:31}},5:{start:{line:10,column:4},end:{line:10,column:28}},6:{start:{line:11,column:4},end:{line:11,column:24}},7:{start:{line:15,column:4},end:{line:15,column:36}},8:{start:{line:19,column:4},end:{line:19,column:29}},9:{start:{line:23,column:4},end:{line:26,column:5}},10:{start:{line:24,column:6},end:{line:24,column:54}},11:{start:{line:25,column:6},end:{line:25,column:13}},12:{start:{line:28,column:18},end:{line:28,column:62}},13:{start:{line:30,column:35},end:{line:30,column:79}},14:{start:{line:31,column:4},end:{line:31,column:32}},15:{start:{line:33,column:4},end:{line:33,column:81}},16:{start:{line:35,column:4},end:{line:35,column:33}},17:{start:{line:39,column:4},end:{line:43,column:5}},18:{start:{line:40,column:20},end:{line:40,column:54}},19:{start:{line:41,column:28},end:{line:41,column:89}},20:{start:{line:42,column:6},end:{line:42,column:48}},21:{start:{line:45,column:4},end:{line:45,column:73}},22:{start:{line:49,column:22},end:{line:49,column:43}},23:{start:{line:51,column:15},end:{line:51,column:16}},24:{start:{line:52,column:16},end:{line:52,column:17}},25:{start:{line:54,column:4},end:{line:63,column:5}},26:{start:{line:55,column:23},end:{line:55,column:35}},27:{start:{line:57,column:6},end:{line:57,column:32}},28:{start:{line:58,column:6},end:{line:58,column:17}},29:{start:{line:60,column:6},end:{line:62,column:7}},30:{start:{line:61,column:8},end:{line:61,column:14}},31:{start:{line:65,column:4},end:{line:65,column:17}},32:{start:{line:69,column:17},end:{line:69,column:40}},33:{start:{line:71,column:22},end:{line:71,column:43}},34:{start:{line:72,column:27},end:{line:72,column:53}},35:{start:{line:74,column:16},end:{line:74,column:17}},36:{start:{line:75,column:4},end:{line:86,column:5}},37:{start:{line:76,column:23},end:{line:76,column:35}},38:{start:{line:78,column:28},end:{line:78,column:49}},39:{start:{line:79,column:30},end:{line:79,column:57}},40:{start:{line:81,column:6},end:{line:83,column:7}},41:{start:{line:82,column:8},end:{line:82,column:14}},42:{start:{line:85,column:6},end:{line:85,column:37}},43:{start:{line:88,column:4},end:{line:88,column:17}},44:{start:{line:92,column:22},end:{line:92,column:35}},45:{start:{line:93,column:16},end:{line:93,column:17}},46:{start:{line:94,column:22},end:{line:94,column:43}},47:{start:{line:95,column:27},end:{line:95,column:53}},48:{start:{line:97,column:4},end:{line:105,column:5}},49:{start:{line:98,column:23},end:{line:98,column:35}},50:{start:{line:99,column:6},end:{line:99,column:39}},51:{start:{line:100,column:6},end:{line:100,column:17}},52:{start:{line:102,column:6},end:{line:104,column:7}},53:{start:{line:103,column:8},end:{line:103,column:14}},54:{start:{line:107,column:4},end:{line:107,column:17}},55:{start:{line:111,column:19},end:{line:111,column:45}},56:{start:{line:112,column:18},end:{line:112,column:50}},57:{start:{line:114,column:28},end:{line:114,column:29}},58:{start:{line:115,column:22},end:{line:115,column:43}},59:{start:{line:117,column:23},end:{line:117,column:42}},60:{start:{line:119,column:36},end:{line:119,column:38}},61:{start:{line:120,column:4},end:{line:134,column:5}},62:{start:{line:121,column:6},end:{line:121,column:49}},63:{start:{line:122,column:6},end:{line:127,column:7}},64:{start:{line:123,column:8},end:{line:126,column:9}},65:{start:{line:124,column:10},end:{line:124,column:40}},66:{start:{line:125,column:10},end:{line:125,column:16}},67:{start:{line:129,column:6},end:{line:133,column:7}},68:{start:{line:132,column:8},end:{line:132,column:56}},69:{start:{line:136,column:4},end:{line:139,column:6}},70:{start:{line:144,column:4},end:{line:144,column:34}},71:{start:{line:148,column:4},end:{line:148,column:40}},72:{start:{line:153,column:4},end:{line:153,column:38}},73:{start:{line:157,column:22},end:{line:157,column:43}},74:{start:{line:158,column:4},end:{line:160,column:5}},75:{start:{line:159,column:6},end:{line:159,column:33}},76:{start:{line:161,column:4},end:{line:161,column:16}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:7,column:2},end:{line:7,column:3}},loc:{start:{line:7,column:23},end:{line:12,column:3}},line:7},1:{name:"(anonymous_1)",decl:{start:{line:14,column:2},end:{line:14,column:3}},loc:{start:{line:14,column:31},end:{line:16,column:3}},line:14},2:{name:"(anonymous_2)",decl:{start:{line:18,column:2},end:{line:18,column:3}},loc:{start:{line:18,column:20},end:{line:20,column:3}},line:18},3:{name:"(anonymous_3)",decl:{start:{line:22,column:2},end:{line:22,column:3}},loc:{start:{line:22,column:50},end:{line:36,column:3}},line:22},4:{name:"(anonymous_4)",decl:{start:{line:38,column:2},end:{line:38,column:3}},loc:{start:{line:38,column:42},end:{line:46,column:3}},line:38},5:{name:"(anonymous_5)",decl:{start:{line:48,column:2},end:{line:48,column:3}},loc:{start:{line:48,column:30},end:{line:66,column:3}},line:48},6:{name:"(anonymous_6)",decl:{start:{line:68,column:2},end:{line:68,column:3}},loc:{start:{line:68,column:50},end:{line:89,column:3}},line:68},7:{name:"(anonymous_7)",decl:{start:{line:91,column:2},end:{line:91,column:3}},loc:{start:{line:91,column:32},end:{line:108,column:3}},line:91},8:{name:"(anonymous_8)",decl:{start:{line:110,column:2},end:{line:110,column:3}},loc:{start:{line:110,column:47},end:{line:140,column:3}},line:110},9:{name:"(anonymous_9)",decl:{start:{line:143,column:2},end:{line:143,column:3}},loc:{start:{line:143,column:19},end:{line:145,column:3}},line:143},10:{name:"(anonymous_10)",decl:{start:{line:147,column:2},end:{line:147,column:3}},loc:{start:{line:147,column:24},end:{line:149,column:3}},line:147},11:{name:"(anonymous_11)",decl:{start:{line:152,column:2},end:{line:152,column:3}},loc:{start:{line:152,column:26},end:{line:154,column:3}},line:152},12:{name:"(anonymous_12)",decl:{start:{line:156,column:2},end:{line:156,column:3}},loc:{start:{line:156,column:26},end:{line:162,column:3}},line:156}},branchMap:{0:{loc:{start:{line:23,column:4},end:{line:26,column:5}},type:"if",locations:[{start:{line:23,column:4},end:{line:26,column:5}},{start:{line:23,column:4},end:{line:26,column:5}}],line:23},1:{loc:{start:{line:39,column:4},end:{line:43,column:5}},type:"if",locations:[{start:{line:39,column:4},end:{line:43,column:5}},{start:{line:39,column:4},end:{line:43,column:5}}],line:39},2:{loc:{start:{line:60,column:6},end:{line:62,column:7}},type:"if",locations:[{start:{line:60,column:6},end:{line:62,column:7}},{start:{line:60,column:6},end:{line:62,column:7}}],line:60},3:{loc:{start:{line:60,column:10},end:{line:60,column:66}},type:"binary-expr",locations:[{start:{line:60,column:10},end:{line:60,column:35}},{start:{line:60,column:39},end:{line:60,column:66}}],line:60},4:{loc:{start:{line:81,column:6},end:{line:83,column:7}},type:"if",locations:[{start:{line:81,column:6},end:{line:83,column:7}},{start:{line:81,column:6},end:{line:83,column:7}}],line:81},5:{loc:{start:{line:81,column:10},end:{line:81,column:43}},type:"binary-expr",locations:[{start:{line:81,column:10},end:{line:81,column:23}},{start:{line:81,column:27},end:{line:81,column:43}}],line:81},6:{loc:{start:{line:102,column:6},end:{line:104,column:7}},type:"if",locations:[{start:{line:102,column:6},end:{line:104,column:7}},{start:{line:102,column:6},end:{line:104,column:7}}],line:102},7:{loc:{start:{line:123,column:8},end:{line:126,column:9}},type:"if",locations:[{start:{line:123,column:8},end:{line:126,column:9}},{start:{line:123,column:8},end:{line:126,column:9}}],line:123},8:{loc:{start:{line:129,column:6},end:{line:133,column:7}},type:"if",locations:[{start:{line:129,column:6},end:{line:133,column:7}},{start:{line:129,column:6},end:{line:133,column:7}}],line:129},9:{loc:{start:{line:158,column:4},end:{line:160,column:5}},type:"if",locations:[{start:{line:158,column:4},end:{line:160,column:5}},{start:{line:158,column:4},end:{line:160,column:5}}],line:158}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(++i.s[0],"#EXTINF:"),s=(++i.s[1],3),l=(++i.s[2],10),u=function(){function e(t){r(this,e),++i.f[0],++i.s[3],this._bufferLevel=0,++i.s[4],this._firstPlaylist=!0,++i.s[5],this._latency=t,++i.s[6],this._lastSN=null}return a(e,[{key:"truncate",value:function(e,t,n,r){if(++i.f[3],++i.s[9],!t.details.live)return++i.b[0][0],++i.s[10],r(n,this._playlistDuration(t)),void++i.s[11];++i.b[0][1];var a=(++i.s[12],this._extraSegmentsCount(e,t)),o=(++i.s[13],this._truncateSegments(a,t,n)),s=o.manifest,l=o.duration;++i.s[14],this._firstPlaylist=!1,++i.s[15],this._lastSN=this._snAtIndex(t,this._playlistLength(t)-a-1),++i.s[16],r(s,l)}},{key:"_extraSegmentsCount",value:function(e,t){if(++i.f[4],++i.s[17],this._firstPlaylist){++i.b[1][0];var n=(++i.s[18],this._latencyToSegmentsCount(t)),r=(++i.s[19],this._playbackCount(t,this._playlistLength(t)-n));return++i.s[20],Math.max(n-r,0)}return++i.b[1][1],++i.s[21],this._segmentCountFrom(e,t,this._bufferLevel)}},{key:"_playbackCount",value:function(e,t){++i.f[5];var n=(++i.s[22],this._fragments(e)),r=(++i.s[23],0),a=(++i.s[24],0);++i.s[25];for(var o=t;o<n.length;o++){var u=(++i.s[26],n[o]);if(++i.s[27],r+=u.duration,++i.s[28],a+=1,++i.s[29],++i.b[3][0],r>=l&&(++i.b[3][1],a>=s)){++i.b[2][0],++i.s[30];break}++i.b[2][1]}return++i.s[31],a}},{key:"_segmentCountFrom",value:function(e,t,n){++i.f[6];var r=(++i.s[32],e+n),a=(++i.s[33],this._fragments(t)),o=(++i.s[34],this._playlistLength(t)),s=(++i.s[35],0);++i.s[36];for(var l=o-1;l>=0;l--){var u=(++i.s[37],a[l]),c=(++i.s[38],u.start<r),d=(++i.s[39],u.sn>=this._lastSN);if(++i.s[40],++i.b[5][0],c||(++i.b[5][1],!d)){++i.b[4][0],++i.s[41];break}++i.b[4][1],++i.s[42],s=o-l-1}return++i.s[43],s}},{key:"_latencyToSegmentsCount",value:function(e){++i.f[7];var t=(++i.s[44],this._latency),n=(++i.s[45],0),r=(++i.s[46],this._fragments(e)),a=(++i.s[47],this._playlistLength(e));++i.s[48];for(var o=a-1;o>=0;o--){var s=(++i.s[49],r[o]);if(++i.s[50],t-=s.duration,++i.s[51],n+=1,++i.s[52],t<=0){++i.b[6][0],++i.s[53];break}++i.b[6][1]}return++i.s[54],n}},{key:"_truncateSegments",value:function(e,t,n){++i.f[8];var r=(++i.s[55],this._playlistLength(t)),a=(++i.s[56],Math.min(e,r-1)),s=(++i.s[57],0),l=(++i.s[58],this._fragments(t)),u=(++i.s[59],n.split("\n")),c=(++i.s[60],-1);++i.s[61];for(var d=0;d<a;d++){++i.s[62],s+=l[d].duration,++i.s[63];for(var f=u.length-1;f>=0;f--){if(++i.s[64],u[f].startsWith(o)){++i.b[7][0],++i.s[65],c=f,++i.s[66];break}++i.b[7][1]}++i.s[67],c>-1?(++i.b[8][0],++i.s[68],u.splice(c,2)):++i.b[8][1]}return++i.s[69],{manifest:u.join("\n"),duration:this._playlistDuration(t)-s}}},{key:"_fragments",value:function(e){return++i.f[9],++i.s[70],e.details.fragments}},{key:"_playlistLength",value:function(e){return++i.f[10],++i.s[71],this._fragments(e).length}},{key:"_playlistDuration",value:function(e){return++i.f[11],++i.s[72],e.details.totalduration}},{key:"_snAtIndex",value:function(e,t){++i.f[12];var n=(++i.s[73],this._fragments(e));return++i.s[74],n.length>t?(++i.b[9][0],++i.s[75],n[t].sn):(++i.b[9][1],++i.s[76],null)}},{key:"bufferLevel",set:function(e){++i.f[1],++i.s[7],this._bufferLevel=e},get:function(){return++i.f[2],++i.s[8],this._bufferLevel}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e="/home/ubuntu/native-wrapper/lib/MediaElement.js",t="1dc314a508530e1834d9e8e90c8bd5df417cb0e4",n=new Function("return this")(),r="__coverage__",i={path:"/home/ubuntu/native-wrapper/lib/MediaElement.js",statementMap:{0:{start:{line:5,column:4},end:{line:5,column:29}},1:{start:{line:9,column:4},end:{line:9,column:34}},2:{start:{line:13,column:4},end:{line:13,column:24}},3:{start:{line:17,column:4},end:{line:17,column:33}},4:{start:{line:21,column:4},end:{line:21,column:25}},5:{start:{line:25,column:4},end:{line:25,column:34}},6:{start:{line:29,column:4},end:{line:29,column:26}},7:{start:{line:33,column:4},end:{line:33,column:31}},8:{start:{line:37,column:4},end:{line:37,column:26}},9:{start:{line:41,column:4},end:{line:41,column:47}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:4,column:2},end:{line:4,column:3}},loc:{start:{line:4,column:24},end:{line:6,column:3}},line:4},1:{name:"(anonymous_1)",decl:{start:{line:8,column:2},end:{line:8,column:3}},loc:{start:{line:8,column:20},end:{line:10,column:3}},line:8},2:{name:"(anonymous_2)",decl:{start:{line:12,column:2},end:{line:12,column:3}},loc:{start:{line:12,column:19},end:{line:14,column:3}},line:12},3:{name:"(anonymous_3)",decl:{start:{line:16,column:2},end:{line:16,column:3}},loc:{start:{line:16,column:15},end:{line:18,column:3}},line:16},4:{name:"(anonymous_4)",decl:{start:{line:20,column:2},end:{line:20,column:3}},loc:{start:{line:20,column:20},end:{line:22,column:3}},line:20},5:{name:"(anonymous_5)",decl:{start:{line:24,column:2},end:{line:24,column:3}},loc:{start:{line:24,column:16},end:{line:26,column:3}},line:24},6:{name:"(anonymous_6)",decl:{start:{line:28,column:2},end:{line:28,column:3}},loc:{start:{line:28,column:21},end:{line:30,column:3}},line:28},7:{name:"(anonymous_7)",decl:{start:{line:32,column:2},end:{line:32,column:3}},loc:{start:{line:32,column:17},end:{line:34,column:3}},line:32},8:{name:"(anonymous_8)",decl:{start:{line:36,column:2},end:{line:36,column:3}},loc:{start:{line:36,column:17},end:{line:38,column:3}},line:36},9:{name:"(anonymous_9)",decl:{start:{line:40,column:2},end:{line:40,column:3}},loc:{start:{line:40,column:28},end:{line:42,column:3}},line:40}},branchMap:{0:{loc:{start:{line:9,column:11},end:{line:9,column:33}},type:"binary-expr",locations:[{start:{line:9,column:11},end:{line:9,column:28}},{start:{line:9,column:32},end:{line:9,column:33}}],line:9},1:{loc:{start:{line:17,column:11},end:{line:17,column:32}},type:"binary-expr",locations:[{start:{line:17,column:11},end:{line:17,column:23}},{start:{line:17,column:27},end:{line:17,column:32}}],line:17},2:{loc:{start:{line:25,column:11},end:{line:25,column:33}},type:"binary-expr",locations:[{start:{line:25,column:11},end:{line:25,column:24}},{start:{line:25,column:28},end:{line:25,column:33}}],line:25},3:{loc:{start:{line:33,column:11},end:{line:33,column:30}},type:"binary-expr",locations:[{start:{line:33,column:11},end:{line:33,column:25}},{start:{line:33,column:29},end:{line:33,column:30}}],line:33}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(138),s=function(e){return e&&e.__esModule?e:{default:e}}(o),l=function(){function e(){r(this,e)}return a(e,[{key:"updateBuffered",value:function(e){++i.f[9],++i.s[9],this._buffered=new s.default(e)}},{key:"currentTime",set:function(e){++i.f[0],++i.s[0],this._currentTime=e},get:function(){return++i.f[1],++i.s[1],++i.b[0][0],this._currentTime||(++i.b[0][1],0)}},{key:"paused",set:function(e){++i.f[2],++i.s[2],this._paused=e},get:function(){return++i.f[3],++i.s[3],++i.b[1][0],this._paused||(++i.b[1][1],!1)}},{key:"seeking",set:function(e){++i.f[4],++i.s[4],this._seeking=e},get:function(){return++i.f[5],++i.s[5],++i.b[2][0],this._seeking||(++i.b[2][1],!1)}},{key:"duration",set:function(e){++i.f[6],++i.s[6],this._duration=e},get:function(){return++i.f[7],++i.s[7],++i.b[3][0],this._duration||(++i.b[3][1],0)}},{key:"buffered",get:function(){return++i.f[8],++i.s[8],this._buffered}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){var e="/home/ubuntu/native-wrapper/lib/PlayerInterface.js",t="6ee9a049480e7fd95190ce899e2b841f0d623604",n=new Function("return this")(),r="__coverage__",i={path:"/home/ubuntu/native-wrapper/lib/PlayerInterface.js",statementMap:{0:{start:{line:9,column:4},end:{line:9,column:12}},1:{start:{line:11,column:4},end:{line:11,column:19}},2:{start:{line:12,column:4},end:{line:12,column:49}},3:{start:{line:14,column:4},end:{line:14,column:67}},4:{start:{line:16,column:4},end:{line:18,column:7}},5:{start:{line:17,column:6},end:{line:17,column:29}},6:{start:{line:22,column:18},end:{line:22,column:28}},7:{start:{line:23,column:18},end:{line:23,column:46}},8:{start:{line:24,column:4},end:{line:26,column:7}},9:{start:{line:30,column:4},end:{line:32,column:5}},10:{start:{line:31,column:6},end:{line:31,column:77}},11:{start:{line:35,column:4},end:{line:39,column:5}},12:{start:{line:36,column:6},end:{line:38,column:7}},13:{start:{line:37,column:8},end:{line:37,column:36}},14:{start:{line:41,column:4},end:{line:41,column:73}},15:{start:{line:46,column:4},end:{line:46,column:14}},16:{start:{line:50,column:4},end:{line:50,column:44}},17:{start:{line:54,column:4},end:{line:54,column:33}},18:{start:{line:58,column:4},end:{line:58,column:45}},19:{start:{line:62,column:4},end:{line:62,column:66}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:8,column:2},end:{line:8,column:3}},loc:{start:{line:8,column:39},end:{line:19,column:3}},line:8},1:{name:"(anonymous_1)",decl:{start:{line:16,column:41},end:{line:16,column:42}},loc:{start:{line:16,column:58},end:{line:18,column:5}},line:16},2:{name:"(anonymous_2)",decl:{start:{line:21,column:2},end:{line:21,column:3}},loc:{start:{line:21,column:20},end:{line:27,column:3}},line:21},3:{name:"(anonymous_3)",decl:{start:{line:29,column:2},end:{line:29,column:3}},loc:{start:{line:29,column:11},end:{line:42,column:3}},line:29},4:{name:"(anonymous_4)",decl:{start:{line:45,column:2},end:{line:45,column:3}},loc:{start:{line:45,column:22},end:{line:47,column:3}},line:45},5:{name:"(anonymous_5)",decl:{start:{line:49,column:2},end:{line:49,column:3}},loc:{start:{line:49,column:35},end:{line:51,column:3}},line:49},6:{name:"(anonymous_6)",decl:{start:{line:53,column:2},end:{line:53,column:3}},loc:{start:{line:53,column:40},end:{line:55,column:3}},line:53},7:{name:"(anonymous_7)",decl:{start:{line:57,column:2},end:{line:57,column:3}},loc:{start:{line:57,column:43},end:{line:59,column:3}},line:57},8:{name:"(anonymous_8)",decl:{start:{line:61,column:2},end:{line:61,column:3}},loc:{start:{line:61,column:58},end:{line:63,column:3}},line:61}},branchMap:{0:{loc:{start:{line:14,column:31},end:{line:14,column:66}},type:"binary-expr",locations:[{start:{line:14,column:31},end:{line:14,column:60}},{start:{line:14,column:64},end:{line:14,column:66}}],line:14},1:{loc:{start:{line:30,column:4},end:{line:32,column:5}},type:"if",locations:[{start:{line:30,column:4},end:{line:32,column:5}},{start:{line:30,column:4},end:{line:32,column:5}}],line:30},2:{loc:{start:{line:36,column:6},end:{line:38,column:7}},type:"if",locations:[{start:{line:36,column:6},end:{line:38,column:7}},{start:{line:36,column:6},end:{line:38,column:7}}],line:36}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},b:{0:[0,0],1:[0,0],2:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(321),c=r(u),d=n(320),f=r(d),h=n(46),v=r(h),p=n(135),_=r(p),m=function(e){function t(e,n,r){i(this,t),++s.f[0],++s.s[0];var o=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return++s.s[1],o.hls=e,++s.s[2],o._handler=new _.default(r),++s.s[3],o.liveMinBufferMargin=(++s.b[0][0],n.liveMinBufferMargin||(++s.b[0][1],10)),++s.s[4],o.hls.on(c.default.Events.LEVEL_SWITCH,function(e,t){++s.f[1],++s.s[5],o.levelSwitch(t)}),o}return o(t,e),l(t,[{key:"levelSwitch",value:function(e){++s.f[2];var t=(++s.s[6],e.level),n=(++s.s[7],this.hls.levels[t].urlId);++s.s[8],this.emit("onTrackChange",{video:new v.default({level:t,urlId:n})})}},{key:"isLive",value:function(){if(++s.f[3],++s.s[9],!this.hls.levels)throw++s.b[1][0],++s.s[10],new Error("Called isLive before the master playlist was parsed");++s.b[1][1],++s.s[11];var e=!0,t=!1,n=void 0;try{for(var r,i=this.hls.levels[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;if(++s.s[12],a.details)return++s.b[2][0],++s.s[13],!!a.details.live;++s.b[2][1]}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}throw++s.s[14],new Error("Called isLive before any levelplaylist was parsed")}},{key:"getBufferLevelMax",value:function(){return++s.f[4],++s.s[15],30}},{key:"setBufferMarginLive",value:function(e){++s.f[5],++s.s[16],this._handler.bufferLevel=e}},{key:"addEventListener",value:function(e,t){++s.f[6],++s.s[17],this.on(e,t)}},{key:"removeEventListener",value:function(e,t){++s.f[7],++s.s[18],this.removeListener(e,t)}},{key:"truncateManifest",value:function(e,t,n,r){++s.f[8],++s.s[19],this._handler.truncate(e,t,n,r)}}]),t}(f.default);t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e="/home/ubuntu/native-wrapper/lib/TimeRanges.js",t="9a477a98738f8586d8c89614dbb31d6e1a8d73c8",n=new Function("return this")(),r="__coverage__",i={path:"/home/ubuntu/native-wrapper/lib/TimeRanges.js",statementMap:{0:{start:{line:1,column:24},end:{line:1,column:27}},1:{start:{line:2,column:24},end:{line:2,column:27}},2:{start:{line:4,column:20},end:{line:4,column:36}},3:{start:{line:8,column:4},end:{line:8,column:22}},4:{start:{line:10,column:19},end:{line:11,column:49}},5:{start:{line:13,column:4},end:{line:22,column:5}},6:{start:{line:14,column:20},end:{line:14,column:29}},7:{start:{line:17,column:16},end:{line:17,column:44}},8:{start:{line:19,column:6},end:{line:21,column:7}},9:{start:{line:20,column:8},end:{line:20,column:78}},10:{start:{line:26,column:4},end:{line:28,column:5}},11:{start:{line:27,column:6},end:{line:27,column:35}},12:{start:{line:30,column:4},end:{line:30,column:37}},13:{start:{line:34,column:4},end:{line:36,column:5}},14:{start:{line:35,column:6},end:{line:35,column:35}},15:{start:{line:38,column:4},end:{line:38,column:35}},16:{start:{line:42,column:4},end:{line:42,column:31}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:7,column:2},end:{line:7,column:3}},loc:{start:{line:7,column:25},end:{line:23,column:3}},line:7},1:{name:"(anonymous_1)",decl:{start:{line:25,column:2},end:{line:25,column:3}},loc:{start:{line:25,column:15},end:{line:31,column:3}},line:25},2:{name:"(anonymous_2)",decl:{start:{line:33,column:2},end:{line:33,column:3}},loc:{start:{line:33,column:13},end:{line:39,column:3}},line:33},3:{name:"(anonymous_3)",decl:{start:{line:41,column:2},end:{line:41,column:3}},loc:{start:{line:41,column:15},end:{line:43,column:3}},line:41}},branchMap:{0:{loc:{start:{line:10,column:19},end:{line:11,column:49}},type:"cond-expr",locations:[{start:{line:11,column:12},end:{line:11,column:44}},{start:{line:11,column:47},end:{line:11,column:49}}],line:10},1:{loc:{start:{line:19,column:6},end:{line:21,column:7}},type:"if",locations:[{start:{line:19,column:6},end:{line:21,column:7}},{start:{line:19,column:6},end:{line:21,column:7}}],line:19},2:{loc:{start:{line:19,column:10},end:{line:19,column:22}},type:"binary-expr",locations:[{start:{line:19,column:10},end:{line:19,column:15}},{start:{line:19,column:19},end:{line:19,column:22}}],line:19},3:{loc:{start:{line:26,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:26,column:4},end:{line:28,column:5}},{start:{line:26,column:4},end:{line:28,column:5}}],line:26},4:{loc:{start:{line:26,column:8},end:{line:26,column:49}},type:"binary-expr",locations:[{start:{line:26,column:8},end:{line:26,column:17}},{start:{line:26,column:21},end:{line:26,column:49}}],line:26},5:{loc:{start:{line:34,column:4},end:{line:36,column:5}},type:"if",locations:[{start:{line:34,column:4},end:{line:36,column:5}},{start:{line:34,column:4},end:{line:36,column:5}}],line:34},6:{loc:{start:{line:34,column:8},end:{line:34,column:49}},type:"binary-expr",locations:[{start:{line:34,column:8},end:{line:34,column:17}},{start:{line:34,column:21},end:{line:34,column:49}}],line:34}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),a=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=(++i.s[0],","),l=(++i.s[1],"-"),u=(++i.s[2],"INDEX_SIZE_ERR"),c=function(){function e(t){r(this,e),++i.f[0],++i.s[3],this._ranges=[];var n=(++i.s[4],t?(++i.b[0][0],t.split(s)):(++i.b[0][1],[]));++i.s[5];for(var o=0,u=n.length;o<u;o++){var c=(++i.s[6],n[o]),d=(++i.s[7],c.split(l)),f=a(d,2),h=f[0],v=f[1];++i.s[8],++i.b[2][0],h&&(++i.b[2][1],v)?(++i.b[1][0],++i.s[9],this._ranges.push({start:parseFloat(h),end:parseFloat(v)})):++i.b[1][1]}}return o(e,[{key:"start",value:function(e){if(++i.f[1],++i.s[10],++i.b[4][0],e<0||(++i.b[4][1],e>=this._ranges.length))throw++i.b[3][0],++i.s[11],new Error(u);return++i.b[3][1],++i.s[12],this._ranges[e].start}},{key:"end",value:function(e){if(++i.f[2],++i.s[13],++i.b[6][0],e<0||(++i.b[6][1],e>=this._ranges.length))throw++i.b[5][0],++i.s[14],new Error(u);return++i.b[5][1],++i.s[15],this._ranges[e].end}},{key:"length",get:function(){return++i.f[3],++i.s[16],this._ranges.length}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";(function(e){function t(e){return e&&e.__esModule?e:{default:e}}var r=function(){var e="/home/ubuntu/native-wrapper/lib/wrapper.js",t="a9a8bb524b4d7fc058823c8cb166ca8a06634bb3",n=new Function("return this")(),r="__coverage__",i={path:"/home/ubuntu/native-wrapper/lib/wrapper.js",statementMap:{0:{start:{line:16,column:26},end:{line:16,column:30}},1:{start:{line:17,column:28},end:{line:17,column:32}},2:{start:{line:19,column:0},end:{line:33,column:2}},3:{start:{line:20,column:2},end:{line:32,column:3}},4:{start:{line:21,column:4},end:{line:29,column:27}},5:{start:{line:31,column:4},end:{line:31,column:23}},6:{start:{line:35,column:0},end:{line:42,column:2}},7:{start:{line:36,column:2},end:{line:41,column:3}},8:{start:{line:37,column:17},end:{line:37,column:50}},9:{start:{line:38,column:4},end:{line:38,column:58}},10:{start:{line:40,column:4},end:{line:40,column:23}},11:{start:{line:44,column:0},end:{line:53,column:2}},12:{start:{line:45,column:2},end:{line:52,column:3}},13:{start:{line:46,column:4},end:{line:46,column:64}},14:{start:{line:47,column:4},end:{line:47,column:49}},15:{start:{line:48,column:4},end:{line:48,column:51}},16:{start:{line:49,column:4},end:{line:49,column:50}},17:{start:{line:51,column:4},end:{line:51,column:23}},18:{start:{line:55,column:0},end:{line:61,column:2}},19:{start:{line:56,column:2},end:{line:60,column:3}},20:{start:{line:57,column:4},end:{line:57,column:44}},21:{start:{line:59,column:4},end:{line:59,column:23}},22:{start:{line:63,column:0},end:{line:69,column:2}},23:{start:{line:64,column:2},end:{line:68,column:3}},24:{start:{line:65,column:4},end:{line:65,column:48}},25:{start:{line:67,column:4},end:{line:67,column:23}},26:{start:{line:71,column:0},end:{line:77,column:2}},27:{start:{line:72,column:2},end:{line:76,column:3}},28:{start:{line:73,column:4},end:{line:73,column:101}},29:{start:{line:75,column:4},end:{line:75,column:23}},30:{start:{line:79,column:0},end:{line:85,column:2}},31:{start:{line:80,column:2},end:{line:84,column:3}},32:{start:{line:81,column:4},end:{line:81,column:44}},33:{start:{line:83,column:4},end:{line:83,column:23}},34:{start:{line:87,column:0},end:{line:93,column:2}},35:{start:{line:88,column:2},end:{line:92,column:3}},36:{start:{line:89,column:4},end:{line:89,column:105}},37:{start:{line:91,column:4},end:{line:91,column:23}},38:{start:{line:95,column:0},end:{line:101,column:2}},39:{start:{line:96,column:2},end:{line:100,column:3}},40:{start:{line:97,column:4},end:{line:97,column:75}},41:{start:{line:99,column:4},end:{line:99,column:23}},42:{start:{line:103,column:0},end:{line:109,column:2}},43:{start:{line:104,column:2},end:{line:108,column:3}},44:{start:{line:105,column:4},end:{line:105,column:36}},45:{start:{line:107,column:4},end:{line:107,column:23}},46:{start:{line:111,column:0},end:{line:117,column:2}},47:{start:{line:112,column:2},end:{line:116,column:3}},48:{start:{line:113,column:4},end:{line:113,column:47}},49:{start:{line:115,column:4},end:{line:115,column:23}},50:{start:{line:119,column:0},end:{line:125,column:2}},51:{start:{line:120,column:2},end:{line:124,column:3}},52:{start:{line:121,column:4},end:{line:121,column:50}},53:{start:{line:123,column:4},end:{line:123,column:23}},54:{start:{line:127,column:0},end:{line:133,column:2}},55:{start:{line:128,column:2},end:{line:132,column:3}},56:{start:{line:129,column:4},end:{line:129,column:77}},57:{start:{line:131,column:4},end:{line:131,column:23}},58:{start:{line:135,column:0},end:{line:141,column:2}},59:{start:{line:136,column:2},end:{line:140,column:3}},60:{start:{line:137,column:4},end:{line:137,column:57}},61:{start:{line:139,column:4},end:{line:139,column:23}},62:{start:{line:143,column:0},end:{line:149,column:2}},63:{start:{line:144,column:2},end:{line:148,column:3}},64:{start:{line:145,column:4},end:{line:145,column:58}},65:{start:{line:147,column:4},end:{line:147,column:23}},66:{start:{line:151,column:0},end:{line:162,column:2}},67:{start:{line:152,column:2},end:{line:161,column:3}},68:{start:{line:153,column:22},end:{line:156,column:5}},69:{start:{line:157,column:24},end:{line:157,column:58}},70:{start:{line:158,column:4},end:{line:158,column:118}},71:{start:{line:160,column:4},end:{line:160,column:23}},72:{start:{line:164,column:0},end:{line:170,column:2}},73:{start:{line:165,column:2},end:{line:169,column:3}},74:{start:{line:166,column:4},end:{line:166,column:46}},75:{start:{line:168,column:4},end:{line:168,column:23}},76:{start:{line:172,column:0},end:{line:182,column:2}},77:{start:{line:173,column:2},end:{line:181,column:3}},78:{start:{line:174,column:4},end:{line:178,column:5}},79:{start:{line:175,column:6},end:{line:175,column:32}},80:{start:{line:177,column:6},end:{line:177,column:33}},81:{start:{line:180,column:4},end:{line:180,column:23}},82:{start:{line:184,column:0},end:{line:194,column:2}},83:{start:{line:185,column:2},end:{line:193,column:3}},84:{start:{line:186,column:4},end:{line:190,column:5}},85:{start:{line:187,column:6},end:{line:187,column:33}},86:{start:{line:189,column:6},end:{line:189,column:34}},87:{start:{line:192,column:4},end:{line:192,column:23}},88:{start:{line:196,column:0},end:{line:206,column:2}},89:{start:{line:197,column:2},end:{line:205,column:3}},90:{start:{line:198,column:4},end:{line:202,column:5}},91:{start:{line:199,column:6},end:{line:199,column:34}},92:{start:{line:201,column:6},end:{line:201,column:35}},93:{start:{line:204,column:4},end:{line:204,column:23}},94:{start:{line:208,column:0},end:{line:218,column:2}},95:{start:{line:209,column:2},end:{line:217,column:3}},96:{start:{line:210,column:4},end:{line:214,column:5}},97:{start:{line:211,column:6},end:{line:211,column:35}},98:{start:{line:213,column:6},end:{line:213,column:36}},99:{start:{line:216,column:4},end:{line:216,column:23}},100:{start:{line:220,column:0},end:{line:226,column:2}},101:{start:{line:221,column:2},end:{line:225,column:3}},102:{start:{line:222,column:4},end:{line:222,column:31}},103:{start:{line:224,column:4},end:{line:224,column:23}},104:{start:{line:228,column:0},end:{line:234,column:2}},105:{start:{line:229,column:2},end:{line:233,column:3}},106:{start:{line:230,column:4},end:{line:230,column:32}},107:{start:{line:232,column:4},end:{line:232,column:23}},108:{start:{line:236,column:0},end:{line:244,column:2}},109:{start:{line:237,column:2},end:{line:241,column:3}},110:{start:{line:238,column:4},end:{line:238,column:30}},111:{start:{line:240,column:4},end:{line:240,column:23}},112:{start:{line:243,column:2},end:{line:243,column:14}},113:{start:{line:246,column:0},end:{line:252,column:2}},114:{start:{line:247,column:2},end:{line:251,column:3}},115:{start:{line:248,column:4},end:{line:248,column:54}},116:{start:{line:250,column:4},end:{line:250,column:23}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:19,column:23},end:{line:19,column:24}},loc:{start:{line:19,column:108},end:{line:33,column:1}},line:19},1:{name:"(anonymous_1)",decl:{start:{line:35,column:24},end:{line:35,column:25}},loc:{start:{line:35,column:59},end:{line:42,column:1}},line:35},2:{name:"(anonymous_2)",decl:{start:{line:44,column:28},end:{line:44,column:29}},loc:{start:{line:44,column:73},end:{line:53,column:1}},line:44},3:{name:"(anonymous_3)",decl:{start:{line:55,column:20},end:{line:55,column:21}},loc:{start:{line:55,column:45},end:{line:61,column:1}},line:55},4:{name:"(anonymous_4)",decl:{start:{line:63,column:29},end:{line:63,column:30}},loc:{start:{line:63,column:49},end:{line:69,column:1}},line:63},5:{name:"(anonymous_5)",decl:{start:{line:71,column:31},end:{line:71,column:32}},loc:{start:{line:71,column:102},end:{line:77,column:1}},line:71},6:{name:"(anonymous_6)",decl:{start:{line:79,column:29},end:{line:79,column:30}},loc:{start:{line:79,column:52},end:{line:85,column:1}},line:79},7:{name:"(anonymous_7)",decl:{start:{line:87,column:33},end:{line:87,column:34}},loc:{start:{line:87,column:99},end:{line:93,column:1}},line:87},8:{name:"(anonymous_8)",decl:{start:{line:95,column:33},end:{line:95,column:34}},loc:{start:{line:95,column:69},end:{line:101,column:1}},line:95},9:{name:"(anonymous_9)",decl:{start:{line:103,column:24},end:{line:103,column:25}},loc:{start:{line:103,column:45},end:{line:109,column:1}},line:103},10:{name:"(anonymous_10)",decl:{start:{line:111,column:36},end:{line:111,column:37}},loc:{start:{line:111,column:42},end:{line:117,column:1}},line:111},11:{name:"(anonymous_11)",decl:{start:{line:119,column:39},end:{line:119,column:40}},loc:{start:{line:119,column:45},end:{line:125,column:1}},line:119},12:{name:"(anonymous_12)",decl:{start:{line:127,column:30},end:{line:127,column:31}},loc:{start:{line:127,column:70},end:{line:133,column:1}},line:127},13:{name:"(anonymous_13)",decl:{start:{line:135,column:34},end:{line:135,column:35}},loc:{start:{line:135,column:52},end:{line:141,column:1}},line:135},14:{name:"(anonymous_14)",decl:{start:{line:143,column:39},end:{line:143,column:40}},loc:{start:{line:143,column:66},end:{line:149,column:1}},line:143},15:{name:"(anonymous_15)",decl:{start:{line:151,column:36},end:{line:151,column:37}},loc:{start:{line:151,column:131},end:{line:162,column:1}},line:151},16:{name:"(anonymous_16)",decl:{start:{line:164,column:36},end:{line:164,column:37}},loc:{start:{line:164,column:54},end:{line:170,column:1}},line:164},17:{name:"(anonymous_17)",decl:{start:{line:172,column:25},end:{line:172,column:26}},loc:{start:{line:172,column:31},end:{line:182,column:1}},line:172},18:{name:"(anonymous_18)",decl:{start:{line:184,column:26},end:{line:184,column:27}},loc:{start:{line:184,column:32},end:{line:194,column:1}},line:184},19:{name:"(anonymous_19)",decl:{start:{line:196,column:27},end:{line:196,column:28}},loc:{start:{line:196,column:33},end:{line:206,column:1}},line:196},20:{name:"(anonymous_20)",decl:{start:{line:208,column:28},end:{line:208,column:29}},loc:{start:{line:208,column:34},end:{line:218,column:1}},line:208},21:{name:"(anonymous_21)",decl:{start:{line:220,column:32},end:{line:220,column:33}},loc:{start:{line:220,column:40},end:{line:226,column:1}},line:220},22:{name:"(anonymous_22)",decl:{start:{line:228,column:33},end:{line:228,column:34}},loc:{start:{line:228,column:41},end:{line:234,column:1}},line:228},23:{name:"(anonymous_23)",decl:{start:{line:236,column:18},end:{line:236,column:19}},loc:{start:{line:236,column:24},end:{line:244,column:1}},line:236},24:{name:"(anonymous_24)",decl:{start:{line:246,column:31},end:{line:246,column:32}},loc:{start:{line:246,column:49},end:{line:252,column:1}},line:246}},branchMap:{0:{loc:{start:{line:174,column:4},end:{line:178,column:5}},type:"if",locations:[{start:{line:174,column:4},end:{line:178,column:5}},{start:{line:174,column:4},end:{line:178,column:5}}],line:174},1:{loc:{start:{line:186,column:4},end:{line:190,column:5}},type:"if",locations:[{start:{line:186,column:4},end:{line:190,column:5}},{start:{line:186,column:4},end:{line:190,column:5}}],line:186},2:{loc:{start:{line:198,column:4},end:{line:202,column:5}},type:"if",locations:[{start:{line:198,column:4},end:{line:202,column:5}},{start:{line:198,column:4},end:{line:202,column:5}}],line:198},3:{loc:{start:{line:210,column:4},end:{line:214,column:5}},type:"if",locations:[{start:{line:210,column:4},end:{line:214,column:5}},{start:{line:210,column:4},end:{line:214,column:5}}],line:210}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0,101:0,102:0,103:0,104:0,105:0,106:0,107:0,108:0,109:0,110:0,111:0,112:0,113:0,114:0,115:0,116:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},a=n[r]||(n[r]={});return a[e]&&a[e].hash===t?a[e]:(i.hash=t,a[e]=i)}(),i=n(62),a=t(i),o=n(92),s=n(35),l=t(s),u=n(17),c=n(91),d=t(c),f=n(90),h=t(f),v=n(89),p=t(v),_=n(93),m=n(133),g=t(m),y=void 0,E=(++r.s[0],!0),S=(++r.s[1],!0);++r.s[2],e.createService=function(e,t,n,i,a,o){++r.f[0],++r.s[3];try{++r.s[4],y=new g.default(e,t,parseInt(n,10),i,a,"true"===o,S,E)}catch(e){++r.s[5],(0,u.nativeError)(e)}},++r.s[6],e.updateManifest=function(e,t){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];++r.f[1],++r.s[7];try{var o=(++r.s[8],parseInt(e,10)/1e3);++r.s[9],y.updateManifest(o,i.join("\n"),t)}catch(e){++r.s[10],(0,u.nativeError)(e)}},++r.s[11],e.updateMediaElement=function(e,t,n,i){++r.f[2],++r.s[12];try{++r.s[13],y.mediaElement.currentTime=parseFloat(e),++r.s[14],y.mediaElement.paused="1"===t,++r.s[15],y.mediaElement.seeking="1"===n,++r.s[16],y.mediaElement.updateBuffered(i)}catch(e){++r.s[17],(0,u.nativeError)(e)}},++r.s[18],e.getSegment=function(e,t){++r.f[3],++r.s[19];try{++r.s[20],y.getSegment(e,t)}catch(e){++r.s[21],(0,u.nativeError)(e)}},++r.s[22],e.abortSegmentRequest=function(e){++r.f[4],++r.s[23];try{++r.s[24],y.abortSegmentRequest(e)}catch(e){++r.s[25],(0,u.nativeError)(e)}},++r.s[26],e.getBinaryDataCallback=function(e,t,n,i,a){++r.f[5],++r.s[27];try{++r.s[28],p.default.getBinaryDataCallback(e,t,n,i,a)}catch(e){++r.s[29],(0,u.nativeError)(e)}},++r.s[30],e.httpRequestProgress=function(e,t,n){++r.f[6],++r.s[31];try{++r.s[32],l.default.progress(e,t,n)}catch(e){++r.s[33],(0,u.nativeError)(e)}},++r.s[34],e.httpRequestDataResponse=function(e,t,n,i,a){++r.f[7],++r.s[35];try{++r.s[36],l.default.dataResponse(e,t,n,parseInt(i,10),a)}catch(e){++r.s[37],(0,u.nativeError)(e)}},++r.s[38],e.httpRequestJSONResponse=function(e,t,n,i){++r.f[8],++r.s[39];try{++r.s[40],l.default.jsonResponse(e,t,parseInt(n,10),i)}catch(e){++r.s[41],(0,u.nativeError)(e)}},++r.s[42],e.hasherCallback=function(e,t){++r.f[9],++r.s[43];try{++r.s[44],(0,o.hasherCallback)(e,t)}catch(e){++r.s[45],(0,u.nativeError)(e)}},++r.s[46],e.connectedToSignalingServer=function(){++r.f[10],++r.s[47];try{++r.s[48],d.default.connectedToSignalingServer()}catch(e){++r.s[49],(0,u.nativeError)(e)}},++r.s[50],e.disconnectedToSignalingServer=function(){++r.f[11],++r.s[51];try{++r.s[52],d.default.disconnectedToSignalingServer()}catch(e){++r.s[53],(0,u.nativeError)(e)}},++r.s[54],e.signalingDidComplete=function(e,t,n){++r.f[12],++r.s[55];try{++r.s[56],d.default.peerConnectionCallback(e,t,n)}catch(e){++r.s[57],(0,u.nativeError)(e)}},++r.s[58],e.peerConnectionDidTimeout=function(e){++r.f[13],++r.s[59];try{++r.s[60],d.default.peerConnectionDidTimeout(e)}catch(e){++r.s[61],(0,u.nativeError)(e)}},++r.s[62],e.peerConnectionReceivedMessage=function(e,t){++r.f[14],++r.s[63];try{++r.s[64],h.default.receivedMessage(e,t)}catch(e){++r.s[65],(0,u.nativeError)(e)}},++r.s[66],e.peerConnectionReceivedData=function(e,t,n,i,o,s,l,c){++r.f[15],++r.s[67];try{var d=(++r.s[68],{level:parseInt(l,10),urlId:parseInt(s,10)}),f=(++r.s[69],new a.default({sn:o,trackView:d}));++r.s[70],h.default.receivedData(e,t,n,i,f,c)}catch(e){++r.s[71],(0,u.nativeError)(e)}},++r.s[72],e.peerConnectionDisconnected=function(e){++r.f[16],++r.s[73];try{++r.s[74],h.default.onDisconnect(e)}catch(e){++r.s[75],(0,u.nativeError)(e)}},++r.s[76],e.enableP2PUpload=function(){++r.f[17],++r.s[77];try{++r.s[78],y?(++r.b[0][0],++r.s[79],y.enableP2PUpload()):(++r.b[0][1],++r.s[80],E=!0)}catch(e){++r.s[81],(0,u.nativeError)(e)}},++r.s[82],e.disableP2PUpload=function(){++r.f[18],++r.s[83];try{++r.s[84],y?(++r.b[1][0],++r.s[85],y.disableP2PUpload()):(++r.b[1][1],++r.s[86],E=!1)}catch(e){++r.s[87],(0,u.nativeError)(e)}},++r.s[88],e.enableP2PDownload=function(){++r.f[19],++r.s[89];try{++r.s[90],y?(++r.b[2][0],++r.s[91],y.enableP2PDownload()):(++r.b[2][1],++r.s[92],S=!0)}catch(e){++r.s[93],(0,u.nativeError)(e)}},++r.s[94],e.disableP2PDownload=function(){++r.f[20],++r.s[95];try{++r.s[96],y?(++r.b[3][0],++r.s[97],y.disableP2PDownload()):(++r.b[3][1],++r.s[98],S=!1)}catch(e){++r.s[99],(0,u.nativeError)(e)}},++r.s[100],e.triggerTimeoutCallback=function(e){++r.f[21],++r.s[101];try{++r.s[102],(0,_.triggerTimeoutCallback)(e)}catch(e){++r.s[103],(0,u.nativeError)(e)}},++r.s[104],e.triggerIntervalCallback=function(e){++r.f[22],++r.s[105];try{++r.s[106],(0,_.triggerIntervalCallback)(e)}catch(e){++r.s[107],(0,u.nativeError)(e)}},++r.s[108],e.getStats=function(){++r.f[23],++r.s[109];try{return++r.s[110],y.getStats()}catch(e){++r.s[111],(0,u.nativeError)(e)}return++r.s[112],null},++r.s[113],e.peerConnectionOffered=function(e){++r.f[24],++r.s[114];try{++r.s[115],d.default.peerConnectionOffered(e)}catch(e){++r.s[116],(0,u.nativeError)(e)}}}).call(t,n(45))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(62),s=r(o),l=n(46),u=r(l),c=function(){function e(t){i(this,e),this.hls=t}return a(e,[{key:"getSegmentTime",value:function(e){if(void 0===e.time)throw new Error("getSegmentTime: segmentView.time is undefined");return e.time}},{key:"getSegmentList",value:function(e,t,n){var r=this.hls.levels[e.level];if(!r)throw new Error("getSegmentList: level doesn't exist");if(!r.details)return console.warn("getSegmentList: level not parsed yet"),[];for(var i=[],a=r.details.fragments,o=0;o<a.length;o++){var l=a[o];t<=l.start&&l.start<=t+n&&i.push(new s.default({sn:l.sn,trackView:e,time:l.start}))}return i}},{key:"getTrackList",value:function(){if(!this.hls.levels)return[];for(var e=[],t=0;t<this.hls.levels.length;t++)for(var n=this.hls.levels[t],r=0;r<n.url.length;r++)e.push(new u.default({level:t,urlId:r,bitrate:n.bitrate}));return e}},{key:"getSegmentDuration",value:function(e){var t=this.hls.levels[e.trackView.level],n=!0,r=!1,i=void 0;try{for(var a,o=t.details.fragments[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){return a.value.duration}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}throw new Error("All segments should have a duration")}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(67),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a={BACKEND_USE_SSL:!0,TRACKER_URL:"",SIGNALING_URL:"",FALLBACK_URLS:{KLARA_URL:"https://klara.streamroot.io"},DISTRIBUTOR:{URL:"https://distributor.streamroot.io",OVERRIDDEN:!1,TIMEOUT_DELAY:1e4,MAX_RETRY:1},SIGNALING_DELAY_STEP:10*1e3,SIGNALING_DELAY_MAX:5*60*1e3,SIGNALING_DELAY_MAX_INITIAL:30*1e3,TRACKER_DELAY_MAX:5*60*1e3,TRACKER_DELAY_INIT:2*1e3,MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE:10,ASK_PEERS_INTERVAL:1*60*1e3,ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL:1e4,SEND_TRACKS_INTERVAL:1*60*1e3,GEOLOCATION_REQUEST_TIMEOUT:3e3,GEOLOCATION_REQUEST_MAX_RETRY:1,CONF_LABEL:"default",ANALYTICS:{KLARA_URL:"",EXPOSE_CONF_LABEL:!1,RETRY_NUMBER:3,RETRY_DELAY:10*1e3,TIMEOUT_DELAY:3*1e3,TRAFFIC_INTERVAL_ARRAY:function(e){for(var t=e.from,n=e.to,r=e.step,i=[],a=t;a<n;a+=r)i.push(a);return i.push(n),i}({from:5*1e3,to:120*1e3,step:10*1e3}),STATS_INTERVAL:2*60*1e3,CONTROL_INTERVAL:10*60*1e3},QOS_REF_PERCENTAGE:0,QOS_P2P_DISABLED:!1,ERRORS:{API_KEY:"d04c6fa616c255ac55dec6b068ad7172",HANDLER:"xhr",STAGES:["staging","qa","production"]},PEER_CONNECTION_TIMEOUT:5e4,ICECANDIDATES_TIMEOUT:15e3,SEND_HEARTBEAT_INTERVAL:5*1e3,CHECK_HEARTBEAT_INTERVAL:10*1e3,DATACHANNEL_TYPE:"limited-retransmits",DATACHANNEL_MAX_PACKET_LIFETIME:1e3,DATACHANNEL_MAX_RETRANSMITS:1,ENABLE_STUN:!0,ENABLE_TURN:!1,TRANSFORM_SDP:!0,STUNSERVERS:["stun.l.google.com:19302"],TURNSERVERS:[{urls:"turn:23.97.160.254:3478?transport=udp",credential:"streamroot",username:"streamroot"}],CLIENT_TRACKER_PROTOCOL_VERSION:"3.0.0",P2P_PROTOCOL_VERSION:"3.3.1",CHUNK_SIZE:15*1024,ALLOW_LIVE_PUSH_SEGMENT:!0,ALLOW_VOD_PUSH_SEGMENT:!0,USE_VOD_PUSH_PATCH:!0,MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER:80,P2P_CACHE_MAX_SIZE:130*(1024*1024),MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH:300,GETSEGMENTTIME_CACHE_MAX_SIZE:1e3,MAX_CHUNK_BY_SEEDER:300,NB_SEGMENT_P2P_PREBUFFER:10,MAX_BUFFER_DURATION:5*60,CHUNK_BATCHING_INTERVAL:1e3,CHUNK_TIMEOUT:2500,CHUNK_GRACE_DURATION:1e4,UP_BUFFERED_AMOUNT_LOW_THRESHOLD:15e3,UP_MAX_BUFFERED_AMOUNT:6e4,CHUNK_UP_TIMEOUT:2500-600,SPLIT_UPLOAD_QUEUE:!1,LIVE:{LOWER_BUFFER_TARGET:10,HIGHER_BUFFER_TARGET:30,BUFFER_CHECK_INTERVAL:100,BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT:.1,UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING:6e3,P2P_CACHE_MAX_SIZE:60*(1024*1024),CHUNK_TIMEOUT:2500,CHUNK_UP_TIMEOUT:2500-600,QOS_REF_PERCENTAGE:0,NEAR_EDGE_MARGIN:2*60*1e3,LOW_TARGET_P2P_DL_BLOCK_DURATION:2e4},SPEED_MONITOR_INTERVAL:1e3,MEAN_SPEED_CALCULATION_INTERVAL:500,PEER_UPLOAD_SPEED_EMA_HALF_LIFE:1e4,PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE:15e3,PEER_SPEED_MONITOR_INTERVAL:1e3,PEER_TIMEOUT_RATIO_WINDOW:3e4,PEER_UPLOAD_CAPACITY_SAFE_RATIO:.8,PEER_UPLOAD_CAPACITY_EXTRA_RATIO:.1,PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL:1e3,DEFAULT_PEER_UPLOAD_CAPACITY:1e3,MIN_PEER_UPLOAD_CAPACITY:200,MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO:.1,PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP:.3,PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN:.5,PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO:!1,PUC_EMWA_WEIGHT_CAP:.9,PEER_INIT_LOCKED_DURATION:1e4,PEER_LOCKED_UPLOAD_THRESHOLD:.05,PEER_LOCKED_DOWNLOAD_THRESHOLD:.1,POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON:!0,POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION:5e3,PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE:2e3,PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE:3e3,PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD:.6,LOOSER_UPLOAD_THRESHOLD:100,PEER_POOL_LIMIT:25,PEER_POOL_MAINTENANCE_INTERVAL:1e3,EXPECTED_CONNECTION_SUCCESS_RATE:.3,RESERVED_OFFER_SLOTS:3,CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL:1e3,MAX_TRACKER_EXCLUSION_LENGTH:100,PEER_DISCONNECTED_EXCLUSION_DURATION:1*60*1e3,PEER_DISCONNECTED_EXCLUSION_RANK:1,OFFER_DECLINED_EXCLUSION_DURATION:1*60*1e3,OFFER_DECLINED_EXCLUSION_RANK:1,PEER_REMOVED_EXCLUSION_DURATION:15*60*1e3,PEER_REMOVED_EXCLUSION_RANK:1,PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION:15*60*1e3,PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK:1,CDN_SPEED_ESTIMATE_CONSIDER_P2P:!0,CDN_CONCURRENT_SCALING_CAP:1.5,P2P_SPEED_ZERO_THRESHOLD:50,P2P_SPEED_ESTIMATION_BUCKET_DURATION:100,P2P_SPEED_ESTIMATION_BUCKET_COUNT:10,P2P_SPEED_EMA_WEIGHT:.5,P2P_SPEED_EMA_ZERO_HALF_LIFE:12e4,P2P_USEFUL_CALCULATION_INTERVAL:5e3,P2P_USEFUL_SMA_WINDOW:12e4,P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION:50,P2P_USEFUL_RATIO_WEIGHT:.8,ABR_SEGMENT_CDN_RATIO_THRESHOLD:.3,ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD:.3,ABR_CDN_DL_THRESHOLD:100,ABR_CDN_DL_DECAY_TIME:6e4,USE_COMBINED_ABR_FEEDBACK:!0,BITRATE_ESTIMATION_WINDOW:3e4,PEER_COMPUTE_RTT_INTERVAL:5e3,USE_CONTINOUS_PROGRESS_FEEDBACK:!0,PROGRESS_ADD_TOTAL:!0,LOCKED_RETRY_INTERVAL:30,LOCKED_RETRY_TIMEOUT:500,TIMEOUT_GET_FULL_SEGMENT:500,RETURN_COPY_SEGMENT:!0,ALLOW_P2P:!0,RANGE_REQUEST_ALLOWED:!0,DEVICE_INFO:"",ID_CLIENT:"",ENABLE_MOBILE_BROWSER:!1,DEBUG:!1};i.default.deepFreeze(a),t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(149),u=r(l),c=n(148),d=r(c),f=n(143),h=r(f),v=n(144),p=r(v),_=n(23),m=r(_),g=n(3),y=r(g),E=n(4),S=function(){function e(t,n){(0,a.default)(this,e),this._trafficIntervalCounter=0,this._conf=n.conf,this._timerStore=new m.default,this._configAnalytics=new h.default(n),this._trafficAnalytics=new u.default(n),this._statsAnalytics=new d.default(t,n),this._mediaEndedListener=new p.default(t,n),n.eventBus.once(y.default.Distributor.READY,this._init.bind(this))}return(0,s.default)(e,[{key:"_init",value:function(){var e=this;this._sendConfigReport(),this._scheduleTrafficReport(),this._scheduleStatReport(),this._scheduleControlReport(),window.onbeforeunload=function(){e._trafficAnalytics.sendUsage(!0)}}},{key:"dispose",value:function(){this._timerStore.clearAll(),this._statsAnalytics.dispose(),this._mediaEndedListener.dispose()}},{key:"_sendConfigReport",value:function(){this._configAnalytics.sendConfig()}},{key:"_scheduleTrafficReport",value:function(){var e=this;if(this._trafficIntervalCounter<this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1){var t=(0,E.createTimeout)(function(){e._trafficAnalytics.sendUsage(),e._scheduleTrafficReport()},this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._trafficIntervalCounter]);this._timerStore.register(t),this._trafficIntervalCounter++}else{var n=this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1],r=this._trafficAnalytics.sendUsage.bind(this._trafficAnalytics,!1),i=(0,E.createInterval)(r,n);this._timerStore.register(i)}}},{key:"_scheduleStatReport",value:function(){var e=(0,E.createInterval)(this._statsAnalytics.sendStats.bind(this._statsAnalytics),this._conf.ANALYTICS.STATS_INTERVAL);this._timerStore.register(e)}},{key:"_scheduleControlReport",value:function(){var e=(0,E.createInterval)(this._statsAnalytics.sendControl.bind(this._statsAnalytics),this._conf.ANALYTICS.CONTROL_INTERVAL);this._timerStore.register(e)}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(63),u=r(l),c=function(){function e(t){(0,a.default)(this,e),this._sharedState=t,this._analyticsClient=new u.default(t,"p2pconfig")}return(0,s.default)(e,[{key:"sendConfig",value:function(){var e={};e.activateP2P=this._sharedState.conf.ALLOW_P2P,e.debug=this._sharedState.p2pConfig.debug||!1,e.deviceInfo=this._sharedState.conf.DEVICE_INFO,e.trackerUrl=this._sharedState.conf.TRACKER_URL,e.backendUrl=this._sharedState.conf.DISTRIBUTOR.URL,e.signalingUrl=this._sharedState.conf.SIGNALING_URL,e.analyticsUrl=this._sharedState.conf.ANALYTICS.KLARA_URL,e.vodCacheSize=this._sharedState.conf.P2P_CACHE_MAX_SIZE/(1024*1024),e.liveCacheSize=this._sharedState.conf.LIVE.P2P_CACHE_MAX_SIZE/(1024*1024),e.rangeRequestEnabled=this._sharedState.conf.RANGE_REQUEST_ALLOWED,e.mobileBrowserEnabled=this._sharedState.conf.ENABLE_MOBILE_BROWSER,e.enableStunServers=this._sharedState.conf.ENABLE_STUN;var t={live:this._sharedState.moduleState.isLive(),p2pConfig:e};this._analyticsClient.send(t)}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(3),u=r(l),c=n(4),d=.3,f=100,h=function(){function e(t,n){(0,a.default)(this,e),this._tickInterval=null,this._sharedState=n,null===t.mediaElement||this._sharedState.moduleState.isLive()||(this._mediaElement=t.mediaElement,this._tickInterval=(0,c.createInterval)(this._tick.bind(this),f))}return(0,s.default)(e,[{key:"_tick",value:function(){if(null!==this._mediaElement){var e=this._mediaElement.duration,t=this._mediaElement.currentTime;e&&e-t<d&&(null!==this._tickInterval&&(this._tickInterval.clear(),this._tickInterval=null),this._sharedState.eventBus.emit(u.default.Media.ENDED))}}},{key:"dispose",value:function(){null!==this._tickInterval&&this._tickInterval.clear()}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(35),u=r(l),c=n(6),d=r(c),f=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"send",value:function(e,t,n){var r=n.conf,i=n.status,a={timeout:r.ANALYTICS.TIMEOUT_DELAY,retry:r.ANALYTICS.RETRY_NUMBER,retryDelay:r.ANALYTICS.RETRY_DELAY,headers:{Authorization:i.getBearerToken(),"Content-Type":"application/json;charset=UTF-8"}},o=new u.default(u.default.Methods.POST,e,a);o.isStreamroot=!0,o.send(t).catch(function(e){d.default.notifyError(new Error("Could not send analytics payload: "+e.message+". Status: "+e.status))})}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t){(0,a.default)(this,e),this._sharedState=t,this._init()}return(0,s.default)(e,[{key:"_init",value:function(){var e=this;this.reset(),this._sharedState.eventBus.on("p2pUploadToggle",function(t){t||(e._p2pUploadAlwaysOn=!1)}),this._sharedState.eventBus.on("p2pDownloadToggle",function(t){t||(e._p2pDownloadAlwaysOn=!1)})}},{key:"reset",value:function(){this._p2pDownloadAlwaysOn=this._sharedState.isP2PDownloadOn,this._p2pUploadAlwaysOn=this._sharedState.isP2PUploadOn}},{key:"p2pDownloadAlwaysOn",get:function(){return this._p2pDownloadAlwaysOn}},{key:"p2pUploadAlwaysOn",get:function(){return this._p2pUploadAlwaysOn}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(70),u=r(l),c=n(29),d=n(3),f=r(d),h=function(){function e(t){(0,a.default)(this,e),this._peerCountStaircaseFunctionIntegral=new u.default,this._sameTrackPeerCountStaircaseFunctionIntegral=new u.default,this._abovePeerPoolLimitPeerCount=new u.default,this._abovePeerPoolLimitTime=new u.default,this._sharedState=t,t.eventBus.on(f.default.PeerPool.PEER_STATS_UPDATE,this._processPeerPoolStats,this),t.eventBus.on(f.default.PeerPool.PEER_OPEN,this._trackPeerCount,this),t.eventBus.on(f.default.PeerPool.PEER_DESTROYED,this._trackPeerCount,this)}return(0,s.default)(e,[{key:"_trackPeerCount",value:function(e){var t=e.peerCount,n=Math.max(0,t-this._sharedState.conf.PEER_POOL_LIMIT);this._abovePeerPoolLimitPeerCount.updateMetric(n),this._abovePeerPoolLimitTime.updateMetric(n>0?1:0)}},{key:"_processPeerPoolStats",value:function(e){var t=e.peerCount,n=e.sameTrackPeerCount;this._peerCountStaircaseFunctionIntegral.updateMetric(t),this._sameTrackPeerCountStaircaseFunctionIntegral.updateMetric(n)}},{key:"getAveragePeerCount",value:function(){return(0,c.toDecimal)(this._peerCountStaircaseFunctionIntegral.getAverage(),2)}},{key:"getSameTrackPeerCount",value:function(){return(0,c.toDecimal)(this._sameTrackPeerCountStaircaseFunctionIntegral.getAverage(),2)}},{key:"getUncorrectedAverageAboveLimitPeerCount",value:function(){return this._abovePeerPoolLimitPeerCount.getAverage()}},{key:"getAbovePeerPoolLimitTime",value:function(){return this._abovePeerPoolLimitTime.getIntegral().value}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(63),d=r(c),f=n(147),h=r(f),v=n(146),p=r(v),_=n(18),m=n(29),g=n(152),y=r(g),E=function(){function e(t,n){(0,s.default)(this,e);var r=n.conf,i=n.moduleState,a=n.status,o=n.transferStats,l=n.efficiencyStats,u=n.controlStats,c=n.bufferStats,f=n.abrStats;this._conf=r,this._status=a,this._transferStats=o,this._efficiencyStats=l,this._controlStats=u,this._abrStats=f,this._moduleState=i,this._bufferStats=c,this._analyticsClient=new d.default(n,"stats"),this._peerStats=n.peerStats,this._mediaStats=n.mediaStats,this._sessionStartTime=Date.now(),this._p2pUseful=new _.Delta,this._cdnDownloaded=new _.Delta,this._p2pConsumed=new _.Delta,this._cdnConsumed=new _.Delta,this._p2pMediaDownloaded=new _.Delta,this._p2pMessagesDownloaded=new _.Delta,this._p2pHeadersDownloaded=new _.Delta,this._p2pMessagesCount=new _.Delta,this._p2pUploaded=new _.Delta,this._PP=new _.Delta,this._PC=new _.Delta,this._CP=new _.Delta,this._CC=new _.Delta,this._HP=new _.Delta,this._HD=new _.Delta,this._M=new _.Delta,this._total=new _.Delta,this._concurrentP2pDownloaded=new _.Delta,this._concurrentP2pDownloadCount=new _.Delta,this._cdnEstimationCount=new _.Delta,this._p2pSpeedWindowsCount=new _.Delta,this._zeroP2pSpeedWindowsCount=new _.Delta,this._peerPoolObserver=new h.default(n),this._optionsObserver=new p.default(n),this._receivedChunkRequest=new _.Delta,this._missedDequeuedChunkRequest=new _.Delta,this._dequeuedReceivedChunkRequest=new _.Delta,this._sentSafeChunkRequest=new _.Delta,this._sentUnsafeChunkRequest=new _.Delta,this._timeoutSentSafeChunkRequest=new _.Delta,this._timeoutSentUnsafeChunkRequest=new _.Delta,this._gracedChunk=new _.Delta,this._expiredGraceChunk=new _.Delta,this._openedMatch=new _.Delta,this._openedOffer=new _.Delta,this._match=new _.Delta,this._excessMatch=new _.Delta,this._unansweredOffer=new _.Delta,this._offer=new _.Delta,this._active=new _.Delta,this._transfer=new _.Delta,this._denied=new _.Delta,this._droppedSameTrack=new _.Delta,this._droppedOtherTrack=new _.Delta,this._offerTimeout=new _.Delta,this._answerTimeout=new _.Delta,this._timeoutNewConnection=new _.Delta,this._timeoutCheckingConnection=new _.Delta,this._timeoutFailedConnection=new _.Delta,this._timeoutNewIce=new _.Delta,this._timeoutGatheringIce=new _.Delta,this._timeoutCompleteIce=new _.Delta,this._disconnected=new _.Delta,this._lateMessage=new _.Delta,this._timeoutLocalSdp=new _.Delta,this._timeoutRemoteSdp=new _.Delta,this._timeoutLocalSdpWithStun=new _.Delta,this._timeoutRemoteSdpWithStun=new _.Delta,this._timeoutWithLocalStunIce=new _.Delta,this._timeoutWithRemoteStunIce=new _.Delta,this._missedIceCandidate=new _.Delta,this._gatheredIceCandidate=new _.Delta,this._iceCandidatesBucket=new _.Delta,this._earlyIceGatheringFinished=new _.Delta,this._p2pSgtCheckSuccess=new _.Delta,this._p2pSgtCheckFail=new _.Delta,this._hybridSgtCheckSuccess=new _.Delta,this._hybridSgtCheckFail=new _.Delta,this._checkHeartbeatFailed=new _.Delta,this._getSegmentSuccess=new _.Delta,this._getSegmentFallback=new _.Delta,this._segmentLockTimeout=new _.Delta,this._fillSegmentSuccess=new _.Delta,this._fillSegmentFallback=new _.Delta,this._fillSegmentTimeout=new _.Delta,this._counterControl=0,this._timeSpentOnEdge=new _.Delta,this._timeSpentStatic=new _.Delta,this._timeSpentLow=new _.Delta,this._timeSpentHigh=new _.Delta,this._bufferedAmount=new _.Delta,this._bufferRefill=new _.Delta,this._abortFragmentCount=new _.Delta,this._emergencyTrackSwitchCount=new _.Delta,this._qosAnalyticsHandler=new y.default(t,n),this._feebackCount=new _.Delta,this._zeroDurationFeedbackCount=new _.Delta,this._lastPayloadTimestamps={},this._trackSwitchWithPeers=new _.Delta,this._sharedState=n}return(0,u.default)(e,[{key:"_getSessionDuration",value:function(){return Date.now()-this._sessionStartTime}},{key:"_getTimespanSinceLastPayload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return isNaN(this._lastPayloadTimestamps[e])?this._getSessionDuration():Date.now()-this._lastPayloadTimestamps[e]}},{key:"_updateLastPayloadTimestamp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";this._lastPayloadTimestamps[e]=Date.now()}},{key:"_getPeerStats",value:function(){var e=this._peerPoolObserver.getUncorrectedAverageAboveLimitPeerCount(),t=this._peerPoolObserver.getAbovePeerPoolLimitTime();return e=t>0?e*this._getTimespanSinceLastPayload()/t:0,{count:this._peerPoolObserver.getAveragePeerCount(),sameTrackCount:this._peerPoolObserver.getSameTrackPeerCount(),match:this._match.calcDelta(this._peerStats.match),excessMatch:this._excessMatch.calcDelta(this._peerStats.excessMatch),openedMatch:this._openedMatch.calcDelta(this._peerStats.openedMatch),openedOffer:this._openedOffer.calcDelta(this._peerStats.openedOffer),unansweredOffer:this._unansweredOffer.calcDelta(this._peerStats.unansweredOffer),offer:this._offer.calcDelta(this._peerStats.offer),locked:this._peerStats.locked.getAverage(),loosers:this._peerStats.loosers.getAverage(),active:this._active.calcDelta(this._peerStats.active),transfer:this._transfer.calcDelta(this._peerStats.transfer),denied:this._denied.calcDelta(this._peerStats.denied),droppedSameTrack:this._droppedSameTrack.calcDelta(this._peerStats.droppedSameTrack),droppedOtherTrack:this._droppedOtherTrack.calcDelta(this._peerStats.droppedOtherTrack),offerTimeout:this._offerTimeout.calcDelta(this._peerStats.offerTimeout),answerTimeout:this._answerTimeout.calcDelta(this._peerStats.answerTimeout),timeoutNewConnection:this._timeoutNewConnection.calcDelta(this._peerStats.timeoutNewConnection),timeoutCheckingConnection:this._timeoutCheckingConnection.calcDelta(this._peerStats.timeoutCheckingConnection),timeoutFailedConnection:this._timeoutFailedConnection.calcDelta(this._peerStats.timeoutFailedConnection),timeoutNewIce:this._timeoutNewIce.calcDelta(this._peerStats.timeoutNewIce),timeoutGatheringIce:this._timeoutGatheringIce.calcDelta(this._peerStats.timeoutGatheringIce),timeoutCompleteIce:this._timeoutCompleteIce.calcDelta(this._peerStats.timeoutCompleteIce),disconnected:this._disconnected.calcDelta(this._peerStats.disconnected),lateMessage:this._lateMessage.calcDelta(this._peerStats.lateMessage),maxPUC:this._peerStats.maxPUC,peerPoolUploadCapacity:this._peerStats.peerPoolUploadCapacity.getAverage(),exclusionSize:this._peerStats.exclusionSize,successPeerConnectionAttemptDuration:this._peerStats.successPeerConnectionAttemptDuration.fetchSample()||0,failedPeerConnectionAttemptDuration:this._peerStats.failedPeerConnectionAttemptDuration.fetchSample()||0,timeSpentAbovePeerLimit:t,averageOverLimitPeerCount:e,timeoutLocalSdp:this._timeoutLocalSdp.calcDelta(this._peerStats.timeoutLocalSdp),timeoutRemoteSdp:this._timeoutRemoteSdp.calcDelta(this._peerStats.timeoutRemoteSdp),timeoutLocalSdpWithStun:this._timeoutLocalSdpWithStun.calcDelta(this._peerStats.timeoutLocalSdpWithStun),timeoutRemoteSdpWithStun:this._timeoutRemoteSdpWithStun.calcDelta(this._peerStats.timeoutRemoteSdpWithStun),timeoutWithLocalStunIce:this._timeoutWithLocalStunIce.calcDelta(this._peerStats.timeoutWithLocalStunIce),timeoutWithRemoteStunIce:this._timeoutWithRemoteStunIce.calcDelta(this._peerStats.timeoutWithRemoteStunIce)}}},{key:"_getBufferStats",value:function(){if(this._bufferStats){var e=(0,m.toDecimal)(this._bufferStats.getTimeSpentOnEdgeRatio(),2),t=(0,m.toDecimal)(this._bufferStats.getTimeSpentWithoutPeerRatio(),2),n=(0,m.toDecimal)(this._bufferStats.getTimeSpentTopSeederRatio(),2),r=this._bufferStats.getTimeSpentDynamicIntegral(),i=r.intervalLength?(0,m.toDecimal)(r.value/r.intervalLength,2):(0,m.toDecimal)(r.value,2),a=(0,m.toDecimal)(1e3*this._bufferRefill.calcDelta(this._bufferStats.bufferRefill)/(r.value+this._bufferStats.bufferedAmount),2),o=this._bufferStats.alwaysDynamicBuffer;return{bufferState:this._bufferStats.bufferState,alwaysDynamicBuffer:o,timeSpentOnEdgeRatio:e,timeSpentWithoutPeerRatio:t,timeSpentDynamicRatio:i,timeSpentTopSeederRatio:n,bufferRefillRatio:a}}}},{key:"_getAbrStats",value:function(){var e=this._abrStats.p2pUsefulEstimate,t=this._concurrentP2pDownloaded.calcDelta(this._abrStats.concurrentP2pDownloaded),n=this._concurrentP2pDownloadCount.calcDelta(this._abrStats.concurrentP2pDownloadCount),r=this._cdnEstimationCount.calcDelta(this._abrStats.cdnEstimationCount),i=this._p2pSpeedWindowsCount.calcDelta(this._abrStats.p2pSpeedWindowsCount),a=this._zeroP2pSpeedWindowsCount.calcDelta(this._abrStats.zeroP2pSpeedWindowsCount),o=this._abrStats.bandwidthEstimateCV,s=this._feebackCount.calcDelta(this._abrStats.feebackCount),l=this._zeroDurationFeedbackCount.calcDelta(this._abrStats.zeroDurationFeedbackCount),u=this._trackSwitchWithPeers.calcDelta(this._abrStats.trackSwitchWithPeers);return this._abrStats.flushBandwidthEstimates(),{p2pUsefulEstimate:e,concurrentP2pDownloaded:t,concurrentP2pDownloadCount:n,cdnEstimationCount:r,p2pSpeedWindowsCount:i,zeroP2pSpeedWindowsCount:a,bandwidthEstimateCV:o,feebackCount:s,zeroDurationFeedbackCount:l,trackSwitchWithPeers:u}}},{key:"_calculateStatsPayload",value:function(){var e=this._status.getConnectedToSignalingServer(),t=this._status.getConnected(),n=this._status.getTrackerVersion(),r=this._status.getTrackerId(),i={PP:this._transferStats.multipleDlPP,PC:this._transferStats.multipleDlPC,CP:this._transferStats.multipleDlCP,CC:this._transferStats.multipleDlCC,HP:this._transferStats.multipleDlHP,HD:this._transferStats.multipleDlHD,M:this._transferStats.multipleDlM},o=i.PP+i.PC+i.CP+i.CC+i.HP+i.HD+i.M,s=this._cdnDownloaded.calcDelta(this._transferStats.cdnDownloaded),l=s,u=this._p2pUseful.calcDelta(this._transferStats.p2pUseful),c=this._p2pConsumed.calcDelta(this._transferStats.p2pConsumed),d=this._cdnConsumed.calcDelta(this._transferStats.cdnConsumed),f=this._p2pMediaDownloaded.calcDelta(this._transferStats.p2pMediaDownloaded),h=this._p2pHeadersDownloaded.calcDelta(this._transferStats.p2pHeadersDownloaded),v=this._p2pMessagesDownloaded.calcDelta(this._transferStats.p2pMessagesDownloaded),p=this._p2pMessagesCount.calcDelta(this._transferStats.p2pMessagesCount),_=this._p2pUploaded.calcDelta(this._transferStats.p2pUploaded),g={p2pMediaDownloaded:f,p2pHeadersDownloaded:h,p2pMessagesDownloaded:v,p2pMessagesCount:p,cdnDownloaded:s,p2pUseful:u,cdnUseful:l,p2pConsumed:c,cdnConsumed:d,p2pUploaded:_,multipleDl:{PP:this._PP.calcDelta(i.PP),PC:this._PC.calcDelta(i.PC),CP:this._CP.calcDelta(i.CP),CC:this._CC.calcDelta(i.CC),HP:this._HP.calcDelta(i.HP),HD:this._HD.calcDelta(i.HD),M:this._M.calcDelta(i.M),total:this._total.calcDelta(o)}},y=this._receivedChunkRequest.calcDelta(this._efficiencyStats.receivedChunkRequestCount),E=this._dequeuedReceivedChunkRequest.calcDelta(this._efficiencyStats.dequeuedReceivedChunkRequestCount),S=this._missedDequeuedChunkRequest.calcDelta(this._efficiencyStats.missedDequeuedChunkRequestCount),T=this._sentSafeChunkRequest.calcDelta(this._efficiencyStats.safeChunkRequestCount),b=this._sentUnsafeChunkRequest.calcDelta(this._efficiencyStats.unsafeChunkRequestCount),R=this._timeoutSentSafeChunkRequest.calcDelta(this._efficiencyStats.safeChunkRequestTimeoutCount),A=this._timeoutSentUnsafeChunkRequest.calcDelta(this._efficiencyStats.unsafeChunkRequestTimeoutCount),D=this._getTimespanSinceLastPayload(),k=D>0?Math.round(y*this._conf.CHUNK_SIZE*8/D):0,w=D>0?Math.round((T+b)*this._conf.CHUNK_SIZE*8/D):0,O=this._gracedChunk.calcDelta(this._efficiencyStats.gracedChunksCount),C=this._expiredGraceChunk.calcDelta(this._efficiencyStats.expiredGraceChunksCount),L={receivedChunkRequestBitrate:k,sentChunkRequestBitrate:w,receivedChunkRequestsMissedRatio:E>0?(0,m.toDecimal)(S/E,2):0,sentSafeChunkRequests:T,sentUnsafeChunkRequests:b,sentSafeChunkRequestsTimeout:R,sentUnsafeChunkRequestsTimeout:A,uploadQueueExpirationRatio:y>0?(0,m.toDecimal)(1-E/y,2):0,gracedChunks:O,expiredGraceChunks:C},P=this._abortFragmentCount.calcDelta(this._mediaStats.abortFragmentCount),I=this._emergencyTrackSwitchCount.calcDelta(this._mediaStats.emergencyTrackSwitchCount),M={emergencyTrackSwitchCPM:I/(D/6e4)};this._qosAnalyticsHandler.initialized&&(M=(0,a.default)(M,this._qosAnalyticsHandler.getQoSAnalytics()));var N=this._moduleState.isAlwaysDvr&&this._moduleState.isLive();this._moduleState.resetIsAlwaysDvr();var x={transfers:g,efficiency:L,qos:M,peers:this._getPeerStats(),buffer:this._getBufferStats(),abr:this._getAbrStats(),live:this._moduleState.isLive(),signalingServerConnected:e,trackerConnected:t,trackerVersion:n,trackerId:r,sessionDuration:this._getSessionDuration(),timespan:D,options:{p2pDownloadAlwaysOn:this._optionsObserver.p2pDownloadAlwaysOn,p2pUploadAlwaysOn:this._optionsObserver.p2pUploadAlwaysOn},confLabel:this._conf.CONF_LABEL,qosTester:this._conf.QOS_P2P_DISABLED,mediaDuration:Math.round(this._mediaStats.duration),videoTrackCount:this._mediaStats.videoTrackCount,abortFragmentCount:P,isAlwaysDvr:N};return this._updateLastPayloadTimestamp(),this._optionsObserver.reset(),x}},{key:"_calculateControlPayload",value:function(){var e=this._missedIceCandidate.calcDelta(this._controlStats.missedIceCandidateCount),t=this._gatheredIceCandidate.calcDelta(this._controlStats.gatheredIceCandidateCount),n=this._iceCandidatesBucket.calcDelta(this._controlStats.iceCandidatesBucketCount),r=this._earlyIceGatheringFinished.calcDelta(this._controlStats.earlyIceGatheringFinishedCount),i=n>0?(0,m.toDecimal)(e/n,2):0,a=n>0?(0,m.toDecimal)(t/n,2):0,o=n>0?r/n:0,s=this._controlStats.getSampledIceGatheringDuration(),l=this._p2pSgtCheckSuccess.calcDelta(this._controlStats.nbRightHashP2P),u=this._p2pSgtCheckFail.calcDelta(this._controlStats.nbWrongHashP2P),c=this._hybridSgtCheckSuccess.calcDelta(this._controlStats.nbRightHashDLM),d=this._hybridSgtCheckFail.calcDelta(this._controlStats.nbWrongHashDLM),f=this._checkHeartbeatFailed.calcDelta(this._controlStats.checkHeartbeatFailed),h=this._getSegmentSuccess.calcDelta(this._controlStats.getSegmentSuccess),v=this._getSegmentFallback.calcDelta(this._controlStats.getSegmentFallback),p=this._segmentLockTimeout.calcDelta(this._controlStats.segmentLockTimeout),_=this._fillSegmentSuccess.calcDelta(this._controlStats.fillSegmentSuccess),g=this._fillSegmentFallback.calcDelta(this._controlStats.fillSegmentFallback),y=this._fillSegmentTimeout.calcDelta(this._controlStats.fillSegmentTimeout),E={live:this._moduleState.isLive(),meanMissedIceCandidate:i,meanGatheredIceCandidate:a,earlyIceCandidateGatheringRatio:o,sampledIceGatheringDuration:s,p2pSgtCheckSuccess:l,p2pSgtCheckFail:u,hybridSgtCheckSuccess:c,hybridSgtCheckFail:d,checkHeartbeatFailed:f,getSegmentSuccess:h,getSegmentFallback:v,segmentLockTimeout:p,fillSegmentSuccess:_,fillSegmentFallback:g,fillSegmentTimeout:y,sessionDuration:this._getSessionDuration(),timespan:this._getTimespanSinceLastPayload("control"),confLabel:this._conf.CONF_LABEL};return this._updateLastPayloadTimestamp("control"),E}},{key:"sendStats",value:function(){var e=this._calculateStatsPayload();e.timespan<2*this._conf.ANALYTICS.STATS_INTERVAL&&this._analyticsClient.send(e)}},{key:"sendControl",value:function(){var e=this._calculateControlPayload();e.timespan<2*this._conf.ANALYTICS.CONTROL_INTERVAL&&this._analyticsClient.send(e,"control")}},{key:"dispose",value:function(){this._qosAnalyticsHandler.dispose()}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(63),u=r(l),c=n(18),d=n(3),f=r(d),h=function(){function e(t){(0,a.default)(this,e);var n=t.moduleState,r=t.transferStats,i=t.eventBus;this._analyticsClient=new u.default(t,"traffic"),this._moduleState=n,this._transferStats=r,this._p2p=new c.Delta,this._cdn=new c.Delta,this._upload=new c.Delta,this._lastPayloadTimestamp=Date.now(),i.once(f.default.Media.ENDED,this.sendUsage.bind(this))}return(0,s.default)(e,[{key:"_calculateUsagePayload",value:function(){var e=this._p2p.calcDelta(this._transferStats.p2pUseful),t=this._cdn.calcDelta(this._transferStats.cdnDownloaded),n=this._upload.calcDelta(this._transferStats.p2pUploaded),r=this._getTimespanSinceLastPayload(),i={live:this._moduleState.isLive(),cdn:t,p2p:e,upload:n,timespan:r};return this._updateLastPayloadTimestamp(),i}},{key:"_getTimespanSinceLastPayload",value:function(){return Date.now()-this._lastPayloadTimestamp}},{key:"_updateLastPayloadTimestamp",value:function(){this._lastPayloadTimestamp=Date.now()}},{key:"sendUsage",value:function(e){var t=this._calculateUsagePayload();e&&(t.unload=!0),this._analyticsClient.send(t,"usage")}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e),this._mediaElement=null}return(0,s.default)(e,[{key:"mediaElement",get:function(){return this._mediaElement},set:function(e){this._mediaElement=e}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(18),u=n(29),c=function(){function e(){(0,a.default)(this,e),this._timeSpentPlayingDelta=new l.Delta,this._timeSpentPausedDelta=new l.Delta,this._timeSpentRebufferingDelta=new l.Delta,this._timeSpentSeekingDelta=new l.Delta,this._timeSpentEndedDelta=new l.Delta,this._rebufferingCountDelta=new l.Delta,this._lastTimeDelta=new l.Delta(Date.now()),this._droppedFrameCountDelta=new l.Delta,this._trackSwitchCountDelta=new l.Delta}return(0,s.default)(e,[{key:"_normalizePerMinute",value:function(e,t,n){var r=this._lastTimeDelta.calcDelta(Date.now()),i=this._rebufferingCountDelta.calcDelta(e),a=i/(r/6e4),o=this._droppedFrameCountDelta.calcDelta(t),s=o/(r/6e4),l=this._trackSwitchCountDelta.calcDelta(n),c=l/(r/6e4);return{rebufferingCPM:(0,u.toDecimal)(a,2),droppedFrameCPM:(0,u.toDecimal)(s,2),trackSwitchCPM:(0,u.toDecimal)(c,2)}}},{key:"format",value:function(e,t){var n=this._normalizePerMinute(e.rebufferingCount,e.droppedFrameCount,t);return{rebufferingCPM:n.rebufferingCPM,droppedFrameCPM:n.droppedFrameCPM,trackSwitchCPM:n.trackSwitchCPM,timeSpentPlaying:(0,u.toDecimal)(this._timeSpentPlayingDelta.calcDelta(e.timeSpentPlaying),2),timeSpentPaused:(0,u.toDecimal)(this._timeSpentPausedDelta.calcDelta(e.timeSpentPaused),2),timeSpentEnded:(0,u.toDecimal)(this._timeSpentEndedDelta.calcDelta(e.timeSpentEnded),2),timeSpentRebuffering:(0,u.toDecimal)(this._timeSpentRebufferingDelta.calcDelta(e.timeSpentRebuffering),2),timeSpentSeeking:(0,u.toDecimal)(this._timeSpentSeekingDelta.calcDelta(e.timeSpentSeeking),2),startupTime:e.startupTime,endedOnce:e.endedOnce}}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(130),u=r(l),c=n(151),d=r(c),f=n(4),h=n(3),v=r(h),p=function(){function e(t,n){(0,a.default)(this,e),this._trackSwitchCount=-1,n.eventBus.on(v.default.Metrics.TRACK_SWITCH,this._onTrackSwitch.bind(this)),null!==t.mediaElement&&(this._initialized=!0,this._qosAnalytics=new u.default(t.mediaElement,f.createInterval),this._qoSAnalyticsFormatter=new d.default)}return(0,s.default)(e,[{key:"_onTrackSwitch",value:function(){this._trackSwitchCount++}},{key:"getQoSAnalytics",value:function(){if(!this._initialized)throw new Error("getQoSAnalytics was called on non-initialized QoSAnalyticsHandler");var e=this._qosAnalytics.getQoSAnalytics();return this._qoSAnalyticsFormatter.format(e,this._trackSwitchCount)}},{key:"dispose",value:function(){this._qosAnalytics&&this._qosAnalytics.dispose()}},{key:"initialized",get:function(){return this._initialized}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(24),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(94),d=r(c),f=function(){function e(){(0,s.default)(this,e),this._scriptOrigin=null,this._metadata={}}return(0,u.default)(e,[{key:"_onErrorListener",value:function(e){e.filename&&e.filename===this._scriptOrigin&&this.notifyError(new d.default(e))}},{key:"notify",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];throw new Error("AbstractError#notify should be implemented")}},{key:"notifyError",value:function(e,t){throw new Error("AbstractError#notifyError should be implemented")}},{key:"_getAppVersion",value:function(){return"4.9.3".split("-")[0]}},{key:"setMetadata",value:function(e){(0,a.default)(this._metadata,e)}},{key:"setScriptOrigin",value:function(e){this._scriptOrigin=e}},{key:"setCustomer",value:function(e){}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(153),p=r(v),_=n(17),m=n(94),g=(r(m),function(e){function t(){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,u.default)(t,[{key:"notify",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"warning";(0,_.nativeError)("["+n+"] "+e+" - "+t)}},{key:"notifyError",value:function(e){(0,_.nativeError)(e)}}]),t}(p.default));t.default=new g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(110),a=r(i),o=n(39),s=r(o),l=n(0),u=r(l),c=n(1),d=r(c),f=n(4),h=n(29),v=n(67),p=r(v),_=n(226),m={GET:"GET",POST:"POST"},g={JSON:"json",ARRAY_BUFFER:"arraybuffer"},y={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},E={INVALID_STATUS:"Response status is not part of valid status codes",REQUEST_ABORTED:"Request has been aborted",REQUEST_ERROR:"An error occured while sending the request",REQUEST_TIMEOUT:"Request timeout"},S=function(){function e(t,n,r){(0,u.default)(this,e),this._method=t,this._url=n,this._retryCount=0,this._aborted=!1,this._options=p.default.merge({responseType:e.ResponseTypes.JSON,validStatusCodes:[].concat((0,s.default)((0,h.range)(200,206)),[304]),timeout:0,retry:0,retryDelay:0,withCredentials:!1,headers:{},events:{onprogress:_.noop}},r)}return(0,d.default)(e,[{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new a.default(function(n,r){function i(){var e=this;this._send(t).then(function(e){n(e)}).catch(function(t){if(e._retryCount===e._options.retry)return void r(t);e._retryCount++,(0,f.createTimeout)(function(){e._init(),i.call(e)},e._options.retryDelay)})}i.call(e)})}},{key:"abort",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"_send",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"_init",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"isStreamroot",set:function(e){this._isStreamrootEndpoint=e}}]),e}();S.Methods=m,S.ResponseTypes=g,S.ReadyStates=y,S.Errors=E,t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,a.default)(this,e),this._message=t,this._status=n}return(0,s.default)(e,[{key:"message",get:function(){return this._message}},{key:"status",get:function(){return this._status}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(110),a=r(i),o=n(7),s=r(o),l=n(0),u=r(l),c=n(1),d=r(c),f=n(10),h=r(f),v=n(9),p=r(v),_=n(14),m=r(_),g=n(61),y=r(g),E=n(155),S=r(E),T=n(17),b=n(65),R=r(b),A=n(6),D=r(A),k=n(156),w=r(k),O=n(158),C=r(O),L=new m.default,P=function(e){function t(e,n,r){(0,u.default)(this,t);var i=(0,h.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e,n,r));return i._aborted=!1,i._id="http-request-"+y.default.v4(),i}return(0,p.default)(t,e),(0,d.default)(t,[{key:"_send",value:function(e){var t=this;L.set(this._id,this);var n={id:this._id,method:this._method,url:this._url,response_type:this._options.responseType,headers:this._options.headers,with_credentials:this._options.withCredentials,valid_status_codes:this._options.validStatusCodes,isStreamrootEndpoint:this._isStreamrootEndpoint,body:e};return(0,T.nativeCall)("send_http_request",n),new a.default(function(e,n){t._onSuccess=e,t._onFailure=n})}},{key:"abort",value:function(){var e={id:this._id};this._aborted=!0,(0,T.nativeCall)("abort_http_request",e)}}],[{key:"progress",value:function(e,t,n){var r=L.get(e),i=void 0,a=parseInt(t,10);i=""!==n?new C.default(!0,a,parseInt(n,10)):new C.default(!1,a,0),r?r._options.events.onprogress(i):D.default.notifyError(new Error("Cannot get httpRequest with given id"))}},{key:"dataResponse",value:function(e,n,r,i,a){var o=new R.default(n,parseInt(r,10)),s=L.get(e);s?(s._aborted?s._onFailure(new w.default(t.Errors.REQUEST_ABORTED)):a?s._onFailure(new w.default(a,i)):s._onSuccess(o),L.delete(e)):D.default.notifyError(new Error("Cannot get httpRequest with given id"))}},{key:"jsonResponse",value:function(e,t,n,r){var i=t&&""!==t?JSON.parse(t):null,a=L.get(e);a?(r?a._onFailure(new w.default(r,n)):a._onSuccess(i),L.delete(e)):D.default.notifyError(new Error("Cannot get httpRequest with given id"))}}]),t}(S.default);t.default=P,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t,n,r){(0,a.default)(this,e),this._lengthComputable=t,this._loaded=n,this._total=r}return(0,s.default)(e,[{key:"lengthComputable",get:function(){return this._lengthComputable}},{key:"loaded",get:function(){return this._loaded}},{key:"total",get:function(){return this._total}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(160),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e){var t=[],n=e,r=function(){for(var e=-1,r=Date.now(),i=0;i<t.length&&r-t[i].timestamp()>n;i++)e=i;return e},a=function(){var e=r();e>-1&&t.splice(0,e+1)},o=function(e){a();var n=new i.default(e);t.push(n)},s=function(){if(a(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e/t.length},l=function(){if(a(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e};this.addPoint=o,this.compute=s,this.computeSum=l};t.default=a,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){var t=e,n=Date.now();this.timestamp=function(){return n},this.value=function(){return t}};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=new o.default(e.conf.BITRATE_ESTIMATION_WINDOW);e.eventBus.on(l.default.SRModuleInterface.ABR_FEEDBACK,function(){t.push(e.transferStats.p2pConsumed+e.transferStats.cdnConsumed);var n=t.delta,r=t.timeDelta;n&&r&&(e.abrStats.estimatedBitrate=8*n/r)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var a=n(69),o=r(a),s=n(3),l=r(s);e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n.USE_COMBINED_ABR_FEEDBACK){var r=e.cdnDownloaded+e.p2pDownloaded,i=e.cdnDownloaded/r,a=void 0;if(i<n.ABR_SEGMENT_CDN_RATIO_THRESHOLD||e.cdnDownloaded<n.ABR_CDN_DL_THRESHOLD){var o=void 0;if(null!==t.cdnTimestamp){var s=Date.now()-t.cdnTimestamp,l=Math.max(0,1-s/n.ABR_CDN_DL_DECAY_TIME);o=(1-l)*t.p2pSpeed+l*t.cdnSpeed}else o=t.p2pSpeed;a=8*r/o}else a=8*e.cdnDownloaded/t.cdnSpeed/i;e.p2pDuration=(1-i)*a,e.cdnDuration=i*a}else t.p2pSpeed>0?e.p2pDuration=8*e.p2pDownloaded/t.p2pSpeed:e.p2pDuration=0,null!==t.cdnSpeed?e.cdnDuration=8*e.cdnDownloaded/t.cdnSpeed:e.cdnDuration=0},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(39),a=r(i),o=n(11),s=r(o),l=n(7),u=r(l),c=n(0),d=r(c),f=n(1),h=r(f),v=n(10),p=r(v),_=n(9),m=r(_),g=n(103),y=r(g),E=n(3),S=r(E),T=n(6),b=r(T),R=n(4),A=function(e){function t(e,n){(0,d.default)(this,t);var r=[],i=(0,p.default)(this,(t.__proto__||(0,u.default)(t)).call(this,r));return i._peerIds=r,i._peerConnector=e,i._sharedState=n,i._sharedState.eventBus.on(S.default.Metrics.TRACK_SWITCH,i._onTrackSwitch,i),i}return(0,m.default)(t,e),(0,h.default)(t,[{key:"dispose",value:function(){this._tryDequeueTimer&&this._tryDequeueTimer.clear(),this._sharedState.eventBus.removeListener(S.default.Metrics.TRACK_SWITCH,this._onTrackSwitch,this)}},{key:"flush",value:function(){this._sharedState.peerStats.excessMatch+=this._peerIds.length,this._peerIds.length=0}},{key:"onPeersFromTracker",value:function(e,t){if(null!==e)return void b.default.notify("Error asking peers from tracker:",e.message);var n=[],r=!0,i=!1,o=void 0;try{for(var l,u=(0,s.default)(t);!(r=(l=u.next()).done);r=!0){var c=l.value,d=c.peers;n.push.apply(n,(0,a.default)(d))}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}if(!(n.length<1)){this.flush(),this._sharedState.peerStats.match+=n.length;var f=!0,h=!1,v=void 0;try{for(var p,_=(0,s.default)(n);!(f=(p=_.next()).done);f=!0){var m=p.value;this.push(m)}}catch(e){h=!0,v=e}finally{try{!f&&_.return&&_.return()}finally{if(h)throw v}}void 0===this._tryDequeueTimer&&this._createTryDequeueTimer()}}},{key:"_onTrackSwitch",value:function(e){e.isVideo&&this.flush()}},{key:"_createTryDequeueTimer",value:function(){this._tryDequeueTimer=(0,R.createInterval)(this._onTryDequeueTimer.bind(this),this._sharedState.conf.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL)}},{key:"_onTryDequeueTimer",value:function(){for(var e=Math.min(this._peerIds.length,this._peerConnector.getOpenConnectorSlotsCount()),t=0;t<e;t++)this.tryDequeue()}},{key:"_canDequeue",value:function(){return this._peerIds.length>0&&this._peerConnector.getOpenConnectorSlotsCount()>this._sharedState.conf.RESERVED_OFFER_SLOTS}},{key:"_dequeuedCallback",value:function(e){this._peerConnector.createPeerConnection(e)}}]),t}(y.default);t.default=A,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(4),d=n(195),f=r(d),h=n(3),v=r(h),p=n(48),_=r(p),m=function(){function e(t,n,r){var i=this;(0,s.default)(this,e),this._wasLowBuffer=!1,this._lowToHighBufTargetTimestamp=a.default,this._p2pCache=t,this._scheduler=n,this._sharedState=r,this._sharedState.eventBus.once(v.default.Distributor.READY,function(){i._timer=(0,c.createInterval)(i._scheduleChunkDownloads.bind(i),i._sharedState.conf.CHUNK_BATCHING_INTERVAL)})}return(0,u.default)(e,[{key:"dispose",value:function(){this._timer&&this._timer.clear()}},{key:"_scheduleChunkRequestsForSegment",value:function(e,t,n,r){for(var i=t.seeders.all(),a=i.length,o=0;o<a;o++){for(var s=i[o],l=n.getOrCreate(s);l[r]>0&&t.hasChunksToDownload;){var u=t.chunkManager.getNextChunks(s,l[r],r);l[r]-=u.size,s.requestChunks(e,u.encoded,r,t.chunkManager)}if(!t.hasChunksToDownload)break}}},{key:"_scheduleChunkDownloads",value:function(){for(var e=new f.default(this._sharedState.conf.CHUNK_BATCHING_INTERVAL),t=this._scheduler.getSegmentListToDownload().slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER),n=t.length,r=0;r<n;r++){var i=t[r],a=this._p2pCache.getOrCreateSegmentHandler(i);this._sharedState.isP2PDownloadOn&&a.hasChunksToDownload&&!this._sharedState.isP2PDownloadBlocked&&(this._scheduleChunkRequestsForSegment(i,a,e,_.default.SAFE),this._scheduleChunkRequestsForSegment(i,a,e,_.default.UNSAFE))}}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(34),u=r(l),c=n(181),d=r(c),f=n(96),h=r(f),v=1,p=-1,_={PENDING:"pending",DOWNLOADING:"downloading",DOWNLOADED:"downloaded",CDN_DOWNLOADED:"CDNdownloaded",FAILED:"failed"},m=function(){function e(t,n,r,i,o){(0,a.default)(this,e),this._sharedState=o,this._conf=o.conf,this._transferStats=o.transferStats,this._efficiencyStats=o.efficiencyStats,this._controlStats=o.controlStats,this._workerHelper=o.workerHelper,this._p2pCache=n,this._dataLocked=!1,this._downloadStatus=[],this._writeLock=!1,this._isEmpty=!0,this._partialSegmentRequested=!1,this._broadcastedSegmentInfoCalled=!1,this._segmentCoord=t,this._peerPool=r,this._segmentInfoMap=i,this._ee=new u.default,1||(this.downloadStatus=this._downloadStatus)}return(0,s.default)(e,[{key:"getEE",value:function(){return this._ee}},{key:"setSegmentSize",value:function(e){if(!this.size){this.size=e;for(var t=Math.ceil(this.size/this._conf.CHUNK_SIZE),n=0;n<t;n++)this._downloadStatus.push(_.PENDING);this.segment=new h.default(e)}}},{key:"getNumberOfChunks",value:function(){return this._downloadStatus.length}},{key:"getChunk",value:function(e,t){if(!this._dataLocked&&this._isChunkP2POrCDNDownloaded(e)){var n=this._conf.CHUNK_SIZE,r=e*this._conf.CHUNK_SIZE;r+n>this.size&&(n=this.size-r),this.segment.getBinaryData(r,n,t)}else this._dataLocked&&console.warn("locked data, not sending"),t(null)}},{key:"_getConsecutiveChunksCount",value:function(e,t,n){for(var r=1,i=t===v?0:e.length-1,a=t===v?e.length-1:0,o=i;o!==a;o+=t){var s=o+t;if(s>=0&&s<=e.length-1){if(1!==Math.abs(e[o]-e[s])||r===n)break;r++}}return r}},{key:"_getRemainingChunks",value:function(){for(var e=[],t=0,n=this._downloadStatus.length;t<n;t++)this._downloadStatus[t]!==_.FAILED&&this._downloadStatus[t]!==_.PENDING||e.push(t);return e}},{key:"_encodePartialBatchStr",value:function(e,t){var n=e;return e&&(n+=","),n+=""+t[0],t.length>1&&(n+="-"+t[t.length-1]),n}},{key:"getNextChunks",value:function(e,t){for(var n="",r=t,i=this._getRemainingChunks();i.length>0&&r>0;){var a=i[0],o=i[i.length-1],s=void 0,l=void 0;if(this._downloadStatus.length-1-o===a){var u=this._getConsecutiveChunksCount(i,v,r),c=this._getConsecutiveChunksCount(i,p,r);l=Math.max(u,c),s=l===u?v:p}else s=this._downloadStatus.length-1-o>a?v:p,l=this._getConsecutiveChunksCount(i,s,r);var d=s===v?0:i.length-l,f=i.splice(d,l);f=s===v?f:f.reverse(),n=this._encodePartialBatchStr(n,f),r-=f.length;for(var h=0,m=f.length;h<m;h++)this._downloadStatus[f[h]]=_.DOWNLOADING}return{encoded:n,size:t-r}}},{key:"chunkDownloaded",value:function(e,t){if(!this.segment||t>=this._downloadStatus.length)return void(this._transferStats.multipleDlM+=e.byteLength);if(this._isEmpty=!1,this._isChunkP2POrCDNDownloaded(t)||this._writeLock){var n=this._downloadStatus[t];n===_.DOWNLOADED?this._transferStats.multipleDlPP+=e.byteLength:(n===_.CDN_DOWNLOADED||this._writeLock)&&(this._transferStats.multipleDlCP+=e.byteLength)}else this._downloadStatus[t]=_.DOWNLOADED,this.segment.setBinaryData(e,t*this._conf.CHUNK_SIZE),(this._sharedState.moduleState.isLive()&&this._conf.ALLOW_LIVE_PUSH_SEGMENT||!this._sharedState.moduleState.isLive()&&this._conf.ALLOW_VOD_PUSH_SEGMENT)&&this._broadcastSegmentInfo(),this.isSegmentDownloaded()&&(this._p2pCache.getSegmentHandler(this._segmentCoord).seeders.clear(),this.lockSegmentData(),this._checkHashP2P(this.segment))}},{key:"timeout",value:function(e){this._downloadStatus[e]===_.DOWNLOADING&&(this._downloadStatus[e]=_.FAILED)}},{key:"isSegmentDownloaded",value:function(){var e=this;return!!this.size&&this._downloadStatus.every(function(t,n){return e._isChunkP2POrCDNDownloaded(n)})}},{key:"shouldDownloadSegment",value:function(){return!this.isSegmentDownloaded()&&!this.partialSegment&&!this._partialSegmentRequested}},{key:"getPartialSegment",value:function(){var e=this;return this._partialSegmentRequested=!0,!(this._isEmpty||!this.size)&&(function(){e.partialSegment||e._dataLocked||(e.partialSegment=new d.default(e._segmentCoord,e._p2pCache,e.segment,e._downloadStatus,e.size,e,e.isSegmentDownloaded(),e._segmentInfoMap,e._sharedState))}(),this._dataLocked||(this._writeLock=!0),this.partialSegment)}},{key:"getPercentageOfChunksDownloaded",value:function(){var e=this;return this._downloadStatus.reduce(function(t,n,r){return t+(e._isChunkP2POrCDNDownloaded(r)?100*(1/e.getNumberOfChunks()):0)},0)}},{key:"storeSegment",value:function(e){this._isEmpty=!1,this.size||this.setSegmentSize(e.byteLength),this.segment=e,this._updateDownloadStatus();var t=this.getP2PAndCDNDownloads();this._transferStats.p2pUseful+=t.p2pDownloaded}},{key:"_broadcastSegmentInfo",value:function(){var e=this.getPercentageOfChunksDownloaded();!this._broadcastedSegmentInfoCalled&&e>=this._conf.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER&&(this._broadcastedSegmentInfoCalled=!0,this._peerPool.broadcastSegmentInfo(this._segmentCoord))}},{key:"_updateDownloadStatus",value:function(){var e=void 0;e={start:0,end:this.getNumberOfChunks()},this.partialSegment&&this.partialSegment.getCDNIndexRange()&&(e=this.partialSegment.getCDNIndexRange());for(var t=e.start;t<e.end;t++){if(this._isChunkP2POrCDNDownloaded(t)){var n=this._conf.CHUNK_SIZE;t===this.getNumberOfChunks()-1&&(n=this.size-(this.getNumberOfChunks()-1)*this._conf.CHUNK_SIZE),this._downloadStatus[t]===_.DOWNLOADED?this._transferStats.multipleDlPC+=n:this._downloadStatus[t]===_.CDN_DOWNLOADED&&(this._transferStats.multipleDlCC+=n)}this._downloadStatus[t]=_.CDN_DOWNLOADED}}},{key:"getP2PAndCDNDownloads",value:function(){var e=0,t=0,n=this.getNumberOfChunks()-1;if(this.size)for(var r=0;r<this._downloadStatus.length;r++){var i=void 0,a=this._downloadStatus[r];i=r<n?this._conf.CHUNK_SIZE:this.size-n*this._conf.CHUNK_SIZE,a===_.DOWNLOADED?e+=i:a===_.CDN_DOWNLOADED&&(t+=i)}return{p2pDownloaded:e,cdnDownloaded:t}}},{key:"lockSegmentData",value:function(){this._dataLocked=!0}},{key:"unlockSegmentData",value:function(){this._dataLocked=!1}},{key:"removePartialSegment",value:function(){delete this.partialSegment}},{key:"_checkHashP2P",value:function(e){var t=this,n=this._segmentInfoMap.getSegmentInfo(this._segmentCoord),r=function(e,r){n.hash===r?(t._controlStats.nbRightHashP2P++,t.segment=new h.default(e),t._transferStats.p2pUseful+=t.size,t.unlockSegmentData()):(t._controlStats.nbWrongHashP2P++,t._p2pCache.removeSegmentHandler(n.segmentCoord),t._transferStats.multipleDlHP+=t.size)};e.getBinaryData(0,e.byteLength,function(e){t._workerHelper.callHashWorker(e,r)})}},{key:"_isChunkP2POrCDNDownloaded",value:function(e){var t=this._downloadStatus[e];return t===_.DOWNLOADED||t===_.CDN_DOWNLOADED}},{key:"hasChunksToDownload",get:function(){return this._downloadStatus.indexOf(_.FAILED)>=0||this._downloadStatus.indexOf(_.PENDING)>=0}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(73),a=r(i),o=n(11),s=r(o),l=n(14),u=r(l),c=n(0),d=r(c),f=n(1),h=r(f),v=n(68),p=function(){function e(t,n){(0,d.default)(this,e),this._segmentListMap=new u.default,this._conf=n.conf;for(var r=t.getTrackList(),i=0;i<r.length;i++)this._segmentListMap.set(r[i],[])}return(0,h.default)(e,[{key:"insert",value:function(e){var t=this._getMatchingTrack(e),n=(0,v.unwrap)(this._segmentListMap.get(t));if(0===n.length)n.push(e);else if(n[0].getId()>e.getId())n.unshift(e);else for(var r=n.length;r>0;r--)if(e.getId()>n[r-1].getId()){n.splice(r,0,e);break}var i=n.length;if(i>this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH){var a=n.slice(i-this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH);this._segmentListMap.set(t,a)}}},{key:"getSegmentListAfter",value:function(e){var t=this._getMatchingTrack(e),n=(0,v.unwrap)(this._segmentListMap.get(t)),r=n.filter(function(t){return t.getId()>e.getId()});return this._segmentListMap.set(t,r),r}},{key:"_getMatchingTrack",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,s.default)(this._segmentListMap);!(t=(i=o.next()).done);t=!0){var l=(0,a.default)(i.value,1),u=l[0];if(e.isInTrack(u))return u}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}throw new Error("The segment "+e.viewToString()+" belongs to no track")}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.conf.DISTRIBUTOR.URL,n=e.conf.ID_CLIENT,r=e.moduleState.content,i="4.9.3",a=t+"?customer="+n+"&content="+r+"&version="+i,s={timeout:e.conf.DISTRIBUTOR.TIMEOUT_DELAY,retry:e.conf.DISTRIBUTOR.MAX_RETRY},u=new o.default(o.default.Methods.GET,a,s);u.isStreamroot=!0,u.send().then(function(t){e.injectConfigFromDistributor(t),e.eventBus.emit(c.default.Distributor.READY)}).catch(function(t){e.conf.DISTRIBUTOR.OVERRIDDEN||(e.setBackendFallbackUrls(),e.eventBus.emit(c.default.Distributor.READY)),l.default.notifyError(new Error("Could not connect to distributor: "+t.message+". Status: "+t.status))})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(35),o=r(a),s=n(6),l=r(s),u=n(3),c=r(u);t.default={connect:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(95),p=r(v),_=n(4),m=n(48),g=r(m),y=function(e){function t(e,n,r,i,o,l){(0,s.default)(this,t);var u=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,l));u._chunkManager=o,u._peer=r,u._sharedState=i;var c=i.moduleState.isLive()?i.conf.LIVE.CHUNK_TIMEOUT:i.conf.CHUNK_TIMEOUT;return u._timeoutTimer=(0,_.createTimeout)(function(){u._chunkTimedOut()},c),u._timedOut=!1,u}return(0,h.default)(t,e),(0,u.default)(t,[{key:"isEqual",value:function(e){return this.id===e.id}},{key:"_chunkTimedOut",value:function(){this._timedOut=!0,this._chunkManager.timeout(this._chunkIndex,this._bandwidthSafety),this._bandwidthSafety===g.default.SAFE?(this._sharedState.efficiencyStats.safeChunkRequestCount++,this._sharedState.efficiencyStats.safeChunkRequestTimeoutCount++):this._bandwidthSafety===g.default.UNSAFE&&(this._sharedState.efficiencyStats.unsafeChunkRequestCount++,this._sharedState.efficiencyStats.unsafeChunkRequestTimeoutCount++),this._peer.timeoutChunk(this)}},{key:"dataDownloaded",value:function(e){this._chunkManager.chunkDownloaded(e,this._chunkIndex),this._timedOut||(this._bandwidthSafety===g.default.SAFE?this._sharedState.efficiencyStats.safeChunkRequestCount++:this._bandwidthSafety===g.default.UNSAFE&&this._sharedState.efficiencyStats.unsafeChunkRequestCount++,this._timeoutTimer.clear())}},{key:"id",get:function(){return t.getIdOf(this._segmentCoord,this._chunkIndex)}},{key:"timestamp",get:function(){return this._timestamp}}],[{key:"getIdOf",value:function(e,t){return e.viewToString()+"C"+t}}]),t}(p.default);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(49),a=r(i),o=n(39),s=r(o),l=n(73),u=r(l),c=n(11),d=r(c),f=n(14),h=r(f),v=n(0),p=r(v),_=n(1),m=r(_),g=function(){function e(t,n,r){(0,p.default)(this,e),this._peerPool=t,this._peerConnector=n,this._secondOrderExclusions=new h.default,this._sharedState=r}return(0,m.default)(e,[{key:"addSecondOrderExclusion",value:function(e,t,n,r){this._secondOrderExclusions.set(e,{rank:t,releaseTimestamp:Date.now()+n,tag:r})}},{key:"_clearExpiredExclusions",value:function(){var e=Date.now(),t=!0,n=!1,r=void 0;try{for(var i,a=(0,d.default)(this._secondOrderExclusions.entries());!(t=(i=a.next()).done);t=!0){var o=(0,u.default)(i.value,2),s=o[0];o[1].releaseTimestamp<=e&&this._secondOrderExclusions.delete(s)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"exclusionList",get:function(){this._clearExpiredExclusions();var e=this._peerConnector.getPendingConnectionPeers(),t=!0,n=!1,r=void 0;try{for(var i,o=(0,d.default)(this._peerPool.getPeerArray());!(t=(i=o.next()).done);t=!0){var l=i.value;e.push(l.getId())}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var c=this._sharedState.conf.MAX_TRACKER_EXCLUSION_LENGTH-e.length;if(c>=this._secondOrderExclusions.size)return[].concat((0,s.default)(e),(0,s.default)(this._secondOrderExclusions.keys()));var f=Date.now(),h=(0,a.default)(this._secondOrderExclusions.entries());h.sort(function(e,t){var n=(0,u.default)(e,2),r=(n[0],n[1]),i=(0,u.default)(t,2),a=(i[0],i[1]);return(a.releaseTimestamp-f)*a.rank-(r.releaseTimestamp-f)*r.rank});var v=h.map(function(e){var t=(0,u.default)(e,2),n=t[0];t[1];return n});return[].concat((0,s.default)(e),(0,s.default)(v.slice(0,c)))}},{key:"secondOrderExclusions",get:function(){return this._clearExpiredExclusions(),this._secondOrderExclusions}}]),e}();t.default=g,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(39),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e){var t=[],n=[],r=e,a={},o=function(e,n){t.push({eventName:e,fn:n}),r.addEventListener(e,n)},s=function(e,t){n.push({eventName:e,fn:t}),window.addEventListener(e,t)},l=function(){for(var e=0;e<t.length;e++){var n=t[e].eventName,i=t[e].fn;r.removeEventListener(n,i)}t=[]},u=function(){for(var e=0;e<n.length;e++){var t=n[e].eventName,r=n[e].fn;window.removeEventListener(t,r)}n=[]},c=function(){l(),u()},d=function(e){function t(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];a[e].arguments=n}return a[e]={arguments:void 0,handler:t},t},f=function(e){if(e in a&&!1)throw new Error("you should not use cacheMediaEvent twice on the same event");r.addEventListener(e,d(e))},h=function(e,t){if(!a[e]||!a[e].arguments)throw new Error("You are trying to trigger an event that have not been cached before");r.removeEventListener(e,a[e].handler),a[e].arguments&&t.apply(void 0,(0,i.default)(a[e].arguments))};this.addMediaEventListener=o,this.addWindowEventListener=s,this.removeAllExternalEventListener=c,this.cacheMediaEvent=f,this.triggerCachedEvent=h,1||(this.removeAllWindowEventListener=u,this.removeAllMediaEventListener=l)};t.default=a,e.exports=t.default},function(e,t,n){"use strict";e.exports={TRACK_CHANGE_EVENT:"onTrackChange",EMERGENCY_FRAG_LOAD_ABORT:"onEmergencyFragLoadAborted"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n,r){this.city=e,this.country=t,this.latitude=n,this.longitude=r};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(68),d=function(){function e(t,n){(0,s.default)(this,e),this._mediaMap=t,this._conf=n.conf,this._cachedSegmentList=new a.default,this._cachedSegmentTime=new a.default}return(0,u.default)(e,[{key:"getSegmentList",value:function(e,t,n){var r=this._cachedSegmentList.get(e.viewToString());if(r&&r.beginTime===t&&r.duration===n)return r.cachedSegmentList;var i=this._mediaMap.getSegmentList(e,t,n);return this._cachedSegmentList.set(e.viewToString(),{beginTime:t,cachedSegmentList:i,duration:n}),i}},{key:"getSegmentTime",value:function(e){var t=this._cachedSegmentTime.get(e.viewToString());if(void 0!==t)return t;var n=this._mediaMap.getSegmentTime(e);if(this._cachedSegmentTime.set(e.viewToString(),n),this._cachedSegmentTime.size>this._conf.GETSEGMENTTIME_CACHE_MAX_SIZE){var r=this._cachedSegmentTime.keys(),i=r.next().value,a=(0,c.unwrap)(i);this._cachedSegmentTime.delete(a)}return n}}]),e}();t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(216),u=function(){function e(t,n){(0,a.default)(this,e),this._isNearEdge=!1,this.isAlwaysDvr=!0,this.currentTracks=new l.CurrentTracks(t),this._playerInterface=n}return(0,s.default)(e,[{key:"isLive",value:function(){return this._playerInterface.isLive()}},{key:"resetIsAlwaysDvr",value:function(){!this._isNearEdge&&this.isLive()&&(this.isAlwaysDvr=!0)}},{key:"isNearEdge",get:function(){return this._isNearEdge},set:function(e){e&&this.isAlwaysDvr&&(this.isAlwaysDvr=!1),this._isNearEdge=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(235),a=r(i),o=n(73),s=r(o),l=n(39),u=r(l),c=n(11),d=r(c),f=n(14),h=r(f),v=n(217),p=r(v),_=n(23),m=r(_),g=n(4),y=n(96),E=r(y),S=function(e,t,n){function r(e){var t=A.get(e.viewToString());return t||!1}function i(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,d.default)(A.values());!(t=(i=a.next()).done);t=!0){i.value.seeders.remove(e)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}function o(e){var t=r(e);return!1===t&&(t=new p.default(e,this,k,D,n),A.set(t.segmentCoord.viewToString(),t),k.requestHasSegment(e),l()),t}function l(){var e=0,t=n.moduleState.isLive()?n.conf.LIVE.P2P_CACHE_MAX_SIZE:n.conf.P2P_CACHE_MAX_SIZE,r=void 0,i=0,a=!0,o=!1,s=void 0;try{for(var l,u=(0,d.default)(A.values());!(a=(l=u.next()).done);a=!0){var c=l.value;if(c.chunkManager.size&&(e+=c.chunkManager.size),e>t){r=A.size-i;break}i++}}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}if(r){var f=A.keys(),h=!0,v=!1,p=void 0;try{for(var _,m=(0,d.default)(f);!(h=(_=m.next()).done);h=!0){var g=_.value;if(0===r)break;var y=A.get(g);A.delete(g),D.removeSegmentInfo(y.segmentCoord),r--}}catch(e){v=!0,p=e}finally{try{!h&&m.return&&m.return()}finally{if(v)throw p}}}}function c(e){A.delete(e.viewToString())}function f(){var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var a,o=(0,d.default)(A.values());!(n=(a=o.next()).done);n=!0){var s=a.value,l=s.chunkManager.getP2PAndCDNDownloads();e+=l.p2pDownloaded,t+=l.cdnDownloaded}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return{p2pDownloaded:e,cdnDownloaded:t}}function v(e,t){var r=o(e),i=r.chunkManager,a=new E.default(t);i.storeSegment(a),r.seeders.clear(),(n.moduleState.isLive()&&n.conf.ALLOW_LIVE_PUSH_SEGMENT||!n.moduleState.isLive()&&n.conf.ALLOW_VOD_PUSH_SEGMENT)&&k.broadcastSegmentInfo(e)}function _(e){var t=r(e).chunkManager;return!!t&&t.getPartialSegment()}function y(e){return[].concat((0,u.default)(A)).filter(function(t){var n=(0,s.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&!r.chunkManager.shouldDownloadSegment()}).map(function(e){var t=(0,s.default)(e,2);t[0];return t[1].segmentCoord})}function S(){return[].concat((0,u.default)(A)).map(function(e){var t=(0,s.default)(e,2),n=(t[0],t[1]);return{segmentcoord:n.segmentCoord,downloadStatusList:n.chunkManager.downloadStatus,seederCount:n.seeders.length}})}function T(e){return[].concat((0,u.default)(A)).filter(function(t){var n=(0,s.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&r.chunkManager.isSegmentDownloaded()}).map(function(e){var t=(0,s.default)(e,2);t[0];return t[1].segmentCoord})}function b(){if(!A.size)return{};var e=void 0,t=0,n=a.default,r=!0,i=!1,o=void 0;try{for(var s,l=(0,d.default)(A.values());!(r=(s=l.next()).done);r=!0){e=s.value.segmentCoord.getId(),n=Math.min(n,e),t=Math.max(t,e)}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}return{minSegmentId:n,maxSegmentId:t}}function R(){w.clearAll(),A=new h.default}var A=new h.default,D=t,k=e,w=new m.default;f();var O=(0,g.createInterval)(f,1e4);w.register(O),this.dispose=R,this.getOrCreateSegmentHandler=o,this.removeSegmentHandler=c,this.doubleCheckP2PDownload_CDNDownload=f,this.fillSegment=v,this.getSegmentHandler=r,this.getPartialSegment=_,this.removePeer=i,this.listSegmentsToSkipForTrack=y,this.listSegmentsDownloadStatus=S,this.listDownloadedSegmentsForTrack=T,this.getSegmentsStats=b,1||(this._segmentHandlers=A,this._manageP2PCache=l)};t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"init",value:function(e,t){this._p2pCache=e,this._scheduler=t}},{key:"getStats",value:function(){var e=this._scheduler.getEdgeSegment();if(e){var t=e.getId(),n=this._p2pCache.getSegmentsStats(),r=n.minSegmentId,i=n.maxSegmentId;return{min:r||t,max:i||t,current:t}}return null}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(3),u=r(l),c=function(){function e(t,n,r,i,o){(0,a.default)(this,e),this._scheduler=t,this._p2pCache=n,this._segmentInfoMap=r,this._distributedSegmentList=i,this._sharedState=o}return(0,s.default)(e,[{key:"_onHasSegment",value:function(e,t,n){var r=n.pushed;if(this._segmentInfoMap.addSegmentInfo(t),!r||this._sharedState.conf.USE_VOD_PUSH_PATCH&&!this._sharedState.moduleState.isLive()||this._distributedSegmentList.insert(t.segmentCoord),this._scheduler.isSegmentRequested(t.segmentCoord)){var i=this._p2pCache.getOrCreateSegmentHandler(t.segmentCoord);i.chunkManager.setSegmentSize(t.size),i.seeders.add(e)}}},{key:"_onPeerOpen",value:function(){this._sharedState.eventBus.emit("segmentInfo",this._scheduler.getSegmentListToDownload(),this._segmentInfoMap)}},{key:"_onPeerDestroyed",value:function(e){var t=e.remotePeer;this._p2pCache.removePeer(t)}}],[{key:"listenEvents",value:function(t,n,r,i,a){var o=new e(t,n,r,i,a);a.eventBus.on(u.default.PeerPool.PEER_OPEN,o._onPeerOpen.bind(o)),a.eventBus.on("hasSegment",o._onHasSegment.bind(o)),a.eventBus.on(u.default.PeerPool.PEER_DESTROYED,o._onPeerDestroyed.bind(o))}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(23),u=r(l),c=n(6),d=r(c),f=n(4),h=n(18),v=n(29),p=n(159),_=r(p),m=n(36),g=r(m),y=function(){function e(t){var n=this;(0,a.default)(this,e);var r=t.conf,i=t.transferStats,o=t.abrStats;this._conf=r,this._transferStats=i,this._abrStats=o,this._p2pMediaDownloadedDelta=new h.Delta,this._p2pTimeElapsedDelta=new h.Delta(Date.now());var s=r.P2P_SPEED_ESTIMATION_BUCKET_COUNT*r.P2P_SPEED_ESTIMATION_BUCKET_DURATION;this._p2pMediaDownloadedSMWA=new _.default(s),this._p2pMediaDownloadedEMWA=new g.default(0,r.P2P_SPEED_EMA_WEIGHT),this._p2pMediaDownloadedLongSMA=new _.default(r.P2P_USEFUL_SMA_WINDOW),this._p2pMediaDownloadedLongDelta=new h.Delta,this._p2pUsefulLongSMA=new _.default(r.P2P_USEFUL_SMA_WINDOW),this._p2pUsefulLongDelta=new h.Delta,this._timerStore=new u.default,this._ewmaZeroWeight=1-Math.exp(Math.log(.5)*r.MEAN_SPEED_CALCULATION_INTERVAL/r.P2P_SPEED_EMA_ZERO_HALF_LIFE);var l=(0,f.createInterval)(function(){n._computeMeanInstantSpeed()},this._conf.MEAN_SPEED_CALCULATION_INTERVAL),c=(0,f.createInterval)(function(){n._computeDeltaP2PSpeed()},r.P2P_SPEED_ESTIMATION_BUCKET_DURATION),d=(0,f.createInterval)(function(){n._updateUsefulP2PRatio()},this._conf.P2P_USEFUL_CALCULATION_INTERVAL);this._timerStore.register(l),this._timerStore.register(c),this._timerStore.register(d)}return(0,s.default)(e,[{key:"getP2PSpeedEstimate",value:function(){var e=this._p2pMediaDownloadedEMWA.value;return e*(1-this._conf.P2P_USEFUL_RATIO_WEIGHT)+e*this._abrStats.p2pUsefulEstimate*this._conf.P2P_USEFUL_RATIO_WEIGHT}},{key:"_updateUsefulP2PRatio",value:function(){var e=this._p2pUsefulLongDelta.calcDelta(this._transferStats.p2pUseful),t=this._p2pMediaDownloadedLongDelta.calcDelta(this._transferStats.p2pMediaDownloaded);t>0&&(this._p2pMediaDownloadedLongSMA.addPoint(t),this._p2pUsefulLongSMA.addPoint(e));var n=this._p2pMediaDownloadedLongSMA.computeSum(),r=this._p2pUsefulLongSMA.computeSum(),i=8*n/this._conf.P2P_USEFUL_SMA_WINDOW<this._conf.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION?1:Math.min(1,r/n);this._abrStats.p2pUsefulEstimate=(0,v.toDecimal)(i,3)}},{key:"_computeMeanInstantSpeed",value:function(){var e=this._p2pMediaDownloadedSMWA.compute();this._abrStats.p2pSpeedWindowsCount++,0===e&&this._abrStats.zeroP2pSpeedWindowsCount++,e<0?d.default.notifyError(new Error("Negative p2pMediaDownloaded delta.")):this._p2pMediaDownloadedEMWA.value<this._conf.P2P_SPEED_ZERO_THRESHOLD?this._p2pMediaDownloadedEMWA.update(e,1):e>0?this._p2pMediaDownloadedEMWA.update(e):0===e&&this._p2pMediaDownloadedEMWA.update(e,this._ewmaZeroWeight),this._abrStats.p2pSpeed=this.getP2PSpeedEstimate()}},{key:"_computeDeltaP2PSpeed",value:function(){var e=this._p2pMediaDownloadedDelta.calcDelta(this._transferStats.p2pMediaDownloaded),t=this._p2pTimeElapsedDelta.calcDelta(Date.now());e>0&&t>0?this._p2pMediaDownloadedSMWA.addPoint(8*e/t):e<0&&d.default.notifyError(new Error("Negative p2pMediaDownloaded delta."))}},{key:"dispose",value:function(){this._timerStore.clearAll()}}]),e}();t.default=y,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(64),p=r(v),_=function(e){function t(e){(0,s.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n._segmentCoord=e,n}return(0,h.default)(t,e),(0,u.default)(t,[{key:"getUpdatedRange",value:function(e){return e}},{key:"getFullSegment",value:function(e,t){t(e,this._segmentCoord)}},{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(p.default);t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(64),p=r(v),_=n(101),m=r(_),g=function(e){function t(e,n,r,i){function o(e,t){function i(i,a){e.response=i;var o=new m.default(f,i.byteLength,a);r.addSegmentInfo(o),n.fillSegment(f,e.response),l.emit("piece_downloaded_prtl",f),t(e,f)}u.callHashWorker(e.response,i)}(0,s.default)(this,t);var l=i.eventBus,u=i.workerHelper,c=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this)),f=e;return c.getFullSegment=function(e,t){l.emit("CDNSegmentDownloaded",f);var n=e.response;i.transferStats.cdnDownloaded+=n.byteLength,o(e,t)},c}return(0,h.default)(t,e),(0,u.default)(t,[{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"getUpdatedRange",value:function(e){return e}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(p.default);t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(237),a=r(i),o=n(7),s=r(o),l=n(0),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(6),p=r(v),_=n(64),m=r(_),g=function(e){function t(e,n,r,i,o,l,c,f,h){function v(e,t,r,i){function a(a,o){t.hash===o?(N.nbRightHashDLM++,e.response=a,_(e),r(e,P)):(N.nbWrongHashDLM++,M.multipleDlHD+=j,M.multipleDlHP+=U,n.removeSegmentHandler(P),i(e,P))}k.callHashWorker(e.response,a)}function _(e){B=e.response,n.fillSegment(P,e.response),D.emit("piece_downloaded_prtl",P),l.unlockSegmentData(),l.removePartialSegment()}function m(){L?U=o:(U=x.start*R.CHUNK_SIZE,x.end<G.length&&(U+=(G.length-x.end-1)*R.CHUNK_SIZE,U+=o-(G.length-1)*R.CHUNK_SIZE))}function g(){for(var e=0;e<G.length;e++)if("downloaded"!==G[e]&&"CDNdownloaded"!==G[e])return e}function y(){for(var e=G.length-1;e>=0;e--)if("downloaded"!==G[e]&&"CDNdownloaded"!==G[e])return e+1}function E(){x=R.RANGE_REQUEST_ALLOWED?{start:g(),end:y()}:{start:0,end:G.length}}function S(e){if(!R.RANGE_REQUEST_ALLOWED)return e;var t=void 0;if(void 0===x.start||void 0===x.end)throw new Error("PartialSegmentP2P: getUpdatedRange called with complete segment");var n=e?e.start+x.start*R.CHUNK_SIZE:x.start*R.CHUNK_SIZE;return x.end===G.length&&e?t=e.end:x.end<G.length&&(t=e?e.start+x.end*R.CHUNK_SIZE-1:x.end*R.CHUNK_SIZE-1),{start:n,end:t}}function T(e){if(void 0===x)throw new Error("assertion: _cdnIndexRange is not defined");if(void 0===B)throw new Error("assertion: _segmentData is not defined");try{B.setBinaryData(e,x.start*R.CHUNK_SIZE)}catch(e){throw p.default.notifyError(e),new Error("Invalid configuration: The current stream has no range request enabled and the p2p configuration has range request set to true.")}return B}function b(e){h.transferStats.cdnDownloaded+=e.byteLength}(0,u.default)(this,t);var R=h.conf,A=h.status,D=h.eventBus,k=h.workerHelper,w=h.controlStats,O=h.transferStats,C=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this)),L=c,P=e,I=f,M=O,N=w,x=void 0,U=void 0,F=void 0,B=void 0,G=void 0,j=0;return C.getFullSegment=function(e,t,n){if(this.isComplete())B.getBinaryData(0,B.byteLength,function(n){e.response=n,l.removePartialSegment(),t(e,null)});else{D.emit("CDNSegmentDownloaded",P);var r=e.response;b(r),j=r.byteLength,T(r).getBinaryData(0,B.byteLength,function(r){if(e.response=r,0!==U){l.lockSegmentData();var i=I.getSegmentInfo(P);v(e,i,t,n)}else _(e),t(e,P)})}},C.getUpdatedRange=S,C.getCDNIndexRange=function(){return x},C.isComplete=function(){return L},C.isLocked=function(){return l.dataLocked},function(){if(B=r,!i.length)throw new Error("PartialSegmentP2P should not be instantiated with an empty segment");G=i.slice(),E(),m(),F=A.getMeanInstantSpeed()}(),(0,a.default)(C,{p2pSpeed:{get:function(){return F},set:void 0},p2pAmount:{get:function(){return U},set:void 0}}),C}return(0,h.default)(t,e),t}(m.default);t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),a=r(i),o=n(14),s=r(o),l=n(4),u=n(101),c=r(u),d=n(222),f=r(d),h=n(18),v=n(201),p=r(v),_=n(184),m=r(_),g=n(3),y=r(g),E=n(168),S=r(E),T=n(221),b=r(T),R=n(48),A=r(R),D=n(36),k=r(D),w=n(69),O=r(w),C=n(6),L=r(C),P=function(e,t,n,r,i){var o=r,u=r.conf,d=r.peerStats,v=new h.Delta,_=new h.Delta,g=new h.Delta,E=new h.Delta(Date.now()),T=r.eventBus,R=e,D=d,w=new f.default(n,r),C=this,P=k.default.fromHalfLife(0,u.PEER_UPLOAD_SPEED_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL),I=k.default.fromHalfLife(0,u.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL),M=new O.default(u.PEER_TIMEOUT_RATIO_WINDOW),N=new O.default(u.PEER_TIMEOUT_RATIO_WINDOW),x=Date.now(),U=0,F=0,B=!1,G=void 0,j=0,H=0,W=void 0,V=0,K=0,q=0,Y=0,X=!1,z=!1,Q=void 0,Z=!1,J=new s.default,$=new s.default,ee=function(){var e=E.calcDelta(Date.now()),t=v.calcDelta(U),n=_.calcDelta(F),i=g.calcDelta(w.dataUploaded);j=8*t/e,H=8*i/e;var a=8*n/e,o=Date.now()-r.moduleState.currentTracks.lastSwitchTimestamp;X?u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&o<u.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION?I.update(a,k.default.halfLifeToEMAWeight(u.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL)):I.update(a):a>0&&(I.update(a,1),X=!0),z?u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&o<u.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION?P.update(H,k.default.halfLifeToEMAWeight(u.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL)):P.update(H):H>0&&(P.update(H,1),z=!0),M.push(V),N.push(K)},te=function(e){n.sendMessage("requestHasSegment",{segmentCoord:e})},ne=function(e,t){var r=t.pushed;n.sendMessage("hasSegment",{segmentInfo:e,pushed:!!r})},re=function(e){V++,K++,$.set(e.id,J.get(e.id)),J.delete(e.id),(0,l.createTimeout)(function(){var t=$.get(e.id);t&&t.timestamp===e.timestamp&&$.delete(e.id)},u.CHUNK_GRACE_DURATION)},ie=function(e,t,r,i){var s=p.default.decode(t),l=!0,u=!1,c=void 0;try{for(var d,f=(0,a.default)(s);!(l=(d=f.next()).done);l=!0){var h=d.value,v=new S.default(e,h,this,o,i,r);J.set(v.id,v)}}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}n.sendMessage("requestChunks",{segmentCoord:e,ids:t,safe:r===A.default.SAFE})},ae=function(){Q.clear(),n.close()},oe=function(){Q.clear(),w.dispose(),W.dispose(),n.destroy()},se=function(e,n){var i=void 0;switch(e){case"heartbeat":G=n.videoTrack;break;case"requestHasSegment":T.emit("segmentRequested",C,new t(n.segmentCoord));break;case"hasSegment":i=new t(n.segmentInfo.segmentCoord);var o=new c.default(i,n.segmentInfo.size,n.segmentInfo.hash),s=!!n.pushed;T.emit("hasSegment",C,o,{pushed:s});break;case"requestChunks":if(!r.isP2PUploadOn)return;i=new t(n.segmentCoord);var l=p.default.decode(n.ids),u=n.safe?A.default.SAFE:A.default.UNSAFE,d=!0,f=!1,h=void 0;try{for(var v,_=(0,a.default)(l);!(d=(v=_.next()).done);d=!0){var m=v.value;r.efficiencyStats.receivedChunkRequestCount++,w.push(new b.default(i,m,r,u))}}catch(e){f=!0,h=e}finally{try{!d&&_.return&&_.return()}finally{if(f)throw h}}break;default:return void L.default.notifyError(new Error("Invalid message "+e+" sent by peerConnection"))}Z||(D.active++,Z=!0)},le=function(e,t,n){U+=e.byteLength;var i=J.get(S.default.getIdOf(n,t));i?(V++,i.dataDownloaded(e),F+=e.byteLength,J.delete(i.id)):(Y++,i=$.get(S.default.getIdOf(n,t)),i?(q++,r.efficiencyStats.gracedChunksCount++,i.dataDownloaded(e),$.delete(i.id)):(r.efficiencyStats.expiredGraceChunksCount++,r.transferStats.multipleDlM+=e.byteLength)),ue()},ue=function(){B||(D.transfer++,B=!0)},ce=function(){return!G||r.moduleState.currentTracks.video.viewToString()===G},de=function(){return Date.now()-x<u.PEER_INIT_LOCKED_DURATION},fe=function(){var e=M.delta,t=N.delta;return e>0?t/e:0},he=function(e){for(var t=0;t<e.length;t++)te(e[t])};C.getRtt=n.getRtt.bind(n),C.requestHasSegment=te,C.answerHasSegment=ne,C.requestChunks=ie,C.timeoutChunk=re,C.isOnSameTrack=ce,C.close=ae,C.getDataDownloaded=function(){return U},C.getDataUploaded=function(){return w.dataUploaded},C.getId=function(){return R},C.getDlSpeed=function(){return j},C.getUpSpeed=function(){return H},C.getUsefulDlSpeedEMA=function(){return I.value},C.getUpSpeedEMA=function(){return P.value},C.getChunkTimeoutCount=function(){return K},C.getChunkRequestedCount=function(){return V},C.getLateChunksCount=function(){return Y},C.getGracedChunksCount=function(){return q},C.getUploadCapacity=function(){return W.value},C.isLooser=function(){var e=fe()>u.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD,t=P.value<u.LOOSER_UPLOAD_THRESHOLD;return e&&t},C.getChunksQuantityForInterval=function(e){var t=W.value*(e/1e3),n=Math.ceil(t*(1+u.PEER_UPLOAD_CAPACITY_EXTRA_RATIO)/(8*u.CHUNK_SIZE/1024)),r=Math.floor(n*u.PEER_UPLOAD_CAPACITY_SAFE_RATIO/(1+u.PEER_UPLOAD_CAPACITY_EXTRA_RATIO));return{safe:r,unsafe:n-r}},C.locked=function(){return(!!u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON||ce())&&(de()||P.value/r.abrStats.estimatedBitrate>u.PEER_LOCKED_UPLOAD_THRESHOLD||I.value/r.abrStats.estimatedBitrate>u.PEER_LOCKED_DOWNLOAD_THRESHOLD)},C.getDebugInfos=function(){return{id:R,dlSpeed:j/8,upSpeed:H/8,dataDownloaded:U,dataUploaded:w.dataUploaded,rtt:n.getRtt(),uploadCapacity:W.value}},function(){W=new m.default(r,C,i),Q=(0,l.createInterval)(ee,u.PEER_SPEED_MONITOR_INTERVAL),w.onTransfering=ue,n.once(y.default.PeerConnection.DISCONNECTED,function(){D.disconnected++,T.emit(y.default.Peer.REMOVE_PEER,C,!0),oe()}),n.on(y.default.PeerConnection.BINARY_DATA_RECEIVED,le),n.on(y.default.PeerConnection.MESSAGE_RECEIVED,se),T.once("segmentInfo",he,C),M.push(0),N.push(0)}()};t.default=P,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),a=r(i),o=n(50),s=r(o),l=n(224),u=r(l),c=n(23),d=r(c),f=n(4),h=n(182),v=r(h),p=n(203),_=r(p),m=n(3),g=r(m),y=n(104),E=r(y),S=n(194),T=r(S),b=n(163),R=r(b),A=n(169),D=r(A),k={EXCLUSION_REMOVED:"removed",EXCLUSION_DISCONNECTED:"disconnected",EXCLUSION_OFFER_DECLINED:"offer_declined",EXCLUSION_CONNECTION_ATTEMPT_TIMED_OUT:"timed_out"},w=function(e,t,n,r,i){var o=i.conf,l=i.status,c=i.peerStats,h=void 0,p=null,m=void 0,y=null,S=void 0,b=!1,A=[],w=s.default,O=new T.default(e,t,i),C=r,L=this,P=i.eventBus,I=new d.default,M=function(e){I.clear(p),p=null;var t=Date.now()-w,n=e-t;n>0?(p=(0,f.createTimeout)(H,n),I.register(p)):H()},N=function(e){if(e.isVideo){var t=!0,n=!1,r=void 0;try{for(var s,l=(0,a.default)(A);!(t=(s=l.next()).done);t=!0){if(s.value.isOnSameTrack()){i.abrStats.trackSwitchWithPeers++;break}}}catch(e){n=!0,r=e}finally{try{!t&&l.return&&l.return()}finally{if(n)throw r}}p&&M(o.ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL)}},x=function(){$()&&L.makeRoom();var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(A);!(n=(o=s.next()).done);n=!0){var l=o.value;l.locked()&&e++,l.isLooser()&&t++}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}c.locked.updateMetric(e),c.loosers.updateMetric(t);var u=0,d=!0,f=!1,h=void 0;try{for(var v,p=(0,a.default)(A);!(d=(v=p.next()).done);d=!0){v.value.isOnSameTrack()&&u++}}catch(e){f=!0,h=e}finally{try{!d&&p.return&&p.return()}finally{if(f)throw h}}P.emit(g.default.PeerPool.PEER_STATS_UPDATE,{peerCount:A.length,sameTrackPeerCount:u})},U=function(){for(var e=0,t=0,n=0;n<A.length;n++){var r=A[n];e+=r.getDlSpeed(),t+=r.getUpSpeed()}l.setDlSpeed(e),l.setUpSpeed(t),l.computeMaxAndAvgSpeed()},F=function(){null!==y&&y.dispose(),y=new _.default(l.getMyPeerId(),this,n,i),S=new R.default(y,i),m=new D.default(this,y,i),h=S.onPeersFromTracker.bind(S),b&&G()},B=function(){p&&(I.clear(p),p=null)},G=function(){if(l.getConnected()&&l.getConnectedToSignalingServer()){var e=Date.now()-w,t=Date.now()-i.moduleState.currentTracks.lastSwitchTimestamp,n=t<e?o.ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL:o.ASK_PEERS_INTERVAL;M(n),b=!0}},j=function(e,t){A=u.default.without(A,e),P.emit(g.default.PeerPool.PEER_DESTROYED,{remotePeer:e,peerCount:A.length}),t?m.addSecondOrderExclusion(e.getId(),o.PEER_DISCONNECTED_EXCLUSION_RANK,o.PEER_DISCONNECTED_EXCLUSION_DURATION,k.EXCLUSION_DISCONNECTED):(m.addSecondOrderExclusion(e.getId(),o.PEER_REMOVED_EXCLUSION_RANK,o.PEER_REMOVED_EXCLUSION_DURATION,k.EXCLUSION_REMOVED),e.isOnSameTrack()?c.droppedSameTrack++:c.droppedOtherTrack++)},H=function e(){w=Date.now();var t=m.exclusionList;c.exclusionSize=m.secondOrderExclusions.size,O.askPeers(t,h),p=(0,f.createTimeout)(e,o.ASK_PEERS_INTERVAL),I.register(p)},W=function(){return A.length},V=function(e){for(var t=0;t<A.length;t++){A[t].requestHasSegment(e)}},K=function(){for(;A.length>0;)A[A.length-1].close()},q=function(e,t,r){var a=Y(),o=new v.default(e,n,t,i,a);A.push(o),r?c.openedMatch++:c.openedOffer++,P.emit(g.default.PeerPool.PEER_OPEN,{remotePeer:o,peerCount:A.length})},Y=function(){for(var e=[],t=0,n=A.length;t<n;t++)e.push(A[t].getUploadCapacity());var r=E.default.median(e);return r?Math.max(r,o.MIN_PEER_UPLOAD_CAPACITY):o.DEFAULT_PEER_UPLOAD_CAPACITY},X=function(){for(var e=0,t=0,n=0,r=A.length;n<r;n++)e=Math.max(e,A[n].getUploadCapacity()),t+=A[n].getUploadCapacity();c.maxPUC=e,c.peerPoolUploadCapacity.updateMetric(t)},z=function(e){m.addSecondOrderExclusion(e,o.OFFER_DECLINED_EXCLUSION_RANK,o.OFFER_DECLINED_EXCLUSION_DURATION,k.EXCLUSION_OFFER_DECLINED),c.denied++},Q=function(e){m.addSecondOrderExclusion(e,o.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK,o.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION,k.EXCLUSION_CONNECTION_ATTEMPT_TIMED_OUT)},Z=function(e){var t=C.getSegmentInfo(e),n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(A);!(n=(o=s.next()).done);n=!0){o.value.answerHasSegment(t,{pushed:!0})}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}},J=function(){var e=[],t=[],n=1,r=1,i=!0,o=!1,s=void 0;try{for(var l,u=(0,a.default)(A);!(i=(l=u.next()).done);i=!0){var c=l.value;c.locked()||(c.isLooser()?e.push(c):t.push(c)),n=Math.max(n,c.getUpSpeedEMA()),r=Math.max(r,c.getUsefulDlSpeedEMA())}}catch(e){o=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw s}}return{loosers:e,unlocked:t,maxUpSpeed:n,maxDownSpeed:r}},$=function(){return A.length-o.PEER_POOL_LIMIT>0},ee=function(e,t,n){return e.getUpSpeedEMA()/t+e.getUsefulDlSpeedEMA()/n},te=function(){null!==y&&y.dispose(),S&&S.dispose(),I.clearAll(),K(),O.dispose()};L.getPeerArray=function(){return A},L.lockedCount=function(){var e=0,t=!0,n=!1,r=void 0;try{for(var i,o=(0,a.default)(A);!(t=(i=o.next()).done);t=!0){i.value.locked()&&e++}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e},L.openSlotsCount=function(){return Math.max(o.PEER_POOL_LIMIT-L.lockedCount(),0)},L.makeRoom=function(){var e=J(),t=e.loosers,n=e.unlocked,r=e.maxUpSpeed,i=e.maxDownSpeed;for(t.sort(function(e,t){return t.getUpSpeedEMA()-e.getUpSpeedEMA()});t.length>0&&$();){var a=t.pop();j(a,!1)}if($())for(n.sort(function(e,t){return ee(t,r,i)-ee(e,r,i)});n.length>0&&$();){var o=n.pop();j(o,!1)}},L.getPeerCount=W,L.getPendingConnectionDebugInfos=function(){return y?y.getPendingConnectionDebugInfos():[]},L.requestHasSegment=V,L.addPeerConnection=q,this.offerDeclined=z,this.connectionAttemptTimeout=Q,L.broadcastSegmentInfo=Z,L.dispose=te,function(){var e=(0,f.createInterval)(U,o.SPEED_MONITOR_INTERVAL),t=(0,f.createInterval)(X,o.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL),n=(0,f.createInterval)(x,o.PEER_POOL_MAINTENANCE_INTERVAL);I.register(e),I.register(t),I.register(n),P.on(g.default.Peer.REMOVE_PEER,j),P.on(g.default.Metrics.TRACK_SWITCH,N,this),l.getEE().on("tracker_ready",F,L),l.getEE().on("tracker_disconnected",B,L),l.getEE().on("signaling_ready",G,L),l.getEE().on("signaling_disconnected",B,L)}()};t.default=w,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(36),u=r(l),c=n(69),d=r(c),f=n(18),h=n(4),v=100,p=function(){function e(t,n,r){var i=this;(0,a.default)(this,e);var o=t.conf,s=this._getTrimmedWindowTimeout(t),l=new f.Delta(n.getDataDownloaded()),c=new f.Delta(Date.now()),v=new d.default(s),p=new d.default(s);this._capacityEmwa=new u.default(r,o.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP),v.push(n.getChunkTimeoutCount()),p.push(n.getChunkRequestedCount()),this._timer=(0,h.createInterval)(function(){v.push(n.getChunkTimeoutCount()),p.push(n.getChunkRequestedCount());var e=p.delta,t=v.delta,r=l.calcDelta(n.getDataDownloaded()),a=c.calcDelta(Date.now());if(null!==t&&null!==e){var s=8*r/1024*1e3/a,u=e>0?t/e:0;s>=i._capacityEmwa.value?i._capacityEmwa.update(s):u>=o.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO&&(o.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO?i._capacityEmwa.update(s,Math.min(u,o.PUC_EMWA_WEIGHT_CAP)):i._capacityEmwa.update(s,o.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN))}},o.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL)}return(0,s.default)(e,[{key:"_getTrimmedWindowTimeout",value:function(e){var t=e.conf,n=e.moduleState,r=t.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL,i=n.isLive()?t.LIVE.CHUNK_TIMEOUT:t.CHUNK_TIMEOUT;return r*Math.ceil(i/r)+v}},{key:"dispose",value:function(){this._timer.clear()}},{key:"value",get:function(){return this._capacityEmwa.value}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(177),a=r(i),o=n(164),s=r(o),l=n(170),u=r(l),c=n(180),d=r(c),f=n(179),h=r(f),v=n(204),p=r(v),_=n(197),m=r(_),g=n(142),y=r(g),E=n(183),S=r(E),T=n(178),b=r(T),R=n(175),A=r(R),D=n(189),k=r(D),w=n(219),O=r(w),C=n(209),L=n(188),P=r(L),I=n(166),M=r(I),N=n(23),x=r(N),U=n(4),F=n(186),B=r(F),G=n(66),j=r(G),H=n(205),W=r(H),V=n(47),K=n(190),q=r(K),Y=n(105),X=n(191),z=r(X),Q=n(6),Z=r(Q),J=n(150),$=r(J),ee=n(167),te=r(ee),ne=n(102),re=r(ne),ie=n(228),ae=r(ie),oe=n(229),se=r(oe),le=n(176),ue=r(le),ce=n(161),de=r(ce),fe=n(193),he=r(fe);1||Z.default.setScriptOrigin(window.document.currentScript&&window.document.currentScript.src?window.document.currentScript.src:null);var ve=function e(t,n,r,i,o,l,c){var f=this;if("string"!=typeof c||""===c||c.length>10)throw new Error("Unvalid argument in PeerAgent constructor: integration version must be a non-empty string of less than 10 characters");var v=new $.default,_=new q.default(i,n,c,t,v,r);Z.default.setCustomer(_.conf.ID_CLIENT),Z.default.setMetadata({stream:_.moduleState.content}),(0,V.checkInterface)(W.default,r),(0,V.checkInterface)(j.default,o.prototype),(0,Y.assertStreamType)(l);var g=void 0,E=void 0,T=void 0,R=void 0,D=void 0,w=void 0,L=void 0,I=void 0,N=void 0,F=void 0,G=void 0,H=void 0,K=void 0,X=void 0,Q=!1,J=void 0,ee=void 0,ne=void 0,ie=new x.default,oe=l,le=function(){N=(0,C.createScheduler)(r,R,w,oe,_)},ce=function(){F&&(G=new P.default,D=new ue.default,E=new S.default(t,D,o,G,_),T=new b.default(_),t.isLive()&&(X=new m.default(t,v,oe,_)),R=new A.default(E,G,_),L=new k.default(G,R,_),I=new O.default(R,_),w=new M.default(r,_),le(),D.init(R,N),g=new s.default(R,N,_),K=new y.default(v,_),(0,de.default)(_),te.default.connect(_),a.default.listenEvents(N,R,G,w,_),ee.listenEvents(ne),fe()),Q=!0},fe=function e(){if(!t.areBuffersInitialized||t.areBuffersInitialized())_.conf.DEBUG&&(H=new p.default(E,X,_));else{var n=(0,U.createTimeout)(e,300);ie.register(n)}},ve=function(e){return e.trackView&&e.trackView.type&&("audio"===e.trackView.type||"video"===e.trackView.type)},pe=function(e){if(!F)throw new Error("P2P is not activated, getP2PData can't be called");var t=void 0;return Q?t=F?R.getPartialSegment(e)||new d.default(e,R,G,_):new h.default(e):(ne=ve(e),ce(),t=new h.default(e)),ne&&ee.updateWithSegmentView(e),N.updateTrackEdge(e),t},_e=function(e,t,n){return null!==n&&(0,V.checkInterface)(j.default,n),B.default.getSegment(this,e,t,n,_)},me=function(){F&&(Q&&(J.removeAllExternalEventListener(),K.dispose(),g.dispose(),R.dispose(),ie.clearAll(),E.dispose(),T.dispose(),H&&H.dispose(),X&&X.dispose()),ae.default.removeFromPeerAgentList(_.peerToken),_.dispose())};!function(){(F=re.default.isP2PEnabled(_.conf))&&(J=new u.default(t),ee=new he.default(J,_))}(),this.getSegment=_e,this.getP2PData=pe,this.dispose=me,this.setMediaElement=function(e){f.mediaElement=e},Object.defineProperty(this,"mediaElement",{get:function(){return v.mediaElement},set:function(e){v.mediaElement=e}}),Object.defineProperty(this,"p2pDownloadOn",{get:function(){return _.isP2PDownloadOn},set:function(e){e!==_.isP2PDownloadOn&&(_.isP2PDownloadOn=e,_.eventBus.emit("p2pDownloadToggle",e))}}),Object.defineProperty(this,"version",{get:function(){return e.version}}),Object.defineProperty(this,"p2pUploadOn",{get:function(){return _.isP2PUploadOn},set:function(e){e!==_.isP2PUploadOn&&(_.isP2PUploadOn=e,_.eventBus.emit("p2pUploadToggle",e))}}),Object.defineProperty(this,"isP2PEnabled",{get:function(){return re.default.isP2PEnabled(_.conf)}}),Object.defineProperty(this,"stats",{get:function(){return z.default.get(E,_,X,v)}}),Object.defineProperty(this,"PublicAPI",{get:function(){return se.default.get(f)}}),1||(i.crow&&window.Streamroot&&window.Streamroot.Reaper&&(window.Streamroot.Reaper.crow=i.crow),Object.defineProperty(this,"internals",{get:function(){return{currentTracks:_.moduleState.currentTracks,map:r,p2pCache:R,scheduler:N}}})),ae.default.addToPeerAgentList(_.peerToken,this)};Object.defineProperty(ve,"StreamTypes",{get:function(){return Y.StreamTypes}}),Object.defineProperty(ve,"version",{get:function(){return"4.9.3"}}),ae.default.setup(ve),t.default=ve,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(24),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(6),d=r(c),f=n(35),h=r(f),v=n(3),p=r(v),_=n(4),m=n(162),g=r(m),y=function(){},E=function(){function e(t,n,r,i,a){var o=r.onProgress,l=void 0===o?y:o,u=r.onError,c=void 0===u?y:u,d=r.onSuccess,f=void 0===d?y:d,h=this;(0,s.default)(this,e),this._request=n,this._handlers={onProgress:l,onError:c,onSuccess:f},this._srModule=t,this._transferStats=a.transferStats,this._controlStats=a.controlStats,this._mediaStats=a.mediaStats,this._abrStats=a.abrStats,this._conf=a.conf,this._eventBus=a.eventBus,this._stats={cdnDownloaded:0,cdnDuration:0,p2pDownloaded:0,p2pDuration:0};var v=this._handlers.onSuccess;this._handlers.onSuccess=function(e,t,n){if((0,g.default)(t,h._abrStats,h._conf),!1){var r=window.Streamroot.Reaper;r.sync(r.scopes.PeerAgent,t,r.actions.ABRFeedback)}h._transferStats.p2pConsumed+=t.p2pDownloaded,h._transferStats.cdnConsumed+=t.cdnDownloaded;var i=e.slice(0);v(i,t,n),h._eventBus.emit(p.default.SRModuleInterface.ABR_FEEDBACK,t)},this._segmentCoord=i}return(0,u.default)(e,[{key:"getSegment",value:function(){try{null===this._segmentCoord?this._getFullSegmentFromCDN():(this._partialSegment=this._srModule.getP2PData(this._segmentCoord),this._setP2PStats(),this._partialSegment.isComplete()?(this._handlers.onProgress(this._stats,this._request),this._getFullP2PSegment()):(this._eventBus.emit(p.default.SRModuleInterface.UNCOMPLETE_SEGMENT_REQUESTED),this._getRemainingRangeFromCDN())),this._controlStats.getSegmentSuccess++}catch(e){console.error(e),d.default.notifyError(e),this._getFullSegmentFromCDN(),this._controlStats.getSegmentFallback++}return{abort:this._abort.bind(this)}}},{key:"_abort",value:function(){this._httpRequest&&this._httpRequest.abort(),this._handlers.onSuccess=y,null!==this._segmentCoord&&this._mediaStats.abortFragmentCount++}},{key:"_getFullP2PSegment",value:function(){var e=this;this._waitSegmentUnlocked(function(t){t?e._fillSegment(null):(e._controlStats.segmentLockTimeout++,e._getFullSegmentFromCDN())})}},{key:"_getRemainingRangeFromCDN",value:function(){var e=this,t=this._getRangeFromRequest();this._fallbackRange=t,this._rangeToDownload=this._partialSegment.getUpdatedRange(t),this._downloadFromCDN(this._rangeToDownload,function(t,n){if(t)return void e._handlers.onError(t,e._request);e._fillSegment(n)})}},{key:"_onProgress",value:function(e){this._stats.cdnDownloaded=e.loaded,this._stats.cdnDuration=new Date-this._startDownloadCdn;var t={};if((0,a.default)(t,this._stats),this._conf.USE_CONTINOUS_PROGRESS_FEEDBACK)if(e.lengthComputable){var n=e.loaded/e.total;t.p2pDownloaded=Math.round(n*this._stats.p2pDownloaded),t.p2pDuration=Math.round(n*this._stats.p2pDuration)}else t.p2pDownloaded=0,t.p2pDuration=0;this._conf.PROGRESS_ADD_TOTAL&&(t.lengthComputable=e.lengthComputable,t.total=e.lengthComputable?e.total+this._stats.p2pDownloaded:0),this._handlers.onProgress(t,this._request)}},{key:"_downloadFromCDN",value:function(e,t){var n=this,r=h.default.Methods.GET,i={headers:this._getHttpRequestHeaders(e),responseType:h.default.ResponseTypes.ARRAY_BUFFER,withCredentials:!!this._request.withCredentials,events:{onprogress:this._onProgress.bind(this)}};this._httpRequest=new h.default(r,this._request.url,i),this._httpRequest.send().then(function(e){n._stats.cdnDownloaded=e.byteLength||0,n._stats.cdnDuration=Date.now()-n._startDownloadCdn;var r=n._transferStats.p2pMediaDownloaded-n._p2pAmountOnStart;n._abrStats.concurrentP2pDownloaded+=r,n._abrStats.cdnEstimationCount++,0!==r&&n._abrStats.concurrentP2pDownloadCount++;var i=n._stats.cdnDownloaded+n._stats.p2pDownloaded;if(n._stats.cdnDownloaded/i>=n._conf.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD&&n._stats.cdnDownloaded>=n._conf.ABR_CDN_DL_THRESHOLD||i<n._conf.ABR_CDN_DL_THRESHOLD){if(n._conf.CDN_SPEED_ESTIMATE_CONSIDER_P2P){var a=Math.min(n._stats.cdnDownloaded+r,n._stats.cdnDownloaded*n._conf.CDN_CONCURRENT_SCALING_CAP);n._abrStats.cdnSpeed=8*a/n._stats.cdnDuration}else n._abrStats.cdnSpeed=8*n._stats.cdnDownloaded/n._stats.cdnDuration;n._abrStats.cdnTimestamp=Date.now()}t(null,e)}).catch(function(e){t(e,null)}),this._startDownloadCdn=Date.now(),this._p2pAmountOnStart=this._transferStats.p2pMediaDownloaded}},{key:"_getHttpRequestHeaders",value:function(e){var t={},n=this._request.headers;if(n&&void 0!==n.length)throw new Error("Custom headers object should not have a `length` attribute (you might use the previous API format)");return n&&((0,a.default)(t,n),this._rangeToDownload&&delete t.Range),void 0===t.Range&&e&&(t.Range=this._rangeValue(e)),t}},{key:"_rangeValue",value:function(e){return"bytes="+e.start+"-"+(e.end||"")}},{key:"_fillSegment",value:function(e){var t=this,n=!1,r=function(e){return function(r,i){n||(n=!0,e.call(t,r,i))}};try{this._partialSegment.getFullSegment({response:e},r(this._onSuccessAsynchronous),r(this._getFullSegmentFromCDN)),this._controlStats.fillSegmentSuccess++}catch(e){return console.error(e),d.default.notifyError(e),this._getFullSegmentFromCDN(),void this._controlStats.fillSegmentFallback++}(0,_.createTimeout)(function(){n||(n=!0,t._getFullSegmentFromCDN(),t._controlStats.fillSegmentSuccess--,t._controlStats.fillSegmentTimeout++)},this._conf.TIMEOUT_GET_FULL_SEGMENT)}},{key:"_waitSegmentUnlocked",value:function(e){var t=this;if(!this._partialSegment.isLocked())return void e(!0);var n=0,r=(0,_.createInterval)(function(){if(t._partialSegment=t._srModule.getP2PData(t._segmentCoord),!t._partialSegment.isLocked())return r.clear(),void e(!0);(n+=t._conf.LOCKED_RETRY_INTERVAL)>t._conf.LOCKED_RETRY_TIMEOUT&&(r.clear(),e(!1))},this._conf.LOCKED_RETRY_INTERVAL)}},{key:"_getRangeFromRequest",value:function(){var e=this._request.headers;if(e&&void 0!==e.Range){var t=e.Range.split("="),n=t[1].split("-");return{start:parseInt(n[0],10),end:parseInt(n[1],10)}}}},{key:"_getFullSegmentFromCDN",value:function(){var e=this;this._stats.p2pDownloaded=0,this._stats.p2pDuration=0,this._downloadFromCDN(this._fallbackRange,function(t,n){if(t)return void e._handlers.onError(t,e._request);e._handlers.onSuccess(n,e._stats,e._request)})}},{key:"_setP2PStats",value:function(){this._stats.p2pDownloaded=this._partialSegment.p2pAmount,this._stats.p2pDuration=0===this._partialSegment.p2pSpeed?0:Math.round(this._partialSegment.p2pAmount/this._partialSegment.p2pSpeed*1e3)}},{key:"_onSuccessAsynchronous",value:function(e){var t=this;0?(0,_.createTimeout)(function(){t._handlers.onSuccess(e.response,t._stats,t._request)},0):this._handlers.onSuccess(e.response,this._stats,this._request)}}]),e}();e.exports={getSegment:function(e,t,n,r,i){return new E(e,t,n,r,i).getSegment()}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t){(0,a.default)(this,e),this._conf=t,this._peers=[]}return(0,s.default)(e,[{key:"add",value:function(e){this.remove(e),this._peers.push(e)}},{key:"remove",value:function(e){var t=e.getId();this._peers=this._peers.filter(function(e){return e.getId()!==t})}},{key:"all",value:function(){var e=this;return this._peers.sort(function(t,n){var r=t.getChunksQuantityForInterval(e._conf.CHUNK_BATCHING_INTERVAL).safe;return n.getChunksQuantityForInterval(e._conf.CHUNK_BATCHING_INTERVAL).safe-r})}},{key:"clear",value:function(){this._peers.length=0}},{key:"length",get:function(){return this._peers.length}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=function(){function e(){(0,s.default)(this,e),this._map=new a.default}return(0,u.default)(e,[{key:"addSegmentInfo",value:function(e){var t=e.segmentCoord.viewToString();this._map.set(t,e)}},{key:"getSegmentInfo",value:function(e){var t=e.viewToString(),n=this._map.get(t);if(!n)throw new Error("segmentInfo not found in the map for the given SegmentCoord");return n}},{key:"removeSegmentInfo",value:function(e){var t=e.viewToString();this._map.delete(t)}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){function r(e,t){if(!1||n.isP2PUploadOn){var r=a.getSegmentHandler(t).chunkManager;if(r){if(r.getPercentageOfChunksDownloaded()>=n.conf.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER){var o=i.getSegmentInfo(t);e.answerHasSegment(o,{pushed:!1})}}}}var i=e,a=t;n.eventBus.on("segmentRequested",r)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(61),d=r(c),f=n(34),h=r(f),v=n(192),p=r(v),_=n(215),m=r(_),g=n(212),y=r(g),E=n(211),S=r(E),T=n(100),b=(r(T),n(214)),R=r(b),A=n(213),D=r(A),k=n(210),w=r(k),O=n(141),C=r(O),L=n(174),P=r(L),I=n(223),M=r(I),N=n(67),x=r(N),U=n(3),F=r(U),B=n(98),G=r(B),j=n(231),H=n(225),W=n(232),V={WS:"ws",WSS:"wss",HTTPS:"https",HTTP:"http"},K=function(){function e(t,n,r,i,o,l){(0,s.default)(this,e),this._lastLowToHighBufferTimestamp=a.default;var u=x.default.deepCopy(C.default);this.p2pConfig=t,(0,j.overloadP2PConfig)(u,t,r),this.conf=u;var c=(0,H.formatContentId)({contentId:t.contentId,contentUrl:n});this.eventBus=new h.default,this.workerHelper=new M.default,this.moduleState=new P.default(this.eventBus,i),this.moduleState.content=c,this.isP2PDownloadOn=!0,this.isP2PUploadOn=!0,this.peerToken=d.default.v4(),this.status=new p.default,this.peerStats=new R.default,this.transferStats=new m.default,this.efficiencyStats=new y.default,this.controlStats=new S.default,this.mediaStats=new D.default(i,o,l),this.abrStats=new w.default(this.eventBus),this.eventBus.on(F.default.BufferManager.BUFFER_TARGET_CHANGED,this._onBufferTargetChanged.bind(this))}return(0,u.default)(e,[{key:"_onBufferTargetChanged",value:function(e,t){e===G.default.LOW&&t===G.default.HIGH?this._lastLowToHighBufferTimestamp=Date.now():e===G.default.HIGH&&t===G.default.LOW&&(this._lastLowToHighBufferTimestamp=a.default)}},{key:"injectConfigFromDistributor",value:function(e){e.configuration&&(0,j.overloadConfigFromDistributor)(this.conf,e.configuration,e.isClustered);var t=this.conf.BACKEND_USE_SSL?V.HTTPS:V.HTTP,n=this.conf.BACKEND_USE_SSL?V.WSS:V.WS;this.conf.TRACKER_URL=(0,W.formatUrl)(t+"://"+e.trackerDns),this.conf.ANALYTICS.KLARA_URL=(0,W.formatUrl)(t+"://"+e.klaraDns),this.conf.SIGNALING_URL=(0,W.formatUrl)(n+"://"+e.signalingDns),this.status.setBearerToken(e.token),this._decideIfQOSTester()}},{key:"setBackendFallbackUrls",value:function(){var e=this.conf.FALLBACK_URLS;this.conf.ANALYTICS.KLARA_URL=(0,W.formatUrl)(e.KLARA_URL),this._decideIfQOSTester()}},{key:"_decideIfQOSTester",value:function(){var e=this.moduleState.isLive()?this.conf.LIVE.QOS_REF_PERCENTAGE:this.conf.QOS_REF_PERCENTAGE;e===parseFloat(e,3)&&100*Math.random()<e&&(this.conf.QOS_P2P_DISABLED=!0)}},{key:"dispose",value:function(){this.workerHelper.dispose()}},{key:"isP2PDownloadBlocked",get:function(){return Date.now()-this._lastLowToHighBufferTimestamp<this.conf.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION}}]),e}();t.default=K,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){for(var t=[],n=e.getPeerArray(),r=0,i=n.length;r<i;r++){var a=n[r].getDebugInfos();t.push(a)}return t}function a(e,t,n,r){var a=t.conf,o=t.status,s=t.controlStats,u=t.efficiencyStats,h=t.transferStats,v=t.abrStats,p=t.peerStats,_=t.bufferStats,m={backend:{distributor:a.DISTRIBUTOR.URL,klara:a.ANALYTICS.KLARA_URL,signaling:{connected:o.getConnectedToSignalingServer(),url:a.SIGNALING_URL},tracker:{connected:o.getConnected(),url:a.TRACKER_URL}},control:s,efficiency:u,transfer:h,abr:{cdnSpeed:v.cdnSpeed||0,cdnTimestamp:v.cdnTimestamp||0,p2pSpeed:v.p2pSpeed,p2pUsefulEstimate:v.p2pUsefulEstimate,concurrentP2pDownloaded:v.concurrentP2pDownloaded,concurrentP2pDownloadCount:v.concurrentP2pDownloadCount,cdnEstimationCount:v.cdnEstimationCount,zeroP2pSpeedWindowsCount:v.zeroP2pSpeedWindowsCount,p2pSpeedWindowsCount:v.p2pSpeedWindowsCount,bandwidthEstimateCV:v.bandwidthEstimateCV,feedbackCount:v.feebackCount,zeroDurationFeedbackCount:v.zeroDurationFeedbackCount},peerId:o.getMyPeerId(),peers:{info:(0,l.default)({},p,{peerPoolUploadCapacity:void 0,successPeerConnectionAttemptDuration:void 0,failedPeerConnectionAttemptDuration:void 0,locked:void 0,loosers:void 0}),pending:e?e.getPendingConnectionDebugInfos():[],connected:e?i(e):[]}};return n&&_&&(m.buffer={alwaysDynamicBuffer:_.alwaysDynamicBuffer,buffered:n.bufferedAmount,bufferRefill:_.bufferRefill,bufferState:_.bufferState,reachedLiveEdge:n._reachedLiveEdge,target:n.bufferTarget}),f?m.qos=f.getQoSAnalytics():f=new c.default(r.mediaElement,d.createInterval),m}function o(e,t,n,r){var i=t.transferStats,o=i.cdnDownloaded,s=i.p2pUseful,l=i.p2pUploaded,u=e?e.getPeerArray().length:0,c={cdn:o,p2p:s,peers:u,upload:l,confLabel:""};if(1||(c.advanced=a(e,t,n,r)),t.conf.ANALYTICS.EXPOSE_CONF_LABEL){var d=t.conf.QOS_P2P_DISABLED?"off":"on";c.confLabel=t.conf.CONF_LABEL+"|"+d}return c}Object.defineProperty(t,"__esModule",{value:!0});var s=n(246),l=r(s),u=n(130),c=r(u),d=n(4),f=null;t.default={get:o},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(){var e=!1,t={city:null,country:null,latitude:null,longitude:null},n=void 0,r=0,a=0,o=0,s=0,l=0,u=0,c=0,d=0,f="",h=!1,v="",p=this,_=void 0,m=void 0,g=new i.default,y=null,E=function(){var e=void 0,t=void 0,n=void 0,i=void 0;r&&(r>o&&(o=r),e=a?(a*_+r)/(_+1):r,t=_?_+1:1,_=t,a=e),s&&(s>u&&(u=s),n=l?(l*m+s)/(m+1):s,i=m?m+1:1,m=i,l=n)};p.getMyPeerId=function(){return n},p.setMyPeerId=function(e){n!==e&&(n=e)},p.getMyLocation=function(){return t},p.setMyLocation=function(e){t=e,g.emit("location_updated",e)},p.getDlSpeed=function(){return r},p.setDlSpeed=function(e){r=e},p.getAvgDlSpeed=function(){return a},p.getMaxDlSpeed=function(){return o},p.getUpSpeed=function(){return s},p.setUpSpeed=function(e){s=e},p.getAvgUpSpeed=function(){return l},p.getMaxUpSpeed=function(){return u},p.getCdnCancelled=function(){return d},p.increaseCdnCancelledBy=function(e){d+=e},p.getConnected=function(){return e},p.setTrackerVersion=function(e){f=e},p.getTrackerVersion=function(){return f},p.setTrackerId=function(e){v=e},p.getTrackerId=function(){return v},p.setConnected=function(t){t!==e&&(e=t,g.emit("change:connected"),!0===t?g.emit("tracker_ready"):g.emit("tracker_disconnected"))},p.getEE=function(){return g},p.setConnectedToSignalingServer=function(){h=!0,g.emit("signaling_ready")},p.setDisconnectedToSignalingServer=function(){h=!1,g.emit("signaling_disconnected")},p.getConnectedToSignalingServer=function(){return h},p.computeMaxAndAvgSpeed=E,p.setMeanInstantSpeed=function(e){c=e},p.getMeanInstantSpeed=function(){return c},p.setBearerToken=function(e){y=e},p.getBearerToken=function(){return y}};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(206),u=r(l),c=n(47),d=n(171),f=r(d),h=function(){function e(t,n){(0,a.default)(this,e),this._externalEventManager=t,this._externalEventManager.cacheMediaEvent(f.default.TRACK_CHANGE_EVENT),this._sharedState=n}return(0,s.default)(e,[{key:"listenEvents",value:function(e){var t=this._updateCurrentTracks.bind(this),n=this._onFragLoadAborted.bind(this);this._externalEventManager.addMediaEventListener(f.default.TRACK_CHANGE_EVENT,t),this._externalEventManager.addMediaEventListener(f.default.EMERGENCY_FRAG_LOAD_ABORT,n);try{this._externalEventManager.triggerCachedEvent(f.default.TRACK_CHANGE_EVENT,t)}catch(t){if(!e)throw t}}},{key:"_onFragLoadAborted",value:function(){this._sharedState.mediaStats.emergencyTrackSwitchCount++}},{key:"_updateCurrentTracks",value:function(e){var t=e.audio,n=e.video;t&&(0,c.checkInterface)(u.default,t),n&&(0,c.checkInterface)(u.default,n),this._sharedState.moduleState.currentTracks.update({audio:t,video:n})}},{key:"updateWithSegmentView",value:function(e){var t={};t[e.trackView.type]=e.trackView,this._updateCurrentTracks(t)}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){var i=t?T.default.Methods.POST:T.default.Methods.GET,a=new T.default(i,e,{headers:{Authorization:r}}),s=t?(0,o.default)(t):null;a.isStreamroot=!0,a.send(s).then(function(e){n(null,e)},function(e){n(e,null)})}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_TRACK_HASH=void 0;var a=n(38),o=r(a),s=n(24),l=r(s),u=n(0),c=r(u),d=n(1),f=r(d),h=n(34),v=r(h),p=n(172),_=r(p),m=n(23),g=r(m),y=n(4),E=n(68),S=n(35),T=r(S),b=n(3),R=r(b),A=n(6),D=r(A),k={TRACKS:"tracks",GEOLOC:"geoloc",RECONNECT:"reconnect"},w={INIT:"init",PEERS:"peers",TRACKS:"tracks",GEOLOC:"geo"},O=t.DEFAULT_TRACK_HASH="defautTrackHash",C=function(){function e(t,n,r){(0,c.default)(this,e),this._conf=r.conf,this._status=r.status,this._moduleState=r.moduleState;var i=new v.default;this._trackerProtocolVersion=this._conf.CLIENT_TRACKER_PROTOCOL_VERSION,this._playerInterface=t,this._p2pCacheStats=n,this._connected=!1,this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._timerStore=new g.default,this._callQueue=[],this._pending=!1,this.getEE=function(){return i},r.eventBus.once(R.default.Distributor.READY,this._init.bind(this))}return(0,f.default)(e,[{key:"_getVideoTrackHash",value:function(){var e=this._moduleState.currentTracks.video;return e?e.viewToString():O}},{key:"askPeers",value:function(e,t){var n=function(e,n){t(e,[n])},r={tracks:[this._getVideoTrackHash()],exclusions:e,peer_number:this._conf.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE,current_position:this._moduleState.videoCurrentTime,id:(0,E.unwrap)(this._peerID)};this._injectBufferIntoPayload(r),this._sendRequest(w.PEERS,r,n,!0)}},{key:"dispose",value:function(){this._disconnect(),this._timerStore.clearAll()}},{key:"_init",value:function(){if(!0!==this._conf.QOS_P2P_DISABLED&&""!==this._conf.TRACKER_URL){this._trackerURL=this._conf.TRACKER_URL,this._bearerToken=this._status.getBearerToken();var e=(0,E.unwrap)(this._moduleState.content),t=this._conf.P2P_PROTOCOL_VERSION,n=this._conf.ID_CLIENT,r=this._moduleState.isLive(),i=this._status.getTrackerId(),a=void 0;if(r){a={content:e,p2p_protocol:t,customer_id:n,is_live:r,buffer_level_max:this._playerInterface.getBufferLevelMax(),tracker_id:i}}else a={content:e,p2p_protocol:t,customer_id:n,is_live:r,tracker_id:i};this._sendRequest(w.INIT,a,this._onTrackerReady.bind(this),!0)}}},{key:"_onTrackerReady",value:function(e,t){if(e)return void D.default.notifyError(e);this._peerID=t.peer_id,this._status.setMyPeerId(this._peerID),this._askGeolocation(this._conf.GEOLOCATION_REQUEST_MAX_RETRY);var n=(0,y.createInterval)(this._publishTracks.bind(this),this._conf.SEND_TRACKS_INTERVAL);this._timerStore.registerAs(k.TRACKS,n),this._status.setConnected(!0),this._status.setTrackerId(t.tracker_id),this._connected=!0,this.getEE().emit("tracker_ready")}},{key:"_publishTracks",value:function(){var e={tracks:[this._getVideoTrackHash()],id:(0,E.unwrap)(this._peerID),current_position:this._moduleState.videoCurrentTime};this._injectBufferIntoPayload(e),this._sendRequest(w.TRACKS,e,function(){},!0)}},{key:"_injectBufferIntoPayload",value:function(e){var t=this._p2pCacheStats.getStats();t&&(this._moduleState.isLive()&&(t.near_edge=this._moduleState.isNearEdge),(0,l.default)(e,{buffer:t}))}},{key:"_askGeolocation",value:function(e){var t=this,n=(0,y.createTimeout)(function(){t._sendRequest(w.GEOLOC,void 0,t._makeGeolocationAnswerHandler(e),!1)},this._conf.GEOLOCATION_REQUEST_TIMEOUT);this._timerStore.registerAs(k.GEOLOC,n)}},{key:"_makeGeolocationAnswerHandler",value:function(e){var t=this;return function(n,r){if(n)0!==e?t._askGeolocation(e-1):console.warn("Geolocation failed");else{var i=new _.default(r.city,r.country,r.latitude,r.longitude);t._status.setMyLocation(i)}}}},{key:"_sendRequest",value:function(e,t,n,r){var a=this,o=function(e,t){if(e&&r)return a._disconnect(),a._scheduleReconnect(),void n(e,t);var o=a._callQueue.shift();void 0===o?a._pending=!1:i(o.url,o.data,o.callback,a._bearerToken),n(e,t)},s=this._trackerURL+e;this._pending?this._callQueue.push({url:s,data:t,callback:o}):(this._pending=!0,i(s,t,o,this._bearerToken))}},{key:"_disconnect",value:function(){this._timerStore.clearNamedTimer(k.TRACKS),this._timerStore.clearNamedTimer(k.GEOLOC),this._timerStore.clearNamedTimer(k.RECONNECT),this._pending=!1,this._callQueue=[],!0===this._connected&&(this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._status.setConnected(!1),this._connected=!1,i(this._trackerURL+"bye",{id:(0,E.unwrap)(this._peerID)},function(){},this._bearerToken),this.getEE().emit("tracker_disconnected"))}},{key:"_scheduleReconnect",value:function(){var e=(0,y.createTimeout)(this._init.bind(this),this._delayReconnection);this._timerStore.registerAs(k.RECONNECT,e),this._delayReconnection=Math.min(2*this._delayReconnection,this._conf.TRACKER_DELAY_MAX)}}]),e}();t.default=C},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=function(){function e(t){(0,s.default)(this,e),this._collection=new a.default,this._computationInterval=t}return(0,u.default)(e,[{key:"getOrCreate",value:function(e){var t=e.getId(),n=this._collection.get(t);return n||(n=e.getChunksQuantityForInterval(this._computationInterval),this._collection.set(t,n)),n}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getBinaryData",value:function(e,t,n){throw new Error("must be implemented")}},{key:"setBinaryData",value:function(e,t){throw new Error("must be implemented")}},{key:"destroy",value:function(){}},{key:"byteLength",get:function(){return this._byteLength},set:function(e){this._byteLength=e}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(4),u=n(105),c=n(3),d=r(c),f=n(199),h=r(f),v=n(198),p=r(v),_=n(100),m=r(_),g=n(227),y=r(g),E=n(98),S=r(E),T=3,b=function(){function e(t,n,r,i){(0,a.default)(this,e),this._peerCount=0,this._bufferTarget=0,this._bufferedAmount=0,this._randomBufferLevel=null,this._reachedLiveEdge=!1,this._bufferTargetState=S.default.INIT,i.bufferStats=new m.default(i.eventBus),this._streamType=r,this._sharedState=i,this._playerInterface=t,this._mediaElementPlaceholder=n,this._bufferStateMachine=new p.default(i.eventBus),this._sharedState.eventBus.on(d.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,this._onLiveEdgeChanged.bind(this)),this._sharedState.eventBus.on(d.default.SRModuleInterface.UNCOMPLETE_SEGMENT_REQUESTED,this._onUncompleteSegmentRequested.bind(this)),this._sharedState.eventBus.on(d.default.PeerPool.PEER_OPEN,this._onPeerCountChanged.bind(this)),this._sharedState.eventBus.on(d.default.PeerPool.PEER_DESTROYED,this._onPeerCountChanged.bind(this)),this._bufferCheck(),this._bufferCheckInterval=(0,l.createInterval)(this._bufferCheck.bind(this),this._sharedState.conf.LIVE.BUFFER_CHECK_INTERVAL),this._uploadCapacityCalculator=new h.default(this._sharedState)}return(0,s.default)(e,[{key:"_onUncompleteSegmentRequested",value:function(){this._isLowBufferTarget()&&(this._sharedState.eventBus.emit(d.default.BufferManager.LOW_BUFFER,this._bufferedAmount),this._setHighTarget())}},{key:"_onLiveEdgeChanged",value:function(e){this._reachedLiveEdge=e&&(this._streamType!==u.StreamTypes.SMOOTH||this._bufferedAmount>this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-T)}},{key:"_onPeerCountChanged",value:function(e){var t=e.peerCount;this._peerCount=t}},{key:"_bufferCheck",value:function(){this._bufferedAmount=y.default.getBufferedAmount(this._mediaElementPlaceholder),this._sharedState.bufferStats.bufferedAmount=this._bufferedAmount,0===this._peerCount?(this._bufferStateMachine.gotoNoPeer(),this._setHighTarget()):this._uploadCapacityCalculator.uploadCapacityEMWA>=this._sharedState.conf.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING?(this._bufferStateMachine.gotoTopSeeder(),this._setHighTarget()):null!==this._mediaElementPlaceholder.mediaElement?(this._bufferStateMachine.gotoDynamic(),this._dynamicBufferCheck()):(this._bufferStateMachine.gotoRandom(),this._setRandomTarget())}},{key:"_dynamicBufferCheck",value:function(){this._isHighBufferTarget()?(this._bufferedAmount>=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET||this._reachedLiveEdge)&&(this._sharedState.eventBus.emit(d.default.BufferManager.HIGH_BUFFER,this._bufferedAmount),this._setLowTarget()):this._isLowBufferTarget()||this._setHighTarget()}},{key:"_bufferTargetStateChanged",value:function(e){e!==this._bufferTargetState&&(this._sharedState.eventBus.emit(d.default.BufferManager.BUFFER_TARGET_CHANGED,this._bufferTargetState,e),this._bufferTargetState=e)}},{key:"_setRandomTarget",value:function(){this._bufferTargetStateChanged(S.default.RANDOM),this._bufferTarget=this._getRandomBufferLevel(),this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_setHighTarget",value:function(){this._bufferTargetStateChanged(S.default.HIGH),this._bufferTarget=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET,this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_setLowTarget",value:function(){this._bufferTargetStateChanged(S.default.LOW),this._bufferTarget=this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_isLowBufferTarget",value:function(){return this._bufferTarget===this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET}},{key:"_isHighBufferTarget",value:function(){return this._bufferTarget===this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET}},{key:"_getRandomBufferLevel",value:function(){return this._randomBufferLevel=this._randomBufferLevel||Math.floor(Math.random()*(this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET+1))+this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._randomBufferLevel}},{key:"dispose",value:function(){this._bufferCheckInterval.clear(),this._uploadCapacityCalculator.dispose()}},{key:"bufferTarget",get:function(){return this._bufferTarget}},{key:"bufferedAmount",get:function(){return this._bufferedAmount}},{key:"mediaElementPlaceholder",set:function(e){this._mediaElementPlaceholder=e}},{key:"reachedLiveEdge",get:function(){return this._reachedLiveEdge}}]),e}();t.default=b,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(3),u=r(l),c=n(97),d=r(c),f=function(){function e(t){(0,a.default)(this,e),this._ee=t,this.gotoIdle()}return(0,s.default)(e,[{key:"_setState",value:function(e){this._state!==e&&(this._prevState=this._state,this._state=e,this._prevState&&this._ee.emit(u.default.BufferManager.STATE_CHANGED,this._prevState,this._state))}},{key:"gotoIdle",value:function(){this._setState(d.default.IDLE)}},{key:"gotoNoPeer",value:function(){this._setState(d.default.NO_PEER)}},{key:"gotoRandom",value:function(){this._setState(d.default.RANDOM)}},{key:"gotoDynamic",value:function(){this._setState(d.default.DYNAMIC)}},{key:"gotoTopSeeder",value:function(){this._setState(d.default.TOP_SEEDER)}},{key:"getState",value:function(){return this._state}},{key:"isIdle",value:function(){return this._state===d.default.IDLE}},{key:"isNoPeer",value:function(){return this._state===d.default.NO_PEER}},{key:"isRandom",value:function(){return this._state===d.default.RANDOM}},{key:"isDynamic",value:function(){return this._state===d.default.DYNAMIC}},{key:"isTopSeeder",value:function(){return this._state===d.default.TOP_SEEDER}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(18),u=n(4),c=n(36),d=r(c),f=1e3,h=function(){function e(t){(0,a.default)(this,e),this._uploadSpeedDelta=new l.Delta,this._uploadSpeedTimestampDelta=new l.Delta(Date.now()),this._sharedState=t,this._uploadCapacityEMWA=new d.default(0,this._sharedState.conf.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT),this._uploadSpeedInterval=(0,u.createInterval)(this._refreshUploadSpeed.bind(this),f)}return(0,s.default)(e,[{key:"_refreshUploadSpeed",value:function(){var e=this._sharedState.transferStats.p2pUploaded,t=this._uploadSpeedDelta.calcDelta(e),n=this._uploadSpeedTimestampDelta.calcDelta(Date.now()),r=8*t/n;r>0&&this._uploadCapacityEMWA.update(r)}},{key:"dispose",value:function(){this._uploadSpeedInterval.clear()}},{key:"uploadCapacityEMWA",get:function(){return this._uploadCapacityEMWA.value}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(34),u=r(l),c=n(23),d=r(c),f=n(3),h=r(f),v=n(6),p=r(v),_=n(4),m=function(){function e(t){(0,a.default)(this,e),this._isCommunicating=!0,this._isConnected=!0,this._rtt=-1,this._ee=new u.default,this._timerStore=new d.default,this._sharedState=t}return(0,s.default)(e,[{key:"_sendHeartbeat",value:function(){return this.sendMessage("heartbeat",{videoTrack:this._getVideoTrack()})}},{key:"_manageHeartbeat",value:function(){var e=this;this._sendHeartbeat();var t=(0,_.createInterval)(function(){e._isCommunicating||(e._sharedState.controlStats.checkHeartbeatFailed++,e._closeConnectionIfOpen()),e._isCommunicating=!1},this._sharedState.conf.CHECK_HEARTBEAT_INTERVAL),n=(0,_.createInterval)(this._sendHeartbeat.bind(this),this._sharedState.conf.SEND_HEARTBEAT_INTERVAL);this._timerStore.register(t),this._timerStore.register(n)}},{key:"_getVideoTrack",value:function(){var e="noTrack";return this._sharedState.moduleState.currentTracks.video&&(e=this._sharedState.moduleState.currentTracks.video.viewToString()),e}},{key:"_setDisconnected",value:function(){if(!this._isConnected)return void p.default.notifyError(new Error("Guarded attempt to trigger 'disconnected' event on PeerConnection more than once"));this._isConnected=!1,this._ee.emit(h.default.PeerConnection.DISCONNECTED)}},{key:"_closeConnectionIfOpen",value:function(){throw new Error("Cannot call abstract method")}},{key:"sendMessage",value:function(e,t){throw new Error("Cannot call abstract method")}},{key:"sendBinaryData",value:function(e,t){throw new Error("Cannot call abstract method")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this._ee).emit.apply(t,[e].concat(r))}},{key:"on",value:function(e,t){this._ee.on(e,t)}},{key:"once",value:function(e,t){this._ee.once(e,t)}},{key:"getRtt",value:function(){return this._rtt}},{key:"getBufferedAmount",value:function(){throw new Error("Cannot call abstract method")}},{key:"onbufferedamountlow",set:function(e){throw new Error("Cannot call abstract method")}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[],n=e.split(","),r=!0,i=!1,a=void 0;try{for(var s,c=(0,l.default)(n);!(r=(s=c.next()).done);r=!0){var d=s.value,f=d.split("-"),h=""!==f[0]?Number(f[0]):NaN,v=""!==f[1]?Number(f[1]):NaN;if(1===f.length&&(0,o.default)(h))t.push(h);else{if(2!==f.length||!(0,o.default)(h)||!(0,o.default)(v))throw new Error("P2P protocol error: could not decode chunk batch");t=t.concat((0,u.range)(h,v))}}}catch(e){i=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw a}}return t}Object.defineProperty(t,"__esModule",{value:!0});var a=n(234),o=r(a),s=n(11),l=r(s),u=n(29);t.default={decode:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n={a:_[e]},r=u(e),i=o(t,r);return(0,p.default)(n,i),n}function a(e){var t=s(e.a);return{type:t,args:l(e,u(t))}}function o(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=(0,h.default)((0,d.default)(t));!(r=(o=s.next()).done);r=!0){var l=o.value;if(void 0===e[l])throw new Error("P2P protocol error: missing mandatory property "+l+" from message to encode");var u=t[l];void 0!==u&&(n[u]=e[l])}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}function s(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,h.default)((0,d.default)(_));!(t=(i=a.next()).done);t=!0){var o=i.value;if(_[o]===e)return o}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return null}function l(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=(0,h.default)((0,d.default)(t));!(r=(o=s.next()).done);r=!0){var l=o.value,u=t[l],c=e[u];if(void 0===c)throw new Error("P2P protocol error: could not decode property "+l+" from encoded payload");n[l]=c}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}function u(e){switch(e){case"info":return m;case"heartbeat":return S;case"requestHasSegment":return g;case"hasSegment":return y;case"requestChunks":return E;default:throw new Error("P2P protocol error: unhandled message type")}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(72),d=r(c),f=n(11),h=r(f),v=n(24),p=r(v),_={info:"a",requestHasSegment:"b",hasSegment:"c",requestChunks:"d",heartbeat:"e"},m={city:"c",country:"d",latitude:"e",longitude:"f"},g={segmentCoord:"b"},y={segmentInfo:"b",pushed:"c"},E={segmentCoord:"b",ids:"c",safe:"d"},S={videoTrack:"b"};t.default={encode:i,decode:a},e.exports=t.default},function(e,t,n){"use strict";function r(e,t,n,r){return 0?new i(e,t,n,r):new i(e,t,r)}Object.defineProperty(t,"__esModule",{value:!0});var i=void 0;i=0?require("./BrowserPeerConnector"):n(91),t.default=r,e.exports=t.default},function(e,t,n){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,r){var i=r.status,a=function(){for(var n={download:{p2pUseful:r.transferStats.p2pUseful,p2pUploaded:r.transferStats.p2pUploaded,cdnDownloaded:r.transferStats.cdnDownloaded,dlSpeed:i.getDlSpeed(),upSpeed:i.getUpSpeed(),p2pDownloaded:r.transferStats.p2pUseful,p2pDownloadedNewAnalytics:r.transferStats.p2pUseful},peers:{count:0},buffer:{bufferTarget:t?t.bufferTarget:0,bufferedAmount:t?t.bufferedAmount:void 0,reachedLiveEdge:t?t._reachedLiveEdge:void 0},tracker:{connected:i.getConnected()},trackerConnected:i.getConnected(),sigConnected:i.getConnectedToSignalingServer(),isLive:r.moduleState.isLive()},a=[],o=0;o<e.getPeerArray().length;o++){var s=e.getPeerArray()[o];s.getId()&&n.peers.count++,a.push(s.getDebugInfos())}return n.peerList=a,1||(n.pendingConnectionList=e.getPendingConnectionDebugInfos()),n};!function(){console.warn("SR_DISPLAY_INTERFACE is deprecated, use Streamroot.PeerAgents[<id>] instead."),n.SR_DISPLAY_INTERFACE={getStats:a}}(),this.dispose=function(){delete window.SR_DISPLAY_INTERFACE}};t.default=r,e.exports=t.default}).call(t,n(45))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getSegmentTime",value:function(e){}},{key:"getSegmentList",value:function(e,t,n){}},{key:"getTrackList",value:function(){}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"viewToString",value:function(){return""}},{key:"isEqual",value:function(e){return!0}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(99),p=r(v),_=function(e){function t(){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,u.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.audio;t&&(e=this._getSegmentsToDownloadByTrack(t,"audio"));var n=this._currentTracks.video;n&&(e=e.concat(this._getSegmentsToDownloadByTrack(n,"video")));var r=e.sort(function(e,t){return e.getId()-t.getId()});return this._sharedState.conf.USE_VOD_PUSH_PATCH?r.slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER):r}},{key:"updateTrackEdge",value:function(e){var t=this._findTrack(e);"audio"===t?this._edges.update({audio:e,video:null}):"video"===t&&this._edges.update({audio:null,video:e})}},{key:"_findTrack",value:function(e){var t=this._currentTracks.video;if(t&&e.isInTrack(t))return"video";var n=this._currentTracks.audio;return n&&e.isInTrack(n)?"audio":void 0}}]),t}(p.default);t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(99),p=r(v),_=function(e){function t(){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,u.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.video;t&&(e=this._getSegmentsToDownloadByTrack(t,"video"));var n=e.sort(function(e,t){return e.getId()-t.getId()});return this._sharedState.conf.USE_VOD_PUSH_PATCH?n.slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER):n}},{key:"updateTrackEdge",value:function(e){this._currentTracks.video&&e.isInTrack(this._currentTracks.video)&&this._edges.update({video:e,audio:null})}}]),t}(p.default);t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r,i){return"hls"===r?new o.default(e,t,n,i):new l.default(e,t,n,i)}Object.defineProperty(t,"__esModule",{value:!0}),t.createScheduler=i;var a=n(208),o=r(a),s=n(207),l=r(s)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(34),u=(r(l),n(3)),c=r(u),d=n(36),f=r(d),h=n(104),v=r(h),p=.1,_=function(){function e(t){var n=this;(0,a.default)(this,e),this.cdnSpeed=null,this.cdnTimestamp=null,this.p2pSpeed=0,this.estimatedBitrate=0,this.p2pUsefulEstimate=1,this.concurrentP2pDownloaded=0,this.concurrentP2pDownloadCount=0,this.cdnEstimationCount=0,this.zeroP2pSpeedWindowsCount=0,this.p2pSpeedWindowsCount=0,this.feebackCount=0,this.zeroDurationFeedbackCount=0,this.trackSwitchWithPeers=0,this._addBandwidthEstimate=function(e){n.feebackCount++;var t=e.p2pDuration+e.cdnDuration;if(0===t)return void n.zeroDurationFeedbackCount++;var r=e.p2pDownloaded+e.cdnDownloaded/t;n._bandwidthEWMA?n._bandwidthEWMA.update(r):n._bandwidthEWMA=new f.default(r,p),n._bandwidthEstimates.push(n._bandwidthEWMA.value)},this._bandwidthEstimates=[],this._eventBus=t,this._eventBus.on(c.default.SRModuleInterface.ABR_FEEDBACK,this._addBandwidthEstimate)}return(0,s.default)(e,[{key:"flushBandwidthEstimates",value:function(){this._bandwidthEstimates=[]}},{key:"dispose",value:function(){this.flushBandwidthEstimates()}},{key:"bandwidthEstimateCV",get:function(){var e=v.default.meanAbsoluteDeviation(this._bandwidthEstimates),t=v.default.mean(this._bandwidthEstimates);return e&&t&&0!==t?e/t:0}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e),this._sampledIceGatheringDuration=0,this.missedIceCandidateCount=0,this.gatheredIceCandidateCount=0,this.iceCandidatesBucketCount=0,this.earlyIceGatheringFinishedCount=0,this.newPeerConnectionCount=0,this.nbRightHashP2P=0,this.nbWrongHashP2P=0,this.nbRightHashDLM=0,this.nbWrongHashDLM=0,this.checkHeartbeatFailed=0,this.getSegmentSuccess=0,this.getSegmentFallback=0,this.segmentLockTimeout=0,this.fillSegmentSuccess=0,this.fillSegmentFallback=0,this.fillSegmentTimeout=0}return(0,s.default)(e,[{key:"getSampledIceGatheringDuration",value:function(){var e=this._sampledIceGatheringDuration;return this._sampledIceGatheringDuration=0,e}},{key:"setSampledIceGatheringDuration",value:function(e){0===this._sampledIceGatheringDuration&&(this._sampledIceGatheringDuration=e)}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function e(){(0,i.default)(this,e),this.receivedChunkRequestCount=0,this.dequeuedReceivedChunkRequestCount=0,this.missedDequeuedChunkRequestCount=0,this.safeChunkRequestCount=0,this.unsafeChunkRequestCount=0,this.safeChunkRequestTimeoutCount=0,this.unsafeChunkRequestTimeoutCount=0,this.gracedChunksCount=0,this.expiredGraceChunksCount=0};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=function(){function e(t,n,r){(0,s.default)(this,e),this.abortFragmentCount=0,this.emergencyTrackSwitchCount=0,this._playerInterface=t,this._mediaElementPlaceholder=n,this._mediaMap=r}return(0,u.default)(e,[{key:"duration",get:function(){return!this._playerInterface.isLive()&&this._mediaElementPlaceholder.mediaElement?this._mediaElementPlaceholder.mediaElement.duration:0}},{key:"videoTrackCount",get:function(){var e=this._mediaMap.getTrackList(),t=0,n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(e);!(n=(o=s.next()).done);n=!0){var l=o.value;l.type&&"video"!==l.type||t++}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return t}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(70),u=r(l),c=n(230),d=r(c),f=20,h=function(){function e(){(0,a.default)(this,e),this.match=0,this.excessMatch=0,this.offer=0,this.openedMatch=0,this.openedOffer=0,this.unansweredOffer=0,this.active=0,this.transfer=0,this.denied=0,this.droppedSameTrack=0,this.droppedOtherTrack=0,this.offerTimeout=0,this.answerTimeout=0,this.timeoutNewConnection=0,this.timeoutCheckingConnection=0,this.timeoutFailedConnection=0,this.timeoutNewIce=0,this.timeoutGatheringIce=0,this.timeoutCompleteIce=0,this.disconnected=0,this.lateMessage=0,this.maxPUC=0,this.exclusionSize=0,this.timeoutLocalSdp=0,this.timeoutRemoteSdp=0,this.timeoutLocalSdpWithStun=0,this.timeoutRemoteSdpWithStun=0,this.timeoutWithLocalStunIce=0,this.timeoutWithRemoteStunIce=0,this.peerPoolUploadCapacity=new u.default,this.locked=new u.default,this.loosers=new u.default,this.successPeerConnectionAttemptDuration=new d.default(f),this.failedPeerConnectionAttemptDuration=new d.default(f)}return(0,s.default)(e,[{key:"incrementTimeout",value:function(e,t,n,r){switch(n?this.offerTimeout++:this.answerTimeout++,r.hasLocalDescription&&this.timeoutLocalSdp++,r.hasRemoteDescription&&this.timeoutRemoteSdp++,r.hasLocalDescriptionWithStun&&this.timeoutLocalSdpWithStun++,r.hasRemoteDescriptionWithStun&&this.timeoutRemoteSdpWithStun++,r.hasLocalStunIceCandidate&&this.timeoutWithLocalStunIce++,r.hasRemoteStunIceCandidate&&this.timeoutWithRemoteStunIce++,e){case"new":this.timeoutNewConnection++;break;case"checking":this.timeoutCheckingConnection++;break;case"failed":this.timeoutFailedConnection++}switch(t){case"new":this.timeoutNewIce++;break;case"gathering":this.timeoutGatheringIce++;break;case"complete":this.timeoutCompleteIce++}}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(){(0,a.default)(this,e),this._p2pUseful=0,this.cdnDownloaded=0,this.p2pConsumed=0,this.cdnConsumed=0,this.p2pMediaDownloaded=0,this.p2pHeadersDownloaded=0,this.p2pMessagesDownloaded=0,this.p2pMessagesCount=0,this.p2pUploaded=0,this.multipleDlPP=0,this.multipleDlPC=0,this.multipleDlCP=0,this.multipleDlCC=0,this.multipleDlHP=0,this.multipleDlHD=0,this.multipleDlM=0}return(0,s.default)(e,[{key:"p2pUseful",get:function(){return this._p2pUseful},set:function(e){if(e<this._p2pUseful)throw new TypeError("p2pUseful increment is not a positive number");this._p2pUseful=e}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CurrentTracks=void 0;var i=n(109),a=r(i),o=n(50),s=r(o),l=n(0),u=r(l),c=n(1),d=r(c),f=n(3),h=r(f);t.CurrentTracks=function(){function e(t){(0,u.default)(this,e),this.audio=void 0,this.video=void 0,this._globalEventBus=t,this._lastSwitchTimestamp=s.default,(0,a.default)(this)}return(0,d.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(!t&&!n)throw new Error("There must be at least one updated track");!t||this.audio&&this.audio.viewToString()===t.viewToString()||(this.audio=t,this._globalEventBus.emit(h.default.Metrics.TRACK_SWITCH,{isVideo:!1})),!n||this.video&&this.video.viewToString()===n.viewToString()||(this.video=n||this.video,this._lastSwitchTimestamp=Date.now(),this._globalEventBus.emit(h.default.Metrics.TRACK_SWITCH,{isVideo:!0}))}},{key:"lastSwitchTimestamp",get:function(){return this._lastSwitchTimestamp}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(51),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(165),d=r(c),f=n(187),h=r(f),v=n(66),p=r(v),_=n(47),m=function(){function e(t,n,r,i,o){(0,s.default)(this,e),(0,_.checkInterface)(p.default,t),this.segmentCoord=t,this.chunkManager=new d.default(t,n,r,i,o),this.seeders=new h.default(o.conf),(0,a.default)(this)}return(0,u.default)(e,[{key:"hasChunksToDownload",get:function(){return this.chunkManager.hasChunksToDownload}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(109),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=function(){function e(t,n){(0,s.default)(this,e),this.audio=void 0,this.video=void 0,this._mediaMapCache=t,this._moduleState=n.moduleState,(0,a.default)(this)}return(0,u.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(void 0===t&&void 0===n)throw new Error("There must be at least one updated track edge");t&&(this.audio=t),n&&(this.video=n,this._moduleState.videoCurrentTime=this._mediaMapCache.getSegmentTime(n))}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e,t){function n(e,t){var n=r.getSegmentHandler(t.segmentCoord).chunkManager;n&&n.getChunk(t.chunkIndex,function(n){n?e.onChunkFound(t,n):e.onChunkMissed()})}var r=e;t.eventBus.on(i.default.UploadQueue.CHUNK_REQUESTED,n)};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=n(48),u=r(l),c=function(){function e(t){(0,a.default)(this,e),this._safeQueue=[],this._unsafeQueue=[],this._sharedState=t}return(0,s.default)(e,[{key:"push",value:function(e){this._sharedState.conf.SPLIT_UPLOAD_QUEUE&&e.bandwidthSafety!==u.default.SAFE?this._unsafeQueue.push(e):this._safeQueue.push(e)}},{key:"shift",value:function(){return this._safeQueue.length?this._safeQueue.shift():this._unsafeQueue.shift()}},{key:"dispose",value:function(){this._safeQueue=[],this._unsafeQueue=[]}},{key:"length",get:function(){return this._safeQueue.length+this._unsafeQueue.length}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(95),p=r(v),_=function(e){function t(e,n,r,i){(0,s.default)(this,t);var o=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,i));return o._sharedState=r,o}return(0,h.default)(t,e),(0,u.default)(t,[{key:"isExpired",get:function(){var e=this._sharedState.moduleState.isLive()?this._sharedState.conf.LIVE.CHUNK_UP_TIMEOUT:this._sharedState.conf.CHUNK_UP_TIMEOUT;return Date.now()-this._timestamp>e}}]),t}(p.default);t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),a=r(i),o=n(0),s=r(o),l=n(1),u=r(l),c=n(10),d=r(c),f=n(9),h=r(f),v=n(220),p=r(v),_=n(103),m=r(_),g=n(3),y=r(g),E=function(e){function t(e,n){(0,s.default)(this,t);var r=new p.default(n),i=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,r));return i._dataUploaded=0,i._onTransfering=function(){},i._peerConnection=e,i._sharedState=n,i._peerConnection.onbufferedamountlow=i._onBufferedAmountLow.bind(i),i._splittedQueue=r,i}return(0,h.default)(t,e),(0,u.default)(t,[{key:"_validateItem",value:function(e){return!e.isExpired}},{key:"_dequeuedCallback",value:function(e){this._sharedState.efficiencyStats.dequeuedReceivedChunkRequestCount++,this._sharedState.eventBus.emit(y.default.UploadQueue.CHUNK_REQUESTED,this,e)}},{key:"onChunkFound",value:function(e,t){var n=t.byteLength;this._peerConnection.sendBinaryData(t,e)&&(this._dataUploaded+=n,this._sharedState.transferStats.p2pUploaded+=n,this._onTransfering())}},{key:"onChunkMissed",value:function(){this._sharedState.efficiencyStats.missedDequeuedChunkRequestCount++,this.tryDequeue()}},{key:"_canDequeue",value:function(){return this._peerConnection.getBufferedAmount()<=this._sharedState.conf.UP_MAX_BUFFERED_AMOUNT}},{key:"_onBufferedAmountLow",value:function(){this.tryDequeue()}},{key:"dispose",value:function(){this._splittedQueue.dispose()}},{key:"dataUploaded",get:function(){return this._dataUploaded}},{key:"onTransfering",set:function(e){this._onTransfering=e}}]),t}(m.default);t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=void 0;l=0?require("./browser/callHashWorker"):n(92).callHashWorker;var u=function(){function e(){(0,a.default)(this,e),this._disposed=!1}return(0,s.default)(e,[{key:"callHashWorker",value:function(e,t){var n=this;return l(e,function(){n._disposed||t.apply(void 0,arguments)})}},{key:"dispose",value:function(){this._disposed=!0}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){for(var n=[],r=0;r<e.length;r++)(0,a.default)(e[r],t)||n.push(e[r]);return n}Object.defineProperty(t,"__esModule",{value:!0});var i=n(240),a=function(e){return e&&e.__esModule?e:{default:e}}(i);t.default={without:r},e.exports=t.default},function(e,t,n){"use strict";function r(e,t){if("string"!=typeof e||!e.length)throw new TypeError(t)}function i(e){var t=e.contentUrl,n=e.contentId;if(null!==n&&void 0!==n)return r(n,"Unvalid p2pConfig property: contentId needs to be a non-empty string"),n;r(t,"Unvalid PeerAgent constructor argument: contentUrl needs to be a non-empty string");var i=o.default.parse(t,!0,!0);return i.host+i.pathname}Object.defineProperty(t,"__esModule",{value:!0}),t.formatContentId=void 0;var a=n(327),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.formatContentId=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.noop=function(){}},function(e,t,n){"use strict";function r(e){if(null===e.mediaElement)return 0;for(var t=e.mediaElement.buffered,n=e.mediaElement.currentTime,r=n,a=0;a<t.length;a++)t.start(a)<r+i&&t.end(a)>r&&(r=t.end(a));return r-n}Object.defineProperty(t,"__esModule",{value:!0});var i=.3;t.default={getBufferedAmount:r},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){window.Streamroot=window.Streamroot||{},window.Streamroot.Downloader=window.Streamroot.Downloader||e,window.Streamroot.peerAgents=window.Streamroot.peerAgents||{},window.Streamroot.uaHelper=c.default,Object.defineProperty(window.Streamroot,"p2pAvailable",{get:function(){var e=(0,l.default)(window.Streamroot.peerAgents);return e.length?window.Streamroot.peerAgents[e[0]].isP2PEnabled:(0,d.isP2PAvailable)()}})}function a(e,t){window.Streamroot.peerAgents&&(window.Streamroot.peerAgents[e]=t.PublicAPI)}function o(e){window.Streamroot.peerAgents[e]&&delete window.Streamroot.peerAgents[e]}Object.defineProperty(t,"__esModule",{value:!0});var s=n(72),l=r(s),u=n(71),c=r(u),d=n(102);t.default={setup:i,addToPeerAgentList:a,removeFromPeerAgentList:o},e.exports=t.default},function(e,t,n){"use strict";function r(e){var t=e.version,n={version:t,get isP2PEnabled(){return e.isP2PEnabled},get stats(){return e.stats},get p2pDownloadOn(){return e.p2pDownloadOn},set p2pDownloadOn(t){e.p2pDownloadOn=t},get p2pUploadOn(){return e.p2pUploadOn},set p2pUploadOn(t){e.p2pUploadOn=t}};return 1||Object.defineProperty(n,"internals",{get:function(){return e.internals}}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.default={get:r},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),l=function(){function e(t){(0,a.default)(this,e),this._maxSize=t,this._internalQueue=[]}return(0,s.default)(e,[{key:"addSample",value:function(e){this._internalQueue.length>=this._maxSize&&this._internalQueue.shift(),this._internalQueue.push(e)}},{key:"fetchSample",value:function(){if(this._internalQueue.length>0){var e=Math.floor(Math.random()*this._internalQueue.length);return this._internalQueue.splice(e,1)[0]}}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e,t,n){if(void 0!==t.backendUrl&&(e.DISTRIBUTOR.URL=t.backendUrl,e.DISTRIBUTOR.OVERRIDDEN=!0),t.cacheSize&&(e.P2P_CACHE_MAX_SIZE=1024*t.cacheSize*1024,e.LIVE.P2P_CACHE_MAX_SIZE=e.P2P_CACHE_MAX_SIZE),void 0!==t.activateP2P&&(e.ALLOW_P2P=!!t.activateP2P),void 0!==t.debug&&(e.DEBUG=!!t.debug),t.signalingUrl&&(e.SIGNALING_URL=t.signalingUrl),t.trackerUrl&&(e.TRACKER_URL=t.trackerUrl),t.analyticsUrl&&(e.ANALYTICS.KLARA_URL=t.analyticsUrl),t.deviceInfo&&(e.DEVICE_INFO=t.deviceInfo),void 0!==t.rangeRequestEnabled&&(e.RANGE_REQUEST_ALLOWED=!!t.rangeRequestEnabled),void 0!==t.enableStunServers&&(e.ENABLE_STUN=!!t.enableStunServers),!t.streamrootKey)throw new Error("There must be a streamrootKey in the P2PConfig object");e.ID_CLIENT=t.streamrootKey,e.ENABLE_MOBILE_BROWSER=!!t.mobileBrowserEnabled,e.P2P_PROTOCOL_VERSION+="-"+n}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t.CONF_LABEL)return void o.default.notify("Received config from distributor, but no CONF_LABEL was present");e.CONF_LABEL=t.CONF_LABEL,n&&(e.P2P_PROTOCOL_VERSION+="-"+e.CONF_LABEL),void 0!==t.BACKEND_USE_SSL&&(e.BACKEND_USE_SSL=t.BACKEND_USE_SSL),void 0!==t.CHUNK_BATCHING_INTERVAL&&(e.CHUNK_BATCHING_INTERVAL=t.CHUNK_BATCHING_INTERVAL),void 0!==t.NB_SEGMENT_P2P_PREBUFFER&&(e.NB_SEGMENT_P2P_PREBUFFER=t.NB_SEGMENT_P2P_PREBUFFER),void 0!==t.MAX_BUFFER_DURATION&&(e.MAX_BUFFER_DURATION=t.MAX_BUFFER_DURATION),void 0!==t.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE&&(e.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE=t.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE),void 0!==t.CHUNK_TIMEOUT&&(e.CHUNK_TIMEOUT=t.CHUNK_TIMEOUT),void 0!==t.CHUNK_UP_TIMEOUT&&(e.CHUNK_UP_TIMEOUT=t.CHUNK_UP_TIMEOUT),void 0!==t.ICECANDIDATES_TIMEOUT&&(e.ICECANDIDATES_TIMEOUT=t.ICECANDIDATES_TIMEOUT),void 0!==t.UP_BUFFERED_AMOUNT_LOW_THRESHOLD&&(e.UP_BUFFERED_AMOUNT_LOW_THRESHOLD=t.UP_BUFFERED_AMOUNT_LOW_THRESHOLD),void 0!==t.UP_MAX_BUFFERED_AMOUNT&&(e.UP_MAX_BUFFERED_AMOUNT=t.UP_MAX_BUFFERED_AMOUNT),void 0!==t.OFFER_DECLINED_EXCLUSION_DURATION&&(e.OFFER_DECLINED_EXCLUSION_DURATION=t.OFFER_DECLINED_EXCLUSION_DURATION),void 0!==t.PEER_REMOVED_EXCLUSION_DURATION&&(e.PEER_REMOVED_EXCLUSION_DURATION=t.PEER_REMOVED_EXCLUSION_DURATION),void 0!==t.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION&&(e.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION=t.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION),void 0!==t.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER&&(e.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER=t.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER),void 0!==t.ALLOW_LIVE_PUSH_SEGMENT&&(e.ALLOW_LIVE_PUSH_SEGMENT=t.ALLOW_LIVE_PUSH_SEGMENT),void 0!==t.ALLOW_VOD_PUSH_SEGMENT&&(e.ALLOW_VOD_PUSH_SEGMENT=t.ALLOW_VOD_PUSH_SEGMENT),void 0!==t.USE_VOD_PUSH_PATCH&&(e.USE_VOD_PUSH_PATCH=t.USE_VOD_PUSH_PATCH),void 0!==t.STUNSERVERS&&(e.STUNSERVERS=t.STUNSERVERS),void 0!==t.TRANSFORM_SDP&&(e.TRANSFORM_SDP=t.TRANSFORM_SDP),void 0!==t.LIVE&&(void 0!==t.LIVE.CHUNK_TIMEOUT&&(e.LIVE.CHUNK_TIMEOUT=t.LIVE.CHUNK_TIMEOUT),void 0!==t.LIVE.CHUNK_UP_TIMEOUT&&(e.LIVE.CHUNK_UP_TIMEOUT=t.LIVE.CHUNK_UP_TIMEOUT),void 0!==t.LIVE.LOWER_BUFFER_TARGET&&(e.LIVE.LOWER_BUFFER_TARGET=t.LIVE.LOWER_BUFFER_TARGET),void 0!==t.LIVE.HIGHER_BUFFER_TARGET&&(e.LIVE.HIGHER_BUFFER_TARGET=t.LIVE.HIGHER_BUFFER_TARGET),void 0!==t.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT&&(e.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT=t.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT),void 0!==t.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING&&(e.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING=t.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING),void 0!==t.LIVE.QOS_REF_PERCENTAGE&&(e.LIVE.QOS_REF_PERCENTAGE=t.LIVE.QOS_REF_PERCENTAGE),void 0!==t.LIVE.NEAR_EDGE_MARGIN&&(e.LIVE.NEAR_EDGE_MARGIN=t.LIVE.NEAR_EDGE_MARGIN),void 0!==t.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION&&(e.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION=t.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION)),void 0!==t.QOS_REF_PERCENTAGE&&(e.QOS_REF_PERCENTAGE=t.QOS_REF_PERCENTAGE),void 0!==t.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL&&(e.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL=t.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL),void 0!==t.DEFAULT_PEER_UPLOAD_CAPACITY&&(e.DEFAULT_PEER_UPLOAD_CAPACITY=t.DEFAULT_PEER_UPLOAD_CAPACITY),void 0!==t.MIN_PEER_UPLOAD_CAPACITY&&(e.MIN_PEER_UPLOAD_CAPACITY=t.MIN_PEER_UPLOAD_CAPACITY),void 0!==t.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO&&(e.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO=t.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO),void 0!==t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP&&(e.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP=t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP),void 0!==t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN&&(e.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN=t.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN),void 0!==t.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO&&(e.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO=t.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO),void 0!==t.PUC_EMWA_WEIGHT_CAP&&(e.PUC_EMWA_WEIGHT_CAP=t.PUC_EMWA_WEIGHT_CAP),void 0!==t.PEER_UPLOAD_CAPACITY_SAFE_RATIO&&(e.PEER_UPLOAD_CAPACITY_SAFE_RATIO=t.PEER_UPLOAD_CAPACITY_SAFE_RATIO),void 0!==t.PEER_UPLOAD_CAPACITY_EXTRA_RATIO&&(e.PEER_UPLOAD_CAPACITY_EXTRA_RATIO=t.PEER_UPLOAD_CAPACITY_EXTRA_RATIO),void 0!==t.SPLIT_UPLOAD_QUEUE&&(e.SPLIT_UPLOAD_QUEUE=t.SPLIT_UPLOAD_QUEUE),void 0!==t.USE_CONTINOUS_PROGRESS_FEEDBACK&&(e.USE_CONTINOUS_PROGRESS_FEEDBACK=t.USE_CONTINOUS_PROGRESS_FEEDBACK),void 0!==t.PROGRESS_ADD_TOTAL&&(e.PROGRESS_ADD_TOTAL=t.PROGRESS_ADD_TOTAL),void 0!==t.DATACHANNEL_MAX_PACKET_LIFETIME&&(e.DATACHANNEL_MAX_PACKET_LIFETIME=t.DATACHANNEL_MAX_PACKET_LIFETIME),void 0!==t.DATACHANNEL_TYPE&&(e.DATACHANNEL_TYPE=t.DATACHANNEL_TYPE),void 0!==t.DATACHANNEL_MAX_RETRANSMITS&&(e.DATACHANNEL_MAX_RETRANSMITS=t.DATACHANNEL_MAX_RETRANSMITS),void 0!==t.ANALYTICS&&void 0!==t.ANALYTICS.EXPOSE_CONF_LABEL&&(e.ANALYTICS.EXPOSE_CONF_LABEL=t.ANALYTICS.EXPOSE_CONF_LABEL),void 0!==t.RANGE_REQUEST_ALLOWED&&(e.RANGE_REQUEST_ALLOWED=t.RANGE_REQUEST_ALLOWED),void 0!==t.ENABLE_STUN&&(e.ENABLE_STUN=t.ENABLE_STUN),void 0!==t.P2P_SPEED_ZERO_THRESHOLD&&(e.P2P_SPEED_ZERO_THRESHOLD=t.P2P_SPEED_ZERO_THRESHOLD),void 0!==t.P2P_SPEED_ESTIMATION_BUCKET_DURATION&&(e.P2P_SPEED_ESTIMATION_BUCKET_DURATION=t.P2P_SPEED_ESTIMATION_BUCKET_DURATION),void 0!==t.P2P_SPEED_ESTIMATION_BUCKET_COUNT&&(e.P2P_SPEED_ESTIMATION_BUCKET_COUNT=t.P2P_SPEED_ESTIMATION_BUCKET_COUNT),void 0!==t.P2P_SPEED_EMA_WEIGHT&&(e.P2P_SPEED_EMA_WEIGHT=t.P2P_SPEED_EMA_WEIGHT),void 0!==t.P2P_SPEED_EMA_ZERO_HALF_LIFE&&(e.P2P_SPEED_EMA_ZERO_HALF_LIFE=t.P2P_SPEED_EMA_ZERO_HALF_LIFE),void 0!==t.P2P_USEFUL_SMA_WINDOW&&(e.P2P_USEFUL_SMA_WINDOW=t.P2P_USEFUL_SMA_WINDOW),void 0!==t.P2P_USEFUL_CALCULATION_INTERVAL&&(e.P2P_USEFUL_CALCULATION_INTERVAL=t.P2P_USEFUL_CALCULATION_INTERVAL),void 0!==t.P2P_USEFUL_RATIO_WEIGHT&&(e.P2P_USEFUL_RATIO_WEIGHT=t.P2P_USEFUL_RATIO_WEIGHT),void 0!==t.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION&&(e.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION=t.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION),void 0!==t.CDN_SPEED_ESTIMATE_CONSIDER_P2P&&(e.CDN_SPEED_ESTIMATE_CONSIDER_P2P=t.CDN_SPEED_ESTIMATE_CONSIDER_P2P),void 0!==t.ABR_SEGMENT_CDN_RATIO_THRESHOLD&&(e.ABR_SEGMENT_CDN_RATIO_THRESHOLD=t.ABR_SEGMENT_CDN_RATIO_THRESHOLD),void 0!==t.ABR_CDN_DL_THRESHOLD&&(e.ABR_CDN_DL_THRESHOLD=t.ABR_CDN_DL_THRESHOLD),void 0!==t.ABR_CDN_DL_DECAY_TIME&&(e.ABR_CDN_DL_DECAY_TIME=t.ABR_CDN_DL_DECAY_TIME),void 0!==t.USE_COMBINED_ABR_FEEDBACK&&(e.USE_COMBINED_ABR_FEEDBACK=t.USE_COMBINED_ABR_FEEDBACK),void 0!==t.CDN_CONCURRENT_SCALING_CAP&&(e.CDN_CONCURRENT_SCALING_CAP=t.CDN_CONCURRENT_SCALING_CAP),void 0!==t.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD&&(e.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD=t.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD),void 0!==t.PEER_UPLOAD_SPEED_EMA_HALF_LIFE&&(e.PEER_UPLOAD_SPEED_EMA_HALF_LIFE=t.PEER_UPLOAD_SPEED_EMA_HALF_LIFE),void 0!==t.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE&&(e.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE=t.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE),void 0!==t.PEER_INIT_LOCKED_DURATION&&(e.PEER_INIT_LOCKED_DURATION=t.PEER_INIT_LOCKED_DURATION),void 0!==t.PEER_LOCKED_UPLOAD_THRESHOLD&&(e.PEER_LOCKED_UPLOAD_THRESHOLD=t.PEER_LOCKED_UPLOAD_THRESHOLD),void 0!==t.PEER_LOCKED_DOWNLOAD_THRESHOLD&&(e.PEER_LOCKED_DOWNLOAD_THRESHOLD=t.PEER_LOCKED_DOWNLOAD_THRESHOLD),void 0!==t.PEER_SPEED_MONITOR_INTERVAL&&(e.PEER_SPEED_MONITOR_INTERVAL=t.PEER_SPEED_MONITOR_INTERVAL),void 0!==t.PEER_TIMEOUT_RATIO_WINDOW&&(e.PEER_TIMEOUT_RATIO_WINDOW=t.PEER_TIMEOUT_RATIO_WINDOW),void 0!==t.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD&&(e.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD=t.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD),void 0!==t.LOOSER_UPLOAD_THRESHOLD&&(e.LOOSER_UPLOAD_THRESHOLD=t.LOOSER_UPLOAD_THRESHOLD),void 0!==t.CHUNK_GRACE_DURATION&&(e.CHUNK_GRACE_DURATION=t.CHUNK_GRACE_DURATION),void 0!==t.PEER_POOL_LIMIT&&(e.PEER_POOL_LIMIT=t.PEER_POOL_LIMIT),void 0!==t.RESERVED_OFFER_SLOTS&&(e.RESERVED_OFFER_SLOTS=t.RESERVED_OFFER_SLOTS),void 0!==t.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL&&(e.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL=t.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL),void 0!==t.EXPECTED_CONNECTION_SUCCESS_RATE&&(e.EXPECTED_CONNECTION_SUCCESS_RATE=t.EXPECTED_CONNECTION_SUCCESS_RATE),void 0!==t.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&(e.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON=t.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON),void 0!==t.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION&&(e.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION=t.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION),void 0!==t.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE&&(e.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE=t.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE),void 0!==t.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE&&(e.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE=t.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE),void 0!==t.MAX_TRACKER_EXCLUSION_LENGTH&&(e.MAX_TRACKER_EXCLUSION_LENGTH=t.MAX_TRACKER_EXCLUSION_LENGTH),void 0!==t.PEER_DISCONNECTED_EXCLUSION_DURATION&&(e.PEER_DISCONNECTED_EXCLUSION_DURATION=t.PEER_DISCONNECTED_EXCLUSION_DURATION),void 0!==t.PEER_DISCONNECTED_EXCLUSION_RANK&&(e.PEER_DISCONNECTED_EXCLUSION_RANK=t.PEER_DISCONNECTED_EXCLUSION_RANK),void 0!==t.OFFER_DECLINED_EXCLUSION_RANK&&(e.OFFER_DECLINED_EXCLUSION_RANK=t.OFFER_DECLINED_EXCLUSION_RANK),void 0!==t.PEER_REMOVED_EXCLUSION_RANK&&(e.PEER_REMOVED_EXCLUSION_RANK=t.PEER_REMOVED_EXCLUSION_RANK),void 0!==t.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK&&(e.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK=t.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK)}Object.defineProperty(t,"__esModule",{value:!0}),t.overloadConfigFromDistributor=t.overloadP2PConfig=void 0;var a=n(6),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.overloadP2PConfig=r,t.overloadConfigFromDistributor=i},function(e,t,n){"use strict";function r(){String.prototype.endsWith=function(e){var t=this.toString();return t.lastIndexOf(e)===t.length-1}}function i(e){return e.endsWith("/")?e:e+"/"}Object.defineProperty(t,"__esModule",{value:!0}),t.polyfillEndsWith=r,t.formatUrl=i,String.prototype.endsWith||r()},function(e,t,n){e.exports={default:n(249),__esModule:!0}},function(e,t,n){e.exports={default:n(252),__esModule:!0}},function(e,t,n){e.exports={default:n(253),__esModule:!0}},function(e,t,n){e.exports={default:n(256),__esModule:!0}},function(e,t,n){e.exports={default:n(257),__esModule:!0}},function(e,t,n){e.exports={default:n(258),__esModule:!0}},function(e,t,n){e.exports={default:n(262),__esModule:!0}},function(e,t,n){e.exports={default:n(263),__esModule:!0}},function(e,t,n){e.exports={default:n(266),__esModule:!0}},function(e,t,n){e.exports={default:n(267),__esModule:!0}},function(e,t,n){e.exports={default:n(269),__esModule:!0}},function(e,t,n){e.exports={default:n(270),__esModule:!0}},function(e,t,n){e.exports={default:n(271),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(24),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},function(e,t,n){n(28),n(294),e.exports=n(2).Array.from},function(e,t,n){n(33),n(28),e.exports=n(292)},function(e,t,n){n(33),n(28),e.exports=n(293)},function(e,t,n){var r=n(2),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,n){n(60),n(28),n(33),n(296),n(315),e.exports=n(2).Map},function(e,t,n){n(297),e.exports=n(2).Number.isInteger},function(e,t,n){n(298),e.exports=9007199254740991},function(e,t,n){n(299),e.exports=-9007199254740991},function(e,t,n){n(300),e.exports=n(2).Object.assign},function(e,t,n){n(301);var r=n(2).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){n(302);var r=n(2).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,n){n(303);var r=n(2).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){n(304),e.exports=n(2).Object.freeze},function(e,t,n){n(305);var r=n(2).Object;e.exports=function(e){return r.getOwnPropertyNames(e)}},function(e,t,n){n(306),e.exports=n(2).Object.getPrototypeOf},function(e,t,n){n(307),e.exports=n(2).Object.isFrozen},function(e,t,n){n(308),e.exports=n(2).Object.is},function(e,t,n){n(309),e.exports=n(2).Object.keys},function(e,t,n){n(310),e.exports=n(2).Object.seal},function(e,t,n){n(311),e.exports=n(2).Object.setPrototypeOf},function(e,t,n){n(316),e.exports=n(2).Object.values},function(e,t,n){n(60),n(28),n(33),n(312),e.exports=n(2).Promise},function(e,t,n){n(60),n(28),n(33),n(313),n(317),e.exports=n(2).Set},function(e,t,n){n(314),n(60),n(318),n(319),e.exports=n(2).Symbol},function(e,t,n){n(28),n(33),e.exports=n(87).f("iterator")},function(e,t){e.exports=function(){}},function(e,t,n){var r=n(55);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){var r=n(22),i=n(58),a=n(291);e.exports=function(e){return function(t,n,o){var s,l=r(t),u=i(l.length),c=a(o,u);if(e&&n!=n){for(;u>c;)if((s=l[c++])!=s)return!0}else for(;u>c;c++)if((e||c in l)&&l[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var r=n(20),i=n(78),a=n(32),o=n(58),s=n(277);e.exports=function(e,t){var n=1==e,l=2==e,u=3==e,c=4==e,d=6==e,f=5==e||d,h=t||s;return function(t,s,v){for(var p,_,m=a(t),g=i(m),y=r(s,v,3),E=o(g.length),S=0,T=n?h(t,E):l?h(t,0):void 0;E>S;S++)if((f||S in g)&&(p=g[S],_=y(p,S,m),e))if(n)T[S]=_;else if(_)switch(e){case 3:return!0;case 5:return p;case 6:return S;case 2:T.push(p)}else if(c)return!1;return d?-1:u||c?c:T}}},function(e,t,n){var r=n(13),i=n(117),a=n(8)("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var r=n(276);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){"use strict";var r=n(16),i=n(43);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(27),i=n(80),a=n(42);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,s=n(e),l=a.f,u=0;s.length>u;)l.call(e,o=s[u++])&&t.push(o);return t}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(13),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t,n){"use strict";var r=n(57),i=n(43),a=n(44),o={};n(21)(o,n(8)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(27),i=n(22);e.exports=function(e,t){for(var n,a=i(e),o=r(a),s=o.length,l=0;s>l;)if(a[n=o[l++]]===t)return n}},function(e,t,n){var r=n(12),i=n(129).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,l="process"==n(40)(o);e.exports=function(){var e,t,n,u=function(){var r,i;for(l&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(l)n=function(){o.nextTick(u)};else if(a){var c=!0,d=document.createTextNode("");new a(u).observe(d,{characterData:!0}),n=function(){d.data=c=!c}}else if(s&&s.resolve){var f=s.resolve();n=function(){f.then(u)}}else n=function(){i.call(r,u)};return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";var r=n(27),i=n(80),a=n(42),o=n(32),s=n(78),l=Object.assign;e.exports=!l||n(25)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=r})?function(e,t){for(var n=o(e),l=arguments.length,u=1,c=i.f,d=a.f;l>u;)for(var f,h=s(arguments[u++]),v=c?r(h).concat(c(h)):r(h),p=v.length,_=0;p>_;)d.call(h,f=v[_++])&&(n[f]=h[f]);return n}:l},function(e,t,n){var r=n(27),i=n(22),a=n(42).f;e.exports=function(e){return function(t){for(var n,o=i(t),s=r(o),l=s.length,u=0,c=[];l>u;)a.call(o,n=s[u++])&&c.push(e?[n,o[n]]:o[n]);return c}}},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){var r=n(13),i=n(19),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{r=n(20)(Function.call,n(122).f(Object.prototype,"__proto__").set,2),r(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},function(e,t,n){var r=n(19),i=n(74),a=n(8)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||void 0==(n=r(o)[a])?t:i(n)}},function(e,t,n){var r=n(84),i=n(54);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),l=r(n),u=s.length;return l<0||l>=u?e?"":void 0:(a=s.charCodeAt(l),a<55296||a>56319||l+1===u||(o=s.charCodeAt(l+1))<56320||o>57343?e?s.charAt(l):a:e?s.slice(l,l+2):(a-55296<<10)+(o-56320)+65536)}}},function(e,t,n){var r=n(84),i=Math.max,a=Math.min;e.exports=function(e,t){return e=r(e),e<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(19),i=n(88);e.exports=n(2).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){var r=n(53),i=n(8)("iterator"),a=n(30);e.exports=n(2).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||a.hasOwnProperty(r(t))}},function(e,t,n){"use strict";var r=n(20),i=n(5),a=n(32),o=n(118),s=n(116),l=n(58),u=n(278),c=n(88);i(i.S+i.F*!n(119)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,d,f=a(e),h="function"==typeof this?this:Array,v=arguments.length,p=v>1?arguments[1]:void 0,_=void 0!==p,m=0,g=c(f);if(_&&(p=r(p,v>2?arguments[2]:void 0,2)),void 0==g||h==Array&&s(g))for(t=l(f.length),n=new h(t);t>m;m++)u(n,m,_?p(f[m],m):f[m]);else for(d=g.call(f),n=new h;!(i=d.next()).done;m++)u(n,m,_?o(d,p,[i.value,m],!0):i.value);return n.length=m,n}})},function(e,t,n){"use strict";var r=n(272),i=n(120),a=n(30),o=n(22);e.exports=n(79)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r=n(111);e.exports=n(113)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(5);r(r.S,"Number",{isInteger:n(281)})},function(e,t,n){var r=n(5);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(5);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(5);r(r.S+r.F,"Object",{assign:n(285)})},function(e,t,n){var r=n(5);r(r.S,"Object",{create:n(57)})},function(e,t,n){var r=n(5);r(r.S+r.F*!n(15),"Object",{defineProperties:n(121)})},function(e,t,n){var r=n(5);r(r.S+r.F*!n(15),"Object",{defineProperty:n(16).f})},function(e,t,n){var r=n(13),i=n(41).onFreeze;n(31)("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){n(31)("getOwnPropertyNames",function(){return n(123).f})},function(e,t,n){var r=n(32),i=n(125);n(31)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(13);n(31)("isFrozen",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(5);r(r.S,"Object",{is:n(287)})},function(e,t,n){var r=n(32),i=n(27);n(31)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(13),i=n(41).onFreeze;n(31)("seal",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(5);r(r.S,"Object",{setPrototypeOf:n(288).set})},function(e,t,n){"use strict";var r,i,a,o=n(56),s=n(12),l=n(20),u=n(53),c=n(5),d=n(13),f=n(74),h=n(75),v=n(55),p=n(289),_=n(129).set,m=n(284)(),g="Promise",y=s.TypeError,E=s.process,S=s[g],E=s.process,T="process"==u(E),b=function(){},R=!!function(){try{var e=S.resolve(1),t=(e.constructor={})[n(8)("species")]=function(e){e(b,b)};return(T||"function"==typeof PromiseRejectionEvent)&&e.then(b)instanceof t}catch(e){}}(),A=function(e,t){return e===t||e===S&&t===a},D=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},k=function(e){return A(S,e)?new w(e):new i(e)},w=i=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw y("Bad Promise constructor");t=e,n=r}),this.resolve=f(t),this.reject=f(n)},O=function(e){try{e()}catch(e){return{error:e}}},C=function(e,t){if(!e._n){e._n=!0;var n=e._c;m(function(){for(var r=e._v,i=1==e._s,a=0;n.length>a;)!function(t){var n,a,o=i?t.ok:t.fail,s=t.resolve,l=t.reject,u=t.domain;try{o?(i||(2==e._h&&I(e),e._h=1),!0===o?n=r:(u&&u.enter(),n=o(r),u&&u.exit()),n===t.promise?l(y("Promise-chain cycle")):(a=D(n))?a.call(n,s,l):s(n)):l(r)}catch(e){l(e)}}(n[a++]);e._c=[],e._n=!1,t&&!e._h&&L(e)})}},L=function(e){_.call(s,function(){var t,n,r,i=e._v;if(P(e)&&(t=O(function(){T?E.emit("unhandledRejection",i,e):(n=s.onunhandledrejection)?n({promise:e,reason:i}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=T||P(e)?2:1),e._a=void 0,t)throw t.error})},P=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,r=0;n.length>r;)if(t=n[r++],t.fail||!P(t.promise))return!1;return!0},I=function(e){_.call(s,function(){var t;T?E.emit("rejectionHandled",e):(t=s.onrejectionhandled)&&t({promise:e,reason:e._v})})},M=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),C(t,!0))},N=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw y("Promise can't be resolved itself");(t=D(e))?m(function(){var r={_w:n,_d:!1};try{t.call(e,l(N,r,1),l(M,r,1))}catch(e){M.call(r,e)}}):(n._v=e,n._s=1,C(n,!1))}catch(e){M.call({_w:n,_d:!1},e)}}};R||(S=function(e){h(this,S,g,"_h"),f(e),r.call(this);try{e(l(N,this,1),l(M,this,1))}catch(e){M.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(81)(S.prototype,{then:function(e,t){var n=k(p(this,S));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?E.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&C(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),w=function(){var e=new r;this.promise=e,this.resolve=l(N,e,1),this.reject=l(M,e,1)}),c(c.G+c.W+c.F*!R,{Promise:S}),n(44)(S,g),n(128)(g),a=n(2)[g],c(c.S+c.F*!R,g,{reject:function(e){var t=k(this);return(0,t.reject)(e),t.promise}}),c(c.S+c.F*(o||!R),g,{resolve:function(e){if(e instanceof S&&A(e.constructor,this))return e;var t=k(this);return(0,t.resolve)(e),t.promise}}),c(c.S+c.F*!(R&&n(119)(function(e){S.all(e).catch(b)})),g,{all:function(e){var t=this,n=k(t),r=n.resolve,i=n.reject,a=O(function(){var n=[],a=0,o=1;v(e,!1,function(e){var s=a++,l=!1;n.push(void 0),o++,t.resolve(e).then(function(e){l||(l=!0,n[s]=e,--o||r(n))},i)}),--o||r(n)});return a&&i(a.error),n.promise},race:function(e){var t=this,n=k(t),r=n.reject,i=O(function(){v(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i&&r(i.error),n.promise}})},function(e,t,n){"use strict";var r=n(111);e.exports=n(113)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(this,e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r=n(12),i=n(26),a=n(15),o=n(5),s=n(127),l=n(41).KEY,u=n(25),c=n(83),d=n(44),f=n(59),h=n(8),v=n(87),p=n(86),_=n(283),m=n(279),g=n(117),y=n(19),E=n(22),S=n(85),T=n(43),b=n(57),R=n(123),A=n(122),D=n(16),k=n(27),w=A.f,O=D.f,C=R.f,L=r.Symbol,P=r.JSON,I=P&&P.stringify,M="prototype",N=h("_hidden"),x=h("toPrimitive"),U={}.propertyIsEnumerable,F=c("symbol-registry"),B=c("symbols"),G=c("op-symbols"),j=Object[M],H="function"==typeof L,W=r.QObject,V=!W||!W[M]||!W[M].findChild,K=a&&u(function(){return 7!=b(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=w(j,t);r&&delete j[t],O(e,t,n),r&&e!==j&&O(j,t,r)}:O,q=function(e){var t=B[e]=b(L[M]);return t._k=e,t},Y=H&&"symbol"==typeof L.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof L},X=function(e,t,n){return e===j&&X(G,t,n),y(e),t=S(t,!0),y(n),i(B,t)?(n.enumerable?(i(e,N)&&e[N][t]&&(e[N][t]=!1),n=b(n,{enumerable:T(0,!1)})):(i(e,N)||O(e,N,T(1,{})),e[N][t]=!0),K(e,t,n)):O(e,t,n)},z=function(e,t){y(e);for(var n,r=m(t=E(t)),i=0,a=r.length;a>i;)X(e,n=r[i++],t[n]);return e},Q=function(e,t){return void 0===t?b(e):z(b(e),t)},Z=function(e){var t=U.call(this,e=S(e,!0));return!(this===j&&i(B,e)&&!i(G,e))&&(!(t||!i(this,e)||!i(B,e)||i(this,N)&&this[N][e])||t)},J=function(e,t){if(e=E(e),t=S(t,!0),e!==j||!i(B,t)||i(G,t)){var n=w(e,t);return!n||!i(B,t)||i(e,N)&&e[N][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=C(E(e)),r=[],a=0;n.length>a;)i(B,t=n[a++])||t==N||t==l||r.push(t);return r},ee=function(e){for(var t,n=e===j,r=C(n?G:E(e)),a=[],o=0;r.length>o;)!i(B,t=r[o++])||n&&!i(j,t)||a.push(B[t]);return a};H||(L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===j&&t.call(G,n),i(this,N)&&i(this[N],e)&&(this[N][e]=!1),K(this,e,T(1,n))};return a&&V&&K(j,e,{configurable:!0,set:t}),q(e)},s(L[M],"toString",function(){return this._k}),A.f=J,D.f=X,n(124).f=R.f=$,n(42).f=Z,n(80).f=ee,a&&!n(56)&&s(j,"propertyIsEnumerable",Z,!0),v.f=function(e){return q(h(e))}),o(o.G+o.W+o.F*!H,{Symbol:L});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)h(te[ne++]);for(var te=k(h.store),ne=0;te.length>ne;)p(te[ne++]);o(o.S+o.F*!H,"Symbol",{for:function(e){return i(F,e+="")?F[e]:F[e]=L(e)},keyFor:function(e){if(Y(e))return _(F,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){V=!0},useSimple:function(){V=!1}}),o(o.S+o.F*!H,"Object",{create:Q,defineProperty:X,defineProperties:z,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee}),P&&o(o.S+o.F*(!H||u(function(){var e=L();return"[null]"!=I([e])||"{}"!=I({a:e})||"{}"!=I(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!Y(e)){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);return t=r[1],"function"==typeof t&&(n=t),!n&&g(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!Y(t))return t}),r[1]=t,I.apply(P,r)}}}),L[M][x]||n(21)(L[M],x,L[M].valueOf),d(L,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},function(e,t,n){var r=n(5);r(r.P+r.R,"Map",{toJSON:n(112)("Map")})},function(e,t,n){var r=n(5),i=n(286)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){var r=n(5);r(r.P+r.R,"Set",{toJSON:n(112)("Set")})},function(e,t,n){n(86)("asyncIterator")},function(e,t,n){n(86)("observable")},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,l=0;l<i;l++)u[l].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){var r,r;!function(t){if(0)if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.Hls=t()}else e.exports=t()}(function(){var e;return function e(t,n,i){function a(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!l&&u)return r(s,!0);if(o)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return a(n||e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof r&&r,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function a(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,a,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),r=u.length,l=0;l<r;l++)u[l].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,a,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,n,r){!function(t){var i=/^([^#]*)(.*)$/,a=/^([^\?]*)(.*)$/,o=/^(([a-z]+:\/\/)?[^:\/]+(?::[0-9]+)?)?(\/?.*)$/i,s={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var n=null,r=null,l=i.exec(t);l&&(r=l[2],t=l[1]);var u=a.exec(t);u&&(n=u[2],t=u[1]);var c=i.exec(e);c&&(e=c[1]);var d=a.exec(e);d&&(e=d[1]);var f=o.exec(e);if(!f)throw new Error("Error trying to parse base URL.");var h=f[2]||"",v=f[1]||"",p=f[3];0!==p.indexOf("/")&&""!==v&&(p="/"+p);var _=null;return _=/^\/\//.test(t)?h+s.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?v+"/"+s.buildAbsolutePath("",t.substring(1)):s.buildAbsolutePath(v+p,t),n&&(_+=n),r&&(_+=r),_},buildAbsolutePath:function(e,t){for(var n,r,i=t,a="",o=e.replace(/[^\/]*$/,i.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),s=0;(r=o.indexOf("/../",s))>-1;s=r+n)n=/^\/(?:\.\.\/)*/.exec(o.slice(r))[0].length,a=(a+o.substring(s,r)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(n-1)/3+"}$"),"/");return a+o.substr(s)}};"object"==typeof r&&"object"==typeof n?n.exports=s:"function"==typeof e&&e.amd?e([],function(){return s}):"object"==typeof r?r.URLToolkit=s:t.URLToolkit=s}(this)},{}],3:[function(e,t,n){var r=arguments[3],i=arguments[4],a=arguments[5],o=JSON.stringify;t.exports=function(e,t){function n(e){_[e]=!0;for(var t in i[e][1]){var r=i[e][1][t];_[r]||n(r)}}for(var s,l=Object.keys(a),u=0,c=l.length;u<c;u++){var d=l[u],f=a[d].exports;if(f===e||f&&f.default===e){s=d;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},u=0,c=l.length;u<c;u++){var d=l[u];h[d]=d}i[s]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[s]=s,i[v]=[Function(["require"],"var f = require("+o(s)+");"+"(f.default ? f.default : f)(self);"),p];var _={};n(v);var m="("+r+")({"+Object.keys(_).map(function(e){return o(e)+":["+i[e][0]+","+o(i[e][1])+"]"}).join(",")+"},{},["+o(v)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return y;var E=g.createObjectURL(y),S=new Worker(E);return S.objectURL=E,S}},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(30),h=r(f),v=e(26),p=e(45),_=e(9),m=r(_),g=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return n.lastLoadedFragLevel=0,n._autoLevelCapping=-1,n._nextAutoLevel=-1,n.hls=e,n.onCheck=n.abandonRulesCheck.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.clearTimer(),d.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var n=this.hls,r=e.frag.level,i=n.levels[r].details.live,a=n.config,o=void 0,s=void 0;i?(o=a.abrEwmaFastLive,s=a.abrEwmaSlowLive):(o=a.abrEwmaFastVoD,s=a.abrEwmaSlowVoD),this.bwEstimator=new m.default(n,s,o,a.abrEwmaDefaultEstimate)}this.fragCurrent=t}}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,n=this.fragCurrent,r=n.loader,i=this.minAutoLevel;if(!r||r.stats&&r.stats.aborted)return p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var a=r.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var o=performance.now()-a.trequest,s=Math.abs(t.playbackRate);if(o>500*n.duration/s){var l=e.levels,c=Math.max(1,a.bw?a.bw/8:1e3*a.loaded/o),d=l[n.level],f=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,v=a.total?a.total:Math.max(a.loaded,Math.round(n.duration*f/8)),_=t.currentTime,m=(v-a.loaded)/c,g=(h.default.bufferInfo(t,_,e.config.maxBufferHole).end-_)/s;if(g<2*n.duration/s&&m>g){var y=void 0,E=void 0;for(E=n.level-1;E>i;E--){var S=l[E].realBitrate?Math.max(l[E].realBitrate,l[E].bitrate):l[E].bitrate;if((y=n.duration*S/(8*.8*c))<g)break}y<m&&(p.logger.warn("loading too slow, abort fragment loading and switch to level "+E+":fragLoadedDelay["+E+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+y.toFixed(1)+"<"+m.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=E,this.bwEstimator.sample(o,a.loaded),r.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:a}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type){this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1;var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;if(n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i),e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&1===n.loadCounter&&"main"===n.type&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;p.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this.bwEstimator.sample(r,t.loaded),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(e,t,n,r,i,a,o,s,l){for(var u=i;u>=r;u--){var c=l[u],d=c.details,f=d?d.totalduration/d.fragments.length:t,h=!!d&&d.live,v=void 0;v=u<=e?o*n:s*n;var _=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,m=_*f/v;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(v)+"/"+_+"/"+f+"/"+a+"/"+m),v>_&&(!m||h||m<a))return u}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator,n=this.hls,r=n.levels,i=n.config.minAutoBitrate;if(!(-1===e||t&&t.canEstimate()))return Math.min(e,this.maxAutoLevel);var a=this.nextABRAutoLevel;if(-1!==e&&(a=Math.min(e,a)),void 0!==i)for(var o=r[a].realBitrate?Math.max(r[a].realBitrate,r[a].bitrate):r[a].bitrate;o<i;)a++;return a},set:function(e){this._nextAutoLevel=e}},{key:"minAutoLevel",get:function(){for(var e=this.hls,t=e.levels,n=e.config.minAutoBitrate,r=t?t.length:0,i=0;i<r;i++){if((t[i].realBitrate?Math.max(t[i].realBitrate,t[i].bitrate):t[i].bitrate)>n)return i}return 0}},{key:"maxAutoLevel",get:function(){var e=this.hls.levels,t=this._autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextABRAutoLevel",get:function(){var e=this.hls,t=this.maxAutoLevel,n=e.levels,r=e.config,i=this.minAutoLevel,a=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,c=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,d=(h.default.bufferInfo(a,l,r.maxBufferHole).end-l)/u,f=this.findBestLevel(o,s,c,i,t,d,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(f>=0)return f;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var v=s?Math.min(s,r.maxStarvationDelay):r.maxStarvationDelay,_=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===d){var g=this.bitrateTestDelay;if(g){v=(s?Math.min(s,r.maxLoadingDelay):r.maxLoadingDelay)-g,p.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),_=m=1}}return f=this.findBestLevel(o,s,c,i,t,d+v,_,m,n),Math.max(f,0)}}]),t}(d.default);n.default=g},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e(41),c=r(u),d=e(30),f=r(d),h=e(22),v=r(h),p=e(28),_=r(p),m=e(27),g=r(m),y=e(31),E=r(y),S=e(46),T=r(S),b=e(26),R=e(45),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},D=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,_.default.MEDIA_ATTACHED,_.default.MEDIA_DETACHING,_.default.AUDIO_TRACKS_UPDATED,_.default.AUDIO_TRACK_SWITCHING,_.default.AUDIO_TRACK_LOADED,_.default.KEY_LOADED,_.default.FRAG_LOADED,_.default.FRAG_PARSING_INIT_SEGMENT,_.default.FRAG_PARSING_DATA,_.default.FRAG_PARSED,_.default.ERROR,_.default.BUFFER_CREATED,_.default.BUFFER_APPENDED,_.default.BUFFER_FLUSHED,_.default.INIT_PTS_FOUND));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=A.STOPPED,n.ontick=n.tick.bind(n),n.initPTS=[],n.waitingFragment=null,n}return o(t,e),l(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),g.default.prototype.destroy.call(this),this.state=A.STOPPED}},{key:"onInitPtsFound",value:function(e){var t=e.id,n=e.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,R.logger.log("InitPTS for cc:"+n+" found from video track:"+r),this.state===A.WAITING_INIT_PTS&&(R.logger.log("sending pending audio frag to demuxer"),this.state=A.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&-1===e?(R.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,n,r,i,a,o=this,l=this.hls,u=l.config,d=function(){switch(o.state){case A.ERROR:case A.PAUSED:case A.BUFFER_FLUSHING:break;case A.STARTING:o.state=A.WAITING_TRACK,o.loadedmetadata=!1;break;case A.IDLE:var s=o.tracks;if(!s)break;if(!o.media&&(o.startFragRequested||!u.startFragPrefetch))break;e=o.loadedmetadata?o.media.currentTime:o.nextLoadPosition;var d=o.mediaBuffer?o.mediaBuffer:o.media,h=f.default.bufferInfo(d,e,u.maxBufferHole),v=h.len,p=h.end,m=o.fragPrevious,g=u.maxMaxBufferLength,y=o.audioSwitch,E=o.trackId;if(v<g&&E<s.length){if(void 0===(n=s[E].details)){o.state=A.WAITING_TRACK;break}if(!y&&!n.live&&m&&m.sn===n.endSN&&(!o.media.seeking||o.media.duration-p<m.duration/2)){o.hls.trigger(_.default.BUFFER_EOS,{type:"audio"}),o.state=A.ENDED;break}var S=n.fragments,T=S.length,D=S[0].start,k=S[T-1].start+S[T-1].duration,w=void 0;if(y)if(n.live&&!n.PTSKnown)R.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),p=0;else if(p=e,n.PTSKnown&&e<D){if(!(h.end>D||h.nextStart))return{v:void 0};R.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),o.media.currentTime=D+.05}if(p<=D){if(w=S[0],n.live&&w.loadIdx&&w.loadIdx===o.fragLoadIdx){var O=h.nextStart?h.nextStart:D;return R.logger.log("no alt audio available @currentTime:"+o.media.currentTime+", seeking @"+(O+.05)),o.media.currentTime=O+.05,{v:void 0}}}else!function(){var e=void 0,t=u.maxFragLookUpTolerance;p<k?(p>k-t&&(t=0),(e=c.default.search(S,function(e){return e.start+e.duration-t<=p?1:e.start-t>p?-1:0}))||R.logger.log("frag not found @bufferEnd/start:"+p+"/"+D)):e=S[T-1],e&&(w=e,D=e.start,m&&w.level===m.level&&w.sn===m.sn&&(w.sn<n.endSN?(w=S[w.sn+1-n.startSN],R.logger.log("SN just loaded, load next one: "+w.sn)):w=null))}();if(w)if(null!=w.decryptdata.uri&&null==w.decryptdata.key)R.logger.log("Loading key for "+w.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+E),o.state=A.KEY_LOADING,l.trigger(_.default.KEY_LOADING,{frag:w});else{if(R.logger.log("Loading "+w.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+E+", currentTime:"+e+",bufferEnd:"+p.toFixed(3)),void 0!==o.fragLoadIdx?o.fragLoadIdx++:o.fragLoadIdx=0,w.loadCounter){w.loadCounter++;var C=u.fragLoadingLoopThreshold;if(w.loadCounter>C&&Math.abs(o.fragLoadIdx-w.loadIdx)<C)return l.trigger(_.default.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:w}),{v:void 0}}else w.loadCounter=1;w.loadIdx=o.fragLoadIdx,o.fragCurrent=w,o.startFragRequested=!0,o.nextLoadPosition=w.start+w.duration,l.trigger(_.default.FRAG_LOADING,{frag:w}),o.state=A.FRAG_LOADING}}break;case A.WAITING_TRACK:t=o.tracks[o.trackId],t&&t.details&&(o.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:r=performance.now(),i=o.retryDate,d=o.media,a=d&&d.seeking,(!i||r>=i||a)&&(R.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),o.state=A.IDLE);break;case A.WAITING_INIT_PTS:case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}}();if("object"===(void 0===d?"undefined":s(d)))return d.v}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(R.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===A.ENDED&&(this.state=A.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){R.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.state=A.IDLE,this.fragCurrent=null,this.state=A.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=A.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,n=e.id,r=this.tracks[n],i=t.totalduration,a=0;if(R.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var o=r.details;o&&t.fragments.length>0?(E.default.mergeDetails(o,t),a=t.fragments[0].start,t.PTSKnown?R.logger.log("live audio playlist sliding:"+a.toFixed(3)):R.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,R.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var s=t.startTimeOffset;isNaN(s)?this.startPosition=0:(R.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s)}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_TRACK&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&"audio"===e.frag.type&&e.frag.level===t.level&&e.frag.sn===t.sn){this.state=A.PARSING,this.stats=e.stats;var n=this.tracks[this.trackId],r=n.details,i=r.totalduration,a=t.start,o=t.level,s=t.sn,l=t.cc,u=this.config.defaultAudioCodec||n.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new v.default(this.hls,"audio"));var c=this.initPTS[l];if(void 0!==c){this.pendingBuffering=!0,R.logger.log("Demuxing "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o);this.demuxer.push(e.payload,u,null,a,l,o,s,i,t.decryptdata,!1,c)}else R.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+r.startSN+" ,"+r.endSN+"],track "+o),this.waitingFragment=e,this.state=A.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING){var n=e.tracks,r=void 0;if(n.video&&delete n.video,r=n.audio){r.levelCodec="mp4a.40.2",r.id=e.id,this.hls.trigger(_.default.BUFFER_CODECS,n),R.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var i=r.initSegment;if(i){var a={type:"audio",data:i,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[a]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(_.default.BUFFER_APPENDING,a))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;n&&"audio"===e.id&&"audio"===e.type&&e.sn===n.sn&&e.level===n.level&&this.state===A.PARSING&&function(){var n=t.trackId,r=t.tracks[n],i=t.fragCurrent,a=t.hls;R.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),E.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS);var o=t.audioSwitch,s=t.media,l=!1;if(o&&s)if(s.readyState){var u=s.currentTime;R.logger.log("switching audio track : currentTime:"+u),u>=e.startPTS&&(R.logger.log("switching audio track : flushing all audio"),t.state=A.BUFFER_FLUSHING,a.trigger(_.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l=!0,t.audioSwitch=!1,a.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:n}))}else t.audioSwitch=!1,a.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:n});var c=t.pendingData;t.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&c.push({type:e.type,data:t,parent:"audio",content:"data"})}),!l&&c.length&&(c.forEach(function(e){t.pendingBuffering=!0,t.hls.trigger(_.default.BUFFER_APPENDING,e)}),t.pendingData=[],t.appended=!0)),t.tick()}()}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==A.PARSING&&t!==A.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==A.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),n.trigger(_.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;R.logger.log("audio buffered : "+T.default.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(_.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=A.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var n=this.fragLoadError;n?n++:n=1;var r=this.config;if(n<=r.fragLoadingMaxRetry){this.fragLoadError=n,t.loadCounter=0;var i=Math.min(Math.pow(2,n-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);R.logger.warn("audioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=A.FRAG_LOADING_WAITING_RETRY}else R.logger.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(_.default.ERROR,e),this.state=A.ERROR}break;case b.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,R.logger.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(R.logger.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(_.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=A.PARSED):(this.state=A.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,R.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(g.default);n.default=D},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.AUDIO_TRACK_LOADED));return n.ticks=0,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){d.default.prototype.destroy.call(this)}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,n=e.audioTracks||[],r=!1;this.tracks=n,this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:n});var i=0;n.forEach(function(e){if(e.default)return t.audioTrack=i,void(r=!0);i++}),!1===r&&n.length&&(f.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(f.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,f.logger.log("switching to audioTrack "+e);var t=this.tracks[e],n=this.hls,r=t.type,i=t.url,a={id:e,type:r,url:i};n.trigger(u.default.AUDIO_TRACK_SWITCH,a),n.trigger(u.default.AUDIO_TRACK_SWITCHING,a);var o=t.details;!i||void 0!==o&&!0!==o.live||(f.logger.log("(re)loading playlist for audioTrack "+e),n.trigger(u.default.AUDIO_TRACK_LOADING,{url:i,id:e}))}}},{key:"updateTrack",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,f.logger.log("updating audioTrack "+e);var t=this.tracks[e],n=t.url,r=t.details;!n||void 0!==r&&!0!==r.live||(f.logger.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:n,id:e}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(d.default);n.default=h},{27:27,28:28,45:45}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=e(26),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED));return n._msDuration=null,n._levelDuration=null,n.onsbue=n.onSBUpdateEnd.bind(n),n.onsbe=n.onSBUpdateError.bind(n),n.pendingTracks={},n.tracks={},n}return o(t,e),s(t,[{key:"destroy",value:function(){d.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){i=!0,f.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(f.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){var t=e.audio,n=e.video,r=0;e.altAudio&&(t||n)&&(r=(t?1:0)+(n?1:0),f.logger.log(r+" sourceBuffer(s) expected")),this.sourceBufferNb=r}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var n=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),n.addEventListener("sourceopen",this.onmso),n.addEventListener("sourceended",this.onmse),n.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(n)}}},{key:"onMediaDetaching",value:function(){f.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){f.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){f.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){f.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){f.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;f.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,n=this.segments.reduce(function(e,n){return n.parent===t?e+1:e},0);this.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:n}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(e){f.logger.error("sourceBuffer error:"+e),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this.onsbue),n.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var n=this.mediaSource;n&&"open"===n.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,n=this.mediaSource;for(var r in e)if(!t[r]){var i=e[r],a=i.levelCodec||i.codec,o=i.container+";codecs="+a;f.logger.log("creating sourceBuffer("+o+")");try{var s=t[r]=n.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[r]={codec:a,container:i.container},i.buffer=s}catch(e){f.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){f.logger.error("sourceBuffer error:",e.event),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,n=e.type;for(var r in t)n&&r!==n||t[r].ended||(t[r].ended=!0,f.logger.log(r+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var n in e){var r=e[n];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}f.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){f.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e=this.media,t=this.mediaSource,n=this.sourceBuffer,r=this._levelDuration;if(null!==r&&e&&t&&n&&0!==e.readyState&&"open"===t.readyState){for(var i in n)if(n[i].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var a=e.duration;(r>this._msDuration&&r>a||a===1/0||isNaN(a))&&(f.logger.log("Updating mediasource duration to "+r.toFixed(3)),this._msDuration=t.duration=r)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n)t+=n[r].buffered.length}catch(e){f.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,n=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void f.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(n&&n.length){var r=n.shift();try{var i=r.type,a=t[i];a?a.updating?n.unshift(r):(a.ended=!1,this.parent=r.parent,a.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){f.logger.error("error while trying to append buffer:"+t.message),n.unshift(r);var o={type:h.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],o.details=h.ErrorDetails.BUFFER_FULL_ERROR,o.fatal=!1,void e.trigger(u.default.ERROR,o);if(this.appendError?this.appendError++:this.appendError=1,o.details=h.ErrorDetails.BUFFER_APPEND_ERROR,o.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return f.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),n=[],o.fatal=!0,void e.trigger(u.default.ERROR,o);o.fatal=!1,e.trigger(u.default.ERROR,o)}}}}},{key:"flushBuffer",value:function(e,t,n){var r,i,a,o,s,l,u=this.sourceBuffer;if(Object.keys(u).length){if(f.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var c in u)if(!n||c===n){if(r=u[c],r.ended=!1,r.updating)return f.logger.warn("cannot flush, sb updating in progress"),!1;try{for(i=0;i<r.buffered.length;i++)if(a=r.buffered.start(i),o=r.buffered.end(i),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&t===Number.POSITIVE_INFINITY?(s=e,l=t):(s=Math.max(a,e),l=Math.min(o,t)),Math.min(l,o)-s>.5)return this.flushBufferCounter++,f.logger.log("flush "+c+" ["+s+","+l+"], of ["+a+","+o+"], pos:"+this.media.currentTime),r.remove(s,l),!1}catch(e){f.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else f.logger.warn("abort flushing too many retries");f.logger.log("buffer flushed")}return!0}}]),t}(d.default);n.default=v},{26:26,27:27,28:28,45:45}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED))}return o(t,e),s(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var t=0,n=void 0,r=void 0,i=this.mediaWidth,a=this.mediaHeight,o=0,s=0;for(n=0;n<=e&&(r=this.levels[n],!this.isLevelRestricted(n))&&(t=n,o=r.width,s=r.height,!(i<=o||a<=s));n++);return t}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(e))}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(d.default);n.default=f},{27:27,28:28}],9:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(44),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n,i,a){r(this,e),this.hls=t,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new o.default(n),this.fast_=new o.default(i)}return i(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var n=8e3*t/e,r=e/1e3;this.fast_.sample(r,n),this.slow_.sample(r,n)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();n.default=s},{44:44}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=function(e){function t(e){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING))}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){"function"==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,n){var r=performance.now();if(t){if(this.lastTime){var i=r-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*a/i,l=this.hls;if(l.trigger(u.default.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),s>0&&a>l.config.fpsDroppedMonitoringThreshold*o){var c=l.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=c)&&(c-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,l.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(d.default);n.default=h},{27:27,28:28,45:45}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(45),h=e(26),v=e(30),p=r(v),_=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.FRAG_LOADED,u.default.ERROR));return n.ontick=n.tick.bind(n),n._manualLevel=n._autoLevelCapping=-1,n}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,n=[],r=[],i={},a=!1,o=!1,s=this.hls,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c=function(e,t){return MediaSource.isTypeSupported(e+"/mp4;codecs="+t)};if(e.levels.forEach(function(e){e.videoCodec&&(a=!0),l&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(o=!0);var t=i[e.bitrate];void 0===t?(i[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),a&&o?n.forEach(function(e){e.videoCodec&&r.push(e)}):r=n,r=r.filter(function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||c("audio",t))&&(!n||c("video",n))}),r.length){t=r[0].bitrate,r.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=r;for(var d=0;d<r.length;d++)if(r[d].bitrate===t){this._firstLevel=d,f.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}s.trigger(u.default.MANIFEST_PARSED,{levels:r,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:a,altAudio:e.audioTracks.length>0})}else s.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e&&(f.logger.log("switching to level "+e),this._level=e,this.hls.trigger(u.default.LEVEL_SWITCH,{level:e}));var n=t[e],r=n.details;if(!r||!0===r.live){var i=n.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:n.url[i],level:e,id:i})}}else this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,n=this.hls,r=void 0,i=void 0,a=!1,o=n.abrController,s=o.minAutoLevel;switch(t){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:r=e.frag.level;break;case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:r=e.context.level,a=!0;break;case h.ErrorDetails.REMUX_ALLOC_ERROR:r=e.level}if(void 0!==r){i=this._levels[r],i.loadError?i.loadError++:i.loadError=1;var l=i.url.length;if(l>1&&i.loadError<l)i.urlId=(i.urlId+1)%l,i.details=void 0,f.logger.warn("level controller,"+t+" for level "+r+": switching to redundant stream id "+i.urlId);else{if(-1===this._manualLevel&&r)f.logger.warn("level controller,"+t+": switch-down for next fragment"),o.nextAutoLevel=Math.max(s,r-1);else if(i&&i.details&&i.details.live)f.logger.warn("level controller,"+t+" on live stream, discard"),a&&(this._level=void 0);else if(t===h.ErrorDetails.LEVEL_LOAD_ERROR||t===h.ErrorDetails.LEVEL_LOAD_TIMEOUT){var c=n.media,d=c&&p.default.isBuffered(c,c.currentTime)&&p.default.isBuffered(c,c.currentTime+.5);if(d){var v=n.config.levelLoadingRetryDelay;f.logger.warn("level controller,"+t+", but media buffered, retry in "+v+"ms"),this.timer=setTimeout(this.ontick,v)}else f.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,n.trigger(u.default.ERROR,e)}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(t&&"main"===t.type){var n=this._levels[t.level];n&&(n.loadError=0)}}},{key:"onLevelLoaded",value:function(e){var t=e.level;if(t===this._level){var n=this._levels[t];n.loadError=0;var r=e.details;if(r.live){var i=1e3*(r.averagetargetduration?r.averagetargetduration:r.targetduration),a=n.details;a&&r.endSN===a.endSN&&(i/=2,f.logger.log("same live playlist, reload twice faster")),i-=performance.now()-e.stats.trequest,i=Math.max(1e3,Math.round(i)),f.logger.log("live playlist, reload in "+i+" ms"),this.timer=setTimeout(this.ontick,i)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],n=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:t.url[n],level:e,id:n})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){-1!==e&&(e=Math.max(e,this.hls.abrController.minAutoLevel)),this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(d.default);n.default=_},{26:26,27:27,28:28,30:30,45:45}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(41),u=r(l),c=e(30),d=r(c),f=e(22),h=r(f),v=e(28),p=r(v),_=e(27),m=r(_),g=e(31),y=r(g),E=e(46),S=r(E),T=e(26),b=e(45),R={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},A=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.MANIFEST_LOADING,p.default.MANIFEST_PARSED,p.default.LEVEL_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_LOAD_EMERGENCY_ABORTED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_SWITCHED,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED));return n.config=e.config,n.audioCodecSwap=!1,n.ticks=0,n._state=R.STOPPED,n.ontick=n.tick.bind(n),n}return o(t,e),s(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),m.default.prototype.destroy.call(this),this.state=R.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(r=0,this.bitrateTest=!0),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(b.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=R.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else b.logger.warn("cannot start loading as manifest not parsed yet"),this.state=R.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.STOPPED}},{key:"tick",value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case R.ERROR:break;case R.BUFFER_FLUSHING:this.fragLoadError=0;break;case R.IDLE:if(!this._doTickIdle())return;break;case R.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=R.IDLE);break;case R.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(b.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=R.IDLE);break;case R.ERROR:case R.STOPPED:case R.FRAG_LOADING:case R.PARSING:case R.PARSED:case R.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&!n&&(this.startFragRequested||!t.startFragPrefetch))return!0;var r=void 0;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,a=this.levels[i],o=a.bitrate,s=void 0;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=d.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,t.maxBufferHole),u=l.len;if(u>=s)return!0;b.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var c=a.details;if(void 0===c||c.live&&this.levelLastLoaded!==i)return this.state=R.WAITING_LEVEL,!0;var f=this.fragPrevious;if(!c.live&&f&&f.sn===c.endSN&&n.duration-Math.max(l.end,f.start)<=Math.max(.2,f.duration/2)){var h={};return this.altAudio&&(h.type="video"),this.hls.trigger(p.default.BUFFER_EOS,h),this.state=R.ENDED,!0}return this._fetchPayloadOrEos(r,l,c)}},{key:"_fetchPayloadOrEos",value:function(e,t,n){var r=this.fragPrevious,i=this.level,a=n.fragments,o=a.length;if(0===o)return!1;var s=a[0].start,l=a[o-1].start+a[o-1].duration,u=t.end,c=void 0;if(n.live){var d=this.config.initialLiveManifestSize;if(o<d)return b.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+d),!1;if(null===(c=this._ensureFragmentAtLivePoint(n,u,s,l,r,a,o)))return!1}else u<s&&(c=a[0]);return c||(c=this._findFragment(s,r,o,a,u,l,n)),!c||this._loadFragmentOrKey(c,i,n,e,u)}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,n,r,i,a,o){var s=this.hls.config,l=this.media,u=void 0,c=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(n-s.maxFragLookUpTolerance,r-c)){var d=this.liveSyncPosition=this.computeLivePosition(n,e);b.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+d.toFixed(3)),t=d,l&&l.readyState&&l.duration>d&&(l.currentTime=d)}if(e.PTSKnown&&t>r&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(i){var f=i.sn+1;f>=e.startSN&&f<=e.endSN&&(u=a[f-e.startSN],b.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=a[Math.min(o-1,Math.round(o/2))],b.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u}},{key:"_findFragment",value:function(e,t,n,r,i,a,o){var s=this.hls.config,l=void 0,c=void 0,d=s.maxFragLookUpTolerance;if(i<a?(i>a-d&&(d=0),c=u.default.search(r,function(e){return e.start+e.duration-d<=i?1:e.start-d>i&&e.start?-1:0})):c=r[n-1],c&&(l=c,c.start,t&&l.level===t.level&&l.sn===t.sn))if(l.sn<o.endSN){var f=t.deltaPTS,h=l.sn-o.startSN;f&&f>s.maxBufferHole&&t.dropped&&h?(l=r[h-1],b.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(l=r[h+1],b.logger.log("SN just loaded, load next one: "+l.sn))}else l=null;return l}},{key:"_loadFragmentOrKey",value:function(e,t,n,r,i){var a=this.hls,o=a.config;if(null==e.decryptdata.uri||null!=e.decryptdata.key){if(b.logger.log("Loading "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t+", currentTime:"+r.toFixed(3)+",bufferEnd:"+i.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var s=o.fragLoadingLoopThreshold;if(e.loadCounter>s&&Math.abs(this.fragLoadIdx-e.loadIdx)<s)return a.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e}),!1}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,this.nextLoadPosition=e.start+e.duration,e.autoLevel=a.autoLevelEnabled,e.bitrateTest=this.bitrateTest,a.trigger(p.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new h.default(a,"main")),this.state=R.FRAG_LOADING,!0}b.logger.log("Loading key for "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t),this.state=R.KEY_LOADING,a.trigger(p.default.KEY_LOADING,{frag:e})}},{key:"getBufferRange",value:function(e){return u.default.search(this.bufferRange,function(t){return e<t.start?-1:e>t.end?1:0})}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&(t=n.currentTime,t>n.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),d.default.isBuffered(n,t)?e=this.getBufferRange(t):d.default.isBuffered(n,t+.1)&&(e=this.getBufferRange(t+.1)),e)){var r=e.frag;r!==this.fragPlaying&&(this.fragPlaying=r,this.hls.trigger(p.default.FRAG_CHANGED,{frag:r}))}}},{key:"immediateLevelSwitch",value:function(){if(b.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,d.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,n=void 0,r=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,n=this.getBufferRange(e.currentTime),n&&n.start>1&&this.flushMainBuffer(0,n.start-1),e.paused)t=0;else{var i=this.hls.nextLoadLevel,a=this.levels[i],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*a.bitrate/(1e3*o)+1:0}if((r=this.getBufferRange(e.currentTime+t))&&(r=this.followingBufferRange(r))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(r.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=R.BUFFER_FLUSHING;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(p.default.BUFFER_FLUSHING,n)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(b.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.media,t=e?e.currentTime:void 0,n=this.config;if(b.logger.log("media seeking to "+t.toFixed(3)),this.state===R.FRAG_LOADING){var r=this.mediaBuffer?this.mediaBuffer:e,i=d.default.bufferInfo(r,t,this.config.maxBufferHole),a=this.fragCurrent;if(0===i.len&&a){var o=n.maxFragLookUpTolerance,s=a.start-o,l=a.start+a.duration+o;t<s||t>l?(a.loader&&(b.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=R.IDLE):b.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===R.ENDED&&(this.state=R.IDLE);e&&(this.lastCurrentTime=t),this.state!==R.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*n.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()}},{key:"onMediaSeeked",value:function(){b.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){b.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){b.logger.log("trigger BUFFER_RESET"),this.hls.trigger(p.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t,n=!1,r=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&b.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var i=this.config;i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,n=e.level,r=this.levels[n],i=t.totalduration,a=0;if(b.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),this.levelLastLoaded=n,t.live){var o=r.details;o&&t.fragments.length>0?(y.default.mergeDetails(o,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,o),t.PTSKnown?b.logger.log("live playlist sliding:"+a.toFixed(3)):b.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,b.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,this.hls.trigger(p.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var s=t.startTimeOffset;isNaN(s)?t.live?(this.startPosition=this.computeLivePosition(a,t),b.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(s<0&&(b.logger.log("negative start time offset "+s+", count from end of last fragment"),s=a+i+s),b.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===R.WAITING_LEVEL&&(this.state=R.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===R.KEY_LOADING&&(this.state=R.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,n=e.frag;if(this.state===R.FRAG_LOADING&&t&&"main"===n.type&&n.level===t.level&&n.sn===t.sn){var r=e.stats,i=this.levels[t.level],a=i.details;if(b.logger.log("Loaded  "+t.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t.level),this.bitrateTest=!1,!0===n.bitrateTest&&this.hls.nextLoadLevel)this.state=R.IDLE,this.startFragRequested=!1,r.tparsed=r.tbuffered=performance.now(),this.hls.trigger(p.default.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.tick();else{this.state=R.PARSING,this.stats=r;var o=a.totalduration,s=isNaN(t.startDTS)?t.start:t.startDTS,l=t.level,u=t.sn,c=this.config.defaultAudioCodec||i.audioCodec;this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),void 0===c&&(c=this.lastAudioCodec),c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,b.logger.log("Parsing "+u+" of ["+a.startSN+" ,"+a.endSN+"],level "+l+", cc "+t.cc);var d=this.demuxer;d||(d=this.demuxer=new h.default(this.hls,"main"));var f=this.media,v=f&&f.seeking,_=!v&&(a.PTSKnown||!a.live);d.push(e.payload,c,i.videoCodec,s,t.cc,l,u,o,t.decryptdata,_,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING){var n,r,i=e.tracks;if(i.audio&&this.altAudio&&delete i.audio,r=i.audio){var a=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();a&&this.audioCodecSwap&&(b.logger.log("swapping playlist audio codec"),a=-1!==a.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===o.indexOf("firefox")&&(a="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==r.container&&(a="mp4a.40.2",b.logger.log("Android: force audio codec to "+a)),r.levelCodec=a,r.id=e.id}if(r=i.video,r&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=e.id),e.unique){var s={codec:"",levelCodec:""};for(n in e.tracks)r=i[n],s.container=r.container,s.codec&&(s.codec+=",",s.levelCodec+=","),r.codec&&(s.codec+=r.codec),r.levelCodec&&(s.levelCodec+=r.levelCodec);i={audiovideo:s}}this.hls.trigger(p.default.BUFFER_CODECS,i);for(n in i){r=i[n],b.logger.log("main track:"+n+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var l=r.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,{type:n,data:l,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,n=this.fragCurrent;if(n&&"main"===e.id&&e.sn===n.sn&&e.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===R.PARSING){var r=this.levels[this.level],i=this.fragCurrent;b.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var a=y.default.updateFragPTSDTS(r.details,i.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),o=this.hls;o.trigger(p.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:a,type:e.type,start:e.startPTS,end:e.endPTS}),"video"===e.type&&(i.dropped=e.dropped),[e.data1,e.data2].forEach(function(n){n&&(t.appended=!0,t.pendingBuffering=!0,o.trigger(p.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===R.PARSING&&(this.stats.tparsed=performance.now(),this.state=R.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,n=e.id;if(!t){if(this.mediaBuffer!==this.media){b.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(b.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.IDLE}var i=this.hls;i.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:n}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(b.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,n=void 0,r=void 0,i=!1;for(var a in t){var o=t[a];"main"===o.id?(r=a,n=o,"video"===a&&(this.videoBuffer=t[a].buffer)):i=!0}i&&n?(b.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==R.PARSING&&t!==R.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var e=this;if(!(this.state!==R.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;t&&function(){var n=e.mediaBuffer?e.mediaBuffer:e.media;b.logger.log("main buffered : "+S.default.toString(n.buffered));var r=e.bufferRange.filter(function(e){return d.default.isBuffered(n,(e.start+e.end)/2)});r.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:t}),e.bufferRange=r.sort(function(e,t){return e.start-t.start}),e.fragPrevious=t;var i=e.stats;i.tbuffered=performance.now(),e.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),e.hls.trigger(p.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),e.state=R.IDLE}(),this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=this.media,r=n&&d.default.isBuffered(n,n.currentTime)&&d.default.isBuffered(n,n.currentTime+.5);switch(e.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var i=this.fragLoadError;i?i++:i=1;var a=this.config;if(i<=a.fragLoadingMaxRetry||r||t.autoLevel&&t.level){this.fragLoadError=i,t.loadCounter=0;var o=Math.min(Math.pow(2,i-1)*a.fragLoadingRetryDelay,a.fragLoadingMaxRetryTimeout);b.logger.warn("mediaController: frag loading failed, retry in "+o+" ms"),this.retryDate=performance.now()+o,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=R.FRAG_LOADING_WAITING_RETRY}else b.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=R.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=R.ERROR));break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.ERROR&&(e.fatal?(this.state=R.ERROR,b.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):this.state===R.WAITING_LEVEL&&(this.state=R.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:this.state!==R.PARSING&&this.state!==R.PARSED||(r?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):(b.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,b.logger.warn("reduce max buffer length to "+t.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,n=this.mediaBuffer?this.mediaBuffer:e,r=n.buffered;if(this.loadedmetadata||!r.length||e.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var i=d.default.bufferInfo(e,t,0),a=!(e.paused||e.ended||0===e.buffered.length),o=.5,s=t!==this.lastCurrentTime,l=this.config;if(s)this.stallReported&&(b.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(a){var u=performance.now(),c=this.hls;if(this.stalled){var f=u-this.stalled,h=i.len,v=this.nudgeRetry||0;if(h<=o&&f>1e3*l.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in low buffer @"+t),c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h}));var _=i.nextStart,m=_-t;if(_&&m<l.maxSeekHole&&m>0){this.nudgeRetry=++v;var g=v*l.nudgeOffset;b.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+_+" + nudge "+g),e.currentTime=_+g,this.stalled=void 0,c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:_+g-t})}}else if(h>o&&f>1e3*l.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,b.logger.warn("playback stalling in high buffer @"+t),c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h})),this.stalled=void 0,this.nudgeRetry=++v,v<l.nudgeMaxRetry){var y=e.currentTime,E=y+v*l.nudgeOffset;b.logger.log("adjust currentTime from "+y+" to "+E),e.currentTime=E,c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("still stuck in high buffer @"+t+" after "+l.nudgeMaxRetry+", raise fatal error"),c.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=u,this.stallReported=!1}}else{this.loadedmetadata=!0;var S=this.startPosition,R=d.default.isBuffered(n,S);t===S&&R||(b.logger.log("target start position:"+S),R||(S=r.start(0),b.logger.log("target start position not buffered, seek to buffered.start(0) "+S)),b.logger.log("adjust currentTime from "+t+" to "+S),e.currentTime=S)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=R.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(t){return d.default.isBuffered(e,(t.start+t.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=R.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,b.logger.log("main stream:"+t+"->"+e),this.hls.trigger(p.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferRange(e.currentTime);if(t)return t.frag.level}return-1}},{key:"nextBufferRange",get:function(){var e=this.media;return e?this.followingBufferRange(this.getBufferRange(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(m.default);n.default=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(42),h=r(f),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.MANIFEST_LOADING,u.default.FRAG_LOADED,u.default.LEVEL_SWITCH));if(n.hls=e,n.config=e.config,n.enabled=!0,n.Cues=e.config.cueHandler,n.config.enableCEA708Captions){var r=n,o=function(e,t){var n=null;try{n=new window.Event("addtrack")}catch(e){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)},s={newCue:function(e,t,n){if(!r.textTrack1){var i=r.getExistingTrack("1");i?(r.textTrack1=i,r.clearCurrentCues(r.textTrack1),o(r.textTrack1,r.media)):(r.textTrack1=r.createTextTrack("captions","English","en"),r.textTrack1.textTrack1=!0)}r.Cues.newCue(r.textTrack1,e,t,n)}},l={newCue:function(e,t,n){if(!r.textTrack2){var i=r.getExistingTrack("2");i?(r.textTrack2=i,r.clearCurrentCues(r.textTrack2),o(r.textTrack2,r.media)):(r.textTrack2=r.createTextTrack("captions","Spanish","es"),r.textTrack2.textTrack2=!0)}r.Cues.newCue(r.textTrack2,e,t,n)}};n.cea608Parser=new h.default(0,s,l)}return n}return o(t,e),s(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n],i="textTrack"+e;if(!0===r[i])return r}return null}},{key:"createTextTrack",value:function(e,t,n){if(this.media)return this.media.addTextTrack(e,t,n)}},{key:"destroy",value:function(){d.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var n=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,n)}}},{key:"extractCea608Data",value:function(e){for(var t,n,r,i,a,o=31&e[0],s=2,l=[],u=0;u<o;u++)t=e[s++],n=127&e[s++],r=127&e[s++],i=0!=(4&t),a=3&t,0===n&&0===r||i&&0===a&&(l.push(n),l.push(r));return l}}]),t}(d.default);n.default=v},{27:27,28:28,42:42}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.aesIV=n}return i(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();n.default=a},{}],15:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return i(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<n.length;r++)n[r]=t.getUint32(4*r);return n}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,n=this.subMix[0],r=this.subMix[1],i=this.subMix[2],a=this.subMix[3],o=this.invSubMix[0],s=this.invSubMix[1],l=this.invSubMix[2],u=this.invSubMix[3],c=new Uint32Array(256),d=0,f=0,h=0;for(h=0;h<256;h++)c[h]=h<128?h<<1:h<<1^283;for(h=0;h<256;h++){var v=f^f<<1^f<<2^f<<3^f<<4;v=v>>>8^255&v^99,e[d]=v,t[v]=d;var p=c[d],_=c[p],m=c[_],g=257*c[v]^16843008*v;n[d]=g<<24|g>>>8,r[d]=g<<16|g>>>16,i[d]=g<<8|g>>>24,a[d]=g,g=16843009*m^65537*_^257*p^16843008*d,o[v]=g<<24|g>>>8,s[v]=g<<16|g>>>16,l[v]=g<<8|g>>>24,u[v]=g,d?(d=p^c[c[c[m^p]]],f^=c[c[f]]):d=f=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a=this.ksRows=4*(i+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(this.ksRows),u=this.invKeySchedule=new Uint32Array(this.ksRows),c=this.sBox,d=this.rcon,f=this.invSubMix[0],h=this.invSubMix[1],v=this.invSubMix[2],p=this.invSubMix[3],_=void 0,m=void 0;for(o=0;o<a;o++)o<i?_=l[o]=t[o]:(m=_,o%i==0?(m=m<<8|m>>>24,m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m],m^=d[o/i|0]<<24):i>6&&o%i==4&&(m=c[m>>>24]<<24|c[m>>>16&255]<<16|c[m>>>8&255]<<8|c[255&m]),l[o]=_=(l[o-i]^m)>>>0);for(s=0;s<a;s++)o=a-s,m=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?m:f[c[m>>>24]]^h[c[m>>>16&255]]^v[c[m>>>8&255]]^p[c[255&m]],u[s]=u[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,n){for(var r,i,a=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,l=this.invSubMix[0],u=this.invSubMix[1],c=this.invSubMix[2],d=this.invSubMix[3],f=this.uint8ArrayToUint32Array_(n),h=f[0],v=f[1],p=f[2],_=f[3],m=new Int32Array(e),g=new Int32Array(m.length),y=void 0,E=void 0,S=void 0,T=void 0,b=void 0,R=void 0,A=void 0,D=void 0,k=void 0,w=void 0,O=void 0,C=void 0;t<m.length;){for(k=this.networkToHostOrderSwap(m[t]),w=this.networkToHostOrderSwap(m[t+1]),O=this.networkToHostOrderSwap(m[t+2]),C=this.networkToHostOrderSwap(m[t+3]),b=k^o[0],R=C^o[1],A=O^o[2],D=w^o[3],r=4,i=1;i<a;i++)y=l[b>>>24]^u[R>>16&255]^c[A>>8&255]^d[255&D]^o[r],E=l[R>>>24]^u[A>>16&255]^c[D>>8&255]^d[255&b]^o[r+1],S=l[A>>>24]^u[D>>16&255]^c[b>>8&255]^d[255&R]^o[r+2],T=l[D>>>24]^u[b>>16&255]^c[R>>8&255]^d[255&A]^o[r+3],b=y,R=E,A=S,D=T,r+=4;y=s[b>>>24]<<24^s[R>>16&255]<<16^s[A>>8&255]<<8^s[255&D]^o[r],E=s[R>>>24]<<24^s[A>>16&255]<<16^s[D>>8&255]<<8^s[255&b]^o[r+1],S=s[A>>>24]<<24^s[D>>16&255]<<16^s[b>>8&255]<<8^s[255&R]^o[r+2],T=s[D>>>24]<<24^s[b>>16&255]<<16^s[R>>8&255]<<8^s[255&A]^o[r+3],r+=3,g[t]=this.networkToHostOrderSwap(y^h),g[t+1]=this.networkToHostOrderSwap(T^v),g[t+2]=this.networkToHostOrderSwap(S^p),g[t+3]=this.networkToHostOrderSwap(E^_),h=k,v=w,p=O,_=C,t+=4}return g.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();n.default=a},{}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(14),s=r(o),l=e(17),u=r(l),c=e(15),d=r(c),f=e(26),h=e(45),v=function(){function e(t,n){i(this,e),this.observer=t,this.config=n;try{var r=crypto||self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return a(e,[{key:"decrypt",value:function(e,t,n,r){var i=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){h.logger.log("JS AES decrypt");var a=this.decryptor;a||(this.decryptor=a=new d.default),a.expandKey(t),r(a.decrypt(e,0,n))}else!function(){h.logger.log("WebCrypto AES decrypt");var a=i.subtle;i.key!==t&&(i.key=t,i.fastAesKey=new u.default(a,t)),i.fastAesKey.expandKey().then(function(t){new s.default(a,n).decrypt(e,t).then(function(e){r(e)})}).catch(function(a){i.onWebCryptoError(a,e,t,n,r)})}()}},{key:"onWebCryptoError",value:function(e,t,n,r,i){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(t,n,r,i)):(h.logger.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();n.default=v},{14:14,15:15,17:17,26:26,45:45}],17:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.subtle=t,this.key=n}return i(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();n.default=a},{}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),l=e(45),u=e(24),c=r(u),d=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.remuxer=new this.remuxerClass(t,n,a,o),this.insertDiscontinuity()}return a(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(e,t,n,r,i,a,o,u,d,f){var h,v,p,_,m,g,y,E,S,T,b=new c.default(e),R=90*b.timeStamp,A=!1;for(i!==this.lastCC?(l.logger.log(this.id+" discontinuity detected"),this.lastCC=i,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):a!==this.lastLevel?(l.logger.log("audio track switch detected"),this.lastLevel=a,this.remuxer.switchLevel(),this.insertDiscontinuity()):o===this.lastSN+1&&(A=!0),h=this._aacTrack,this.lastSN=o,this.lastLevel=a,g=b.length,S=e.length;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);for(h.audiosamplerate||(v=s.default.getAudioConfig(this.observer,e,g,t),h.config=v.config,h.audiosamplerate=v.samplerate,h.channelCount=v.channelCount,h.codec=v.codec,h.manifestCodec=v.manifestCodec,h.duration=u,l.logger.log("parsed codec:"+h.codec+",rate:"+v.samplerate+",nb channel:"+v.channelCount)),m=0,_=1024*9e4/h.audiosamplerate;g+5<S&&(y=1&e[g+1]?7:9,p=(3&e[g+3])<<11|e[g+4]<<3|(224&e[g+5])>>>5,(p-=y)>0&&g+y+p<=S);)for(E=R+m*_,T={unit:e.subarray(g+y,g+y+p),pts:E,dts:E},h.samples.push(T),h.len+=p,g+=p+y,m++;g<S-1&&(255!==e[g]||240!=(240&e[g+1]));g++);this.remuxer.remux(a,o,i,h,{samples:[]},{samples:[{pts:R,dts:R,unit:b.payload}]},{samples:[]},r,A,d,f)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,n,r=new c.default(e);if(r.hasTimeStamp)for(t=r.length,n=e.length;t<n-1;t++)if(255===e[t]&&240==(240&e[t+1]))return!0;return!1}}]),e}();n.default=d},{19:19,24:24,45:45}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=e(26),s=function(){function e(){r(this,e)}return i(e,null,[{key:"getAudioConfig",value:function(e,t,n,r){var i,s,l,u,c,d=navigator.userAgent.toLowerCase(),f=r,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return i=((192&t[n+2])>>>6)+1,(s=(60&t[n+2])>>>2)>h.length-1?void e.trigger(Event.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s}):(u=(1&t[n+2])<<2,u|=(192&t[n+3])>>>6,a.logger.log("manifest codec:"+r+",ADTS data:type:"+i+",sampleingIndex:"+s+"["+h[s]+"Hz],channelConfig:"+u),/firefox/i.test(d)?s>=6?(i=5,c=new Array(4),l=s-3):(i=2,c=new Array(2),l=s):-1!==d.indexOf("android")?(i=2,c=new Array(2),l=s):(i=5,c=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&s>=6?l=s-3:((r&&-1!==r.indexOf("mp4a.40.2")&&s>=6&&1===u||!r&&1===u)&&(i=2,c=new Array(2)),l=s)),c[0]=i<<3,c[0]|=(14&s)>>1,c[1]|=(1&s)<<7,c[1]|=u<<3,5===i&&(c[1]|=(14&l)>>1,c[2]=(1&l)<<7,c[2]|=2<<2,c[3]=0),{config:c,samplerate:h[s],channelCount:u,codec:"mp4a.40."+i,manifestCodec:f})}}]),e}();n.default=s},{26:26,45:45}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),l=e(26),u=e(16),c=r(u),d=e(18),f=r(d),h=e(25),v=r(h),p=e(38),_=r(p),m=e(39),g=r(m),y=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this.hls=t,this.id=n,this.config=this.hls.config||a,this.typeSupported=r}return a(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,n,r,i,a,o,l,u,d,f){if(e.byteLength>0&&null!=u&&null!=u.key&&"AES-128"===u.method){null==this.decrypter&&(this.decrypter=new c.default(this.hls,this.config));var h,v=this;try{h=performance.now()}catch(e){h=Date.now()}this.decrypter.decrypt(e,u.key.buffer,u.iv.buffer,function(e){var u;try{u=performance.now()}catch(e){u=Date.now()}v.hls.trigger(s.default.FRAG_DECRYPTED,{level:a,sn:o,stats:{tstart:h,tdecrypt:u}}),v.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,l,d,f)})}else this.pushDecrypted(new Uint8Array(e),t,n,r,i,a,o,l,d,f)}},{key:"pushDecrypted",value:function(e,t,n,r,i,a,o,u,c,d){var h=this.demuxer;if(!h||i!==this.cc&&!h.probe(e)){var p=this.hls,m=this.id,y=this.config,E=this.typeSupported;if(v.default.probe(e))h=!0===this.typeSupported.mp2t?new v.default(p,m,g.default,y,E):new v.default(p,m,_.default,y,E),h.probe=v.default.probe;else{if(!f.default.probe(e))return void p.trigger(s.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,id:m,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});h=new f.default(p,m,_.default,y,E),h.probe=f.default.probe}this.demuxer=h}h.push(e,t,n,r,i,a,o,u,c,d),this.cc=i}}]),e}();n.default=y},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e(20),a=r(i),o=e(28),s=r(o),l=e(45),u=e(1),c=r(u),d=function(e){var t=new c.default;t.trigger=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var o=JSON.parse(i.config);e.demuxer=new a.default(t,i.id,i.typeSupported,o);try{(0,l.enableLogs)(!0===o.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":e.demuxer.push(i.data,i.audioCodec,i.videoCodec,i.timeOffset,i.cc,i.level,i.sn,i.duration,i.decryptdata,i.accurateTimeOffset,i.defaultInitPTS)}}),t.on(s.default.FRAG_DECRYPTED,n),t.on(s.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(s.default.FRAG_PARSED,n),t.on(s.default.ERROR,n),t.on(s.default.FRAG_PARSING_METADATA,n),t.on(s.default.FRAG_PARSING_USERDATA,n),t.on(s.default.INIT_PTS_FOUND,n),t.on(s.default.FRAG_PARSING_DATA,function(t,n){var r=n.data1.buffer,i=n.data2.buffer;delete n.data1,delete n.data2,e.postMessage({event:t,data:n,data1:r,data2:i},[r,i])})};n.default=d},{1:1,20:20,28:28,45:45}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),l=e(20),u=r(l),c=e(21),d=r(c),f=e(45),h=e(26),v=function(){function t(n,r){i(this,t),this.hls=n,this.id=r;var a={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:n.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(n.config.enableWorker&&"undefined"!=typeof Worker){f.logger.log("demuxing in webworker");var o=void 0;try{var l=e(3);o=this.w=l(d.default),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(e){n.trigger(s.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:a,id:r,config:JSON.stringify(n.config)})}catch(e){f.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&URL.revokeObjectURL(o.objectURL),this.demuxer=new u.default(n,r,a),this.w=void 0}}else this.demuxer=new u.default(n,r,a);this.demuxInitialized=!0}return a(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}}},{key:"push",value:function(e,t,n,r,i,a,o,s,l,u,c){var d=this.w;if(d)d.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:n,timeOffset:r,cc:i,level:a,sn:o,duration:s,decryptdata:l,accurateTimeOffset:u,defaultInitPTS:c},[e]);else{var f=this.demuxer;f&&f.push(e,t,n,r,i,a,o,s,l,u,c)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,n=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data.data2=new Uint8Array(t.data2);default:n.trigger(t.event,t.data)}}}]),t}();n.default=v},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,r=8,i=8;for(t=0;t<e;t++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i}},{key:"readSPS",value:function(){var e,t,n,r,i,a,o,s=0,l=0,u=0,c=0,d=this.readUByte.bind(this),f=this.readBits.bind(this),h=this.readUEG.bind(this),v=this.readBoolean.bind(this),p=this.skipBits.bind(this),_=this.skipEG.bind(this),m=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(d(),e=d(),f(5),p(3),d(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var y=h();if(3===y&&p(1),m(),m(),p(1),v())for(a=3!==y?8:12,o=0;o<a;o++)v()&&g(o<6?16:64)}m();var E=h();if(0===E)h();else if(1===E)for(p(1),_(),_(),t=h(),o=0;o<t;o++)_();m(),p(1),n=h(),r=h(),i=f(1),0===i&&p(1),p(1),v()&&(s=h(),l=h(),u=h(),c=h());var S=[1,1];if(v()&&v()){switch(d()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[d()<<8|d(),d()<<8|d()]}}return{width:Math.ceil(16*(n+1)-2*s-2*l),height:(2-i)*(r+1)*16-(i?2:4)*(u+c),pixelRatio:S}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();n.default=o},{45:45}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),this._hasTimeStamp=!1;var n,i,o,s,l,u,c,d,f=0;do{if(c=this.readUTF(t,f,3),f+=3,"ID3"===c)f+=3,n=127&t[f++],i=127&t[f++],o=127&t[f++],s=127&t[f++],l=(n<<21)+(i<<14)+(o<<7)+s,u=f+l,this._parseID3Frames(t,f,u),f=u;else{if("3DI"!==c)return f-=3,void((d=f)&&(this.hasTimeStamp||a.logger.warn("ID3 tag found, but no timestamp"),this._length=d,this._payload=t.subarray(0,d)));f+=7,a.logger.log("3DI footer found, end: "+f)}}while(!0)}return i(e,[{key:"readUTF",value:function(e,t,n){var r="",i=t,a=t+n;do{r+=String.fromCharCode(e[i++])}while(i<a);return r}},{key:"_parseID3Frames",value:function(e,t,n){for(var r,i;t+8<=n;)switch(r=this.readUTF(e,t,4),t+=4,e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],e[t++]<<8+e[t++],t,r){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var o=1&e[t++];this._hasTimeStamp=!0,i=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,o&&(i+=47721858.84),i=Math.round(i),a.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();n.default=o},{45:45}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(19),s=r(o),l=e(28),u=r(l),c=e(23),d=r(c),f=e(45),h=e(26),v=function(){function e(t,n,r,a,o){i(this,e),this.observer=t,this.id=n,this.remuxerClass=r,this.config=a,this.typeSupported=o,this.lastCC=0,this.remuxer=new this.remuxerClass(t,n,a,o)}return a(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,n,r,i,a,o,s,l,c){var d,v,p,_,m,g=e.length,y=this.remuxer.passthrough,E=!1;this.audioCodec=t,this.videoCodec=n,this._duration=s,this.contiguous=!1,this.accurateTimeOffset=l,i!==this.lastCC&&(f.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=i),a!==this.lastLevel?(f.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=a):o===this.lastSN+1&&(this.contiguous=!0),this.lastSN=o;var S=this.pmtParsed,T=this._avcTrack,b=this._audioTrack,R=this._id3Track,A=T.id,D=b.id,k=R.id,w=this._pmtId,O=T.pesData,C=b.pesData,L=R.pesData,P=this._parsePAT,I=this._parsePMT,M=this._parsePES,N=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),U=this._parseMPEGPES.bind(this),F=this._parseID3PES.bind(this);for(g-=g%188,d=0;d<g;d+=188)if(71===e[d]){if(v=!!(64&e[d+1]),p=((31&e[d+1])<<8)+e[d+2],(48&e[d+3])>>4>1){if((_=d+5+e[d+4])===d+188)continue}else _=d+4;switch(p){case A:if(v){if(O&&(m=M(O))&&(N(m,!1),y&&T.codec&&(-1===D||b.codec)))return void this.remux(a,o,i,e,r);O={data:[],size:0}}O&&(O.data.push(e.subarray(_,d+188)),O.size+=d+188-_);break;case D:if(v){if(C&&(m=M(C))&&(b.isAAC?x(m):U(m),y&&b.codec&&(-1===A||T.codec)))return void this.remux(a,o,i,e,r);C={data:[],size:0}}C&&(C.data.push(e.subarray(_,d+188)),C.size+=d+188-_);break;case k:v&&(L&&(m=M(L))&&F(m),L={data:[],size:0}),L&&(L.data.push(e.subarray(_,d+188)),L.size+=d+188-_);break;case 0:v&&(_+=e[_]+1),w=this._pmtId=P(e,_);break;case w:v&&(_+=e[_]+1);var B=I(e,_,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3);A=B.avc,A>0&&(T.id=A),D=B.audio,D>0&&(b.id=D,b.isAAC=B.isAAC),k=B.id3,k>0&&(R.id=k),E&&!S&&(f.logger.log("reparse from beginning"),E=!1,d=-188),S=this.pmtParsed=!0;break;case 17:case 8191:break;default:E=!0}}else this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});O&&(m=M(O))?(N(m,!0),T.pesData=null):T.pesData=O,C&&(m=M(C))?(b.isAAC?x(m):U(m),b.pesData=null):(C&&C.size&&f.logger.log("last AAC PES packet truncated,might overlap between fragments"),b.pesData=C),L&&(m=M(L))?(F(m),R.pesData=null):R.pesData=L,this.remux(a,o,i,null,r,c)}},{key:"remux",value:function(e,t,n,r,i,a){for(var o=this._avcTrack,s=o.samples,l=0,u=0,c=0;c<s.length;c++){for(var d=s[c],f=d.units.units,h=f.length,v=0,p=0;p<h;p++)v+=f[p].data.length;u+=v,l+=h,d.length=v}o.len=u,o.nbNalu=l,this.remuxer.remux(e,t,n,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,i,this.contiguous,this.accurateTimeOffset,a,r)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,n){var r,i,a,o,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=(15&e[t+1])<<8|e[t+2],i=t+3+r-4,a=(15&e[t+10])<<8|e[t+11],t+=12+a;t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 15:-1===s.audio&&(s.audio=o);break;case 21:-1===s.id3&&(s.id3=o);break;case 27:-1===s.avc&&(s.avc=o);break;case 3:case 4:n?-1===s.audio&&(s.audio=o,s.isAAC=!1):f.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:f.logger.warn("HEVC stream type found, not supported for now");break;default:f.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}return s}},{key:"_parsePES",value:function(e){var t,n,r,i,a,o,s,l,u=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&c.length>1;){var d=new Uint8Array(c[0].length+c[1].length);d.set(c[0]),d.set(c[1],c[0].length),c[0]=d,c.splice(1,1)}if(t=c[0],1===(t[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;n=t[7],192&n&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&n?(s=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,s>4294967295&&(s-=8589934592),o-s>60*9e4&&(f.logger.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),i=t[8],l=i+9,e.size-=l,a=new Uint8Array(e.size);for(var h=0,v=c.length;h<v;h++){t=c[h];var p=t.byteLength;if(l){if(l>p){l-=p;continue}t=t.subarray(l),p-=l,l=0}a.set(t,u),u+=p}return r&&(r-=i+3),{data:a,pts:o,dts:s,len:r}}return null}},{key:"pushAccesUnit",value:function(e,t){e.units.units.length&&e.frame&&(!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(t.samples.length||this.contiguous)?t.samples.push(e):t.dropped++),e.debug.length&&f.logger.log(e.pts+"/"+e.dts+":"+e.debug+","+e.units.length)}},{key:"_parseAVCPES",value:function(e,t){var n,r,i,a=this,o=this._avcTrack,s=this._parseAVCNALu(e.data),l=!1,u=this.avcSample;e.data=null,s.forEach(function(t){switch(t.type){case 1:r=!0,l&&u&&(u.debug+="NDR "),u.frame=!0;var s=t.data;if(s.length>4){var c=new d.default(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(u.key=!0)}break;case 5:r=!0,u||(u=a.avcSample=a._createAVCSample(!0,e.pts,e.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:r=!0,l&&u&&(u.debug+="SEI "),n=new d.default(a.discardEPB(t.data)),n.readUByte();for(var f=0,h=0,v=!1,p=0;!v&&n.bytesAvailable>1;){f=0;do{p=n.readUByte(),f+=p}while(255===p);h=0;do{p=n.readUByte(),h+=p}while(255===p);if(4===f&&0!==n.bytesAvailable){v=!0;if(181===n.readUByte()){if(49===n.readUShort()){if(1195456820===n.readUInt()){if(3===n.readUByte()){var _=n.readUByte(),m=n.readUByte(),g=31&_,y=[_,m];for(i=0;i<g;i++)y.push(n.readUByte()),y.push(n.readUByte()),y.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:y})}}}}}else if(h<n.bytesAvailable)for(i=0;i<h;i++)n.readUByte()}break;case 7:if(r=!0,l&&u&&(u.debug+="SPS "),!o.sps){n=new d.default(t.data);var E=n.readSPS();o.width=E.width,o.height=E.height,o.pixelRatio=E.pixelRatio,o.sps=[t.data],o.duration=a._duration;var S=t.data.subarray(1,4),T="avc1.";for(i=0;i<3;i++){var b=S[i].toString(16);b.length<2&&(b="0"+b),T+=b}o.codec=T}break;case 8:r=!0,l&&u&&(u.debug+="PPS "),o.pps||(o.pps=[t.data]);break;case 9:r=!1,u&&a.pushAccesUnit(u,o),u=a.avcSample=a._createAVCSample(!1,e.pts,e.dts,l?"AUD ":"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}if(u&&r){u.units.units.push(t)}}),t&&u&&(this.pushAccesUnit(u,o),this.avcSample=null)}},{key:"_createAVCSample",value:function(e,t,n,r){return{key:e,pts:t,dts:n,units:{units:[],length:0},debug:r}}},{key:"_insertSampleInOrder",value:function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.units.length){var n=this._avcTrack,r=n.samples;e=r[r.length-1]}if(e){var i=e.units.units;t=i[i.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t,n,r,i,a,o=0,s=e.byteLength,l=this._avcTrack,u=l.naluState||0,c=u,d=[],f=-1;for(-1===u&&(f=0,a=31&e[0],u=0,o=1);o<s;)if(t=e[o++],u)if(1!==u)if(t)if(1===t){if(f>=0)r={data:e.subarray(f,o-u-1),type:a},d.push(r);else{var h=this._getLastNalUnit();if(h&&(c&&o<=4-c&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-c)),(n=o-u-1)>0)){var v=new Uint8Array(h.data.byteLength+n);v.set(h.data,0),v.set(e.subarray(0,n),h.data.byteLength),h.data=v}}o<s?(i=31&e[o],f=o,a=i,u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(f>=0&&u>=0&&(r={data:e.subarray(f,s),type:a,state:u},d.push(r)),0===d.length){var p=this._getLastNalUnit();if(p){var _=new Uint8Array(p.data.byteLength+e.byteLength);_.set(p.data,0),_.set(e,p.data.byteLength),p.data=_}}return l.naluState=u,d}},{key:"discardEPB",value:function(e){for(var t,n,r=e.byteLength,i=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var o=0;for(a=0;a<t;o++,a++)o===i[0]&&(o++,i.shift()),n[a]=e[o];return n}},{key:"_parseAACPES",value:function(e){var t,n,r,i,a,o,l,c,d,v=this._audioTrack,p=e.data,_=e.pts,m=0,g=this.aacOverFlow,y=this.aacLastPTS;if(g){var E=new Uint8Array(g.byteLength+p.byteLength);E.set(g,0),E.set(p,g.byteLength),p=E}for(a=m,c=p.length;a<c-1&&(255!==p[a]||240!=(240&p[a+1]));a++);if(a){var S,T;if(a<c-1?(S="AAC PES did not start with ADTS header,offset:"+a,T=!1):(S="no ADTS header found in AAC PES",T=!0),f.logger.warn("parsing error:"+S),this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:T,reason:S}),T)return}if(!v.audiosamplerate){var b=this.audioCodec;t=s.default.getAudioConfig(this.observer,p,a,b),v.config=t.config,v.audiosamplerate=t.samplerate,v.channelCount=t.channelCount,v.codec=t.codec,v.manifestCodec=t.manifestCodec,v.duration=this._duration,f.logger.log("parsed codec:"+v.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)}if(i=0,r=1024*9e4/v.audiosamplerate,g&&y){var R=y+r;Math.abs(R-_)>1&&(f.logger.log("AAC: align PTS for overlapping frames by "+Math.round((R-_)/90)),_=R)}for(;a+5<c&&(o=1&p[a+1]?7:9,n=(3&p[a+3])<<11|p[a+4]<<3|(224&p[a+5])>>>5,(n-=o)>0&&a+o+n<=c);)for(l=_+i*r,d={unit:p.subarray(a+o,a+o+n),pts:l,dts:l},v.samples.push(d),v.len+=n,a+=n+o,i++;a<c-1&&(255!==p[a]||240!=(240&p[a+1]));a++);g=a<c?p.subarray(a,c):null,this.aacOverFlow=g,this.aacLastPTS=l}},{key:"_parseMPEGPES",value:function(e){for(var t,n=e.data,r=e.pts,i=n.length,a=0,o=0;o<i&&(t=this._parseMpeg(n,o,i,a++,r))>0;)o+=t}},{key:"_onMpegFrame",value:function(e,t,n,r,i,a){var o=1152/n*1e3,s=a+i*o,l=this._audioTrack;l.config=[],l.channelCount=r,l.audiosamplerate=n,l.duration=this._duration,l.samples.push({unit:e,pts:s,dts:s}),l.len+=e.length}},{key:"_onMpegNoise",value:function(e){f.logger.warn("mpeg audio has noise: "+e.length+" bytes")}},{key:"_parseMpeg",value:function(e,t,n,r,i){var a=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(t+2>n)return-1;if(255===e[t]||224==(224&e[t+1])){if(t+24>n)return-1;var s=e[t+1]>>3&3,l=e[t+1]>>1&3,u=e[t+2]>>4&15,c=e[t+2]>>2&3,d=!!(2&e[t+2]);if(1!==s&&0!==u&&15!==u&&3!==c){var f=3===s?3-l:3===l?3:4,h=1e3*a[14*f+u-1],v=3===s?0:2===s?1:2,p=o[3*v+c],_=d?1:0,m=e[t+3]>>6==3?1:2,g=3===l?(3===s?12:6)*h/p+_<<2:(3===s?144:72)*h/p+_|0;return t+g>n?-1:(this._onMpegFrame&&this._onMpegFrame(e.subarray(t,t+g),h,p,m,r,i),g)}}for(var y=t+2;y<n;){if(255===e[y-1]&&224==(224&e[y]))return this._onMpegNoise&&this._onMpegNoise(e.subarray(t,y-1)),y-t-1;y++}return-1}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=3*188&&71===e[0]&&71===e[188]&&71===e[2*188]}}]),e}();n.default=v},{19:19,23:23,26:26,28:28,45:45}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},n.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(45),s=e(26),l=e(28),u=function(e){return e&&e.__esModule?e:{default:e}}(l),c=function(){function e(t){r(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return a(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===i(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();n.default=c},{26:26,28:28,45:45}],28:[function(e,t,n){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();n.default=a},{}],30:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"isBuffered",value:function(e,t){if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0;return!1}},{key:"bufferInfo",value:function(e,t,n){if(e){var r,i=e.buffered,a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,t,n)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,n){var r,i,a,o,s,l=[];for(e.sort(function(e,t){var n=e.start-t.start;return n||t.end-e.end}),s=0;s<e.length;s++){var u=l.length;if(u){var c=l[u-1].end;e[s].start-c<n?e[s].end>c&&(l[u-1].end=e[s].end):l.push(e[s])}else l.push(e[s])}for(s=0,r=0,i=a=t;s<l.length;s++){var d=l[s].start,f=l[s].end;if(t+n>=d&&t<f)i=d,a=f,r=a-t;else if(t+n<d){o=d;break}}return{len:r,start:i,end:a,nextStart:o}}}]),e}();n.default=a},{}],31:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(){r(this,e)}return i(e,null,[{key:"mergeDetails",value:function(t,n){var r,i=Math.max(t.startSN,n.startSN)-n.startSN,o=Math.min(t.endSN,n.endSN)-n.startSN,s=n.startSN-t.startSN,l=t.fragments,u=n.fragments,c=0;if(o<i)return void(n.PTSKnown=!1);for(var d=i;d<=o;d++){var f=l[s+d],h=u[d];h&&f&&(c=f.cc-h.cc,isNaN(f.startPTS)||(h.start=h.startPTS=f.startPTS,h.endPTS=f.endPTS,h.duration=f.duration,r=h))}if(c)for(a.logger.log("discontinuity sliding from playlist, take drift into account"),d=0;d<u.length;d++)u[d].cc+=c;if(r)e.updateFragPTSDTS(n,r.sn,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(s>=0&&s<l.length){var v=l[s].start;for(d=0;d<u.length;d++)u[d].start+=v}n.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,n,r,i,a,o){var s,l,u,c;if(!t||n<t.startSN||n>t.endSN)return 0;if(s=n-t.startSN,l=t.fragments,u=l[s],!isNaN(u.startPTS)){var d=Math.abs(u.startPTS-r);isNaN(u.deltaPTS)?u.deltaPTS=d:u.deltaPTS=Math.max(d,u.deltaPTS),r=Math.min(r,u.startPTS),i=Math.max(i,u.endPTS),a=Math.min(a,u.startDTS),o=Math.max(o,u.endDTS)}var f=r-u.start;for(u.start=u.startPTS=r,u.endPTS=i,u.startDTS=a,u.endDTS=o,u.duration=i-r,c=s;c>0;c--)e.updatePTS(l,c,c-1);for(c=s;c<l.length-1;c++)e.updatePTS(l,c,c+1);return t.PTSKnown=!0,f}},{key:"updatePTS",value:function(e,t,n){var r=e[t],i=e[n],o=i.startPTS;isNaN(o)?i.start=n>t?r.start+r.duration:r.start-i.duration:n>t?(r.duration=o-r.start,r.duration<0&&a.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&a.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();n.default=o},{45:45}],32:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(28),s=r(o),l=e(26),u=e(36),c=r(u),d=e(34),f=r(d),h=e(4),v=r(h),p=e(7),_=r(p),m=e(8),g=r(m),y=e(5),E=r(y),S=e(12),T=r(S),b=e(11),R=r(b),A=e(13),D=r(A),k=e(10),w=r(k),O=e(6),C=r(O),L=e(45),P=e(47),I=r(P),M=e(1),N=r(M),x=e(35),U=r(x),F=e(43),B=r(F),G=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var r in n)r in t||(t[r]=n[r]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,L.enableLogs)(t.debug),this.config=t;var a=this.observer=new N.default;a.trigger=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.emit.apply(a,[e,e].concat(n))},a.off=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];a.removeListener.apply(a,[e].concat(n))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a),this.playlistLoader=new c.default(this),this.fragmentLoader=new f.default(this),this.levelController=new R.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new C.default(this),this.keyLoader=new U.default(this)}return a(e,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.21"}},{key:"Events",get:function(){return s.default}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:I.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:v.default,bufferController:_.default,capLevelController:g.default,fpsController:w.default,streamController:T.default,audioStreamController:E.default,timelineController:D.default,cueHandler:B.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),a(e,[{key:"destroy",value:function(){L.logger.log("destroy"),this.trigger(s.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){L.logger.log("attachMedia"),this.media=e,this.trigger(s.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){L.logger.log("detachMedia"),this.trigger(s.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){L.logger.log("loadSource:"+e),this.url=e,this.trigger(s.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;L.logger.log("startLoad("+e+")"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){L.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){L.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){L.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){L.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){L.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){L.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(e){L.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){L.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){L.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();n.default=G},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(e,t,n){"use strict";t.exports=e(32).default},{32:32}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING));return n.loaders={},n}return o(t,e),s(t,[{key:"destroy",value:function(){var e=this.loaders;for(var t in e){var n=e[t];n&&n.destroy()}this.loaders={},d.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=this.hls.config;t.loaded=0,r&&(h.logger.warn("abort previous fragment loader for type:"+n),r.abort()),r=this.loaders[n]=t.loader=void 0!==i.fLoader?new i.fLoader(i):new i.loader(i);var a=void 0,o=void 0,s=void 0;a={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var l=t.byteRangeStartOffset,u=t.byteRangeEndOffset;isNaN(l)||isNaN(u)||(a.rangeStart=l,a.rangeEnd=u),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},r.load(a,o,s)}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=n.frag;i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:r,frag:i,stats:t})}},{key:"loaderror",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.loader;n&&n.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(e,t,n){var r=t.frag;r.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:r,stats:e})}}]),t}(d.default);n.default=v},{26:26,27:27,28:28,45:45}],35:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(28),u=r(l),c=e(27),d=r(c),f=e(26),h=e(45),v=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.KEY_LOADING));return n.loaders={},n.decryptkey=null,n.decrypturl=null,n}return o(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},d.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,n=t.type,r=this.loaders[n],i=t.decryptdata,a=i.uri;if(a!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;r&&(h.logger.warn("abort previous key loader for type:"+n),r.abort()),t.loader=this.loaders[n]=new o.loader(o),this.decrypturl=a,this.decryptkey=null;var s=void 0,l=void 0,c=void 0;s={url:a,frag:t,responseType:"arraybuffer"},l={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(s,l,c)}else this.decryptkey&&(i.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,n){var r=n.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(u.default.KEY_LOADED,{frag:r})}},{key:"loaderror",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})}},{key:"loadtimeout",value:function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})}}]),t}(d.default);n.default=v},{26:26,27:27,28:28,45:45}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e(2),u=r(l),c=e(28),d=r(c),f=e(27),h=r(f),v=e(26),p=e(40),_=r(p),m=e(45),g=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,y=/#EXT-X-MEDIA:(.*)/g,E=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,S=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,T=function(){function e(){o(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return s(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=u.default.buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),e}(),b=function(){function e(){o(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return s(e,[{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var n=e;return e&&e.method&&e.uri&&!e.iv&&(n=new T,n.method=e.method,n.baseuri=e.baseuri,n.reluri=e.reluri,n.iv=this.createInitializationVector(t)),n}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=u.default.buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var n=this.lastByteRangeEndOffset;e[0]=n||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),R=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,d.default.MANIFEST_LOADING,d.default.LEVEL_LOADING,d.default.AUDIO_TRACK_LOADING));return n.loaders={},n}return a(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(e,t){var n=this.loaders[t.type];if(n){var r=n.context;if(r&&r.url===e)return void m.logger.trace("playlist request ongoing");m.logger.warn("abort previous loader for type:"+t.type),n.abort()}var i=this.hls.config,a=void 0,o=void 0,s=void 0,l=void 0;"manifest"===t.type?(a=i.manifestLoadingMaxRetry,o=i.manifestLoadingTimeOut,s=i.manifestLoadingRetryDelay,l=i.manifestLoadingMaxRetryTimeout):(a=i.levelLoadingMaxRetry,o=i.levelLoadingTimeOut,s=i.levelLoadingRetryDelay,l=i.levelLoadingMaxRetryTimeout,m.logger.log("loading playlist for "+t.type+" "+(t.level||t.id))),n=this.loaders[t.type]=t.loader=void 0!==i.pLoader?new i.pLoader(i):new i.loader(i),t.url=e,t.responseType="";var u=void 0,c=void 0;u={timeout:o,maxRetry:a,retryDelay:s,maxRetryDelay:l},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.load(t,u,c)}},{key:"resolve",value:function(e,t){return u.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){var n=[],r=void 0;for(g.lastIndex=0;null!=(r=g.exec(e));){var i={},a=i.attrs=new _.default(r[1]);i.url=this.resolve(r[2],t);var o=a.decimalResolution("RESOLUTION");o&&(i.width=o.width,i.height=o.height),i.bitrate=a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),i.name=a.NAME;var s=a.CODECS;if(s){s=s.split(/[ ,]+/);for(var l=0;l<s.length;l++){var u=s[l];-1!==u.indexOf("avc1")?i.videoCodec=this.avc1toavcoti(u):i.audioCodec=u}}n.push(i)}return n}},{key:"parseMasterPlaylistMedia",value:function(e,t,n){var r=void 0,i=[];for(y.lastIndex=0;null!=(r=y.exec(e));){var a={},o=new _.default(r[1]);o.TYPE===n&&(a.groupId=o["GROUP-ID"],a.name=o.NAME,a.type=n,a.default="YES"===o.DEFAULT,a.autoselect="YES"===o.AUTOSELECT,a.forced="YES"===o.FORCED,o.URI&&(a.url=this.resolve(o.URI,t)),a.lang=o.LANGUAGE,a.name||(a.name=a.lang),i.push(a))}return i}},{key:"avc1toavcoti",value:function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseLevelPlaylist",value:function(e,t,n,r){var i,a,o=0,s=0,l={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},u=new T,c=0,d=null,f=new b;for(E.lastIndex=0;null!==(i=E.exec(e));){var h=i[1];if(h){f.duration=parseFloat(h);var v=(" "+i[2]).slice(1);f.title=v||null,f.tagList.push(v?["INF",h,v]:["INF",h])}else if(i[3]){if(!isNaN(f.duration)){var p=o++;f.type=r,f.start=s,f.levelkey=u,f.sn=p,f.level=n,f.cc=c,f.baseurl=t,f.relurl=(" "+i[3]).slice(1),l.fragments.push(f),d=f,s+=f.duration,f=new b}}else if(i[4]){if(f.rawByteRange=(" "+i[4]).slice(1),d){var g=d.byteRangeEndOffset;g&&(f.lastByteRangeEndOffset=g)}}else if(i[5])f.rawProgramDateTime=(" "+i[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]);else{for(i=i[0].match(S),a=1;a<i.length&&void 0===i[a];a++);var y=(" "+i[a+1]).slice(1),R=(" "+i[a+2]).slice(1);switch(i[a]){case"#":f.tagList.push(R?[y,R]:[y]);break;case"PLAYLIST-TYPE":l.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(y);break;case"TARGETDURATION":l.targetduration=parseFloat(y);break;case"VERSION":l.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":c++,f.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":c=parseInt(y);break;case"KEY":var A=y,D=new _.default(A),k=D.enumeratedString("METHOD"),w=D.URI,O=D.hexadecimalInteger("IV");k&&(u=new T,w&&"AES-128"===k&&(u.method=k,u.baseuri=t,u.reluri=w,u.key=null,u.iv=O));break;case"START":var C=y,L=new _.default(C),P=L.decimalFloatingPoint("TIME-OFFSET");isNaN(P)||(l.startTimeOffset=P);break;case"MAP":var I=new _.default(y);f.relurl=I.URI,f.rawByteRange=I.BYTERANGE,f.baseurl=t,f.level=n,f.type=r,f.sn="initSegment",l.initSegment=f,f=new b;break;default:m.logger.warn("line parsed but not handled: "+i)}}}return f=d,f&&!f.relurl&&(l.fragments.pop(),s-=f.duration),l.totalduration=s,l.averagetargetduration=s/l.fragments.length,l.endSN=o-1,l}},{key:"loadsuccess",value:function(e,t,n){var r=e.data,i=e.url,a=n.type,o=n.id,s=n.level,l=this.hls;if(this.loaders[a]=void 0,void 0!==i&&0!==i.indexOf("data:")||(i=n.url),t.tload=performance.now(),0===r.indexOf("#EXTM3U"))if(r.indexOf("#EXTINF:")>0){var u="audioTrack"!==a,c=this.parseLevelPlaylist(r,i,(u?s:o)||0,u?"main":"audio");"manifest"===a&&l.trigger(d.default.MANIFEST_LOADED,{levels:[{url:i,details:c}],audioTracks:[],url:i,stats:t}),t.tparsed=performance.now(),c.targetduration?u?l.trigger(d.default.LEVEL_LOADED,{details:c,level:s||0,id:o||0,stats:t}):l.trigger(d.default.AUDIO_TRACK_LOADED,{details:c,id:o,stats:t}):l.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"invalid targetduration"})}else{var f=this.parseMasterPlaylist(r,i);if(f.length){var h=this.parseMasterPlaylistMedia(r,i,"AUDIO");if(h.length){var p=!1;h.forEach(function(e){e.url||(p=!0)}),!1===p&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(m.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main"}))}l.trigger(d.default.MANIFEST_LOADED,{levels:f,audioTracks:h,url:i,stats:t})}else l.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no level found in manifest"})}else l.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,response:e,context:t})}},{key:"loadtimeout",value:function(e,t){var n,r,i=t.loader;switch(t.type){case"manifest":n=v.ErrorDetails.MANIFEST_LOAD_TIMEOUT,r=!0;break;case"level":n=v.ErrorDetails.LEVEL_LOAD_TIMEOUT,r=!1;break;case"audioTrack":n=v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,r=!1}i&&(i.abort(),this.loaders[t.type]=void 0),this.hls.trigger(d.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:n,fatal:r,url:i.url,loader:i,context:t})}}]),t}(h.default);n.default=R},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,l,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;i--;)r+=n[i].byteLength;for(t=new Uint8Array(r),t[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<a;i++)t.set(n[i],r),r+=n[i].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,n){return n*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))}},{key:"moov",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))}},{key:"mvhd",value:function(t,n){n*=t;var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,r)}},{key:"sdtp",value:function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var n,r,i,a=[],o=[];for(n=0;n<t.sps.length;n++)r=t.sps[n],i=r.byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)r=t.pps[n],i=r.byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],252|3,224|t.sps.length].concat(a).concat([t.pps.length]).concat(o))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var n=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var n=t.audiosamplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,a=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,n){var r=e.sdtp(t),i=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,n){var r,i,a,o,s,l,u=t.samples||[],c=u.length,d=12+16*c,f=new Uint8Array(d);for(n+=8+d,f.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)i=u[r],a=i.duration,o=i.size,s=i.flags,l=i.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,s.degradPrio&240<<8,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*r);return e.box(e.types.trun,f)}},{key:"initSegment",value:function(t){e.types||e.init();var n,r=e.moov(t);return n=new Uint8Array(e.FTYP.byteLength+r.byteLength),n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n}}]),e}();n.default=a},{}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e(29),s=r(o),l=e(28),u=r(l),c=e(45),d=e(37),f=r(d),h=e(26),v=function(){function e(t,n,r,a){i(this,e),this.observer=t,this.id=n,this.config=r,this.typeSupported=a,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return a(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a,o,s,l,c,d){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(r,i,s,n),null!==d&&(this._initPTS=this._initDTS=d),this.ISGenerated)if(r.samples.length){var f=this.remuxAudio(r,s,l,c);if(i.samples.length){var h=void 0;f&&(h=f.endPTS-f.startPTS),this.remuxVideo(i,s,l,h)}}else{var v=void 0;i.samples.length&&(v=this.remuxVideo(i,s,l)),v&&r.codec&&this.remuxEmptyAudio(r,s,l,v)}a.samples.length&&this.remuxID3(a,s),o.samples.length&&this.remuxText(o,s),this.observer.trigger(u.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,n,r){var i,a,o=this.observer,s=e.samples,l=t.samples,d=this.PES_TIMESCALE,v=this.typeSupported,p="audio/mp4",_={},m={id:this.id,level:this.level,sn:this.sn,tracks:_,unique:!1},g=void 0===this._initPTS;g&&(i=a=1/0),e.config&&s.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&function(){e.timescale=e.audiosamplerate/function e(t,n){return n?e(n,t%n):t}(e.audiosamplerate,e.isAAC?1024:1152)}(),c.logger.log("audio mp4 timescale :"+e.timescale),e.isAAC||(v.mpeg?(p="audio/mpeg",e.codec=""):v.mp3&&(e.codec="mp3")),_.audio={container:p,codec:e.codec,initSegment:!e.isAAC&&v.mpeg?new Uint8Array:f.default.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(i=a=s[0].pts-d*n)),t.sps&&t.pps&&l.length&&(t.timescale=this.MP4_TIMESCALE,_.video={container:"video/mp4",codec:t.codec,initSegment:f.default.initSegment([t]),metadata:{width:t.width,height:t.height}},g&&(i=Math.min(i,l[0].pts-d*n),a=Math.min(a,l[0].dts-d*n),this.observer.trigger(u.default.INIT_PTS_FOUND,{id:this.id,initPTS:i,cc:r}))),Object.keys(_).length?(o.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,m),this.ISGenerated=!0,g&&(this._initPTS=i,this._initDTS=a)):o.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,n,r){var i,a,o,s,l,d,v,p=8,_=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,g=e.samples,y=[],E=g.length,S=this._PTSNormalize,T=this._initDTS;g.sort(function(e,t){var n=e.dts-t.dts;return n||e.pts-t.pts});var b=g.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(b<0){c.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var R=0;R<g.length;R++)g[R].dts+=b}var A=void 0;A=n?this.nextAvcDts:t*_;var D=g[0];l=Math.max(S(D.dts-T,A),0),s=Math.max(S(D.pts-T,A),0);var k=Math.round((l-A)/90);n&&k&&(k>1?c.logger.log("AVC:"+k+" ms hole between fragments detected,filling it"):k<-1&&c.logger.log("AVC:"+-k+" ms overlapping between fragments detected"),l=A,g[0].dts=l+T,s=Math.max(s-k,A),g[0].pts=s+T,c.logger.log("Video/PTS/DTS adjusted: "+Math.round(s/90)+"/"+Math.round(l/90)+",delta:"+k+" ms")),D=g[g.length-1],v=Math.max(S(D.dts-T,A),0),d=Math.max(S(D.pts-T,A),0),d=Math.max(d,v);var w=navigator.vendor,O=navigator.userAgent,C=w&&w.indexOf("Apple")>-1&&O&&!O.match("CriOS");C&&(i=Math.round((v-l)/(m*(g.length-1))));for(var L=0;L<E;L++){var P=g[L];C?P.dts=l+L*m*i:(P.dts=Math.max(S(P.dts-T,A),l),P.dts=Math.round(P.dts/m)*m),P.pts=Math.max(S(P.pts-T,A),P.dts),P.pts=Math.round(P.pts/m)*m}var I=e.len+4*e.nbNalu+8;try{a=new Uint8Array(I)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:I,reason:"fail allocating video mdat "+I})}var M=new DataView(a.buffer);M.setUint32(0,I),a.set(f.default.types.mdat,4);for(var N=0;N<E;N++){for(var x=g[N],U=x.units.units,F=0,B=void 0,G=0,j=U.length;G<j;G++){var H=U[G],W=H.data,V=H.data.byteLength;M.setUint32(p,V),p+=4,a.set(W,p),p+=V,F+=4+V}if(C)B=Math.max(0,i*Math.round((x.pts-x.dts)/(m*i)));else{if(N<E-1)i=g[N+1].dts-x.dts;else{var K=this.config,q=x.dts-g[N>0?N-1:N].dts;if(K.stretchShortVideoTrack){var Y=K.maxBufferHole,X=K.maxSeekHole,z=Math.floor(Math.min(Y,X)*_),Q=(r?s+r*_:this.nextAudioPts)-x.pts;Q>z?(i=Q-q,i<0&&(i=q),c.logger.log("It is approximately "+Q/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=q}else i=q}i/=m,B=Math.round((x.pts-x.dts)/m)}y.push({size:F,duration:i,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:x.key?2:1,isNonSync:x.key?0:1}})}this.nextAvcDts=v+i*m;var Z=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,y.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var J=y[0].flags;J.dependsOn=2,J.isNonSync=0}e.samples=y,o=f.default.moof(e.sequenceNumber++,l/m,e),e.samples=[];var $={id:this.id,level:this.level,sn:this.sn,data1:o,data2:a,startPTS:s/_,endPTS:(d+m*i)/_,startDTS:l/_,endDTS:this.nextAvcDts/_,type:"video",nb:y.length,dropped:Z};return this.observer.trigger(u.default.FRAG_PARSING_DATA,$),$}},{key:"remuxAudio",value:function(e,t,n,r){var i,a,o,l,d,v,p,_,m,g,y,E,S,T,b,R,A=this.PES_TIMESCALE,D=e.timescale,k=A/D,w=e.timescale*(e.isAAC?1024:1152)/e.audiosamplerate,O=w*k,C=this._PTSNormalize,L=this._initDTS,P=!e.isAAC&&this.typeSupported.mpeg,I=P?0:8,M=[],N=[];if(e.samples.sort(function(e,t){return e.pts-t.pts}),N=e.samples,R=this.nextAudioPts,n|=N.length&&R&&(Math.abs(t-R/A)<.1||Math.abs(N[0].pts-R-this._initDTS)<20*O),n||(R=t*A),r&&e.isAAC)for(var x=0,U=R;x<N.length;){var F=N[x],B=C(F.pts-L,R),G=B-U;if(G<=-O)c.logger.warn("Dropping 1 audio frame @ "+Math.round(U/90)/1e3+"s due to "+Math.round(Math.abs(G/90))+" ms overlap."),N.splice(x,1),e.len-=F.unit.length;else if(G>=O&&U){var j=Math.round(G/O);c.logger.warn("Injecting "+j+" audio frame @ "+Math.round(U/90)/1e3+"s due to "+Math.round(G/90)+" ms gap.");for(var H=0;H<j;H++)b=U+L,b=Math.max(b,L),T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),T=F.unit.subarray()),N.splice(x,0,{unit:T,pts:b,dts:b}),e.len+=T.length,U+=O,x+=1;F.pts=F.dts=U+L,U+=O,x+=1}else Math.abs(G),U+=O,F.pts=F.dts=0===x?L+R:N[x-1].pts+O,x+=1}for(var W=0,V=N.length;W<V;W++){if(a=N[W],l=a.unit,g=a.pts-L,y=a.dts-L,void 0!==m)E=C(g,m),S=C(y,m),o.duration=Math.round((S-m)/k);else{E=C(g,R),S=C(y,R);var K=Math.round(1e3*(E-R)/A),q=0;if(n&&e.isAAC&&K){if(K>0)q=Math.round((E-R)/O),c.logger.log(K+" ms hole between AAC samples detected,filling it"),q>0&&(T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(T=l.subarray()),e.len+=q*T.length);else if(K<-12){c.logger.log(-K+" ms overlapping between AAC samples detected, drop frame"),e.len-=l.byteLength;continue}E=S=R}if(p=Math.max(0,E),_=Math.max(0,S),!(e.len>0))return;var Y=P?e.len:e.len+8;try{d=new Uint8Array(Y)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Y,reason:"fail allocating audio mdat "+Y})}P||(i=new DataView(d.buffer),i.setUint32(0,Y),d.set(f.default.types.mdat,4));for(var X=0;X<q;X++)b=E-(q-X)*O,T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(c.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),T=l.subarray()),d.set(T,I),I+=T.byteLength,o={size:T.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o)}d.set(l,I);var z=l.byteLength;I+=z,o={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(o),m=S}var Q=0,Z=M.length;if(Z>=2&&(Q=M[Z-2].duration,o.duration=Q),Z){this.nextAudioPts=E+k*Q,e.len=0,e.samples=M,v=P?new Uint8Array:f.default.moof(e.sequenceNumber++,_/k,e),e.samples=[];var J={id:this.id,level:this.level,sn:this.sn,data1:v,data2:d,startPTS:p/A,endPTS:this.nextAudioPts/A,startDTS:_/A,endDTS:(S+k*Q)/A,type:"audio",nb:Z};return this.observer.trigger(u.default.FRAG_PARSING_DATA,J),J}return null}},{key:"remuxEmptyAudio",value:function(e,t,n,r){var i=this.PES_TIMESCALE,a=e.timescale?e.timescale:e.audiosamplerate,o=i/a,l=this.nextAudioPts,u=(void 0!==l?l:r.startDTS*i)+this._initDTS,d=r.endDTS*i+this._initDTS,f=1024,h=o*f,v=Math.ceil((d-u)/h),p=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(c.logger.warn("remux empty Audio"),!p)return void c.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var _=[],m=0;m<v;m++){var g=u+m*h;_.push({unit:p,pts:g,dts:g}),e.len+=p.length}e.samples=_,this.remuxAudio(e,t,n)}},{key:"remuxID3",value:function(e,t){var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE,n.dts=(n.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var n,r=e.samples.length;if(r){for(var i=0;i<r;i++)n=e.samples[i],n.pts=(n.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}},{key:"passthrough",get:function(){return!1}}]),e}();n.default=v},{26:26,28:28,29:29,37:37,45:45}],39:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(28),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,n){r(this,e),this.observer=t,this.id=n,this.ISGenerated=!1}return i(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,i,a){var s=this.observer;if(!this.ISGenerated){var l={},u={id:this.id,tracks:l,unique:!0},c=t,d=c.codec;d&&(u.tracks.video={container:c.container,codec:d,metadata:{width:c.width,height:c.height}}),c=e,d=c.codec,d&&(u.tracks.audio={container:c.container,codec:d,metadata:{channelCount:c.channelCount}}),this.ISGenerated=!0,s.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,u)}s.trigger(o.default.FRAG_PARSING_DATA,{id:this.id,data1:a,startPTS:i,startDTS:i,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();n.default=s},{28:28}],40:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){r(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}return i(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=a.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,n={};for(o.lastIndex=0;null!==(t=o.exec(e));){var r=t[2],i='"';0===r.indexOf(i)&&r.lastIndexOf(i)===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n}}]),e}();n.default=s},{}],41:[function(e,t,n){"use strict";var r={search:function(e,t){for(var n=0,r=e.length-1,i=null,a=null;n<=r;){i=(n+r)/2|0,a=e[i];var o=t(a);if(o>0)n=i+1;else{if(!(o<0))return a;r=i-1}}return null}};t.exports=r},{}],42:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(e){var t=e;return a.hasOwnProperty(e)&&(t=a[e]),String.fromCharCode(t)},s=15,l=32,u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],v={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},p=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},_=function(){function e(t,n,i,a,o){r(this,e),this.foreground=t||"white",this.underline=n||!1,this.italics=i||!1,this.background=a||"black",this.flash=o||!1}return i(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),m=function(){function e(t,n,i,a,o,s){r(this,e),this.uchar=t||" ",this.penState=new _(n,i,a,o,s)}return i(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),g=function(){function e(){r(this,e),this.chars=[];for(var t=0;t<l;t++)this.chars.push(new m);this.pos=0,this.currPenState=new _}return i(e,[{key:"equals",value:function(e){for(var t=!0,n=0;n<l;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<l;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<l;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(v.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(v.log("ERROR","Too large cursor position "+this.pos),this.pos=l)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=o(e);if(this.pos>=l)return void v.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<l;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,n=0;n<l;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),y=function(){function e(){r(this,e),this.rows=[];for(var t=0;t<s;t++)this.rows.push(new g);this.currRow=s-1,this.nrRollUpRows=null,this.reset()}return i(e,[{key:"reset",value:function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1}},{key:"equals",value:function(e){for(var t=!0,n=0;n<s;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){v.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e,t){v.log("INFO","pacData = "+JSON.stringify(e));var n=e.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==n){for(var r=0;r<s;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=t.rows[i].cueStartTime;if(a&&a<v.time)for(r=0;r<this.nrRollUpRows;r++)this.rows[n-this.nrRollUpRows+r+1].copy(t.rows[i+r])}this.currRow=n;var o=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,u=Math.max(l-1,0);o.setCursor(e.indent),e.color=o.chars[u].penState.foreground}var c={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(c)}},{key:"setBkgData",value:function(e){v.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void v.log("DEBUG","roll_up but nrRollUpRows not set yet");v.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),v.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<s;i++){var a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),E=function(){function e(t,n){r(this,e),this.chNr=t,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new y,this.nonDisplayedMemory=new y,this.lastOutputScreen=new y,this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return i(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e,this.lastOutputScreen)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,v.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";v.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(v.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){v.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){v.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){v.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){v.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){v.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){v.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){v.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){v.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){v.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){v.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){v.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(v.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,v.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){v.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}v.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=v.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),S=function(){function e(t,n,i){r(this,e),this.field=t||1,this.outputs=[n,i],this.channels=[new E(1,n),new E(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return i(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var n,r,i,a=!1;this.lastTime=e,v.setTime(e);for(var o=0;o<t.length;o+=2)if(r=127&t[o],i=127&t[o+1],0!==r||0!==i){if(v.log("DATA","["+p([t[o],t[o+1]])+"] -> ("+p([r,i])+")"),n=this.parseCmd(r,i),n||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(a=this.parseChars(r,i)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(a)}else v.log("WARNING","No channel found yet. TEXT-MODE?");n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,v.log("WARNING","Couldn't parse cleaned data "+p([r,i])+" orig: "+p([t[o],t[o+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var n=null,r=(20===e||28===e)&&32<=t&&t<=47,i=(23===e||31===e)&&33<=t&&t<=35;if(!r&&!i)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,v.log("DEBUG","Repeated command ("+p([e,t])+") is dropped"),!0;n=20===e||23===e?1:2;var a=this.channels[n-1];return 20===e||28===e?32===t?a.ccRCL():33===t?a.ccBS():34===t?a.ccAOF():35===t?a.ccAON():36===t?a.ccDER():37===t?a.ccRU(2):38===t?a.ccRU(3):39===t?a.ccRU(4):40===t?a.ccFON():41===t?a.ccRDC():42===t?a.ccTR():43===t?a.ccRTD():44===t?a.ccEDM():45===t?a.ccCR():46===t?a.ccENM():47===t&&a.ccEOC():a.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"parseMidrow",value:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return v.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[n-1].ccMIDROW(t),v.log("DEBUG","MIDROW ("+p([e,t])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var n=null,r=null,i=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,a=(16===e||24===e)&&64<=t&&t<=95;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;n=e<=23?1:2,r=64<=t&&t<=95?1===n?u[e]:d[e]:1===n?c[e]:f[e];var o=this.interpretPAC(r,t);return this.channels[n-1].setPAC(o),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0}},{key:"interpretPAC",value:function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}},{key:"parseChars",value:function(e,t){var n=null,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),17<=i&&i<=19){var a=t;a=17===i?t+80:18===i?t+112:t+144,v.log("INFO","Special char '"+o(a)+"' in channel "+n),r=[a]}else 32<=e&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=p(r);v.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r}},{key:"parseBackgroundAttributes",value:function(e,t){var n,r,i,a,o=(16===e||24===e)&&32<=t&&t<=47,s=(23===e||31===e)&&45<=t&&t<=47;return!(!o&&!s)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=h[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,a=this.channels[i-1],a.setBkgData(n),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();n.default=S},{}],43:[function(e,t,n){"use strict";var r={newCue:function(e,t,n,r){for(var i,a,o,s,l,u=window.VTTCue||window.TextTrackCue,c=0;c<r.rows.length;c++)if(i=r.rows[c],o=!0,s=0,l="",!i.isEmpty()){for(var d=0;d<i.chars.length;d++)i.chars[d].uchar.match(/\s/)&&o?s++:(l+=i.chars[d].uchar,o=!1);i.cueStartTime=t,a=new u(t,n,l.trim()),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?a.line=c+1:a.line=c>7?c-2:c+1,a.align="left",a.position=Math.max(0,Math.min(100,100*(s/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(a)}}};t.exports=r},{}],44:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return i(e,[{key:"sample",value:function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();n.default=a},{}],45:[function(e,t,n){"use strict";function r(){}function i(e,t){return t="["+e+"] > "+t}function a(e){var t=self.console[e];return t?function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];r[0]&&(r[0]=i(e,r[0])),t.apply(self.console,r)}:r}function o(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){u[t]=e[t]?e[t].bind(e):a(t)})}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l={trace:r,debug:r,log:r,warn:r,info:r,error:r},u=l;n.enableLogs=function(e){if(!0===e||"object"===(void 0===e?"undefined":s(e))){o(e,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},n.logger=u},{}],46:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e)}return i(e,null,[{key:"toString",value:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}}]),e}();n.default=a},{}],47:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e(45),o=function(){function e(t){r(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return i(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var n=this.stats;n.tfirst=0,n.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(performance.now(),r.trequest)),4===n){var s=t.status;if(s>=200&&s<300){r.tload=Math.max(r.tfirst,performance.now());var l=void 0,u=void 0;"arraybuffer"===i.responseType?(l=t.response,u=l.byteLength):(l=t.responseText,u=l.length),r.loaded=r.total=u;var c={url:t.responseURL,data:l};this.callbacks.onSuccess(c,r,i)}else r.retry>=o.maxRetry||s>=400&&s<499?(a.logger.error(s+" while loading "+i.url),this.callbacks.onError({code:s,text:t.statusText},i)):(a.logger.warn(s+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)}},{key:"loadtimeout",value:function(){a.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var n=this.callbacks.onProgress;n&&n(t,this.context,null)}}]),e}();n.default=o},{45:45}]},{},[33])(33)})},function(e,t,n){(function(e,r){var i;!function(a){function o(e){throw RangeError(N[e])}function s(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function l(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(M,"."),r+s(e.split("."),t).join(".")}function u(e){for(var t,n,r=[],i=0,a=e.length;i<a;)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<a?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function c(e){return s(e,function(e){var t="";return e>65535&&(e-=65536,t+=F(e>>>10&1023|55296),e=56320|1023&e),t+=F(e)}).join("")}function d(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:R}function f(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function h(e,t,n){var r=0;for(e=n?U(e/w):e>>1,e+=U(e/t);e>x*D>>1;r+=R)e=U(e/x);return U(r+(x+1)*e/(e+k))}function v(e){var t,n,r,i,a,s,l,u,f,v,p=[],_=e.length,m=0,g=C,y=O;for(n=e.lastIndexOf(L),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&o("not-basic"),p.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<_;){for(a=m,s=1,l=R;i>=_&&o("invalid-input"),u=d(e.charCodeAt(i++)),(u>=R||u>U((b-m)/s))&&o("overflow"),m+=u*s,f=l<=y?A:l>=y+D?D:l-y,!(u<f);l+=R)v=R-f,s>U(b/v)&&o("overflow"),s*=v;t=p.length+1,y=h(m-a,t,0==a),U(m/t)>b-g&&o("overflow"),g+=U(m/t),m%=t,p.splice(m++,0,g)}return c(p)}function p(e){var t,n,r,i,a,s,l,c,d,v,p,_,m,g,y,E=[];for(e=u(e),_=e.length,t=C,n=0,a=O,s=0;s<_;++s)(p=e[s])<128&&E.push(F(p));for(r=i=E.length,i&&E.push(L);r<_;){for(l=b,s=0;s<_;++s)(p=e[s])>=t&&p<l&&(l=p);for(m=r+1,l-t>U((b-n)/m)&&o("overflow"),n+=(l-t)*m,t=l,s=0;s<_;++s)if(p=e[s],p<t&&++n>b&&o("overflow"),p==t){for(c=n,d=R;v=d<=a?A:d>=a+D?D:d-a,!(c<v);d+=R)y=c-v,g=R-v,E.push(F(f(v+y%g,0))),c=U(y/g);E.push(F(f(c,0))),a=h(n,m,r==i),n=0,++r}++n,++t}return E.join("")}function _(e){return l(e,function(e){return P.test(e)?v(e.slice(4).toLowerCase()):e})}function m(e){return l(e,function(e){return I.test(e)?"xn--"+p(e):e})}var g="object"==typeof t&&t&&!t.nodeType&&t,y="object"==typeof e&&e&&!e.nodeType&&e,E="object"==typeof r&&r;E.global!==E&&E.window!==E&&E.self!==E||(a=E);var S,T,b=2147483647,R=36,A=1,D=26,k=38,w=700,O=72,C=128,L="-",P=/^xn--/,I=/[^\x20-\x7E]/,M=/[\x2E\u3002\uFF0E\uFF61]/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=R-A,U=Math.floor,F=String.fromCharCode;if(S={version:"1.3.2",ucs2:{decode:u,encode:c},decode:v,encode:p,toASCII:m,toUnicode:_},0)if(g&&y)if(e.exports==g)y.exports=S;else for(T in S)S.hasOwnProperty(T)&&(g[T]=S[T]);else a.punycode=S;else void 0!==(i=function(){return S}.call(t,n,t,e))&&(e.exports=i)}(this)}).call(t,n(332)(e),n(45))},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,a){t=t||"&",n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var l=1e3;a&&"number"==typeof a.maxKeys&&(l=a.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var d,f,h,v,p=e[c].replace(s,"%20"),_=p.indexOf(n);_>=0?(d=p.substr(0,_),f=p.substr(_+1)):(d=p,f=""),h=decodeURIComponent(d),v=decodeURIComponent(f),r(o,h)?i(o[h])?o[h].push(v):o[h]=[o[h],v]:o[h]=v}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(o(e),function(o){var s=encodeURIComponent(i(o))+n;return a(e[o])?r(e[o],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[o]))}).join(t):s?encodeURIComponent(i(s))+n+encodeURIComponent(i(e)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";t.decode=t.parse=n(323),t.encode=t.stringify=n(324)},function(e,t,n){var r;!function(i,a){"use strict";var o="",s="?",l="function",u="undefined",c="object",d="string",f="model",h="name",v="type",p="vendor",_="version",m="architecture",g="console",y="mobile",E="tablet",S="smarttv",T="wearable",b={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===d?e.replace(/[^\d\.]/g,"").split(".")[0]:a},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},R={rgx:function(){for(var e,t,n,r,i,o,s,d=0,f=arguments;d<f.length&&!o;){var h=f[d],v=f[d+1];if(typeof e===u){e={};for(r in v)v.hasOwnProperty(r)&&(i=v[r],typeof i===c?e[i[0]]=a:e[i]=a)}for(t=n=0;t<h.length&&!o;)if(o=h[t++].exec(this.getUA()))for(r=0;r<v.length;r++)s=o[++n],i=v[r],typeof i===c&&i.length>0?2==i.length?typeof i[1]==l?e[i[0]]=i[1].call(this,s):e[i[0]]=i[1]:3==i.length?typeof i[1]!==l||i[1].exec&&i[1].test?e[i[0]]=s?s.replace(i[1],i[2]):a:e[i[0]]=s?i[1].call(this,s,i[2]):a:4==i.length&&(e[i[0]]=s?i[3].call(this,s.replace(i[1],i[2])):a):e[i]=s||a;d+=2}return e},str:function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(b.has(t[n][r],e))return n===s?a:n}else if(b.has(t[n],e))return n===s?a:n;return e}},A={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},D={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[h,_],[/(opios)[\/\s]+([\w\.]+)/i],[[h,"Opera Mini"],_],[/\s(opr)\/([\w\.]+)/i],[[h,"Opera"],_],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[h,_],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[h,"IE"],_],[/(edge)\/((\d+)?[\w\.]+)/i],[h,_],[/(yabrowser)\/([\w\.]+)/i],[[h,"Yandex"],_],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],_],[/(micromessenger)\/([\w\.]+)/i],[[h,"WeChat"],_],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[_,[h,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[h,/(.+)/,"$1 WebView"],_],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[_,[h,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[h,_],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[h,"UCBrowser"],_],[/(dolfin)\/([\w\.]+)/i],[[h,"Dolphin"],_],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[h,"Chrome"],_],[/;fbav\/([\w\.]+);/i],[_,[h,"Facebook"]],[/fxios\/([\w\.-]+)/i],[_,[h,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[_,[h,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[_,h],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[h,[_,R.str,A.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[h,_],[/(navigator|netscape)\/([\w\.-]+)/i],[[h,"Netscape"],_],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[h,_]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,b.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",b.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,b.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[f,p,[v,E]],[/applecoremedia\/[\w\.]+ \((ipad)/],[f,[p,"Apple"],[v,E]],[/(apple\s{0,1}tv)/i],[[f,"Apple TV"],[p,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[p,f,[v,E]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[f,[p,"Amazon"],[v,E]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[f,R.str,A.device.amazon.model],[p,"Amazon"],[v,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[f,p,[v,y]],[/\((ip[honed|\s\w*]+);/i],[f,[p,"Apple"],[v,y]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[p,f,[v,y]],[/\(bb10;\s(\w+)/i],[f,[p,"BlackBerry"],[v,y]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[f,[p,"Asus"],[v,E]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[p,"Sony"],[f,"Xperia Tablet"],[v,E]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[p,"Sony"],[f,"Xperia Phone"],[v,y]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[p,f,[v,g]],[/android.+;\s(shield)\sbuild/i],[f,[p,"Nvidia"],[v,g]],[/(playstation\s[34portablevi]+)/i],[f,[p,"Sony"],[v,g]],[/(sprint\s(\w+))/i],[[p,R.str,A.device.sprint.vendor],[f,R.str,A.device.sprint.model],[v,y]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[p,f,[v,E]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[p,[f,/_/g," "],[v,y]],[/(nexus\s9)/i],[f,[p,"HTC"],[v,E]],[/(nexus\s6p)/i],[f,[p,"Huawei"],[v,y]],[/(microsoft);\s(lumia[\s\w]+)/i],[p,f,[v,y]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[f,[p,"Microsoft"],[v,g]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[p,"Microsoft"],[v,y]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[f,[p,"Motorola"],[v,y]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[f,[p,"Motorola"],[v,E]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[p,b.trim],[f,b.trim],[v,S]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[p,"Samsung"],[v,S]],[/\(dtv[\);].+(aquos)/i],[f,[p,"Sharp"],[v,S]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[p,"Samsung"],f,[v,E]],[/smart-tv.+(samsung)/i],[p,[v,S],f],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[p,"Samsung"],f,[v,y]],[/sie-(\w+)*/i],[f,[p,"Siemens"],[v,y]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[p,"Nokia"],f,[v,y]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[f,[p,"Acer"],[v,E]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[p,"LG"],f,[v,E]],[/(lg) netcast\.tv/i],[p,f,[v,S]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[f,[p,"LG"],[v,y]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[f,[p,"Lenovo"],[v,E]],[/linux;.+((jolla));/i],[p,f,[v,y]],[/((pebble))app\/[\d\.]+\s/i],[p,f,[v,T]],[/android.+;\s(glass)\s\d/i],[f,[p,"Google"],[v,T]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[f,/_/g," "],[p,"Xiaomi"],[v,y]],[/android.+a000(1)\s+build/i],[f,[p,"OnePlus"],[v,y]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[v,b.lowerize],p,f]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[_,[h,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[h,_],[/rv\:([\w\.]+).*(gecko)/i],[_,h]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[h,_],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[h,[_,R.str,A.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[h,"Windows"],[_,R.str,A.os.windows.version]],[/\((bb)(10);/i],[[h,"BlackBerry"],_],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[h,_],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[h,"Symbian"],_],[/\((series40);/i],[h],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[h,"Firefox OS"],_],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[h,_],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[h,"Chromium OS"],_],[/(sunos)\s?([\w\.]+\d)*/i],[[h,"Solaris"],_],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[h,_],[/(haiku)\s(\w+)/i],[h,_],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[h,"iOS"],[_,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[h,"Mac OS"],[_,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[h,_]]},k=function(e,t){if(!(this instanceof k))return new k(e,t).getResult();var n=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:o),r=t?b.extend(D,t):D;return this.getBrowser=function(){var e=R.rgx.apply(this,r.browser);return e.major=b.major(e.version),e},this.getCPU=function(){return R.rgx.apply(this,r.cpu)},this.getDevice=function(){return R.rgx.apply(this,r.device)},this.getEngine=function(){return R.rgx.apply(this,r.engine)},this.getOS=function(){return R.rgx.apply(this,r.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};k.VERSION="0.7.12",k.BROWSER={NAME:h,MAJOR:"major",VERSION:_},k.CPU={ARCHITECTURE:m},k.DEVICE={MODEL:f,VENDOR:p,TYPE:v,CONSOLE:g,MOBILE:y,SMARTTV:S,TABLET:E,WEARABLE:T,EMBEDDED:"embedded"},k.ENGINE={NAME:h,VERSION:_},k.OS={NAME:h,VERSION:_},typeof t!==u?(typeof e!==u&&e.exports&&(t=e.exports=k),t.UAParser=k):"function"===l&&n(331)?(r=function(){return k}.call(t,n,t,e))!==a&&(e.exports=r):i.UAParser=k;var w=i.jQuery||i.Zepto;if(typeof w!==u){var O=new k;w.ua=O.getResult(),w.ua.get=function(){return O.getUA()},w.ua.set=function(e){O.setUA(e);var t=O.getResult();for(var n in t)w.ua[n]=t[n]}}}("object"==typeof window?window:this)},function(e,t,n){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&u.isObject(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}function a(e){return u.isString(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)}function o(e,t){return i(e,!1,!0).resolve(t)}function s(e,t){return e?i(e,!1,!0).resolveObject(t):t}var l=n(322),u=n(328);t.parse=i,t.resolve=o,t.resolveObject=s,t.format=a,t.Url=r;var c=/^([a-z0-9.+-]+:)/i,d=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["<",">",'"',"`"," ","\r","\n","\t"],v=["{","}","|","\\","^","`"].concat(h),p=["'"].concat(v),_=["%","/","?",";","#"].concat(p),m=["/","?","#"],g=/^[+a-z0-9A-Z_-]{0,63}$/,y=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,E={javascript:!0,"javascript:":!0},S={javascript:!0,"javascript:":!0},T={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=n(325);r.prototype.parse=function(e,t,n){if(!u.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),i=-1!==r&&r<e.indexOf("#")?"?":"#",a=e.split(i),o=/\\/g;a[0]=a[0].replace(o,"/"),e=a.join(i);var s=e;if(s=s.trim(),!n&&1===e.split("#").length){var d=f.exec(s);if(d)return this.path=s,this.href=s,this.pathname=d[1],d[2]?(this.search=d[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=c.exec(s);if(h){h=h[0];var v=h.toLowerCase();this.protocol=v,s=s.substr(h.length)}if(n||h||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var R="//"===s.substr(0,2);!R||h&&S[h]||(s=s.substr(2),this.slashes=!0)}if(!S[h]&&(R||h&&!T[h])){for(var A=-1,D=0;D<m.length;D++){var k=s.indexOf(m[D]);-1!==k&&(-1===A||k<A)&&(A=k)}var w,O;O=-1===A?s.lastIndexOf("@"):s.lastIndexOf("@",A),-1!==O&&(w=s.slice(0,O),s=s.slice(O+1),this.auth=decodeURIComponent(w)),A=-1;for(var D=0;D<_.length;D++){var k=s.indexOf(_[D]);-1!==k&&(-1===A||k<A)&&(A=k)}-1===A&&(A=s.length),this.host=s.slice(0,A),s=s.slice(A),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var L=this.hostname.split(/\./),D=0,P=L.length;D<P;D++){var I=L[D];if(I&&!I.match(g)){for(var M="",N=0,x=I.length;N<x;N++)I.charCodeAt(N)>127?M+="x":M+=I[N];if(!M.match(g)){var U=L.slice(0,D),F=L.slice(D+1),B=I.match(y);B&&(U.push(B[1]),F.unshift(B[2])),F.length&&(s="/"+F.join(".")+s),this.hostname=U.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=l.toASCII(this.hostname));var G=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+G,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!E[v])for(var D=0,P=p.length;D<P;D++){var H=p[D];if(-1!==s.indexOf(H)){var W=encodeURIComponent(H);W===H&&(W=escape(H)),s=s.split(H).join(W)}}var V=s.indexOf("#");-1!==V&&(this.hash=s.substr(V),s=s.slice(0,V));var K=s.indexOf("?");if(-1!==K?(this.search=s.substr(K),this.query=s.substr(K+1),t&&(this.query=b.parse(this.query)),s=s.slice(0,K)):t&&(this.search="",this.query={}),s&&(this.pathname=s),T[v]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var G=this.pathname||"",q=this.search||"";this.path=G+q}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,a="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&u.isObject(this.query)&&Object.keys(this.query).length&&(a=b.stringify(this.query));var o=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||T[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),o=o.replace("#","%23"),t+i+n+o+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(u.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,i=Object.keys(this),a=0;a<i.length;a++){var o=i[a];n[o]=this[o]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),l=0;l<s.length;l++){var c=s[l];"protocol"!==c&&(n[c]=e[c])}return T[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!T[e.protocol]){for(var d=Object.keys(e),f=0;f<d.length;f++){var h=d[f];n[h]=e[h]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||S[e.protocol])n.pathname=e.pathname;else{for(var v=(e.pathname||"").split("/");v.length&&!(e.host=v.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==v[0]&&v.unshift(""),v.length<2&&v.unshift(""),n.pathname=v.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var p=n.pathname||"",_=n.search||"";n.path=p+_}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=g||m||n.host&&e.pathname,E=y,b=n.pathname&&n.pathname.split("/")||[],v=e.pathname&&e.pathname.split("/")||[],R=n.protocol&&!T[n.protocol];if(R&&(n.hostname="",n.port=null,n.host&&(""===b[0]?b[0]=n.host:b.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===v[0]?v[0]=e.host:v.unshift(e.host)),e.host=null),y=y&&(""===v[0]||""===b[0])),g)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,b=v;else if(v.length)b||(b=[]),b.pop(),b=b.concat(v),n.search=e.search,n.query=e.query;else if(!u.isNullOrUndefined(e.search)){if(R){n.hostname=n.host=b.shift();var A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");A&&(n.auth=A.shift(),n.host=n.hostname=A.shift())}return n.search=e.search,n.query=e.query,u.isNull(n.pathname)&&u.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!b.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var D=b.slice(-1)[0],k=(n.host||e.host||b.length>1)&&("."===D||".."===D)||""===D,w=0,O=b.length;O>=0;O--)D=b[O],"."===D?b.splice(O,1):".."===D?(b.splice(O,1),w++):w&&(b.splice(O,1),w--);if(!y&&!E)for(;w--;w)b.unshift("..");!y||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),k&&"/"!==b.join("/").substr(-1)&&b.push("");var C=""===b[0]||b[0]&&"/"===b[0].charAt(0);if(R){n.hostname=n.host=C?"":b.length?b.shift():"";var A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");A&&(n.auth=A.shift(),n.host=n.hostname=A.shift())}return y=y||n.host&&b.length,y&&!C&&b.unshift(""),b.length?n.pathname=b.join("/"):(n.pathname=null,n.path=null),u.isNull(n.pathname)&&u.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=d.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){function r(e,t,n){var r=t&&n||0,i=t||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:l,d=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:c+1,h=d-u+(f-c)/1e4;if(h<0&&void 0===e.clockseq&&(o=o+1&16383),(h<0||d>u)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=d,c=f,l=o,d+=122192928e5;var v=(1e4*(268435455&d)+f)%4294967296;i[r++]=v>>>24&255,i[r++]=v>>>16&255,i[r++]=v>>>8&255,i[r++]=255&v;var p=d/4294967296*1e4&268435455;i[r++]=p>>>8&255,i[r++]=255&p,i[r++]=p>>>24&15|16,i[r++]=p>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var _=e.node||s,m=0;m<6;++m)i[r+m]=_[m];return t||a(i)}var i=n(132),a=n(131),o=i(),s=[1|o[0],o[1],o[2],o[3],o[4],o[5]],l=16383&(o[6]<<8|o[7]),u=0,c=0;e.exports=r},function(e,t,n){function r(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[r+s]=o[s];return t||a(o)}var i=n(132),a=n(131);e.exports=r},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}]);